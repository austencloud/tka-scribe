[pytest]
# Core configuration with PyQt6 crash protection
addopts =
    -v
    --tb=short
    --disable-warnings
    --maxfail=10

# Python path - comprehensive setup
pythonpath = 
    .
    src
    src/desktop/modern/src
    src/desktop/modern
    src/desktop/legacy/src  
    src/desktop/legacy
    launcher

# Test discovery - EXCLUDE PyQt6 tests that crash Python
testpaths =
    test_basic_setup.py
    src/desktop/modern/tests/unit/core
    src/desktop/modern/tests/unit/application/services/core
    src/desktop/modern/tests/unit/test_refactored_di_container.py

# CRITICAL: Ignore ALL tests that import PyQt6 (they crash Python)
ignore_paths =
    src/desktop/modern/tests/integration/workflows/
    src/desktop/modern/tests/legacy/
    src/desktop/legacy/tests/
    launcher/tests/
    src/desktop/modern/tests/presentation/
    src/desktop/modern/tests/manual_testing/

python_files = test_*.py *_test.py
python_functions = test_*
python_classes = Test*

# Test markers for organization
markers =
    unit: Unit tests (safe, no GUI)
    integration: Integration tests  
    modern: Modern codebase
    legacy: Legacy codebase (BROKEN - PyQt6 crashes)
    launcher: Launcher tests (BROKEN - PyQt6 crashes)
    broken: Tests with known issues
    slow: Slow tests
    gui: GUI tests (BROKEN - PyQt6 crashes)
    safe: Tests that don't use PyQt6

minversion = 6.0

# Filter warnings and crashes
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning
    ignore::ImportWarning
    ignore::pytest.PytestDeprecationWarning

asyncio_mode = auto
asyncio_default_fixture_loop_scope = function
