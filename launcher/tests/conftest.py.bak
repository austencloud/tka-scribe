"""
Launcher Tests Configuration
==========================

This conftest.py ensures that all tests in the launcher
can import modules correctly.
"""

import sys
import os
from pathlib import Path

# Add the launcher directory to Python path
current_dir = Path(__file__).parent
launcher_root = current_dir.parent  # launcher/
tka_root = launcher_root.parent  # TKA/

# Add essential paths
paths_to_add = [
    str(launcher_root),  # For launcher modules
    str(tka_root),  # For project_root
]

for path in paths_to_add:
    if path not in sys.path:
        sys.path.insert(0, path)

# Set up project root
try:
    from project_root import ensure_project_setup
    ensure_project_setup()
except ImportError:
    print(f"Warning: Could not import project_root from {tka_root}")

import pytest

# Skip PyQt6 tests if PyQt6 is not available
pytest_plugins = ["pytest_qt"]

def pytest_configure(config):
    """Configure pytest for launcher tests."""
    # Try to import PyQt6 to see if it's available
    try:
        import PyQt6
        config.qt_api = "pyqt6"
    except ImportError:
        # Mark all tests as skipped if PyQt6 is not available
        config.addinivalue_line("markers", "skip_if_no_pyqt6: skip if PyQt6 not available")

@pytest.fixture(scope="session")
def launcher_root_path():
    """Provide the launcher root path."""
    return launcher_root

@pytest.fixture(autouse=True)
def skip_if_no_pyqt6(request):
    """Skip tests if PyQt6 is not available."""
    try:
        import PyQt6
    except ImportError:
        pytest.skip("PyQt6 not available")
