import { GridMode, MotionType } from "/src/lib/domain/enums.ts";
import { ArrowAdjustmentCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowAdjustmentCalculator.ts";
import { ArrowLocationCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowLocationCalculator.ts";
import { ArrowRotationCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowRotationCalculator.ts";
import { DashLocationCalculator } from "/src/lib/services/positioning/arrows/calculation/DashLocationCalculator.ts";
import { ArrowCoordinateSystemService } from "/src/lib/services/positioning/arrows/coordinate_system/ArrowCoordinateSystemService.ts";
import { ArrowPositionCalculator } from "/src/lib/services/positioning/arrows/orchestration/ArrowPositionCalculator.ts";
import { DefaultPlacementService } from "/src/lib/services/positioning/arrows/placement/DefaultPlacementService.ts";
import { SpecialPlacementService } from "/src/lib/services/positioning/arrows/placement/SpecialPlacementService.ts";
import {
  DirectionalTupleCalculator,
  DirectionalTupleProcessor,
  QuadrantIndexCalculator
} from "/src/lib/services/positioning/arrows/processors/DirectionalTupleProcessor.ts";
export class PositioningServiceFactory {
  /**
   * Factory for creating the complete positioning service ecosystem.
   *
   * Creates all services with proper dependency injection and ensures
   * they are wired together correctly for optimal positioning accuracy.
   */
  static instance;
  // Singleton services (shared across all arrows)
  dashLocationCalculator;
  coordinateSystemService;
  specialPlacementService;
  defaultPlacementService;
  directionalTupleProcessor;
  /**
   * Get the singleton instance of the positioning service factory.
   */
  static getInstance() {
    if (!PositioningServiceFactory.instance) {
      PositioningServiceFactory.instance = new PositioningServiceFactory();
    }
    return PositioningServiceFactory.instance;
  }
  createLocationCalculator() {
    if (!this.dashLocationCalculator) {
      this.dashLocationCalculator = this.createDashLocationCalculator();
    }
    return new ArrowLocationCalculator(this.dashLocationCalculator);
  }
  createRotationCalculator() {
    return new ArrowRotationCalculator();
  }
  createAdjustmentCalculator() {
    if (!this.specialPlacementService) {
      this.specialPlacementService = new SpecialPlacementService();
    }
    if (!this.defaultPlacementService) {
      this.defaultPlacementService = new DefaultPlacementService();
    }
    if (!this.directionalTupleProcessor) {
      this.directionalTupleProcessor = this.createDirectionalTupleProcessor();
    }
    return new ArrowAdjustmentCalculator({
      specialPlacementService: this.specialPlacementService,
      defaultPlacementService: this.defaultPlacementService,
      tupleProcessor: this.directionalTupleProcessor
    });
  }
  createCoordinateSystemService() {
    if (!this.coordinateSystemService) {
      this.coordinateSystemService = new ArrowCoordinateSystemService();
    }
    return this.coordinateSystemService;
  }
  createDashLocationCalculator() {
    if (!this.dashLocationCalculator) {
      this.dashLocationCalculator = new DashLocationCalculator();
    }
    return this.dashLocationCalculator;
  }
  createDirectionalTupleProcessor() {
    if (!this.directionalTupleProcessor) {
      const directionalTupleCalculator = new DirectionalTupleCalculator();
      const quadrantIndexCalculator = new QuadrantIndexCalculator();
      this.directionalTupleProcessor = new DirectionalTupleProcessor(
        directionalTupleCalculator,
        quadrantIndexCalculator
      );
    }
    return this.directionalTupleProcessor;
  }
  createPositioningOrchestrator() {
    const locationCalculator = this.createLocationCalculator();
    const rotationCalculator = this.createRotationCalculator();
    const adjustmentCalculator = this.createAdjustmentCalculator();
    const coordinateSystemService = this.createCoordinateSystemService();
    return new ArrowPositionCalculator(
      locationCalculator,
      rotationCalculator,
      adjustmentCalculator,
      coordinateSystemService
    );
  }
  /**
   * Create a complete positioning pipeline for use in services.
   * Returns all the key services needed for positioning operations.
   */
  createPositioningPipeline() {
    return {
      locationCalculator: this.createLocationCalculator(),
      rotationCalculator: this.createRotationCalculator(),
      adjustmentCalculator: this.createAdjustmentCalculator(),
      coordinateSystemService: this.createCoordinateSystemService(),
      orchestrator: this.createPositioningOrchestrator()
    };
  }
  /**
   * Reset all singleton services (useful for testing).
   */
  resetServices() {
    this.dashLocationCalculator = void 0;
    this.coordinateSystemService = void 0;
    this.specialPlacementService = void 0;
    this.defaultPlacementService = void 0;
    this.directionalTupleProcessor = void 0;
  }
  /**
   * Pre-warm all services by creating them in advance.
   * Useful for ensuring consistent performance.
   */
  async preWarmServices() {
    console.log("Pre-warming positioning services...");
    this.createLocationCalculator();
    this.createRotationCalculator();
    this.createCoordinateSystemService();
    this.createDirectionalTupleProcessor();
    if (!this.defaultPlacementService) {
      this.defaultPlacementService = new DefaultPlacementService();
    }
    if (!this.defaultPlacementService.isLoaded()) {
      try {
        await this.defaultPlacementService.debugAvailableKeys(
          MotionType.PRO,
          GridMode.DIAMOND
        );
        console.log("✅ Positioning services pre-warmed successfully");
      } catch (error) {
        console.warn("⚠️ Some positioning services failed to pre-warm:", error);
      }
    }
  }
}
export function getPositioningServiceFactory() {
  return PositioningServiceFactory.getInstance();
}
export function createPositioningOrchestrator() {
  return getPositioningServiceFactory().createPositioningOrchestrator();
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL3Bvc2l0aW9uaW5nL1Bvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qKlxuICogUG9zaXRpb25pbmcgU2VydmljZSBGYWN0b3J5XG4gKlxuICogRmFjdG9yeSBmb3IgY3JlYXRpbmcgYW5kIHdpcmluZyB1cCBhbGwgcG9zaXRpb25pbmcgc2VydmljZXMgd2l0aCBwcm9wZXIgZGVwZW5kZW5jaWVzLlxuICogUHJvdmlkZXMgYSBjZW50cmFsaXplZCB3YXkgdG8gY3JlYXRlIHRoZSBjb21wbGV0ZSBwb3NpdGlvbmluZyBwaXBlbGluZS5cbiAqL1xuXG5pbXBvcnQgeyBHcmlkTW9kZSwgTW90aW9uVHlwZSB9IGZyb20gXCIkbGliL2RvbWFpbi9lbnVtc1wiO1xuaW1wb3J0IHR5cGUge1xuICBJQXJyb3dBZGp1c3RtZW50Q2FsY3VsYXRvcixcbiAgSUFycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UsXG4gIElBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvcixcbiAgSUFycm93UG9zaXRpb25pbmdPcmNoZXN0cmF0b3IsXG4gIElBcnJvd1JvdGF0aW9uQ2FsY3VsYXRvcixcbiAgSURpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IsXG4gIElQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5LFxufSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nXCI7XG5pbXBvcnQgeyBBcnJvd0FkanVzdG1lbnRDYWxjdWxhdG9yIH0gZnJvbSBcIiRzZXJ2aWNlcy9wb3NpdGlvbmluZy9hcnJvd3MvY2FsY3VsYXRpb24vQXJyb3dBZGp1c3RtZW50Q2FsY3VsYXRvclwiO1xuaW1wb3J0IHsgQXJyb3dMb2NhdGlvbkNhbGN1bGF0b3IgfSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9jYWxjdWxhdGlvbi9BcnJvd0xvY2F0aW9uQ2FsY3VsYXRvclwiO1xuaW1wb3J0IHsgQXJyb3dSb3RhdGlvbkNhbGN1bGF0b3IgfSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9jYWxjdWxhdGlvbi9BcnJvd1JvdGF0aW9uQ2FsY3VsYXRvclwiO1xuaW1wb3J0IHsgRGFzaExvY2F0aW9uQ2FsY3VsYXRvciB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL2NhbGN1bGF0aW9uL0Rhc2hMb2NhdGlvbkNhbGN1bGF0b3JcIjtcbmltcG9ydCB7IEFycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UgfSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9jb29yZGluYXRlX3N5c3RlbS9BcnJvd0Nvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlXCI7XG5pbXBvcnQgeyBBcnJvd1Bvc2l0aW9uQ2FsY3VsYXRvciB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL29yY2hlc3RyYXRpb24vQXJyb3dQb3NpdGlvbkNhbGN1bGF0b3JcIjtcbmltcG9ydCB7IERlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlIH0gZnJvbSBcIiRzZXJ2aWNlcy9wb3NpdGlvbmluZy9hcnJvd3MvcGxhY2VtZW50L0RlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlXCI7XG5pbXBvcnQgeyBTcGVjaWFsUGxhY2VtZW50U2VydmljZSB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL3BsYWNlbWVudC9TcGVjaWFsUGxhY2VtZW50U2VydmljZVwiO1xuaW1wb3J0IHtcbiAgRGlyZWN0aW9uYWxUdXBsZUNhbGN1bGF0b3IsXG4gIERpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IsXG4gIFF1YWRyYW50SW5kZXhDYWxjdWxhdG9yLFxufSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9wcm9jZXNzb3JzL0RpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3JcIjtcblxuZXhwb3J0IGNsYXNzIFBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkgaW1wbGVtZW50cyBJUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSB7XG4gIC8qKlxuICAgKiBGYWN0b3J5IGZvciBjcmVhdGluZyB0aGUgY29tcGxldGUgcG9zaXRpb25pbmcgc2VydmljZSBlY29zeXN0ZW0uXG4gICAqXG4gICAqIENyZWF0ZXMgYWxsIHNlcnZpY2VzIHdpdGggcHJvcGVyIGRlcGVuZGVuY3kgaW5qZWN0aW9uIGFuZCBlbnN1cmVzXG4gICAqIHRoZXkgYXJlIHdpcmVkIHRvZ2V0aGVyIGNvcnJlY3RseSBmb3Igb3B0aW1hbCBwb3NpdGlvbmluZyBhY2N1cmFjeS5cbiAgICovXG5cbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFBvc2l0aW9uaW5nU2VydmljZUZhY3Rvcnk7XG5cbiAgLy8gU2luZ2xldG9uIHNlcnZpY2VzIChzaGFyZWQgYWNyb3NzIGFsbCBhcnJvd3MpXG4gIHByaXZhdGUgZGFzaExvY2F0aW9uQ2FsY3VsYXRvcjogRGFzaExvY2F0aW9uQ2FsY3VsYXRvciB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBjb29yZGluYXRlU3lzdGVtU2VydmljZTogSUFycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgc3BlY2lhbFBsYWNlbWVudFNlcnZpY2U6IFNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGRlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlOiBEZWZhdWx0UGxhY2VtZW50U2VydmljZSB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBkaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yOiBJRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvciB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogR2V0IHRoZSBzaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhlIHBvc2l0aW9uaW5nIHNlcnZpY2UgZmFjdG9yeS5cbiAgICovXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5IHtcbiAgICBpZiAoIVBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkuaW5zdGFuY2UpIHtcbiAgICAgIFBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkuaW5zdGFuY2UgPSBuZXcgUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSgpO1xuICAgIH1cbiAgICByZXR1cm4gUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeS5pbnN0YW5jZTtcbiAgfVxuXG4gIGNyZWF0ZUxvY2F0aW9uQ2FsY3VsYXRvcigpOiBJQXJyb3dMb2NhdGlvbkNhbGN1bGF0b3Ige1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhcnJvdyBsb2NhdGlvbiBjYWxjdWxhdG9yIHdpdGggZGFzaCBsb2NhdGlvbiBzZXJ2aWNlIGRlcGVuZGVuY3kuXG4gICAgICovXG4gICAgaWYgKCF0aGlzLmRhc2hMb2NhdGlvbkNhbGN1bGF0b3IpIHtcbiAgICAgIHRoaXMuZGFzaExvY2F0aW9uQ2FsY3VsYXRvciA9IHRoaXMuY3JlYXRlRGFzaExvY2F0aW9uQ2FsY3VsYXRvcigpO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgQXJyb3dMb2NhdGlvbkNhbGN1bGF0b3IodGhpcy5kYXNoTG9jYXRpb25DYWxjdWxhdG9yKTtcbiAgfVxuXG4gIGNyZWF0ZVJvdGF0aW9uQ2FsY3VsYXRvcigpOiBJQXJyb3dSb3RhdGlvbkNhbGN1bGF0b3Ige1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhcnJvdyByb3RhdGlvbiBjYWxjdWxhdG9yIChubyBkZXBlbmRlbmNpZXMpLlxuICAgICAqL1xuICAgIHJldHVybiBuZXcgQXJyb3dSb3RhdGlvbkNhbGN1bGF0b3IoKTtcbiAgfVxuXG4gIGNyZWF0ZUFkanVzdG1lbnRDYWxjdWxhdG9yKCk6IElBcnJvd0FkanVzdG1lbnRDYWxjdWxhdG9yIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYXJyb3cgYWRqdXN0bWVudCBjYWxjdWxhdG9yIHdpdGggcGxhY2VtZW50IHNlcnZpY2VzIGFuZCB0dXBsZSBwcm9jZXNzb3IuXG4gICAgICogTm93IHVzZXMgY29uc29saWRhdGVkIHNlcnZpY2UgdGhhdCBjb21iaW5lcyBsb29rdXAgYW5kIGNhbGN1bGF0aW9uIGxvZ2ljLlxuICAgICAqL1xuICAgIGlmICghdGhpcy5zcGVjaWFsUGxhY2VtZW50U2VydmljZSkge1xuICAgICAgdGhpcy5zcGVjaWFsUGxhY2VtZW50U2VydmljZSA9IG5ldyBTcGVjaWFsUGxhY2VtZW50U2VydmljZSgpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZSkge1xuICAgICAgdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZSA9IG5ldyBEZWZhdWx0UGxhY2VtZW50U2VydmljZSgpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yKSB7XG4gICAgICB0aGlzLmRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IgPSB0aGlzLmNyZWF0ZURpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IoKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgY29uc29saWRhdGVkIHNlcnZpY2Ugd2l0aCBhbGwgZGVwZW5kZW5jaWVzXG4gICAgcmV0dXJuIG5ldyBBcnJvd0FkanVzdG1lbnRDYWxjdWxhdG9yKHtcbiAgICAgIHNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlOiB0aGlzLnNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlLFxuICAgICAgZGVmYXVsdFBsYWNlbWVudFNlcnZpY2U6IHRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UsXG4gICAgICB0dXBsZVByb2Nlc3NvcjogdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yLFxuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlQ29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UoKTogSUFycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2Uge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBjb29yZGluYXRlIHN5c3RlbSBzZXJ2aWNlIChzaW5nbGV0b24gZm9yIGNvbnNpc3RlbmN5KS5cbiAgICAgKi9cbiAgICBpZiAoIXRoaXMuY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UpIHtcbiAgICAgIHRoaXMuY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UgPSBuZXcgQXJyb3dDb29yZGluYXRlU3lzdGVtU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jb29yZGluYXRlU3lzdGVtU2VydmljZTtcbiAgfVxuXG4gIGNyZWF0ZURhc2hMb2NhdGlvbkNhbGN1bGF0b3IoKTogRGFzaExvY2F0aW9uQ2FsY3VsYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGRhc2ggbG9jYXRpb24gY2FsY3VsYXRvciAoc2luZ2xldG9uIGZvciBjb25zaXN0ZW5jeSkuXG4gICAgICovXG4gICAgaWYgKCF0aGlzLmRhc2hMb2NhdGlvbkNhbGN1bGF0b3IpIHtcbiAgICAgIHRoaXMuZGFzaExvY2F0aW9uQ2FsY3VsYXRvciA9IG5ldyBEYXNoTG9jYXRpb25DYWxjdWxhdG9yKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmRhc2hMb2NhdGlvbkNhbGN1bGF0b3I7XG4gIH1cblxuICBjcmVhdGVEaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yKCk6IElEaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgZGlyZWN0aW9uYWwgdHVwbGUgcHJvY2Vzc29yIHdpdGggZGVwZW5kZW5jaWVzLlxuICAgICAqL1xuICAgIGlmICghdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yKSB7XG4gICAgICBjb25zdCBkaXJlY3Rpb25hbFR1cGxlQ2FsY3VsYXRvciA9IG5ldyBEaXJlY3Rpb25hbFR1cGxlQ2FsY3VsYXRvcigpO1xuICAgICAgY29uc3QgcXVhZHJhbnRJbmRleENhbGN1bGF0b3IgPSBuZXcgUXVhZHJhbnRJbmRleENhbGN1bGF0b3IoKTtcblxuICAgICAgdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yID0gbmV3IERpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IoXG4gICAgICAgIGRpcmVjdGlvbmFsVHVwbGVDYWxjdWxhdG9yLFxuICAgICAgICBxdWFkcmFudEluZGV4Q2FsY3VsYXRvclxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcjtcbiAgfVxuXG4gIGNyZWF0ZVBvc2l0aW9uaW5nT3JjaGVzdHJhdG9yKCk6IElBcnJvd1Bvc2l0aW9uaW5nT3JjaGVzdHJhdG9yIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIGNvbXBsZXRlIHBvc2l0aW9uaW5nIG9yY2hlc3RyYXRvciB3aXRoIGFsbCBkZXBlbmRlbmNpZXMuXG4gICAgICogVGhpcyBpcyB0aGUgbWFpbiBzZXJ2aWNlIHRoYXQgY29vcmRpbmF0ZXMgYWxsIHBvc2l0aW9uaW5nIGNhbGN1bGF0aW9ucy5cbiAgICAgKi9cbiAgICBjb25zdCBsb2NhdGlvbkNhbGN1bGF0b3IgPSB0aGlzLmNyZWF0ZUxvY2F0aW9uQ2FsY3VsYXRvcigpO1xuICAgIGNvbnN0IHJvdGF0aW9uQ2FsY3VsYXRvciA9IHRoaXMuY3JlYXRlUm90YXRpb25DYWxjdWxhdG9yKCk7XG4gICAgY29uc3QgYWRqdXN0bWVudENhbGN1bGF0b3IgPSB0aGlzLmNyZWF0ZUFkanVzdG1lbnRDYWxjdWxhdG9yKCk7XG4gICAgY29uc3QgY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UgPSB0aGlzLmNyZWF0ZUNvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlKCk7XG5cbiAgICByZXR1cm4gbmV3IEFycm93UG9zaXRpb25DYWxjdWxhdG9yKFxuICAgICAgbG9jYXRpb25DYWxjdWxhdG9yLFxuICAgICAgcm90YXRpb25DYWxjdWxhdG9yLFxuICAgICAgYWRqdXN0bWVudENhbGN1bGF0b3IsXG4gICAgICBjb29yZGluYXRlU3lzdGVtU2VydmljZVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY29tcGxldGUgcG9zaXRpb25pbmcgcGlwZWxpbmUgZm9yIHVzZSBpbiBzZXJ2aWNlcy5cbiAgICogUmV0dXJucyBhbGwgdGhlIGtleSBzZXJ2aWNlcyBuZWVkZWQgZm9yIHBvc2l0aW9uaW5nIG9wZXJhdGlvbnMuXG4gICAqL1xuICBjcmVhdGVQb3NpdGlvbmluZ1BpcGVsaW5lKCk6IHtcbiAgICBsb2NhdGlvbkNhbGN1bGF0b3I6IElBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvcjtcbiAgICByb3RhdGlvbkNhbGN1bGF0b3I6IElBcnJvd1JvdGF0aW9uQ2FsY3VsYXRvcjtcbiAgICBhZGp1c3RtZW50Q2FsY3VsYXRvcjogSUFycm93QWRqdXN0bWVudENhbGN1bGF0b3I7XG4gICAgY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2U6IElBcnJvd0Nvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlO1xuICAgIG9yY2hlc3RyYXRvcjogSUFycm93UG9zaXRpb25pbmdPcmNoZXN0cmF0b3I7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBsb2NhdGlvbkNhbGN1bGF0b3I6IHRoaXMuY3JlYXRlTG9jYXRpb25DYWxjdWxhdG9yKCksXG4gICAgICByb3RhdGlvbkNhbGN1bGF0b3I6IHRoaXMuY3JlYXRlUm90YXRpb25DYWxjdWxhdG9yKCksXG4gICAgICBhZGp1c3RtZW50Q2FsY3VsYXRvcjogdGhpcy5jcmVhdGVBZGp1c3RtZW50Q2FsY3VsYXRvcigpLFxuICAgICAgY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2U6IHRoaXMuY3JlYXRlQ29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UoKSxcbiAgICAgIG9yY2hlc3RyYXRvcjogdGhpcy5jcmVhdGVQb3NpdGlvbmluZ09yY2hlc3RyYXRvcigpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmVzZXQgYWxsIHNpbmdsZXRvbiBzZXJ2aWNlcyAodXNlZnVsIGZvciB0ZXN0aW5nKS5cbiAgICovXG4gIHJlc2V0U2VydmljZXMoKTogdm9pZCB7XG4gICAgdGhpcy5kYXNoTG9jYXRpb25DYWxjdWxhdG9yID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuY29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5zcGVjaWFsUGxhY2VtZW50U2VydmljZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmRlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvciA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmUtd2FybSBhbGwgc2VydmljZXMgYnkgY3JlYXRpbmcgdGhlbSBpbiBhZHZhbmNlLlxuICAgKiBVc2VmdWwgZm9yIGVuc3VyaW5nIGNvbnNpc3RlbnQgcGVyZm9ybWFuY2UuXG4gICAqL1xuICBhc3luYyBwcmVXYXJtU2VydmljZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coXCJQcmUtd2FybWluZyBwb3NpdGlvbmluZyBzZXJ2aWNlcy4uLlwiKTtcblxuICAgIC8vIENyZWF0ZSBhbGwgc2luZ2xldG9uIHNlcnZpY2VzXG4gICAgdGhpcy5jcmVhdGVMb2NhdGlvbkNhbGN1bGF0b3IoKTtcbiAgICB0aGlzLmNyZWF0ZVJvdGF0aW9uQ2FsY3VsYXRvcigpO1xuICAgIHRoaXMuY3JlYXRlQ29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UoKTtcbiAgICB0aGlzLmNyZWF0ZURpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IoKTtcblxuICAgIC8vIExvYWQgcGxhY2VtZW50IGRhdGFcbiAgICBpZiAoIXRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UpIHtcbiAgICAgIHRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UgPSBuZXcgRGVmYXVsdFBsYWNlbWVudFNlcnZpY2UoKTtcbiAgICB9XG5cbiAgICAvLyBFbnN1cmUgcGxhY2VtZW50IGRhdGEgaXMgbG9hZGVkXG4gICAgaWYgKCF0aGlzLmRlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlLmlzTG9hZGVkKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UuZGVidWdBdmFpbGFibGVLZXlzKFxuICAgICAgICAgIE1vdGlvblR5cGUuUFJPLFxuICAgICAgICAgIEdyaWRNb2RlLkRJQU1PTkRcbiAgICAgICAgKTtcbiAgICAgICAgY29uc29sZS5sb2coXCLinIUgUG9zaXRpb25pbmcgc2VydmljZXMgcHJlLXdhcm1lZCBzdWNjZXNzZnVsbHlcIik7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gU29tZSBwb3NpdGlvbmluZyBzZXJ2aWNlcyBmYWlsZWQgdG8gcHJlLXdhcm06XCIsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgdGhlIHBvc2l0aW9uaW5nIHNlcnZpY2UgZmFjdG9yeSBpbnN0YW5jZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkoKTogUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSB7XG4gIHJldHVybiBQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5LmdldEluc3RhbmNlKCk7XG59XG5cbi8qKlxuICogQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gY3JlYXRlIGEgY29tcGxldGUgcG9zaXRpb25pbmcgb3JjaGVzdHJhdG9yLlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25pbmdPcmNoZXN0cmF0b3IoKTogSUFycm93UG9zaXRpb25pbmdPcmNoZXN0cmF0b3Ige1xuICByZXR1cm4gZ2V0UG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSgpLmNyZWF0ZVBvc2l0aW9uaW5nT3JjaGVzdHJhdG9yKCk7XG59XG4iXSwKICAibWFwcGluZ3MiOiAiQUFPQSxTQUFTLFVBQVUsa0JBQWtCO0FBVXJDLFNBQVMsaUNBQWlDO0FBQzFDLFNBQVMsK0JBQStCO0FBQ3hDLFNBQVMsK0JBQStCO0FBQ3hDLFNBQVMsOEJBQThCO0FBQ3ZDLFNBQVMsb0NBQW9DO0FBQzdDLFNBQVMsK0JBQStCO0FB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
