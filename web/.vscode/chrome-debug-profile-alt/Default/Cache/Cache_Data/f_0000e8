import { MotionColor } from "/src/lib/domain/enums.ts";
import { PropPlacementService } from "/src/lib/services/implementations/positioning/PropPlacementService.ts";
export class PropCoordinatorService {
  svgCache = /* @__PURE__ */ new Map();
  placementService;
  constructor() {
    this.placementService = new PropPlacementService();
  }
  async calculatePropRenderData(propData, motionData, pictographData) {
    try {
      if (!pictographData) {
        throw new Error(
          "PictographData is required for prop placement calculation"
        );
      }
      if (!motionData) {
        throw new Error(
          "MotionData is required for prop placement calculation"
        );
      }
      const placementData = this.placementService.calculatePlacement(
        pictographData,
        motionData
      );
      console.log("‚úÖ About to load SVG data");
      const svgData = await this.loadSvgData(propData, motionData);
      console.log("‚úÖ SVG data loaded:", svgData);
      const result = {
        position: { x: placementData.positionX, y: placementData.positionY },
        rotation: placementData.rotationAngle,
        svgData,
        loaded: true,
        error: null
      };
      console.log(
        "‚úÖ PropCoordinatorService.calculatePropRenderData returning:",
        result
      );
      return result;
    } catch (error) {
      console.error(
        "‚ùå PropCoordinatorService.calculatePropRenderData error:",
        error
      );
      return {
        position: { x: 475, y: 475 },
        rotation: 0,
        svgData: null,
        loaded: false,
        error: error instanceof Error ? error.message : "Unknown error"
      };
    }
  }
  async loadSvgData(propData, motionData) {
    const color = motionData?.color || MotionColor.BLUE;
    const cacheKey = `${propData.propType}_${color}`;
    if (this.svgCache.has(cacheKey)) {
      console.log(
        `‚úÖ PropCoordinatorService: Using cached SVG for ${cacheKey}`
      );
      const cachedData = this.svgCache.get(cacheKey);
      if (cachedData) {
        return cachedData;
      }
    }
    console.log(`üîÑ PropCoordinatorService: Creating new SVG for ${cacheKey}`);
    const response = await fetch(`/images/props/${propData.propType}.svg`);
    if (!response.ok) throw new Error("Failed to fetch SVG");
    const originalSvgText = await response.text();
    const { viewBox, center } = this.parsePropSvg(originalSvgText);
    const coloredSvgText = this.applyColorToSvg(originalSvgText, color);
    const svgContent = this.extractSvgContent(coloredSvgText);
    const svgData = {
      svgContent,
      viewBox,
      center
    };
    console.log(`üíæ PropCoordinatorService: Caching SVG for ${cacheKey}`);
    this.svgCache.set(cacheKey, svgData);
    return svgData;
  }
  parsePropSvg(svgText) {
    const doc = new DOMParser().parseFromString(svgText, "image/svg+xml");
    const svg = doc.documentElement;
    const viewBoxValues = svg.getAttribute("viewBox")?.split(/\s+/) || [
      "0",
      "0",
      "252.8",
      "77.8"
    ];
    const viewBox = {
      width: parseFloat(viewBoxValues[2] || "252.8") || 252.8,
      height: parseFloat(viewBoxValues[3] || "77.8") || 77.8
    };
    let center = { x: viewBox.width / 2, y: viewBox.height / 2 };
    try {
      const centerElement = doc.getElementById("centerPoint");
      if (centerElement) {
        center = {
          x: parseFloat(centerElement.getAttribute("cx") || "0") || center.x,
          y: parseFloat(centerElement.getAttribute("cy") || "0") || center.y
        };
      }
    } catch {
    }
    return { viewBox, center };
  }
  applyColorToSvg(svgText, color) {
    const colorMap = /* @__PURE__ */ new Map([
      [MotionColor.BLUE, "#2E3192"],
      [MotionColor.RED, "#ED1C24"]
    ]);
    const targetColor = colorMap.get(color) || "#2E3192";
    let coloredSvg = svgText.replace(
      /fill="#[0-9A-Fa-f]{6}"/g,
      `fill="${targetColor}"`
    );
    coloredSvg = coloredSvg.replace(
      /fill:\s*#[0-9A-Fa-f]{6}/g,
      `fill:${targetColor}`
    );
    const colorSuffix = color.toLowerCase();
    coloredSvg = coloredSvg.replace(/\.st(\d+)/g, `.st$1-${colorSuffix}`);
    coloredSvg = coloredSvg.replace(
      /class="st(\d+)"/g,
      `class="st$1-${colorSuffix}"`
    );
    coloredSvg = coloredSvg.replace(
      /<circle[^>]*id="centerPoint"[^>]*\/?>/g,
      ""
    );
    console.log(
      `üîß PropCoordinatorService: Applied unique class names with suffix -${colorSuffix}`
    );
    return coloredSvg;
  }
  extractSvgContent(svgText) {
    console.log(
      `üîç PropCoordinatorService: Extracting SVG content from: ${svgText.substring(0, 200)}...`
    );
    const svgContentMatch = svgText.match(/<svg[^>]*>(.*)<\/svg>/s);
    if (!svgContentMatch) {
      console.warn("Could not extract SVG content");
      console.log(
        `üö´ PropCoordinatorService: SVG text that failed to match: ${svgText}`
      );
      return svgText;
    }
    const extractedContent = svgContentMatch[1];
    console.log(
      `‚úÖ PropCoordinatorService: Extracted SVG content: ${extractedContent.substring(0, 200)}...`
    );
    return extractedContent;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9yZW5kZXJpbmcvUHJvcENvb3JkaW5hdG9yU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBQcm9wIENvb3JkaW5hdG9yIFNlcnZpY2VcbiAqXG4gKiBPcmNoZXN0cmF0ZXMgcHJvcCByZW5kZXJpbmcgYnkgY29vcmRpbmF0aW5nIHBsYWNlbWVudCBjYWxjdWxhdGlvbiBhbmQgU1ZHIGxvYWRpbmcuXG4gKiBGb2N1c2VzIG9uIHJlbmRlcmluZyBjb29yZGluYXRpb24gcmF0aGVyIHRoYW4gcGxhY2VtZW50IGNhbGN1bGF0aW9uIGxvZ2ljLlxuICogVXNlcyBQcm9wUGxhY2VtZW50U2VydmljZSBmb3IgcGxhY2VtZW50IGNhbGN1bGF0aW9ucyBmb2xsb3dpbmcgc2VwYXJhdGlvbiBvZiBjb25jZXJucy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IFByb3BEYXRhLCBNb3Rpb25EYXRhLCBQaWN0b2dyYXBoRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHsgTW90aW9uQ29sb3IgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcbmltcG9ydCB7IFByb3BQbGFjZW1lbnRTZXJ2aWNlIH0gZnJvbSBcIi4uL3Bvc2l0aW9uaW5nL1Byb3BQbGFjZW1lbnRTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSB7IElQcm9wUGxhY2VtZW50U2VydmljZSB9IGZyb20gXCIuLi9wb3NpdGlvbmluZy9Qcm9wUGxhY2VtZW50U2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFByb3BSZW5kZXJEYXRhIHtcbiAgcG9zaXRpb246IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfTtcbiAgcm90YXRpb246IG51bWJlcjtcbiAgc3ZnRGF0YToge1xuICAgIHN2Z0NvbnRlbnQ6IHN0cmluZztcbiAgICB2aWV3Qm94OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG4gICAgY2VudGVyOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gIH0gfCBudWxsO1xuICBsb2FkZWQ6IGJvb2xlYW47XG4gIGVycm9yOiBzdHJpbmcgfCBudWxsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlIHtcbiAgY2FsY3VsYXRlUHJvcFJlbmRlckRhdGEoXG4gICAgcHJvcERhdGE6IFByb3BEYXRhLFxuICAgIG1vdGlvbkRhdGE/OiBNb3Rpb25EYXRhLFxuICAgIHBpY3RvZ3JhcGhEYXRhPzogUGljdG9ncmFwaERhdGEgLy8g4pyFIFNJTVBMSUZJRUQ6IENvbXBsZXRlIHBpY3RvZ3JhcGggZGF0YSBjb250YWlucyBncmlkTW9kZVxuICApOiBQcm9taXNlPFByb3BSZW5kZXJEYXRhPjtcbn1cblxuZXhwb3J0IGNsYXNzIFByb3BDb29yZGluYXRvclNlcnZpY2UgaW1wbGVtZW50cyBJUHJvcENvb3JkaW5hdG9yU2VydmljZSB7XG4gIHByaXZhdGUgc3ZnQ2FjaGUgPSBuZXcgTWFwPFxuICAgIHN0cmluZyxcbiAgICB7XG4gICAgICBzdmdDb250ZW50OiBzdHJpbmc7XG4gICAgICB2aWV3Qm94OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG4gICAgICBjZW50ZXI6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfTtcbiAgICB9XG4gID4oKTtcbiAgcHJpdmF0ZSBwbGFjZW1lbnRTZXJ2aWNlOiBJUHJvcFBsYWNlbWVudFNlcnZpY2U7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wbGFjZW1lbnRTZXJ2aWNlID0gbmV3IFByb3BQbGFjZW1lbnRTZXJ2aWNlKCk7XG4gIH1cblxuICBhc3luYyBjYWxjdWxhdGVQcm9wUmVuZGVyRGF0YShcbiAgICBwcm9wRGF0YTogUHJvcERhdGEsXG4gICAgbW90aW9uRGF0YT86IE1vdGlvbkRhdGEsXG4gICAgcGljdG9ncmFwaERhdGE/OiBQaWN0b2dyYXBoRGF0YVxuICApOiBQcm9taXNlPFByb3BSZW5kZXJEYXRhPiB7XG4gICAgLy8gRGVidWcgbG9nZ2luZyByZW1vdmVkIGZvciBwZXJmb3JtYW5jZVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIOKchSBTSU1QTElGSUVEOiBPbmx5IG5lZWQgcGljdG9ncmFwaERhdGEgYW5kIG1vdGlvbkRhdGEgZm9yIHBsYWNlbWVudCBjYWxjdWxhdGlvblxuICAgICAgaWYgKCFwaWN0b2dyYXBoRGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJQaWN0b2dyYXBoRGF0YSBpcyByZXF1aXJlZCBmb3IgcHJvcCBwbGFjZW1lbnQgY2FsY3VsYXRpb25cIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIW1vdGlvbkRhdGEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiTW90aW9uRGF0YSBpcyByZXF1aXJlZCBmb3IgcHJvcCBwbGFjZW1lbnQgY2FsY3VsYXRpb25cIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwbGFjZW1lbnREYXRhID0gdGhpcy5wbGFjZW1lbnRTZXJ2aWNlLmNhbGN1bGF0ZVBsYWNlbWVudChcbiAgICAgICAgcGljdG9ncmFwaERhdGEsXG4gICAgICAgIG1vdGlvbkRhdGFcbiAgICAgICk7XG5cbiAgICAgIC8vIExvYWQgU1ZHIGRhdGEgdXNpbmcgbW90aW9uIGRhdGEgZm9yIGNvbG9yIChzaW5nbGUgc291cmNlIG9mIHRydXRoKVxuICAgICAgY29uc29sZS5sb2coXCLinIUgQWJvdXQgdG8gbG9hZCBTVkcgZGF0YVwiKTtcbiAgICAgIGNvbnN0IHN2Z0RhdGEgPSBhd2FpdCB0aGlzLmxvYWRTdmdEYXRhKHByb3BEYXRhLCBtb3Rpb25EYXRhKTtcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIFNWRyBkYXRhIGxvYWRlZDpcIiwgc3ZnRGF0YSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgcG9zaXRpb246IHsgeDogcGxhY2VtZW50RGF0YS5wb3NpdGlvblgsIHk6IHBsYWNlbWVudERhdGEucG9zaXRpb25ZIH0sXG4gICAgICAgIHJvdGF0aW9uOiBwbGFjZW1lbnREYXRhLnJvdGF0aW9uQW5nbGUsXG4gICAgICAgIHN2Z0RhdGEsXG4gICAgICAgIGxvYWRlZDogdHJ1ZSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCLinIUgUHJvcENvb3JkaW5hdG9yU2VydmljZS5jYWxjdWxhdGVQcm9wUmVuZGVyRGF0YSByZXR1cm5pbmc6XCIsXG4gICAgICAgIHJlc3VsdFxuICAgICAgKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwi4p2MIFByb3BDb29yZGluYXRvclNlcnZpY2UuY2FsY3VsYXRlUHJvcFJlbmRlckRhdGEgZXJyb3I6XCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9zaXRpb246IHsgeDogNDc1LCB5OiA0NzUgfSxcbiAgICAgICAgcm90YXRpb246IDAsXG4gICAgICAgIHN2Z0RhdGE6IG51bGwsXG4gICAgICAgIGxvYWRlZDogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWRTdmdEYXRhKFxuICAgIHByb3BEYXRhOiBQcm9wRGF0YSxcbiAgICBtb3Rpb25EYXRhPzogTW90aW9uRGF0YVxuICApOiBQcm9taXNlPHtcbiAgICBzdmdDb250ZW50OiBzdHJpbmc7XG4gICAgdmlld0JveDogeyB3aWR0aDogbnVtYmVyOyBoZWlnaHQ6IG51bWJlciB9O1xuICAgIGNlbnRlcjogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9O1xuICB9PiB7XG4gICAgLy8gVXNlIG1vdGlvbkRhdGEuY29sb3IgYXMgc291cmNlIG9mIHRydXRoLCBmYWxsYmFjayB0byBibHVlXG4gICAgY29uc3QgY29sb3IgPSBtb3Rpb25EYXRhPy5jb2xvciB8fCBNb3Rpb25Db2xvci5CTFVFO1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7cHJvcERhdGEucHJvcFR5cGV9XyR7Y29sb3J9YDtcblxuICAgIGlmICh0aGlzLnN2Z0NhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg4pyFIFByb3BDb29yZGluYXRvclNlcnZpY2U6IFVzaW5nIGNhY2hlZCBTVkcgZm9yICR7Y2FjaGVLZXl9YFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLnN2Z0NhY2hlLmdldChjYWNoZUtleSk7XG4gICAgICBpZiAoY2FjaGVkRGF0YSkge1xuICAgICAgICByZXR1cm4gY2FjaGVkRGF0YTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UhCBQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlOiBDcmVhdGluZyBuZXcgU1ZHIGZvciAke2NhY2hlS2V5fWApO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgL2ltYWdlcy9wcm9wcy8ke3Byb3BEYXRhLnByb3BUeXBlfS5zdmdgKTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggU1ZHXCIpO1xuXG4gICAgY29uc3Qgb3JpZ2luYWxTdmdUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIGNvbnN0IHsgdmlld0JveCwgY2VudGVyIH0gPSB0aGlzLnBhcnNlUHJvcFN2ZyhvcmlnaW5hbFN2Z1RleHQpO1xuICAgIGNvbnN0IGNvbG9yZWRTdmdUZXh0ID0gdGhpcy5hcHBseUNvbG9yVG9Tdmcob3JpZ2luYWxTdmdUZXh0LCBjb2xvcik7XG5cbiAgICAvLyBFeHRyYWN0IGp1c3QgdGhlIGlubmVyIFNWRyBjb250ZW50IChubyBzY2FsaW5nIG5lZWRlZCAtIHByb3BzIGFyZSBhbHJlYWR5IGNvcnJlY3RseSBzaXplZClcbiAgICBjb25zdCBzdmdDb250ZW50ID0gdGhpcy5leHRyYWN0U3ZnQ29udGVudChjb2xvcmVkU3ZnVGV4dCk7XG5cbiAgICBjb25zdCBzdmdEYXRhID0ge1xuICAgICAgc3ZnQ29udGVudCxcbiAgICAgIHZpZXdCb3gsXG4gICAgICBjZW50ZXIsXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5K+IFByb3BDb29yZGluYXRvclNlcnZpY2U6IENhY2hpbmcgU1ZHIGZvciAke2NhY2hlS2V5fWApO1xuICAgIHRoaXMuc3ZnQ2FjaGUuc2V0KGNhY2hlS2V5LCBzdmdEYXRhKTtcbiAgICByZXR1cm4gc3ZnRGF0YTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VQcm9wU3ZnKHN2Z1RleHQ6IHN0cmluZyk6IHtcbiAgICB2aWV3Qm94OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG4gICAgY2VudGVyOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gIH0ge1xuICAgIGNvbnN0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoc3ZnVGV4dCwgXCJpbWFnZS9zdmcreG1sXCIpO1xuICAgIGNvbnN0IHN2ZyA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICBjb25zdCB2aWV3Qm94VmFsdWVzID0gc3ZnLmdldEF0dHJpYnV0ZShcInZpZXdCb3hcIik/LnNwbGl0KC9cXHMrLykgfHwgW1xuICAgICAgXCIwXCIsXG4gICAgICBcIjBcIixcbiAgICAgIFwiMjUyLjhcIixcbiAgICAgIFwiNzcuOFwiLFxuICAgIF07XG4gICAgY29uc3Qgdmlld0JveCA9IHtcbiAgICAgIHdpZHRoOiBwYXJzZUZsb2F0KHZpZXdCb3hWYWx1ZXNbMl0gfHwgXCIyNTIuOFwiKSB8fCAyNTIuOCxcbiAgICAgIGhlaWdodDogcGFyc2VGbG9hdCh2aWV3Qm94VmFsdWVzWzNdIHx8IFwiNzcuOFwiKSB8fCA3Ny44LFxuICAgIH07XG5cbiAgICBsZXQgY2VudGVyID0geyB4OiB2aWV3Qm94LndpZHRoIC8gMiwgeTogdmlld0JveC5oZWlnaHQgLyAyIH07XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2VudGVyRWxlbWVudCA9IGRvYy5nZXRFbGVtZW50QnlJZChcImNlbnRlclBvaW50XCIpO1xuICAgICAgaWYgKGNlbnRlckVsZW1lbnQpIHtcbiAgICAgICAgY2VudGVyID0ge1xuICAgICAgICAgIHg6IHBhcnNlRmxvYXQoY2VudGVyRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJjeFwiKSB8fCBcIjBcIikgfHwgY2VudGVyLngsXG4gICAgICAgICAgeTogcGFyc2VGbG9hdChjZW50ZXJFbGVtZW50LmdldEF0dHJpYnV0ZShcImN5XCIpIHx8IFwiMFwiKSB8fCBjZW50ZXIueSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIFVzZSBkZWZhdWx0IGNlbnRlclxuICAgIH1cblxuICAgIHJldHVybiB7IHZpZXdCb3gsIGNlbnRlciB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBseUNvbG9yVG9Tdmcoc3ZnVGV4dDogc3RyaW5nLCBjb2xvcjogTW90aW9uQ29sb3IpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbG9yTWFwID0gbmV3IE1hcChbXG4gICAgICBbTW90aW9uQ29sb3IuQkxVRSwgXCIjMkUzMTkyXCJdLFxuICAgICAgW01vdGlvbkNvbG9yLlJFRCwgXCIjRUQxQzI0XCJdLFxuICAgIF0pO1xuXG4gICAgY29uc3QgdGFyZ2V0Q29sb3IgPSBjb2xvck1hcC5nZXQoY29sb3IpIHx8IFwiIzJFMzE5MlwiO1xuXG4gICAgbGV0IGNvbG9yZWRTdmcgPSBzdmdUZXh0LnJlcGxhY2UoXG4gICAgICAvZmlsbD1cIiNbMC05QS1GYS1mXXs2fVwiL2csXG4gICAgICBgZmlsbD1cIiR7dGFyZ2V0Q29sb3J9XCJgXG4gICAgKTtcbiAgICBjb2xvcmVkU3ZnID0gY29sb3JlZFN2Zy5yZXBsYWNlKFxuICAgICAgL2ZpbGw6XFxzKiNbMC05QS1GYS1mXXs2fS9nLFxuICAgICAgYGZpbGw6JHt0YXJnZXRDb2xvcn1gXG4gICAgKTtcblxuICAgIC8vIE1ha2UgQ1NTIGNsYXNzIG5hbWVzIHVuaXF1ZSBmb3IgZWFjaCBjb2xvciB0byBwcmV2ZW50IGNvbmZsaWN0c1xuICAgIC8vIFJlcGxhY2UgLnN0MCwgLnN0MSwgZXRjLiB3aXRoIC5zdDAtYmx1ZSwgLnN0MS1ibHVlLCBldGMuXG4gICAgY29uc3QgY29sb3JTdWZmaXggPSBjb2xvci50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbG9yZWRTdmcgPSBjb2xvcmVkU3ZnLnJlcGxhY2UoL1xcLnN0KFxcZCspL2csIGAuc3QkMS0ke2NvbG9yU3VmZml4fWApO1xuXG4gICAgLy8gQWxzbyB1cGRhdGUgY2xhc3MgcmVmZXJlbmNlcyBpbiBlbGVtZW50c1xuICAgIGNvbG9yZWRTdmcgPSBjb2xvcmVkU3ZnLnJlcGxhY2UoXG4gICAgICAvY2xhc3M9XCJzdChcXGQrKVwiL2csXG4gICAgICBgY2xhc3M9XCJzdCQxLSR7Y29sb3JTdWZmaXh9XCJgXG4gICAgKTtcblxuICAgIC8vIFJlbW92ZSBjZW50ZXJQb2ludCBjaXJjbGUgdG8gcHJldmVudCBkZXRlY3Rpb24gaXNzdWVzXG4gICAgY29sb3JlZFN2ZyA9IGNvbG9yZWRTdmcucmVwbGFjZShcbiAgICAgIC88Y2lyY2xlW14+XSppZD1cImNlbnRlclBvaW50XCJbXj5dKlxcLz8+L2csXG4gICAgICBcIlwiXG4gICAgKTtcblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYPCflKcgUHJvcENvb3JkaW5hdG9yU2VydmljZTogQXBwbGllZCB1bmlxdWUgY2xhc3MgbmFtZXMgd2l0aCBzdWZmaXggLSR7Y29sb3JTdWZmaXh9YFxuICAgICk7XG4gICAgcmV0dXJuIGNvbG9yZWRTdmc7XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RTdmdDb250ZW50KHN2Z1RleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gRXh0cmFjdCBTVkcgY29udGVudCAoZXZlcnl0aGluZyBpbnNpZGUgdGhlIDxzdmc+IHRhZ3MpXG4gICAgLy8gUHJvcHMgYXJlIGFscmVhZHkgY29ycmVjdGx5IHNpemVkIGZvciA5NTB4OTUwIGNvb3JkaW5hdGUgc3lzdGVtXG4gICAgY29uc29sZS5sb2coXG4gICAgICBg8J+UjSBQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlOiBFeHRyYWN0aW5nIFNWRyBjb250ZW50IGZyb206ICR7c3ZnVGV4dC5zdWJzdHJpbmcoMCwgMjAwKX0uLi5gXG4gICAgKTtcblxuICAgIGNvbnN0IHN2Z0NvbnRlbnRNYXRjaCA9IHN2Z1RleHQubWF0Y2goLzxzdmdbXj5dKj4oLiopPFxcL3N2Zz4vcyk7XG4gICAgaWYgKCFzdmdDb250ZW50TWF0Y2gpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBleHRyYWN0IFNWRyBjb250ZW50XCIpO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5qrIFByb3BDb29yZGluYXRvclNlcnZpY2U6IFNWRyB0ZXh0IHRoYXQgZmFpbGVkIHRvIG1hdGNoOiAke3N2Z1RleHR9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBzdmdUZXh0O1xuICAgIH1cblxuICAgIGNvbnN0IGV4dHJhY3RlZENvbnRlbnQgPSBzdmdDb250ZW50TWF0Y2hbMV07XG4gICAgY29uc29sZS5sb2coXG4gICAgICBg4pyFIFByb3BDb29yZGluYXRvclNlcnZpY2U6IEV4dHJhY3RlZCBTVkcgY29udGVudDogJHtleHRyYWN0ZWRDb250ZW50LnN1YnN0cmluZygwLCAyMDApfS4uLmBcbiAgICApO1xuICAgIHJldHVybiBleHRyYWN0ZWRDb250ZW50O1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiQUFTQSxTQUFTLG1CQUFtQjtBQUM1QixTQUFTLDRCQUE0QjtBQXVCOUIsYUFBTSx1QkFBMEQ7QUFBQSxFQUM3RCxXQUFX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
