import { Location, MotionType } from "/src/lib/domain/index.ts";
import { DashLocationCalculator } from "/src/lib/services/positioning/arrows/calculation/DashLocationCalculator.ts";
export class ArrowLocationCalculator {
  /**
   * Pure algorithmic service for calculating arrow locations.
   *
   * Implements location calculation algorithms without any UI dependencies.
   * Each motion type has its own calculation strategy.
   */
  dashLocationService;
  // Direction pairs mapping for shift arrows (PRO/ANTI/FLOAT)
  // Maps start/end location pairs to their calculated arrow location
  shiftDirectionPairs = {
    // Cardinal + Diagonal combinations
    [this.createLocationPairKey([Location.NORTH, Location.EAST])]: Location.NORTHEAST,
    [this.createLocationPairKey([Location.EAST, Location.SOUTH])]: Location.SOUTHEAST,
    [this.createLocationPairKey([Location.SOUTH, Location.WEST])]: Location.SOUTHWEST,
    [this.createLocationPairKey([Location.WEST, Location.NORTH])]: Location.NORTHWEST,
    // Diagonal + Cardinal combinations
    [this.createLocationPairKey([Location.NORTHEAST, Location.NORTHWEST])]: Location.NORTH,
    [this.createLocationPairKey([Location.NORTHEAST, Location.SOUTHEAST])]: Location.EAST,
    [this.createLocationPairKey([Location.SOUTHWEST, Location.SOUTHEAST])]: Location.SOUTH,
    [this.createLocationPairKey([Location.NORTHWEST, Location.SOUTHWEST])]: Location.WEST
  };
  constructor(dashLocationService) {
    this.dashLocationService = dashLocationService || new DashLocationCalculator();
  }
  calculateLocation(motion, pictographData) {
    const motionType = motion.motionType?.toLowerCase();
    switch (motionType) {
      case "static":
        return this.calculateStaticLocation(motion);
      case "pro":
      case "anti":
      case "float":
        return this.calculateShiftLocation(motion);
      case "dash":
        return this.calculateDashLocation(motion, pictographData);
      default:
        console.warn(
          `Unknown motion type: ${motionType}, using start location`
        );
        return motion.startLocation || Location.NORTH;
    }
  }
  calculateStaticLocation(motion) {
    return motion.startLocation || Location.NORTH;
  }
  calculateShiftLocation(motion) {
    if (!motion.startLocation || !motion.endLocation) {
      console.warn(
        "Shift motion missing startLocation or endLocation, using startLocation"
      );
      return motion.startLocation || Location.NORTH;
    }
    const locationPairKey = this.createLocationPairKey([
      motion.startLocation,
      motion.endLocation
    ]);
    const calculatedLocation = this.shiftDirectionPairs[locationPairKey] || motion.startLocation;
    return calculatedLocation;
  }
  calculateDashLocation(motion, pictographData) {
    if (!pictographData) {
      console.warn(
        "No pictograph data provided for dash location calculation, using start location"
      );
      return motion.startLocation || Location.NORTH;
    }
    const isBlueArrow = this.isBlueArrowMotion(motion, pictographData);
    return this.dashLocationService.calculateDashLocationFromPictographData(
      pictographData,
      isBlueArrow
    );
  }
  getSupportedMotionTypes() {
    return [
      MotionType.STATIC,
      MotionType.PRO,
      MotionType.ANTI,
      MotionType.FLOAT,
      MotionType.DASH
    ];
  }
  validateMotionData(motion) {
    if (!motion) {
      return false;
    }
    const motionType = motion.motionType?.toLowerCase();
    if (!this.getSupportedMotionTypes().includes(motionType)) {
      return false;
    }
    if (["pro", "anti", "float"].includes(motionType || "")) {
      return motion.startLocation != null && motion.endLocation != null;
    }
    if (["static", "dash"].includes(motionType || "")) {
      return motion.startLocation != null;
    }
    return true;
  }
  extractBeatDataFromPictograph(pictograph) {
    if (!pictograph.arrows) {
      return null;
    }
    const blueMotion = pictograph.motions?.blue;
    const redMotion = pictograph.motions?.red;
    return {
      beatNumber: pictograph.metadata?.created_from_beat || 1,
      letter: pictograph.letter,
      pictographData: {
        motions: {
          blue: blueMotion,
          red: redMotion
        }
      }
    };
  }
  isBlueArrowMotion(motion, pictographData) {
    if (pictographData.motions?.blue === motion) {
      return true;
    }
    if (pictographData.motions?.red === motion) {
      return false;
    }
    console.warn("Could not determine arrow color for motion, assuming blue");
    return true;
  }
  /**
   * Create a normalized key for location pairs to enable bidirectional lookup.
   * This ensures that [A, B] and [B, A] produce the same key.
   */
  createLocationPairKey(locations) {
    const sortedLocations = [...locations].sort();
    return sortedLocations.join(",");
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9jYWxjdWxhdGlvbi9BcnJvd0xvY2F0aW9uQ2FsY3VsYXRvci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBBcnJvdyBMb2NhdGlvbiBDYWxjdWxhdG9yIFNlcnZpY2VcbiAqXG4gKiBQdXJlIGFsZ29yaXRobWljIHNlcnZpY2UgZm9yIGNhbGN1bGF0aW5nIGFycm93IGxvY2F0aW9ucyBiYXNlZCBvbiBtb3Rpb24gZGF0YS5cbiAqIERpcmVjdCBUeXBlU2NyaXB0IHBvcnQgb2YgdGhlIFB5dGhvbiBBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvclNlcnZpY2UuXG4gKlxuICogVGhpcyBzZXJ2aWNlIGhhbmRsZXM6XG4gKiAtIFN0YXRpYyBtb3Rpb24gbG9jYXRpb24gY2FsY3VsYXRpb24gKHVzZXMgc3RhcnQgbG9jYXRpb24pXG4gKiAtIFNoaWZ0IG1vdGlvbiBsb2NhdGlvbiBjYWxjdWxhdGlvbiAoUFJPL0FOVEkvRkxPQVQgdXNpbmcgc3RhcnQvZW5kIHBhaXIgbWFwcGluZylcbiAqIC0gRGFzaCBtb3Rpb24gbG9jYXRpb24gY2FsY3VsYXRpb24gKHdpdGggVHlwZSAzIGRldGVjdGlvbiBzdXBwb3J0KVxuICpcbiAqIE5vIFVJIGRlcGVuZGVuY2llcywgY29tcGxldGVseSB0ZXN0YWJsZSBpbiBpc29sYXRpb24uXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBNb3Rpb25EYXRhLCBQaWN0b2dyYXBoRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHsgTG9jYXRpb24sIE1vdGlvblR5cGUgfSBmcm9tIFwiJGxpYi9kb21haW5cIjtcbmltcG9ydCB0eXBlIHsgSUFycm93TG9jYXRpb25DYWxjdWxhdG9yIH0gZnJvbSBcIi4uLy4uL2NvcmUtc2VydmljZXNcIjtcbmltcG9ydCB0eXBlIHsgQmVhdERhdGEgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IERhc2hMb2NhdGlvbkNhbGN1bGF0b3IgfSBmcm9tIFwiLi9EYXNoTG9jYXRpb25DYWxjdWxhdG9yXCI7XG5cbmV4cG9ydCBjbGFzcyBBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvciBpbXBsZW1lbnRzIElBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvciB7XG4gIC8qKlxuICAgKiBQdXJlIGFsZ29yaXRobWljIHNlcnZpY2UgZm9yIGNhbGN1bGF0aW5nIGFycm93IGxvY2F0aW9ucy5cbiAgICpcbiAgICogSW1wbGVtZW50cyBsb2NhdGlvbiBjYWxjdWxhdGlvbiBhbGdvcml0aG1zIHdpdGhvdXQgYW55IFVJIGRlcGVuZGVuY2llcy5cbiAgICogRWFjaCBtb3Rpb24gdHlwZSBoYXMgaXRzIG93biBjYWxjdWxhdGlvbiBzdHJhdGVneS5cbiAgICovXG5cbiAgcHJpdmF0ZSBkYXNoTG9jYXRpb25TZXJ2aWNlOiBEYXNoTG9jYXRpb25DYWxjdWxhdG9yO1xuXG4gIC8vIERpcmVjdGlvbiBwYWlycyBtYXBwaW5nIGZvciBzaGlmdCBhcnJvd3MgKFBSTy9BTlRJL0ZMT0FUKVxuICAvLyBNYXBzIHN0YXJ0L2VuZCBsb2NhdGlvbiBwYWlycyB0byB0aGVpciBjYWxjdWxhdGVkIGFycm93IGxvY2F0aW9uXG4gIHByaXZhdGUgcmVhZG9ubHkgc2hpZnREaXJlY3Rpb25QYWlyczogUmVjb3JkPHN0cmluZywgTG9jYXRpb24+ID0ge1xuICAgIC8vIENhcmRpbmFsICsgRGlhZ29uYWwgY29tYmluYXRpb25zXG4gICAgW3RoaXMuY3JlYXRlTG9jYXRpb25QYWlyS2V5KFtMb2NhdGlvbi5OT1JUSCwgTG9jYXRpb24uRUFTVF0pXTpcbiAgICAgIExvY2F0aW9uLk5PUlRIRUFTVCxcbiAgICBbdGhpcy5jcmVhdGVMb2NhdGlvblBhaXJLZXkoW0xvY2F0aW9uLkVBU1QsIExvY2F0aW9uLlNPVVRIXSldOlxuICAgICAgTG9jYXRpb24uU09VVEhFQVNULFxuICAgIFt0aGlzLmNyZWF0ZUxvY2F0aW9uUGFpcktleShbTG9jYXRpb24uU09VVEgsIExvY2F0aW9uLldFU1RdKV06XG4gICAgICBMb2NhdGlvbi5TT1VUSFdFU1QsXG4gICAgW3RoaXMuY3JlYXRlTG9jYXRpb25QYWlyS2V5KFtMb2NhdGlvbi5XRVNULCBMb2NhdGlvbi5OT1JUSF0pXTpcbiAgICAgIExvY2F0aW9uLk5PUlRIV0VTVCxcbiAgICAvLyBEaWFnb25hbCArIENhcmRpbmFsIGNvbWJpbmF0aW9uc1xuICAgIFt0aGlzLmNyZWF0ZUxvY2F0aW9uUGFpcktleShbTG9jYXRpb24uTk9SVEhFQVNULCBMb2NhdGlvbi5OT1JUSFdFU1RdKV06XG4gICAgICBMb2NhdGlvbi5OT1JUSCxcbiAgICBbdGhpcy5jcmVhdGVMb2NhdGlvblBhaXJLZXkoW0xvY2F0aW9uLk5PUlRIRUFTVCwgTG9jYXRpb24uU09VVEhFQVNUXSldOlxuICAgICAgTG9jYXRpb24uRUFTVCxcbiAgICBbdGhpcy5jcmVhdGVMb2NhdGlvblBhaXJLZXkoW0xvY2F0aW9uLlNPVVRIV0VTVCwgTG9jYXRpb24uU09VVEhFQVNUXSldOlxuICAgICAgTG9jYXRpb24uU09VVEgsXG4gICAgW3RoaXMuY3JlYXRlTG9jYXRpb25QYWlyS2V5KFtMb2NhdGlvbi5OT1JUSFdFU1QsIExvY2F0aW9uLlNPVVRIV0VTVF0pXTpcbiAgICAgIExvY2F0aW9uLldFU1QsXG4gIH07XG5cbiAgY29uc3RydWN0b3IoZGFzaExvY2F0aW9uU2VydmljZT86IERhc2hMb2NhdGlvbkNhbGN1bGF0b3IpIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIHRoZSBsb2NhdGlvbiBjYWxjdWxhdG9yLlxuICAgICAqXG4gICAgICogQXJnczpcbiAgICAgKiAgICAgZGFzaExvY2F0aW9uU2VydmljZTogU2VydmljZSBmb3IgZGFzaCBsb2NhdGlvbiBjYWxjdWxhdGlvbnNcbiAgICAgKi9cbiAgICB0aGlzLmRhc2hMb2NhdGlvblNlcnZpY2UgPVxuICAgICAgZGFzaExvY2F0aW9uU2VydmljZSB8fCBuZXcgRGFzaExvY2F0aW9uQ2FsY3VsYXRvcigpO1xuICB9XG5cbiAgY2FsY3VsYXRlTG9jYXRpb24oXG4gICAgbW90aW9uOiBNb3Rpb25EYXRhLFxuICAgIHBpY3RvZ3JhcGhEYXRhPzogUGljdG9ncmFwaERhdGFcbiAgKTogTG9jYXRpb24ge1xuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSBhcnJvdyBsb2NhdGlvbiBiYXNlZCBvbiBtb3Rpb24gdHlwZSBhbmQgZGF0YS5cbiAgICAgKlxuICAgICAqIEFyZ3M6XG4gICAgICogICAgIG1vdGlvbjogTW90aW9uIGRhdGEgY29udGFpbmluZyB0eXBlLCBzdGFydC9lbmQgbG9jYXRpb25zLCByb3RhdGlvbiBkaXJlY3Rpb25cbiAgICAgKiAgICAgcGljdG9ncmFwaERhdGE6IE9wdGlvbmFsIHBpY3RvZ3JhcGggZGF0YSBmb3IgREFTSCBtb3Rpb24gVHlwZSAzIGRldGVjdGlvblxuICAgICAqXG4gICAgICogUmV0dXJuczpcbiAgICAgKiAgICAgTG9jYXRpb24gZW51bSB2YWx1ZSByZXByZXNlbnRpbmcgdGhlIGNhbGN1bGF0ZWQgYXJyb3cgbG9jYXRpb25cbiAgICAgKlxuICAgICAqIFRocm93czpcbiAgICAgKiAgICAgRXJyb3I6IElmIGRhc2ggbW90aW9uIHJlcXVpcmVzIHBpY3RvZ3JhcGggZGF0YSBidXQgbm9uZSBwcm92aWRlZFxuICAgICAqL1xuICAgIGNvbnN0IG1vdGlvblR5cGUgPSBtb3Rpb24ubW90aW9uVHlwZT8udG9Mb3dlckNhc2UoKTtcblxuICAgIHN3aXRjaCAobW90aW9uVHlwZSkge1xuICAgICAgY2FzZSBcInN0YXRpY1wiOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVTdGF0aWNMb2NhdGlvbihtb3Rpb24pO1xuICAgICAgY2FzZSBcInByb1wiOlxuICAgICAgY2FzZSBcImFudGlcIjpcbiAgICAgIGNhc2UgXCJmbG9hdFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVTaGlmdExvY2F0aW9uKG1vdGlvbik7XG4gICAgICBjYXNlIFwiZGFzaFwiOlxuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVEYXNoTG9jYXRpb24obW90aW9uLCBwaWN0b2dyYXBoRGF0YSk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgYFVua25vd24gbW90aW9uIHR5cGU6ICR7bW90aW9uVHlwZX0sIHVzaW5nIHN0YXJ0IGxvY2F0aW9uYFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gbW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEg7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTdGF0aWNMb2NhdGlvbihtb3Rpb246IE1vdGlvbkRhdGEpOiBMb2NhdGlvbiB7XG4gICAgLyoqXG4gICAgICogQ2FsY3VsYXRlIGxvY2F0aW9uIGZvciBzdGF0aWMgYXJyb3dzLlxuICAgICAqXG4gICAgICogU3RhdGljIGFycm93cyB1c2UgdGhlaXIgc3RhcnQgbG9jYXRpb24gZGlyZWN0bHkuXG4gICAgICpcbiAgICAgKiBBcmdzOlxuICAgICAqICAgICBtb3Rpb246IE1vdGlvbiBkYXRhIHdpdGggU1RBVElDIHR5cGVcbiAgICAgKlxuICAgICAqIFJldHVybnM6XG4gICAgICogICAgIFRoZSBzdGFydCBsb2NhdGlvbiBvZiB0aGUgbW90aW9uXG4gICAgICovXG4gICAgcmV0dXJuIG1vdGlvbi5zdGFydExvY2F0aW9uIHx8IExvY2F0aW9uLk5PUlRIO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTaGlmdExvY2F0aW9uKG1vdGlvbjogTW90aW9uRGF0YSk6IExvY2F0aW9uIHtcbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgbG9jYXRpb24gZm9yIHNoaWZ0IGFycm93cyAoUFJPL0FOVEkvRkxPQVQpLlxuICAgICAqXG4gICAgICogU2hpZnQgYXJyb3dzIHVzZSBhIG1hcHBpbmcgZnJvbSBzdGFydC9lbmQgbG9jYXRpb24gcGFpcnMgdG8gZGV0ZXJtaW5lXG4gICAgICogdGhlaXIgYXJyb3cgbG9jYXRpb24uIFRoaXMgaW1wbGVtZW50cyB0aGUgcHJvdmVuIHNoaWZ0IGxvY2F0aW9uIGFsZ29yaXRobS5cbiAgICAgKlxuICAgICAqIEFyZ3M6XG4gICAgICogICAgIG1vdGlvbjogTW90aW9uIGRhdGEgd2l0aCBQUk8sIEFOVEksIG9yIEZMT0FUIHR5cGVcbiAgICAgKlxuICAgICAqIFJldHVybnM6XG4gICAgICogICAgIENhbGN1bGF0ZWQgbG9jYXRpb24gYmFzZWQgb24gc3RhcnQvZW5kIHBhaXIgbWFwcGluZ1xuICAgICAqL1xuICAgIGlmICghbW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgIW1vdGlvbi5lbmRMb2NhdGlvbikge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBcIlNoaWZ0IG1vdGlvbiBtaXNzaW5nIHN0YXJ0TG9jYXRpb24gb3IgZW5kTG9jYXRpb24sIHVzaW5nIHN0YXJ0TG9jYXRpb25cIlxuICAgICAgKTtcbiAgICAgIHJldHVybiBtb3Rpb24uc3RhcnRMb2NhdGlvbiB8fCBMb2NhdGlvbi5OT1JUSDtcbiAgICB9XG5cbiAgICBjb25zdCBsb2NhdGlvblBhaXJLZXkgPSB0aGlzLmNyZWF0ZUxvY2F0aW9uUGFpcktleShbXG4gICAgICBtb3Rpb24uc3RhcnRMb2NhdGlvbixcbiAgICAgIG1vdGlvbi5lbmRMb2NhdGlvbixcbiAgICBdKTtcbiAgICBjb25zdCBjYWxjdWxhdGVkTG9jYXRpb24gPVxuICAgICAgdGhpcy5zaGlmdERpcmVjdGlvblBhaXJzW2xvY2F0aW9uUGFpcktleV0gfHwgbW90aW9uLnN0YXJ0TG9jYXRpb247XG5cbiAgICByZXR1cm4gY2FsY3VsYXRlZExvY2F0aW9uO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVEYXNoTG9jYXRpb24oXG4gICAgbW90aW9uOiBNb3Rpb25EYXRhLFxuICAgIHBpY3RvZ3JhcGhEYXRhPzogUGljdG9ncmFwaERhdGFcbiAgKTogTG9jYXRpb24ge1xuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSBsb2NhdGlvbiBmb3IgZGFzaCBhcnJvd3MuXG4gICAgICpcbiAgICAgKiBEYXNoIGFycm93cyB1c2Ugc3BlY2lhbGl6ZWQgbG9naWMgdGhhdCBtYXkgcmVxdWlyZSBwaWN0b2dyYXBoIGRhdGFcbiAgICAgKiBmb3IgVHlwZSAzIGRldGVjdGlvbiBhbmQgb3RoZXIgc3BlY2lhbCBjYXNlcy5cbiAgICAgKlxuICAgICAqIEFyZ3M6XG4gICAgICogICAgIG1vdGlvbjogTW90aW9uIGRhdGEgd2l0aCBEQVNIIHR5cGVcbiAgICAgKiAgICAgcGljdG9ncmFwaERhdGE6IFBpY3RvZ3JhcGggZGF0YSBmb3IgVHlwZSAzIGRldGVjdGlvblxuICAgICAqXG4gICAgICogUmV0dXJuczpcbiAgICAgKiAgICAgQ2FsY3VsYXRlZCBkYXNoIGxvY2F0aW9uXG4gICAgICpcbiAgICAgKiBUaHJvd3M6XG4gICAgICogICAgIEVycm9yOiBJZiBwaWN0b2dyYXBoIGRhdGEgaXMgcmVxdWlyZWQgYnV0IG5vdCBwcm92aWRlZFxuICAgICAqL1xuICAgIGlmICghcGljdG9ncmFwaERhdGEpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgXCJObyBwaWN0b2dyYXBoIGRhdGEgcHJvdmlkZWQgZm9yIGRhc2ggbG9jYXRpb24gY2FsY3VsYXRpb24sIHVzaW5nIHN0YXJ0IGxvY2F0aW9uXCJcbiAgICAgICk7XG4gICAgICByZXR1cm4gbW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEg7XG4gICAgfVxuXG4gICAgY29uc3QgaXNCbHVlQXJyb3cgPSB0aGlzLmlzQmx1ZUFycm93TW90aW9uKG1vdGlvbiwgcGljdG9ncmFwaERhdGEpO1xuXG4gICAgcmV0dXJuIHRoaXMuZGFzaExvY2F0aW9uU2VydmljZS5jYWxjdWxhdGVEYXNoTG9jYXRpb25Gcm9tUGljdG9ncmFwaERhdGEoXG4gICAgICBwaWN0b2dyYXBoRGF0YSxcbiAgICAgIGlzQmx1ZUFycm93XG4gICAgKTtcbiAgfVxuXG4gIGdldFN1cHBvcnRlZE1vdGlvblR5cGVzKCk6IE1vdGlvblR5cGVbXSB7XG4gICAgLyoqXG4gICAgICogR2V0IGxpc3Qgb2YgbW90aW9uIHR5cGVzIHN1cHBvcnRlZCBieSB0aGlzIGNhbGN1bGF0b3IuXG4gICAgICpcbiAgICAgKiBSZXR1cm5zOlxuICAgICAqICAgICBMaXN0IG9mIHN1cHBvcnRlZCBNb3Rpb25UeXBlIGVudW0gdmFsdWVzXG4gICAgICovXG4gICAgcmV0dXJuIFtcbiAgICAgIE1vdGlvblR5cGUuU1RBVElDLFxuICAgICAgTW90aW9uVHlwZS5QUk8sXG4gICAgICBNb3Rpb25UeXBlLkFOVEksXG4gICAgICBNb3Rpb25UeXBlLkZMT0FULFxuICAgICAgTW90aW9uVHlwZS5EQVNILFxuICAgIF07XG4gIH1cblxuICB2YWxpZGF0ZU1vdGlvbkRhdGEobW90aW9uOiBNb3Rpb25EYXRhKTogYm9vbGVhbiB7XG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgdGhhdCBtb3Rpb24gZGF0YSBpcyBzdWl0YWJsZSBmb3IgbG9jYXRpb24gY2FsY3VsYXRpb24uXG4gICAgICpcbiAgICAgKiBBcmdzOlxuICAgICAqICAgICBtb3Rpb246IE1vdGlvbiBkYXRhIHRvIHZhbGlkYXRlXG4gICAgICpcbiAgICAgKiBSZXR1cm5zOlxuICAgICAqICAgICBUcnVlIGlmIG1vdGlvbiBkYXRhIGlzIHZhbGlkIGZvciBsb2NhdGlvbiBjYWxjdWxhdGlvblxuICAgICAqL1xuICAgIGlmICghbW90aW9uKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgbW90aW9uVHlwZSA9IG1vdGlvbi5tb3Rpb25UeXBlPy50b0xvd2VyQ2FzZSgpO1xuICAgIGlmICghdGhpcy5nZXRTdXBwb3J0ZWRNb3Rpb25UeXBlcygpLmluY2x1ZGVzKG1vdGlvblR5cGUgYXMgTW90aW9uVHlwZSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHMgYmFzZWQgb24gbW90aW9uIHR5cGVcbiAgICBpZiAoW1wicHJvXCIsIFwiYW50aVwiLCBcImZsb2F0XCJdLmluY2x1ZGVzKG1vdGlvblR5cGUgfHwgXCJcIikpIHtcbiAgICAgIC8vIFNoaWZ0IG1vdGlvbnMgcmVxdWlyZSBib3RoIHN0YXJ0IGFuZCBlbmQgbG9jYXRpb25zXG4gICAgICByZXR1cm4gbW90aW9uLnN0YXJ0TG9jYXRpb24gIT0gbnVsbCAmJiBtb3Rpb24uZW5kTG9jYXRpb24gIT0gbnVsbDtcbiAgICB9XG4gICAgaWYgKFtcInN0YXRpY1wiLCBcImRhc2hcIl0uaW5jbHVkZXMobW90aW9uVHlwZSB8fCBcIlwiKSkge1xuICAgICAgLy8gU3RhdGljIGFuZCBkYXNoIG1vdGlvbnMgcmVxdWlyZSBhdCBsZWFzdCBzdGFydCBsb2NhdGlvblxuICAgICAgcmV0dXJuIG1vdGlvbi5zdGFydExvY2F0aW9uICE9IG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBleHRyYWN0QmVhdERhdGFGcm9tUGljdG9ncmFwaChwaWN0b2dyYXBoOiBQaWN0b2dyYXBoRGF0YSk6IEJlYXREYXRhIHwgbnVsbCB7XG4gICAgLyoqRXh0cmFjdCBiZWF0IGRhdGEgZnJvbSBwaWN0b2dyYXBoIGZvciBkYXNoIGxvY2F0aW9uIGNhbGN1bGF0aW9uLiovXG4gICAgaWYgKCFwaWN0b2dyYXBoLmFycm93cykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gRXh0cmFjdCBtb3Rpb24gZGF0YSBmcm9tIG1vdGlvbnMgZGljdGlvbmFyeVxuICAgIGNvbnN0IGJsdWVNb3Rpb24gPSBwaWN0b2dyYXBoLm1vdGlvbnM/LmJsdWU7XG4gICAgY29uc3QgcmVkTW90aW9uID0gcGljdG9ncmFwaC5tb3Rpb25zPy5yZWQ7XG5cbiAgICAvLyBDcmVhdGUgYmVhdCBkYXRhXG4gICAgcmV0dXJuIHtcbiAgICAgIGJlYXROdW1iZXI6IHBpY3RvZ3JhcGgubWV0YWRhdGE/LmNyZWF0ZWRfZnJvbV9iZWF0IHx8IDEsXG4gICAgICBsZXR0ZXI6IHBpY3RvZ3JhcGgubGV0dGVyLFxuICAgICAgcGljdG9ncmFwaERhdGE6IHtcbiAgICAgICAgbW90aW9uczoge1xuICAgICAgICAgIGJsdWU6IGJsdWVNb3Rpb24sXG4gICAgICAgICAgcmVkOiByZWRNb3Rpb24sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0gYXMgQmVhdERhdGE7XG4gIH1cblxuICBpc0JsdWVBcnJvd01vdGlvbihcbiAgICBtb3Rpb246IE1vdGlvbkRhdGEsXG4gICAgcGljdG9ncmFwaERhdGE6IFBpY3RvZ3JhcGhEYXRhXG4gICk6IGJvb2xlYW4ge1xuICAgIC8qKkRldGVybWluZSBpZiB0aGUgZ2l2ZW4gbW90aW9uIGJlbG9uZ3MgdG8gdGhlIGJsdWUgYXJyb3cuKi9cbiAgICAvLyBDb21wYXJlIHRoZSBtb3Rpb24gd2l0aCBibHVlIGFuZCByZWQgbW90aW9ucyBpbiBwaWN0b2dyYXBoIGRhdGFcbiAgICBpZiAocGljdG9ncmFwaERhdGEubW90aW9ucz8uYmx1ZSA9PT0gbW90aW9uKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LnJlZCA9PT0gbW90aW9uKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIEZhbGxiYWNrOiBpZiB3ZSBjYW4ndCBkZXRlcm1pbmUsIGFzc3VtZSBibHVlXG4gICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGRldGVybWluZSBhcnJvdyBjb2xvciBmb3IgbW90aW9uLCBhc3N1bWluZyBibHVlXCIpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5vcm1hbGl6ZWQga2V5IGZvciBsb2NhdGlvbiBwYWlycyB0byBlbmFibGUgYmlkaXJlY3Rpb25hbCBsb29rdXAuXG4gICAqIFRoaXMgZW5zdXJlcyB0aGF0IFtBLCBCXSBhbmQgW0IsIEFdIHByb2R1Y2UgdGhlIHNhbWUga2V5LlxuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVMb2NhdGlvblBhaXJLZXkobG9jYXRpb25zOiBMb2NhdGlvbltdKTogc3RyaW5nIHtcbiAgICAvLyBTb3J0IGxvY2F0aW9ucyB0byBlbnN1cmUgY29uc2lzdGVudCBrZXkgcmVnYXJkbGVzcyBvZiBvcmRlclxuICAgIGNvbnN0IHNvcnRlZExvY2F0aW9ucyA9IFsuLi5sb2NhdGlvbnNdLnNvcnQoKTtcbiAgICByZXR1cm4gc29ydGVkTG9jYXRpb25zLmpvaW4oXCIsXCIpO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiQUFlQSxTQUFTLFVBQVUsa0JBQWtCO0FBR3JDLFNBQVMsOEJBQThCO0FBRWhDLGFBQU0sd0JBQTREO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFRL0Q7QUFBQTtBQUFBO0FBQUEsRUFJUyxzQkFBZ0Q7QUFBQTtBQUFBLElBRS9ELENBQUMsS0FBSyxzQkFBc0IsQ0FBQyxTQUFTLE9BQU8sU0FBUyxJQUFJLENBQUMsQ0FBQyxHQUMxRCxTQUFTO0FBQUEsSUFDWCxDQUFDLEtBQUssc0JBQXNCLENBQUMsU0FBUyxNQUFNLFNBQVMsS0FBSyxDQUFDLENBQUMsR0FDMUQsU0FBUztBQUFBLElBQ1gsQ0FBQyxLQUFLLHNCQUFzQixDQUFDLFNBQVMsT0FBTyxTQUFTLElBQUksQ0FBQyxDQUFDLEdBQzFELFNBQVM7QUFBQSxJQUNYLENBQUMsS0FBSyxzQkFBc0IsQ0FBQyxTQUFTLE1BQU0sU0FBUyxLQUFLLENBQUMsQ0FBQyxHQUMxRCxTQUFTO0FBQUE7QUFBQSxJQUVYLENBQUMsS0FBSyxzQkFBc0IsQ0FBQyxTQUFTLFdBQVcsU0FBUyxTQUFTLENBQUMsQ0FBQyxHQUNuRSxTQUFTO0FBQUEsSUFDWCxDQUFDLEtBQUssc0JBQXNCLENBQUMsU0FBUyxXQUFXLFNBQVMsU0FBUyxDQUFDLENBQUMsR0FDbkUsU0FBUztBQUFBLElBQ1gsQ0FBQyxLQUFLLHNCQUFzQixDQUFDLFNBQVMsV0FBVyxTQUFTLFNBQVMsQ0FBQyxDQUFDLEdBQ25FLFNB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
