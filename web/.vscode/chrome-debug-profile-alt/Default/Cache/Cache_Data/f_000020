import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/lib/components/tabs/sequence_card/SequenceCardTab.svelte");import "/node_modules/.vite/deps/svelte_internal_disclose-version.js?v=474c1bba";

SequenceCardTab[$.FILENAME] = 'src/lib/components/tabs/sequence_card/SequenceCardTab.svelte';

import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=474c1bba";
import { onMount } from "/node_modules/.vite/deps/svelte.js?v=474c1bba";
import SequenceCardNavigation from "/src/lib/components/tabs/sequence_card/Navigation.svelte";
import PageDisplay from "/src/lib/components/tabs/sequence_card/PageDisplay.svelte";
import { PngMetadataExtractor } from "/src/lib/utils/png-metadata-extractor.ts";

var root = $.add_locations($.from_html(`<div class="sequence-card-tab s-Gv3PCk3SAVyc"><div class="header s-Gv3PCk3SAVyc"><div class="header-content s-Gv3PCk3SAVyc"><h1 class="title s-Gv3PCk3SAVyc">Sequence Cards</h1> <p class="subtitle s-Gv3PCk3SAVyc"> </p></div></div> <div class="main-content s-Gv3PCk3SAVyc"><div class="navigation s-Gv3PCk3SAVyc"><!></div> <div class="content s-Gv3PCk3SAVyc"><!></div></div></div>`), SequenceCardTab[$.FILENAME], [
	[
		129,
		0,

		[
			[131, 2, [[132, 4, [[133, 6], [134, 6]]]]],
			[139, 2, [[141, 4], [151, 4]]]
		]
	]
]);

function SequenceCardTab($$anchor, $$props) {
	$.check_target(new.target);
	$.push($$props, true, SequenceCardTab);

	let sequences = $.tag($.state($.proxy([])), 'sequences');
	let isLoading = $.tag($.state(false), 'isLoading');
	let selectedLength = $.tag($.state(16), 'selectedLength');
	let columnCount = $.tag($.state(3), 'columnCount');
	let error = $.tag($.state(null), 'error');

	let filteredSequences = $.tag(
		$.derived(() => () => {
			if ($.strict_equals($.get(selectedLength), 0)) {
				return $.get(sequences);
			}

			return $.get(sequences).filter((seq) => $.strict_equals(seq.beats.length, $.get(selectedLength)));
		}),
		'filteredSequences'
	);

	let pages = $.tag(
		$.derived(() => () => {
			return createPages($.get(filteredSequences)());
		}),
		'pages'
	);

	onMount(async () => {
		(await $.track_reactivity_loss(loadSequences()))();
	});

	async function loadSequences() {
		try {
			$.set(isLoading, true);
			$.set(error, null);

			const response = (await $.track_reactivity_loss(fetch("/api/sequences")))();
			const data = (await $.track_reactivity_loss(response.json()))();

			if (data.success) {
				const sequencePromises = data.sequences.map(async (seq) => {
					try {
						const metadata = (await $.track_reactivity_loss(PngMetadataExtractor.extractSequenceMetadata(seq.word)))();
						const realBeats = metadata.slice(1).filter((step) => step.letter && !step.sequence_start_position);
						const actualLength = realBeats.length;

						console.log(`\u{1F4CF} ${seq.word}: ${actualLength} beats (from metadata)`);

						return {
							id: seq.word,
							name: seq.word,
							beats: new Array(actualLength).fill({}),

							// Use actual length from metadata
							metadata: {
								imagePath: seq.path,
								word: seq.word,
								actualLength,
								rawMetadata: metadata
							}
						};
					} catch(error2) {
						console.warn(...$.log_if_contains_state('warn', `\u26A0\uFE0F Failed to extract metadata for ${seq.word}, using default length:`, error2));

						return {
							id: seq.word,
							name: seq.word,
							beats: new Array(16).fill({}),

							// Default fallback
							metadata: {
								imagePath: seq.path,
								word: seq.word,
								actualLength: 16,
								extractionError: error2
							}
						};
					}
				});

				$.set(sequences, (await $.track_reactivity_loss(Promise.all(sequencePromises)))(), true);
			} else {
				throw new Error(data.error || "Failed to load sequences");
			}
		} catch(err) {
			$.set(error, err instanceof Error ? err.message : "Failed to load sequences", true);
			console.error(...$.log_if_contains_state('error', "Failed to load sequences:", err));
		} finally {
			$.set(isLoading, false);
		}
	}

	function handleLengthSelected(length) {
		$.set(selectedLength, length, true);
	}

	function handleColumnCountChanged(count) {
		$.set(columnCount, count, true);
	}

	function createPages(sequences2) {
		if ($.strict_equals(sequences2.length, 0)) {
			return [{ id: "empty-page", sequences: [], isEmpty: true }];
		}

		const sequencesPerPage = 6;
		const pages2 = [];

		for (let i = 0; i < sequences2.length; i += sequencesPerPage) {
			const pageSequences = sequences2.slice(i, i + sequencesPerPage);

			pages2.push({
				id: `page-${Math.floor(i / sequencesPerPage) + 1}`,
				sequences: pageSequences,
				isEmpty: false
			});
		}

		return pages2;
	}

	let progressMessage = $.tag($.state("Ready"), 'progressMessage');

	$.user_effect(() => {
		if ($.get(isLoading)) {
			$.set(progressMessage, `Loading ${$.strict_equals($.get(selectedLength), 0) ? "all" : `${$.get(selectedLength)}-beat`} sequences...`);
		} else {
			const pageCount = $.get(pages)().length;
			const sequenceCount = $.get(filteredSequences)().length;

			if ($.strict_equals(pageCount, 1) && $.get(pages)()[0].isEmpty) {
				$.set(progressMessage, `No ${$.strict_equals($.get(selectedLength), 0) ? "" : `${$.get(selectedLength)}-beat `}sequences found`);
			} else {
				$.set(progressMessage, `${pageCount} page${$.strict_equals(pageCount, 1) ? "" : "s"} \u2022 ${sequenceCount} sequence${$.strict_equals(sequenceCount, 1) ? "" : "s"}`);
			}
		}
	});

	var div = root();
	var div_1 = $.child(div);
	var div_2 = $.child(div_1);
	var p = $.sibling($.child(div_2), 2);
	var text = $.child(p, true);

	$.reset(p);
	$.reset(div_2);
	$.reset(div_1);

	var div_3 = $.sibling(div_1, 2);
	var div_4 = $.child(div_3);
	var node = $.child(div_4);

	$.add_svelte_meta(
		() => SequenceCardNavigation(node, {
			get selectedLength() {
				return $.get(selectedLength);
			},

			get columnCount() {
				return $.get(columnCount);
			},

			onLengthSelected: handleLengthSelected,
			onColumnCountChanged: handleColumnCountChanged
		}),
		'component',
		SequenceCardTab,
		142,
		6,
		{ componentTag: 'SequenceCardNavigation' }
	);

	$.reset(div_4);

	var div_5 = $.sibling(div_4, 2);
	var node_1 = $.child(div_5);

	{
		let $0 = $.derived(() => $.get(pages)());

		$.add_svelte_meta(
			() => PageDisplay(node_1, {
				get pages() {
					return $.get($0);
				},

				get isLoading() {
					return $.get(isLoading);
				},

				get error() {
					return $.get(error);
				},

				get columnCount() {
					return $.get(columnCount);
				},

				onRetry: loadSequences
			}),
			'component',
			SequenceCardTab,
			152,
			6,
			{ componentTag: 'PageDisplay' }
		);
	}

	$.reset(div_5);
	$.reset(div_3);
	$.reset(div);
	$.template_effect(() => $.set_text(text, $.get(progressMessage)));
	$.append($$anchor, div);

	return $.pop({ ...$.legacy_api() });
}

if (import.meta.hot) {
	SequenceCardTab = $.hmr(SequenceCardTab, () => SequenceCardTab[$.HMR].source);

	import.meta.hot.acceptExports(["default"],(module) => {
		$.cleanup_styles('s-Gv3PCk3SAVyc');
		module.default[$.HMR].source = SequenceCardTab[$.HMR].source;
		$.set(SequenceCardTab[$.HMR].source, module.default[$.HMR].original);
	});
}

export default SequenceCardTab;
import "/src/lib/components/tabs/sequence_card/SequenceCardTab.svelte?svelte&type=style&lang.css";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7U0FLUztPQUtILDRCQUFxQztPQUNyQyxpQkFBbUI7U0FDbkIsNEJBQTBCOzs7Ozs7Ozs7Ozs7Ozs0Q0FaaEMsQ0FBQzs7OztLQW1CSztLQUNFLDBCQUFtQixLQUFHO0tBQ3hCLCtCQUFPO0tBQ1Q7S0FDQSxzQkFBaUMsSUFBSTs7S0FTdkM7d0JBQW9COzZCQUNaLGlCQUFjO2lCQUNyQjtHQUVEOztnQkFDTTtFQUNGOzs7O0tBS0E7d0JBQW1CO1VBRWYsa0JBQWM7RUFFaEI7Ozs7Q0FHZ0Qsb0JBQ3RDO2lDQUNOO0NBSUE7O2dCQUlFO01BRUY7U0FFQSxXQUFRO1NBQUEsT0FDTjs7U0FJQSwwQ0FBUTtTQUNSLHNDQUFVOztPQUM0QjtVQUVwQyxtQkFBZTtTQUNmO1lBRUEsMENBQWEsNkNBQ2Y7WUFLQUEscUJBQ0YsU0FFQSxRQUNNLFNBQUk7WUFFb0I7O01BQ2xCLFFBQ1IsaUJBQ00sSUFBSTs7O09BSWQ7T0FDRjtPQUNEOzs7T0FHRDtRQUNLO1FBQ0ssTUFBTTtRQUNsQjtRQUNZOzs7S0FHZCxRQUFFQSxRQUFBO01BQ0EsUUFBWSx1RkFDZCxtQ0FDRkE7OztPQVVTO09BQ1AsTUFBYztPQUNoQjs7O09BR1M7UUFDSEMsV0FBVSxJQUFjO1FBQ25CO1FBQ0w7UUFDTSxpQkFBQUQ7OztLQUdOO0lBQ0Y7O1VBTUlFLDBDQUFTO0dBRWYsT0FBUztjQUNELFdBQWdCRCxTQUFVLDBCQUFhO0dBQzdDQztFQUFXLFFBQ0wsS0FBUTtTQUNaLHNCQUFXO0dBQ1gsa0RBQVM7RUFDWCxVQUFDO1NBQ0g7RUFFQTtDQUNGOztVQVNTO1FBQ0wsZ0JBQU07Q0FDTjs7VUFJTztRQUNMO0NBQTZIOztVQUk3SCxZQUFBRCxZQUFBOzthQUlELElBQU8sY0FDUCxlQUNFLFNBQU87RUFHWjs7UUFJRyxtQkFBb0I7UUFDbEJDOztXQUVGLFdBQUFELFdBQUE7U0FDRSxnQkFBY0EsV0FBQTs7R0FDdkJDLE9BQVM7SUFDRCxpQkFBaUIsTUFBQyxvQkFBb0I7SUFDdEM7SUFDRDs7OztTQUlFQTtDQUNUOztLQUdBLGdDQUFjOztDQUdkLG9CQUFPO1lBQ0QsWUFBRztTQUNMLGtEQUFHO0VBQ0wsT0FBRzs7U0FFQzs7dUJBRUYsV0FBYTtVQUNULDZDQUFrQjtHQUN0QixPQUFRO1VBQ1Isb0JBQW1CO0dBQ25CO0VBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7eUJBc0JVOzs7Ozs7Ozs7Ozs7Ozs7aUNBT0csS0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7YUFJZDs7Ozs7Ozs7Ozs7OztnREF2QmdCOzs7O0NBUmxCIiwibmFtZXMiOlsiZXJyb3IiLCJzZXF1ZW5jZXMiLCJwYWdlcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJTZXF1ZW5jZUNhcmRUYWIuc3ZlbHRlIl0sInNvdXJjZXNDb250ZW50IjpbIjwhLS0gU2VxdWVuY2VDYXJkVGFiLnN2ZWx0ZSAtIFNpbXBsZSBwYWdlLWJhc2VkIHNlcXVlbmNlIGNhcmQgdGFiIG1hdGNoaW5nIGxlZ2FjeSBkZXNrdG9wIC0tPlxuPHNjcmlwdCBsYW5nPVwidHNcIj5cbiAgaW1wb3J0IHsgb25Nb3VudCB9IGZyb20gXCJzdmVsdGVcIjtcbiAgaW1wb3J0IHR5cGUgeyBTZXF1ZW5jZURhdGEgfSBmcm9tIFwiJHNlcnZpY2VzL2ludGVyZmFjZXMvZG9tYWluLXR5cGVzXCI7XG4gIC8vIE5vdGU6IExvYWRpbmcgZGlyZWN0bHkgZnJvbSBkaWN0aW9uYXJ5IEFQSVxuICBpbXBvcnQgU2VxdWVuY2VDYXJkTmF2aWdhdGlvbiBmcm9tIFwiLi9OYXZpZ2F0aW9uLnN2ZWx0ZVwiO1xuICBpbXBvcnQgUGFnZURpc3BsYXkgZnJvbSBcIi4vUGFnZURpc3BsYXkuc3ZlbHRlXCI7XG4gIGltcG9ydCB7IFBuZ01ldGFkYXRhRXh0cmFjdG9yIH0gZnJvbSBcIiRsaWIvdXRpbHMvcG5nLW1ldGFkYXRhLWV4dHJhY3RvclwiO1xuXG4gIC8vIFNpbXBsZSBzdGF0ZSBtYXRjaGluZyBsZWdhY3kgZGVza3RvcFxuICBsZXQgc2VxdWVuY2VzOiBTZXF1ZW5jZURhdGFbXSA9ICRzdGF0ZShbXSk7XG4gIGxldCBpc0xvYWRpbmcgPSAkc3RhdGUoZmFsc2UpO1xuICBsZXQgc2VsZWN0ZWRMZW5ndGggPSAkc3RhdGUoMTYpOyAvLyBEZWZhdWx0IGxpa2UgZGVza3RvcFxuICBsZXQgY29sdW1uQ291bnQgPSAkc3RhdGUoMyk7IC8vIERlZmF1bHQgbGlrZSBkZXNrdG9wXG4gIGxldCBlcnJvciA9ICRzdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcblxuICAvLyBOb3RlOiBXZSBsb2FkIGRpcmVjdGx5IGZyb20gZGljdGlvbmFyeSBBUEkgaW5zdGVhZCBvZiB1c2luZyBzZXF1ZW5jZSBzZXJ2aWNlXG5cbiAgLy8gRmlsdGVyZWQgc2VxdWVuY2VzIGJhc2VkIG9uIHNlbGVjdGVkIGxlbmd0aFxuICBsZXQgZmlsdGVyZWRTZXF1ZW5jZXMgPSAkZGVyaXZlZCgoKSA9PiB7XG4gICAgaWYgKHNlbGVjdGVkTGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gc2VxdWVuY2VzOyAvLyBTaG93IGFsbFxuICAgIH1cbiAgICByZXR1cm4gc2VxdWVuY2VzLmZpbHRlcigoc2VxKSA9PiBzZXEuYmVhdHMubGVuZ3RoID09PSBzZWxlY3RlZExlbmd0aCk7XG4gIH0pO1xuXG4gIC8vIENyZWF0ZSBwYWdlcyBmcm9tIGZpbHRlcmVkIHNlcXVlbmNlcyAoY29sdW1uQ291bnQgZG9lc24ndCBhZmZlY3QgcGFnZSBjb250ZW50KVxuICBsZXQgcGFnZXMgPSAkZGVyaXZlZCgoKSA9PiB7XG4gICAgcmV0dXJuIGNyZWF0ZVBhZ2VzKGZpbHRlcmVkU2VxdWVuY2VzKCkpO1xuICB9KTtcblxuICAvLyBMb2FkIHNlcXVlbmNlcyBvbiBtb3VudFxuICBvbk1vdW50KGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBsb2FkU2VxdWVuY2VzKCk7XG4gIH0pO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGxvYWRTZXF1ZW5jZXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGlzTG9hZGluZyA9IHRydWU7XG4gICAgICBlcnJvciA9IG51bGw7XG5cbiAgICAgIC8vIExvYWQgc2VxdWVuY2VzIGRpcmVjdGx5IGZyb20gZGljdGlvbmFyeSBBUEkgaW5zdGVhZCBvZiBsb2NhbCBzdG9yYWdlXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiL2FwaS9zZXF1ZW5jZXNcIik7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBpZiAoZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgIC8vIENvbnZlcnQgQVBJIHJlc3BvbnNlIHRvIFNlcXVlbmNlRGF0YSBmb3JtYXQgd2l0aCBhY3R1YWwgbWV0YWRhdGEgZXh0cmFjdGlvblxuICAgICAgICBjb25zdCBzZXF1ZW5jZVByb21pc2VzID0gZGF0YS5zZXF1ZW5jZXMubWFwKGFzeW5jIChzZXE6IGFueSkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBFeHRyYWN0IG1ldGFkYXRhIGZyb20gUE5HIHRvIGdldCBhY3R1YWwgc2VxdWVuY2UgbGVuZ3RoXG4gICAgICAgICAgICBjb25zdCBtZXRhZGF0YSA9IGF3YWl0IFBuZ01ldGFkYXRhRXh0cmFjdG9yLmV4dHJhY3RTZXF1ZW5jZU1ldGFkYXRhKFxuICAgICAgICAgICAgICBzZXEud29yZFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFjdHVhbCBzZXF1ZW5jZSBsZW5ndGggZnJvbSBtZXRhZGF0YVxuICAgICAgICAgICAgLy8gRXhjbHVkZSBtZXRhZGF0YSBlbnRyeSAoaW5kZXggMCkgYW5kIHN0YXJ0IHBvc2l0aW9uIGVudHJpZXNcbiAgICAgICAgICAgIGNvbnN0IHJlYWxCZWF0cyA9IG1ldGFkYXRhXG4gICAgICAgICAgICAgIC5zbGljZSgxKVxuICAgICAgICAgICAgICAuZmlsdGVyKFxuICAgICAgICAgICAgICAgIChzdGVwOiBhbnkpID0+IHN0ZXAubGV0dGVyICYmICFzdGVwLnNlcXVlbmNlX3N0YXJ0X3Bvc2l0aW9uXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbExlbmd0aCA9IHJlYWxCZWF0cy5sZW5ndGg7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICBg8J+TjyAke3NlcS53b3JkfTogJHthY3R1YWxMZW5ndGh9IGJlYXRzIChmcm9tIG1ldGFkYXRhKWBcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlkOiBzZXEud29yZCxcbiAgICAgICAgICAgICAgbmFtZTogc2VxLndvcmQsXG4gICAgICAgICAgICAgIGJlYXRzOiBuZXcgQXJyYXkoYWN0dWFsTGVuZ3RoKS5maWxsKHt9KSwgLy8gVXNlIGFjdHVhbCBsZW5ndGggZnJvbSBtZXRhZGF0YVxuICAgICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgIGltYWdlUGF0aDogc2VxLnBhdGgsXG4gICAgICAgICAgICAgICAgd29yZDogc2VxLndvcmQsXG4gICAgICAgICAgICAgICAgYWN0dWFsTGVuZ3RoOiBhY3R1YWxMZW5ndGgsXG4gICAgICAgICAgICAgICAgcmF3TWV0YWRhdGE6IG1ldGFkYXRhLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICBg4pqg77iPIEZhaWxlZCB0byBleHRyYWN0IG1ldGFkYXRhIGZvciAke3NlcS53b3JkfSwgdXNpbmcgZGVmYXVsdCBsZW5ndGg6YCxcbiAgICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICAvLyBGYWxsYmFjayB0byBkZWZhdWx0IGxlbmd0aCBpZiBtZXRhZGF0YSBleHRyYWN0aW9uIGZhaWxzXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBpZDogc2VxLndvcmQsXG4gICAgICAgICAgICAgIG5hbWU6IHNlcS53b3JkLFxuICAgICAgICAgICAgICBiZWF0czogbmV3IEFycmF5KDE2KS5maWxsKHt9KSwgLy8gRGVmYXVsdCBmYWxsYmFja1xuICAgICAgICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgICAgICAgIGltYWdlUGF0aDogc2VxLnBhdGgsXG4gICAgICAgICAgICAgICAgd29yZDogc2VxLndvcmQsXG4gICAgICAgICAgICAgICAgYWN0dWFsTGVuZ3RoOiAxNixcbiAgICAgICAgICAgICAgICBleHRyYWN0aW9uRXJyb3I6IGVycm9yLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFdhaXQgZm9yIGFsbCBtZXRhZGF0YSBleHRyYWN0aW9ucyB0byBjb21wbGV0ZVxuICAgICAgICBzZXF1ZW5jZXMgPSBhd2FpdCBQcm9taXNlLmFsbChzZXF1ZW5jZVByb21pc2VzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihkYXRhLmVycm9yIHx8IFwiRmFpbGVkIHRvIGxvYWQgc2VxdWVuY2VzXCIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZXJyb3IgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyci5tZXNzYWdlIDogXCJGYWlsZWQgdG8gbG9hZCBzZXF1ZW5jZXNcIjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBzZXF1ZW5jZXM6XCIsIGVycik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlzTG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIE5vdGU6IFNlcXVlbmNlIGxlbmd0aCBpcyBub3cgZXh0cmFjdGVkIGZyb20gUE5HIG1ldGFkYXRhXG5cbiAgLy8gSGFuZGxlIGxlbmd0aCBzZWxlY3Rpb24gZnJvbSBuYXZpZ2F0aW9uXG4gIGZ1bmN0aW9uIGhhbmRsZUxlbmd0aFNlbGVjdGVkKGxlbmd0aDogbnVtYmVyKSB7XG4gICAgc2VsZWN0ZWRMZW5ndGggPSBsZW5ndGg7XG4gIH1cblxuICAvLyBIYW5kbGUgY29sdW1uIGNvdW50IGNoYW5nZSBmcm9tIG5hdmlnYXRpb25cbiAgZnVuY3Rpb24gaGFuZGxlQ29sdW1uQ291bnRDaGFuZ2VkKGNvdW50OiBudW1iZXIpIHtcbiAgICBjb2x1bW5Db3VudCA9IGNvdW50O1xuICB9XG5cbiAgLy8gUGFnZSBjcmVhdGlvbiBsb2dpYyBtYXRjaGluZyBsZWdhY3kgZGVza3RvcCBleGFjdGx5XG4gIGZ1bmN0aW9uIGNyZWF0ZVBhZ2VzKHNlcXVlbmNlczogU2VxdWVuY2VEYXRhW10pIHtcbiAgICBpZiAoc2VxdWVuY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiBcImVtcHR5LXBhZ2VcIixcbiAgICAgICAgICBzZXF1ZW5jZXM6IFtdLFxuICAgICAgICAgIGlzRW1wdHk6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICBdO1xuICAgIH1cblxuICAgIC8vIExlZ2FjeSBkZXNrdG9wIGRlZmF1bHQ6IDIgY29sdW1ucyDDlyAzIHJvd3MgPSA2IHNlcXVlbmNlcyBwZXIgcGFnZVxuICAgIC8vIFRoaXMgbWF0Y2hlcyB0aGUgcHJpbnRhYmxlX2ZhY3RvcnkucHkgZGVmYXVsdCBncmlkIGNvbmZpZ3VyYXRpb25cbiAgICBjb25zdCBzZXF1ZW5jZXNQZXJQYWdlID0gNjtcbiAgICBjb25zdCBwYWdlcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXF1ZW5jZXMubGVuZ3RoOyBpICs9IHNlcXVlbmNlc1BlclBhZ2UpIHtcbiAgICAgIGNvbnN0IHBhZ2VTZXF1ZW5jZXMgPSBzZXF1ZW5jZXMuc2xpY2UoaSwgaSArIHNlcXVlbmNlc1BlclBhZ2UpO1xuICAgICAgcGFnZXMucHVzaCh7XG4gICAgICAgIGlkOiBgcGFnZS0ke01hdGguZmxvb3IoaSAvIHNlcXVlbmNlc1BlclBhZ2UpICsgMX1gLFxuICAgICAgICBzZXF1ZW5jZXM6IHBhZ2VTZXF1ZW5jZXMsXG4gICAgICAgIGlzRW1wdHk6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhZ2VzO1xuICB9XG5cbiAgLy8gUHJvZ3Jlc3MgbWVzc2FnZSAtIHNpbXBsaWZpZWQgdG8gYXZvaWQgY29tcGlsYXRpb24gaXNzdWVzXG4gIGxldCBwcm9ncmVzc01lc3NhZ2UgPSAkc3RhdGUoXCJSZWFkeVwiKTtcblxuICAvLyBVcGRhdGUgcHJvZ3Jlc3MgbWVzc2FnZSB3aGVuIHN0YXRlIGNoYW5nZXNcbiAgJGVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgcHJvZ3Jlc3NNZXNzYWdlID0gYExvYWRpbmcgJHtzZWxlY3RlZExlbmd0aCA9PT0gMCA/IFwiYWxsXCIgOiBgJHtzZWxlY3RlZExlbmd0aH0tYmVhdGB9IHNlcXVlbmNlcy4uLmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBhZ2VDb3VudCA9IHBhZ2VzKCkubGVuZ3RoO1xuICAgICAgY29uc3Qgc2VxdWVuY2VDb3VudCA9IGZpbHRlcmVkU2VxdWVuY2VzKCkubGVuZ3RoO1xuXG4gICAgICBpZiAocGFnZUNvdW50ID09PSAxICYmIHBhZ2VzKClbMF0uaXNFbXB0eSkge1xuICAgICAgICBwcm9ncmVzc01lc3NhZ2UgPSBgTm8gJHtzZWxlY3RlZExlbmd0aCA9PT0gMCA/IFwiXCIgOiBgJHtzZWxlY3RlZExlbmd0aH0tYmVhdCBgfXNlcXVlbmNlcyBmb3VuZGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwcm9ncmVzc01lc3NhZ2UgPSBgJHtwYWdlQ291bnR9IHBhZ2Uke3BhZ2VDb3VudCA9PT0gMSA/IFwiXCIgOiBcInNcIn0g4oCiICR7c2VxdWVuY2VDb3VudH0gc2VxdWVuY2Uke3NlcXVlbmNlQ291bnQgPT09IDEgPyBcIlwiIDogXCJzXCJ9YDtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuPC9zY3JpcHQ+XG5cbjwhLS0gU2ltcGxlIGxheW91dDogbmF2aWdhdGlvbiBzaWRlYmFyICsgcGFnZSBkaXNwbGF5IC0tPlxuPGRpdiBjbGFzcz1cInNlcXVlbmNlLWNhcmQtdGFiXCI+XG4gIDwhLS0gSGVhZGVyIC0tPlxuICA8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+XG4gICAgPGRpdiBjbGFzcz1cImhlYWRlci1jb250ZW50XCI+XG4gICAgICA8aDEgY2xhc3M9XCJ0aXRsZVwiPlNlcXVlbmNlIENhcmRzPC9oMT5cbiAgICAgIDxwIGNsYXNzPVwic3VidGl0bGVcIj57cHJvZ3Jlc3NNZXNzYWdlfTwvcD5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG5cbiAgPCEtLSBNYWluIGNvbnRlbnQgLS0+XG4gIDxkaXYgY2xhc3M9XCJtYWluLWNvbnRlbnRcIj5cbiAgICA8IS0tIE5hdmlnYXRpb24gU2lkZWJhciAtLT5cbiAgICA8ZGl2IGNsYXNzPVwibmF2aWdhdGlvblwiPlxuICAgICAgPFNlcXVlbmNlQ2FyZE5hdmlnYXRpb25cbiAgICAgICAge3NlbGVjdGVkTGVuZ3RofVxuICAgICAgICB7Y29sdW1uQ291bnR9XG4gICAgICAgIG9uTGVuZ3RoU2VsZWN0ZWQ9e2hhbmRsZUxlbmd0aFNlbGVjdGVkfVxuICAgICAgICBvbkNvbHVtbkNvdW50Q2hhbmdlZD17aGFuZGxlQ29sdW1uQ291bnRDaGFuZ2VkfVxuICAgICAgLz5cbiAgICA8L2Rpdj5cblxuICAgIDwhLS0gUGFnZSBEaXNwbGF5IEFyZWEgLS0+XG4gICAgPGRpdiBjbGFzcz1cImNvbnRlbnRcIj5cbiAgICAgIDxQYWdlRGlzcGxheVxuICAgICAgICBwYWdlcz17cGFnZXMoKX1cbiAgICAgICAge2lzTG9hZGluZ31cbiAgICAgICAge2Vycm9yfVxuICAgICAgICB7Y29sdW1uQ291bnR9XG4gICAgICAgIG9uUmV0cnk9e2xvYWRTZXF1ZW5jZXN9XG4gICAgICAvPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvZGl2PlxuXG48c3R5bGU+XG4gIC5zZXF1ZW5jZS1jYXJkLXRhYiB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgIGhlaWdodDogMTAwJTtcbiAgICBiYWNrZ3JvdW5kOiAjMWExYTFhO1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgfVxuXG4gIC8qIEhlYWRlciAqL1xuICAuaGVhZGVyIHtcbiAgICBiYWNrZ3JvdW5kOiAjMmEyYTJhO1xuICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjNDQ0O1xuICAgIHBhZGRpbmc6IDE2cHggMjBweDtcbiAgICBmbGV4LXNocmluazogMDtcbiAgfVxuXG4gIC5oZWFkZXItY29udGVudCB7XG4gICAgbWF4LXdpZHRoOiAxMjAwcHg7XG4gICAgbWFyZ2luOiAwIGF1dG87XG4gIH1cblxuICAudGl0bGUge1xuICAgIG1hcmdpbjogMCAwIDRweCAwO1xuICAgIGZvbnQtc2l6ZTogMjRweDtcbiAgICBmb250LXdlaWdodDogNjAwO1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgfVxuXG4gIC5zdWJ0aXRsZSB7XG4gICAgbWFyZ2luOiAwO1xuICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICBjb2xvcjogI2FhYTtcbiAgfVxuXG4gIC8qIE1haW4gQ29udGVudCAqL1xuICAubWFpbi1jb250ZW50IHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXg6IDE7XG4gICAgbWluLWhlaWdodDogMDtcbiAgfVxuXG4gIC5uYXZpZ2F0aW9uIHtcbiAgICB3aWR0aDogMjUwcHg7XG4gICAgYmFja2dyb3VuZDogIzJhMmEyYTtcbiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjNDQ0O1xuICAgIGZsZXgtc2hyaW5rOiAwO1xuICB9XG5cbiAgLmNvbnRlbnQge1xuICAgIGZsZXg6IDE7XG4gICAgYmFja2dyb3VuZDogIzFhMWExYTtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICB9XG5cbiAgLyogUmVzcG9uc2l2ZSAqL1xuICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHtcbiAgICAubWFpbi1jb250ZW50IHtcbiAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgfVxuXG4gICAgLm5hdmlnYXRpb24ge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICBoZWlnaHQ6IGF1dG87XG4gICAgICBtYXgtaGVpZ2h0OiAyMDBweDtcbiAgICAgIGJvcmRlci1yaWdodDogbm9uZTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjNDQ0O1xuICAgIH1cblxuICAgIC50aXRsZSB7XG4gICAgICBmb250LXNpemU6IDIwcHg7XG4gICAgfVxuXG4gICAgLnN1YnRpdGxlIHtcbiAgICAgIGZvbnQtc2l6ZTogMTJweDtcbiAgICB9XG4gIH1cbjwvc3R5bGU+XG4iXSwiZmlsZSI6IkM6L1RLQS93ZWIvc3JjL2xpYi9jb21wb25lbnRzL3RhYnMvc2VxdWVuY2VfY2FyZC9TZXF1ZW5jZUNhcmRUYWIuc3ZlbHRlIn0=