import { GridMode } from "/src/lib/domain/index.ts";
import {
  FilterType as FilterTypeEnum,
  SortMethod as SortMethodEnum
} from "/src/lib/domain/browse/index.ts";
export class BrowseService {
  cachedSequences = null;
  /**
   * âœ… PERMANENT: Validate sequence metadata to prevent malformed data
   */
  isValidSequenceMetadata(sequence) {
    const word = sequence.word || sequence.name || sequence.id || "";
    const problematicSequences = [
      "KD__KD__JE__JE__",
      "KI_X_",
      "KDÎ¨Î¦KDÎ¨Î¦JEÎ¨Î¦JEÎ¨Î¦",
      "KIÎ¸X-"
    ];
    if (problematicSequences.includes(word) || problematicSequences.includes(sequence.id)) {
      console.warn(
        `ðŸš« CIRCUIT BREAKER: Blocking problematic sequence "${word}"`
      );
      return false;
    }
    return word.length > 0 && word.length <= 200 && // Increased limit for complex sequences
    word !== "A_A" && // Exclude test sequences
    !word.toLowerCase().includes("test");
  }
  async loadSequenceMetadata() {
    console.log("ðŸ” BrowseService.loadSequenceMetadata() called");
    if (this.cachedSequences !== null) {
      console.log(
        "ðŸ“¦ Returning cached sequences:",
        this.cachedSequences.length,
        "items"
      );
      return this.cachedSequences;
    }
    try {
      console.log("ðŸ”„ Loading from sequence index...");
      const sequences = await this.loadFromSequenceIndex();
      console.log(
        "âœ… Successfully loaded from sequence index:",
        sequences.length,
        "sequences"
      );
      console.log(
        "ðŸ“‹ Sequence IDs:",
        sequences.map((s) => s.id)
      );
      const validSequences = sequences.filter((seq) => {
        const isValid = this.isValidSequenceMetadata(seq);
        if (!isValid) {
          console.warn(
            `Filtered out invalid sequence: ${seq.word || seq.name || seq.id}`
          );
        }
        return isValid;
      });
      console.log(
        `ðŸ” Filtered ${sequences.length - validSequences.length} invalid sequences`
      );
      this.cachedSequences = validSequences;
      return validSequences;
    } catch (error) {
      console.warn(
        "âŒ Failed to load sequence index, generating from dictionary:",
        error
      );
      const sequences = await this.generateSequenceIndex();
      console.log(
        "ðŸ”§ Generated sequences as fallback:",
        sequences.length,
        "sequences"
      );
      this.cachedSequences = sequences;
      return sequences;
    }
  }
  async applyFilter(sequences, filterType, filterValue) {
    console.log("ðŸ” BrowseService.applyFilter() called with:");
    console.log("  - filterType:", filterType);
    console.log("  - filterValue:", filterValue);
    console.log("  - input sequences:", sequences.length, "items");
    if (filterType === FilterTypeEnum.ALL_SEQUENCES) {
      console.log(
        "âœ… ALL_SEQUENCES filter detected - returning all sequences:",
        sequences.length
      );
      return sequences;
    }
    console.log("ðŸ”„ Applying specific filter...");
    let filtered;
    switch (filterType) {
      case FilterTypeEnum.STARTING_LETTER:
        filtered = this.filterByStartingLetter(sequences, filterValue);
        break;
      case FilterTypeEnum.CONTAINS_LETTERS:
        filtered = this.filterByContainsLetters(sequences, filterValue);
        break;
      case FilterTypeEnum.LENGTH:
        filtered = this.filterByLength(sequences, filterValue);
        break;
      case FilterTypeEnum.DIFFICULTY:
        filtered = this.filterByDifficulty(sequences, filterValue);
        break;
      case FilterTypeEnum.STARTING_POSITION:
        filtered = this.filterByStartingPosition(sequences, filterValue);
        break;
      case FilterTypeEnum.AUTHOR:
        filtered = this.filterByAuthor(sequences, filterValue);
        break;
      case FilterTypeEnum.GRID_MODE:
        filtered = this.filterByGridMode(sequences, filterValue);
        break;
      case FilterTypeEnum.FAVORITES:
        filtered = sequences.filter((s) => s.isFavorite);
        break;
      case FilterTypeEnum.RECENT:
        filtered = this.filterByRecent(sequences);
        break;
      default:
        console.log("âš ï¸ Unknown filter type, returning all sequences");
        filtered = sequences;
    }
    console.log(
      "ðŸ“Š Filter result:",
      filtered.length,
      "sequences after filtering"
    );
    return filtered;
  }
  async sortSequences(sequences, sortMethod) {
    const sorted = [...sequences];
    switch (sortMethod) {
      case SortMethodEnum.ALPHABETICAL:
        return sorted.sort((a, b) => a.word.localeCompare(b.word));
      case SortMethodEnum.DATE_ADDED:
        return sorted.sort((a, b) => {
          const dateA = a.dateAdded || /* @__PURE__ */ new Date(0);
          const dateB = b.dateAdded || /* @__PURE__ */ new Date(0);
          return dateB.getTime() - dateA.getTime();
        });
      case SortMethodEnum.DIFFICULTY_LEVEL:
        return sorted.sort((a, b) => {
          const levelA = this.getDifficultyOrder(a.difficultyLevel);
          const levelB = this.getDifficultyOrder(b.difficultyLevel);
          return levelA - levelB;
        });
      case SortMethodEnum.SEQUENCE_LENGTH:
        return sorted.sort(
          (a, b) => (a.sequenceLength || 0) - (b.sequenceLength || 0)
        );
      case SortMethodEnum.AUTHOR:
        return sorted.sort(
          (a, b) => (a.author || "").localeCompare(b.author || "")
        );
      case SortMethodEnum.POPULARITY:
        return sorted.sort(
          (a, b) => Number(b.isFavorite) - Number(a.isFavorite)
        );
      default:
        return sorted;
    }
  }
  async groupSequencesIntoSections(sequences, sortMethod) {
    const sections = {};
    for (const sequence of sequences) {
      const sectionKey = this.getSectionKey(sequence, sortMethod);
      if (!sections[sectionKey]) {
        sections[sectionKey] = [];
      }
      sections[sectionKey].push(sequence);
    }
    return sections;
  }
  async getUniqueValues(field) {
    const sequences = await this.loadSequenceMetadata();
    const values = /* @__PURE__ */ new Set();
    for (const sequence of sequences) {
      const value = sequence[field];
      if (value != null) {
        values.add(String(value));
      }
    }
    return Array.from(values).sort();
  }
  async getFilterOptions(filterType) {
    switch (filterType) {
      case FilterTypeEnum.STARTING_LETTER:
        return ["A-D", "E-H", "I-L", "M-P", "Q-T", "U-Z"];
      case FilterTypeEnum.LENGTH:
        return ["3", "4", "5", "6", "7", "8+"];
      case FilterTypeEnum.DIFFICULTY:
        return ["beginner", "intermediate", "advanced"];
      case FilterTypeEnum.AUTHOR:
        return this.getUniqueValues("author");
      case FilterTypeEnum.GRID_MODE:
        return [GridMode.DIAMOND, GridMode.BOX];
      default:
        return [];
    }
  }
  // Private helper methods
  async loadFromSequenceIndex() {
    console.log("ðŸŒ Fetching sequence-index.json...");
    const response = await fetch("/sequence-index.json");
    console.log("ðŸŒ Response status:", response.status, response.statusText);
    if (!response.ok) {
      throw new Error(`Failed to load sequence index: ${response.status}`);
    }
    const data = await response.json();
    console.log("ðŸ“„ Loaded sequence index data:", data);
    console.log("ðŸ“„ Total sequences in index:", data.totalSequences);
    console.log("ðŸ“„ Sequences array length:", data.sequences?.length || 0);
    const rawSequences = data.sequences || [];
    const sequences = rawSequences.filter((seq) => {
      const word = seq.word || seq.name || seq.id;
      if (!word || typeof word === "string" && word.length === 0) {
        console.warn(
          `ðŸš« Filtering sequence with no word: ${JSON.stringify(seq)}`
        );
        return false;
      }
      return true;
    }).map((seq) => {
      let gridMode = seq.gridMode;
      if (typeof gridMode === "string") {
        if (gridMode === "GridMode.DIAMOND" || gridMode === "diamond") {
          gridMode = GridMode.DIAMOND;
        } else if (gridMode === "GridMode.BOX" || gridMode === "box") {
          gridMode = GridMode.BOX;
        }
      }
      let dateAdded = seq.dateAdded;
      if (typeof dateAdded === "string") {
        dateAdded = new Date(dateAdded);
      }
      const result = {
        id: String(seq.id || seq.word || seq.name),
        name: String(seq.name || `${seq.word} Sequence`),
        word: String(seq.word || seq.name || seq.id),
        thumbnails: Array.isArray(seq.thumbnails) ? seq.thumbnails : [],
        isFavorite: Boolean(seq.isFavorite),
        isCircular: Boolean(seq.isCircular),
        tags: Array.isArray(seq.tags) ? seq.tags : ["flow", "practice"],
        metadata: typeof seq.metadata === "object" && seq.metadata !== null ? seq.metadata : { source: "tka_dictionary" }
      };
      if (seq.author && typeof seq.author === "string")
        result.author = seq.author;
      if (gridMode && typeof gridMode === "string")
        result.gridMode = gridMode;
      if (seq.difficultyLevel && typeof seq.difficultyLevel === "string")
        result.difficultyLevel = seq.difficultyLevel;
      if (seq.sequenceLength && typeof seq.sequenceLength === "number")
        result.sequenceLength = seq.sequenceLength;
      if (seq.level && typeof seq.level === "number")
        result.level = seq.level;
      if (dateAdded instanceof Date) result.dateAdded = dateAdded;
      if (seq.propType && typeof seq.propType === "string")
        result.propType = seq.propType;
      if (seq.startingPosition && typeof seq.startingPosition === "string")
        result.startingPosition = seq.startingPosition;
      return result;
    });
    console.log(
      `ðŸ“¦ Processed ${sequences.length} real sequences from dictionary`
    );
    console.log(
      "ðŸ“‹ Sample sequence IDs:",
      sequences.slice(0, 10).map((s) => s.id)
    );
    return sequences;
  }
  async generateSequenceIndex() {
    console.log("ðŸ”§ Scanning dictionary folder to generate sequence index...");
    try {
      const sequences = [];
      console.warn(
        "âš ï¸ Dictionary scanning not implemented - please ensure sequence-index.json is up to date"
      );
      return sequences;
    } catch (error) {
      console.error("âŒ Failed to scan dictionary folder:", error);
      return [];
    }
  }
  filterByStartingLetter(sequences, filterValue) {
    if (!filterValue || typeof filterValue !== "string") return sequences;
    if (filterValue.includes("-")) {
      const [start, end] = filterValue.split("-");
      return sequences.filter((s) => {
        const firstLetter = s.word[0]?.toUpperCase();
        return firstLetter && start && end && firstLetter >= start && firstLetter <= end;
      });
    }
    return sequences.filter(
      (s) => s.word[0]?.toUpperCase() === filterValue.toUpperCase()
    );
  }
  filterByContainsLetters(sequences, filterValue) {
    if (!filterValue || typeof filterValue !== "string") return sequences;
    return sequences.filter(
      (s) => s.word.toLowerCase().includes(filterValue.toLowerCase())
    );
  }
  filterByLength(sequences, filterValue) {
    if (!filterValue) return sequences;
    if (filterValue === "8+") {
      return sequences.filter((s) => (s.sequenceLength || 0) >= 8);
    }
    const length = parseInt(String(filterValue));
    if (isNaN(length)) return sequences;
    return sequences.filter((s) => s.sequenceLength === length);
  }
  filterByDifficulty(sequences, filterValue) {
    if (!filterValue) return sequences;
    return sequences.filter((s) => s.difficultyLevel === filterValue);
  }
  filterByStartingPosition(sequences, filterValue) {
    if (!filterValue) return sequences;
    return sequences.filter((s) => s.startingPosition === filterValue);
  }
  filterByAuthor(sequences, filterValue) {
    if (!filterValue) return sequences;
    return sequences.filter((s) => s.author === filterValue);
  }
  filterByGridMode(sequences, filterValue) {
    if (!filterValue) return sequences;
    return sequences.filter((s) => s.gridMode === filterValue);
  }
  filterByRecent(sequences) {
    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1e3);
    return sequences.filter((s) => {
      const dateAdded = s.dateAdded || /* @__PURE__ */ new Date(0);
      return dateAdded >= thirtyDaysAgo;
    });
  }
  getDifficultyOrder(difficulty) {
    switch (difficulty) {
      case "beginner":
        return 1;
      case "intermediate":
        return 2;
      case "advanced":
        return 3;
      default:
        return 0;
    }
  }
  getSectionKey(sequence, sortMethod) {
    switch (sortMethod) {
      case SortMethodEnum.ALPHABETICAL:
        return sequence.word[0]?.toUpperCase() || "#";
      case SortMethodEnum.DIFFICULTY_LEVEL:
        return sequence.difficultyLevel || "Unknown";
      case SortMethodEnum.AUTHOR:
        return sequence.author || "Unknown";
      case SortMethodEnum.SEQUENCE_LENGTH: {
        const length = sequence.sequenceLength || 0;
        if (length <= 4) return "3-4 beats";
        if (length <= 6) return "5-6 beats";
        if (length <= 8) return "7-8 beats";
        return "9+ beats";
      }
      default:
        return "All";
    }
  }
  clearCache() {
    this.cachedSequences = null;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9icm93c2UvQnJvd3NlU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBCcm93c2UgU2VydmljZSBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEhhbmRsZXMgbG9hZGluZywgZmlsdGVyaW5nLCBhbmQgc29ydGluZyBvZiBzZXF1ZW5jZSBtZXRhZGF0YSBmb3IgdGhlIGJyb3dzZSB0YWIuXG4gKiBQb3J0ZWQgYW5kIGFkYXB0ZWQgZnJvbSBkZXNrdG9wIGFwcCdzIEJyb3dzZVNlcnZpY2UuXG4gKi9cblxuaW1wb3J0IHsgR3JpZE1vZGUgfSBmcm9tIFwiJGxpYi9kb21haW5cIjtcbmltcG9ydCB7XG4gIEZpbHRlclR5cGUgYXMgRmlsdGVyVHlwZUVudW0sXG4gIFNvcnRNZXRob2QgYXMgU29ydE1ldGhvZEVudW0sXG59IGZyb20gXCIkbGliL2RvbWFpbi9icm93c2VcIjtcbmltcG9ydCB0eXBlIHtcbiAgQnJvd3NlU2VxdWVuY2VNZXRhZGF0YSxcbiAgRmlsdGVyVHlwZSxcbiAgRmlsdGVyVmFsdWUsXG4gIFNvcnRNZXRob2QsXG59IGZyb20gXCIkbGliL3NlcnZpY2VzL2ludGVyZmFjZXMvZG9tYWluLXR5cGVzXCI7XG5pbXBvcnQgdHlwZSB7IElCcm93c2VTZXJ2aWNlIH0gZnJvbSBcIiRsaWIvc2VydmljZXMvaW50ZXJmYWNlcy9icm93c2UtaW50ZXJmYWNlc1wiO1xuXG5leHBvcnQgY2xhc3MgQnJvd3NlU2VydmljZSBpbXBsZW1lbnRzIElCcm93c2VTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBjYWNoZWRTZXF1ZW5jZXM6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSB8IG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiDinIUgUEVSTUFORU5UOiBWYWxpZGF0ZSBzZXF1ZW5jZSBtZXRhZGF0YSB0byBwcmV2ZW50IG1hbGZvcm1lZCBkYXRhXG4gICAqL1xuICBwcml2YXRlIGlzVmFsaWRTZXF1ZW5jZU1ldGFkYXRhKHNlcXVlbmNlOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgd29yZCA9IHNlcXVlbmNlLndvcmQgfHwgc2VxdWVuY2UubmFtZSB8fCBzZXF1ZW5jZS5pZCB8fCBcIlwiO1xuXG4gICAgLy8g4pyFIENJUkNVSVQgQlJFQUtFUjogQmxvY2sgc3BlY2lmaWMga25vd24gcHJvYmxlbWF0aWMgc2VxdWVuY2VzXG4gICAgY29uc3QgcHJvYmxlbWF0aWNTZXF1ZW5jZXMgPSBbXG4gICAgICBcIktEX19LRF9fSkVfX0pFX19cIixcbiAgICAgIFwiS0lfWF9cIixcbiAgICAgIFwiS0TOqM6mS0TOqM6mSkXOqM6mSkXOqM6mXCIsXG4gICAgICBcIktJzrhYLVwiLFxuICAgIF07XG5cbiAgICBpZiAoXG4gICAgICBwcm9ibGVtYXRpY1NlcXVlbmNlcy5pbmNsdWRlcyh3b3JkKSB8fFxuICAgICAgcHJvYmxlbWF0aWNTZXF1ZW5jZXMuaW5jbHVkZXMoc2VxdWVuY2UuaWQpXG4gICAgKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGDwn5qrIENJUkNVSVQgQlJFQUtFUjogQmxvY2tpbmcgcHJvYmxlbWF0aWMgc2VxdWVuY2UgXCIke3dvcmR9XCJgXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEJhc2ljIHZhbGlkYXRpb24gZm9yIHJlYWwgZGljdGlvbmFyeSBzZXF1ZW5jZXNcbiAgICByZXR1cm4gKFxuICAgICAgd29yZC5sZW5ndGggPiAwICYmXG4gICAgICB3b3JkLmxlbmd0aCA8PSAyMDAgJiYgLy8gSW5jcmVhc2VkIGxpbWl0IGZvciBjb21wbGV4IHNlcXVlbmNlc1xuICAgICAgd29yZCAhPT0gXCJBX0FcIiAmJiAvLyBFeGNsdWRlIHRlc3Qgc2VxdWVuY2VzXG4gICAgICAhd29yZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwidGVzdFwiKSAvLyBObyB0ZXN0IHNlcXVlbmNlc1xuICAgICk7XG4gIH1cblxuICBhc3luYyBsb2FkU2VxdWVuY2VNZXRhZGF0YSgpOiBQcm9taXNlPEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXT4ge1xuICAgIGNvbnNvbGUubG9nKFwi8J+UjSBCcm93c2VTZXJ2aWNlLmxvYWRTZXF1ZW5jZU1ldGFkYXRhKCkgY2FsbGVkXCIpO1xuXG4gICAgaWYgKHRoaXMuY2FjaGVkU2VxdWVuY2VzICE9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCLwn5OmIFJldHVybmluZyBjYWNoZWQgc2VxdWVuY2VzOlwiLFxuICAgICAgICB0aGlzLmNhY2hlZFNlcXVlbmNlcy5sZW5ndGgsXG4gICAgICAgIFwiaXRlbXNcIlxuICAgICAgKTtcbiAgICAgIHJldHVybiB0aGlzLmNhY2hlZFNlcXVlbmNlcztcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IHRvIGxvYWQgZnJvbSBzZXF1ZW5jZSBpbmRleCBmaXJzdFxuICAgICAgY29uc29sZS5sb2coXCLwn5SEIExvYWRpbmcgZnJvbSBzZXF1ZW5jZSBpbmRleC4uLlwiKTtcbiAgICAgIGNvbnN0IHNlcXVlbmNlcyA9IGF3YWl0IHRoaXMubG9hZEZyb21TZXF1ZW5jZUluZGV4KCk7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCLinIUgU3VjY2Vzc2Z1bGx5IGxvYWRlZCBmcm9tIHNlcXVlbmNlIGluZGV4OlwiLFxuICAgICAgICBzZXF1ZW5jZXMubGVuZ3RoLFxuICAgICAgICBcInNlcXVlbmNlc1wiXG4gICAgICApO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwi8J+TiyBTZXF1ZW5jZSBJRHM6XCIsXG4gICAgICAgIHNlcXVlbmNlcy5tYXAoKHMpID0+IHMuaWQpXG4gICAgICApO1xuXG4gICAgICAvLyDinIUgUEVSTUFORU5UOiBGaWx0ZXIgb3V0IGludmFsaWQgc2VxdWVuY2VzXG4gICAgICBjb25zdCB2YWxpZFNlcXVlbmNlcyA9IHNlcXVlbmNlcy5maWx0ZXIoKHNlcSkgPT4ge1xuICAgICAgICBjb25zdCBpc1ZhbGlkID0gdGhpcy5pc1ZhbGlkU2VxdWVuY2VNZXRhZGF0YShzZXEpO1xuICAgICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgRmlsdGVyZWQgb3V0IGludmFsaWQgc2VxdWVuY2U6ICR7c2VxLndvcmQgfHwgc2VxLm5hbWUgfHwgc2VxLmlkfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpc1ZhbGlkO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+UjSBGaWx0ZXJlZCAke3NlcXVlbmNlcy5sZW5ndGggLSB2YWxpZFNlcXVlbmNlcy5sZW5ndGh9IGludmFsaWQgc2VxdWVuY2VzYFxuICAgICAgKTtcblxuICAgICAgdGhpcy5jYWNoZWRTZXF1ZW5jZXMgPSB2YWxpZFNlcXVlbmNlcztcbiAgICAgIHJldHVybiB2YWxpZFNlcXVlbmNlcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICBcIuKdjCBGYWlsZWQgdG8gbG9hZCBzZXF1ZW5jZSBpbmRleCwgZ2VuZXJhdGluZyBmcm9tIGRpY3Rpb25hcnk6XCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gc2Nhbm5pbmcgZGljdGlvbmFyeSBmb2xkZXJzXG4gICAgICBjb25zdCBzZXF1ZW5jZXMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlU2VxdWVuY2VJbmRleCgpO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwi8J+UpyBHZW5lcmF0ZWQgc2VxdWVuY2VzIGFzIGZhbGxiYWNrOlwiLFxuICAgICAgICBzZXF1ZW5jZXMubGVuZ3RoLFxuICAgICAgICBcInNlcXVlbmNlc1wiXG4gICAgICApO1xuICAgICAgdGhpcy5jYWNoZWRTZXF1ZW5jZXMgPSBzZXF1ZW5jZXM7XG4gICAgICByZXR1cm4gc2VxdWVuY2VzO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFwcGx5RmlsdGVyKFxuICAgIHNlcXVlbmNlczogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdLFxuICAgIGZpbHRlclR5cGU6IEZpbHRlclR5cGUsXG4gICAgZmlsdGVyVmFsdWU6IEZpbHRlclZhbHVlXG4gICk6IFByb21pc2U8QnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdPiB7XG4gICAgY29uc29sZS5sb2coXCLwn5SNIEJyb3dzZVNlcnZpY2UuYXBwbHlGaWx0ZXIoKSBjYWxsZWQgd2l0aDpcIik7XG4gICAgY29uc29sZS5sb2coXCIgIC0gZmlsdGVyVHlwZTpcIiwgZmlsdGVyVHlwZSk7XG4gICAgY29uc29sZS5sb2coXCIgIC0gZmlsdGVyVmFsdWU6XCIsIGZpbHRlclZhbHVlKTtcbiAgICBjb25zb2xlLmxvZyhcIiAgLSBpbnB1dCBzZXF1ZW5jZXM6XCIsIHNlcXVlbmNlcy5sZW5ndGgsIFwiaXRlbXNcIik7XG5cbiAgICBpZiAoZmlsdGVyVHlwZSA9PT0gRmlsdGVyVHlwZUVudW0uQUxMX1NFUVVFTkNFUykge1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwi4pyFIEFMTF9TRVFVRU5DRVMgZmlsdGVyIGRldGVjdGVkIC0gcmV0dXJuaW5nIGFsbCBzZXF1ZW5jZXM6XCIsXG4gICAgICAgIHNlcXVlbmNlcy5sZW5ndGhcbiAgICAgICk7XG4gICAgICByZXR1cm4gc2VxdWVuY2VzO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwi8J+UhCBBcHBseWluZyBzcGVjaWZpYyBmaWx0ZXIuLi5cIik7XG4gICAgbGV0IGZpbHRlcmVkOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW107XG5cbiAgICBzd2l0Y2ggKGZpbHRlclR5cGUpIHtcbiAgICAgIGNhc2UgRmlsdGVyVHlwZUVudW0uU1RBUlRJTkdfTEVUVEVSOlxuICAgICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlTdGFydGluZ0xldHRlcihzZXF1ZW5jZXMsIGZpbHRlclZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEZpbHRlclR5cGVFbnVtLkNPTlRBSU5TX0xFVFRFUlM6XG4gICAgICAgIGZpbHRlcmVkID0gdGhpcy5maWx0ZXJCeUNvbnRhaW5zTGV0dGVycyhzZXF1ZW5jZXMsIGZpbHRlclZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEZpbHRlclR5cGVFbnVtLkxFTkdUSDpcbiAgICAgICAgZmlsdGVyZWQgPSB0aGlzLmZpbHRlckJ5TGVuZ3RoKHNlcXVlbmNlcywgZmlsdGVyVmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRmlsdGVyVHlwZUVudW0uRElGRklDVUxUWTpcbiAgICAgICAgZmlsdGVyZWQgPSB0aGlzLmZpbHRlckJ5RGlmZmljdWx0eShzZXF1ZW5jZXMsIGZpbHRlclZhbHVlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEZpbHRlclR5cGVFbnVtLlNUQVJUSU5HX1BPU0lUSU9OOlxuICAgICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlTdGFydGluZ1Bvc2l0aW9uKHNlcXVlbmNlcywgZmlsdGVyVmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRmlsdGVyVHlwZUVudW0uQVVUSE9SOlxuICAgICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlBdXRob3Ioc2VxdWVuY2VzLCBmaWx0ZXJWYWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBGaWx0ZXJUeXBlRW51bS5HUklEX01PREU6XG4gICAgICAgIGZpbHRlcmVkID0gdGhpcy5maWx0ZXJCeUdyaWRNb2RlKHNlcXVlbmNlcywgZmlsdGVyVmFsdWUpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgRmlsdGVyVHlwZUVudW0uRkFWT1JJVEVTOlxuICAgICAgICBmaWx0ZXJlZCA9IHNlcXVlbmNlcy5maWx0ZXIoKHMpID0+IHMuaXNGYXZvcml0ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBGaWx0ZXJUeXBlRW51bS5SRUNFTlQ6XG4gICAgICAgIGZpbHRlcmVkID0gdGhpcy5maWx0ZXJCeVJlY2VudChzZXF1ZW5jZXMpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUubG9nKFwi4pqg77iPIFVua25vd24gZmlsdGVyIHR5cGUsIHJldHVybmluZyBhbGwgc2VxdWVuY2VzXCIpO1xuICAgICAgICBmaWx0ZXJlZCA9IHNlcXVlbmNlcztcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIFwi8J+TiiBGaWx0ZXIgcmVzdWx0OlwiLFxuICAgICAgZmlsdGVyZWQubGVuZ3RoLFxuICAgICAgXCJzZXF1ZW5jZXMgYWZ0ZXIgZmlsdGVyaW5nXCJcbiAgICApO1xuICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgfVxuXG4gIGFzeW5jIHNvcnRTZXF1ZW5jZXMoXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgc29ydE1ldGhvZDogU29ydE1ldGhvZFxuICApOiBQcm9taXNlPEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXT4ge1xuICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5zZXF1ZW5jZXNdO1xuXG4gICAgc3dpdGNoIChzb3J0TWV0aG9kKSB7XG4gICAgICBjYXNlIFNvcnRNZXRob2RFbnVtLkFMUEhBQkVUSUNBTDpcbiAgICAgICAgcmV0dXJuIHNvcnRlZC5zb3J0KChhLCBiKSA9PiBhLndvcmQubG9jYWxlQ29tcGFyZShiLndvcmQpKTtcbiAgICAgIGNhc2UgU29ydE1ldGhvZEVudW0uREFURV9BRERFRDpcbiAgICAgICAgcmV0dXJuIHNvcnRlZC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgY29uc3QgZGF0ZUEgPSBhLmRhdGVBZGRlZCB8fCBuZXcgRGF0ZSgwKTtcbiAgICAgICAgICBjb25zdCBkYXRlQiA9IGIuZGF0ZUFkZGVkIHx8IG5ldyBEYXRlKDApO1xuICAgICAgICAgIHJldHVybiBkYXRlQi5nZXRUaW1lKCkgLSBkYXRlQS5nZXRUaW1lKCk7XG4gICAgICAgIH0pO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5ESUZGSUNVTFRZX0xFVkVMOlxuICAgICAgICByZXR1cm4gc29ydGVkLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICBjb25zdCBsZXZlbEEgPSB0aGlzLmdldERpZmZpY3VsdHlPcmRlcihhLmRpZmZpY3VsdHlMZXZlbCk7XG4gICAgICAgICAgY29uc3QgbGV2ZWxCID0gdGhpcy5nZXREaWZmaWN1bHR5T3JkZXIoYi5kaWZmaWN1bHR5TGV2ZWwpO1xuICAgICAgICAgIHJldHVybiBsZXZlbEEgLSBsZXZlbEI7XG4gICAgICAgIH0pO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5TRVFVRU5DRV9MRU5HVEg6XG4gICAgICAgIHJldHVybiBzb3J0ZWQuc29ydChcbiAgICAgICAgICAoYSwgYikgPT4gKGEuc2VxdWVuY2VMZW5ndGggfHwgMCkgLSAoYi5zZXF1ZW5jZUxlbmd0aCB8fCAwKVxuICAgICAgICApO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5BVVRIT1I6XG4gICAgICAgIHJldHVybiBzb3J0ZWQuc29ydCgoYSwgYikgPT5cbiAgICAgICAgICAoYS5hdXRob3IgfHwgXCJcIikubG9jYWxlQ29tcGFyZShiLmF1dGhvciB8fCBcIlwiKVxuICAgICAgICApO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5QT1BVTEFSSVRZOlxuICAgICAgICByZXR1cm4gc29ydGVkLnNvcnQoXG4gICAgICAgICAgKGEsIGIpID0+IE51bWJlcihiLmlzRmF2b3JpdGUpIC0gTnVtYmVyKGEuaXNGYXZvcml0ZSlcbiAgICAgICAgKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBzb3J0ZWQ7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ3JvdXBTZXF1ZW5jZXNJbnRvU2VjdGlvbnMoXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgc29ydE1ldGhvZDogU29ydE1ldGhvZFxuICApOiBQcm9taXNlPFJlY29yZDxzdHJpbmcsIEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXT4+IHtcbiAgICBjb25zdCBzZWN0aW9uczogUmVjb3JkPHN0cmluZywgQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdPiA9IHt9O1xuXG4gICAgZm9yIChjb25zdCBzZXF1ZW5jZSBvZiBzZXF1ZW5jZXMpIHtcbiAgICAgIGNvbnN0IHNlY3Rpb25LZXkgPSB0aGlzLmdldFNlY3Rpb25LZXkoc2VxdWVuY2UsIHNvcnRNZXRob2QpO1xuICAgICAgaWYgKCFzZWN0aW9uc1tzZWN0aW9uS2V5XSkge1xuICAgICAgICBzZWN0aW9uc1tzZWN0aW9uS2V5XSA9IFtdO1xuICAgICAgfVxuICAgICAgc2VjdGlvbnNbc2VjdGlvbktleV0ucHVzaChzZXF1ZW5jZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlY3Rpb25zO1xuICB9XG5cbiAgYXN5bmMgZ2V0VW5pcXVlVmFsdWVzKFxuICAgIGZpZWxkOiBrZXlvZiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhXG4gICk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBzZXF1ZW5jZXMgPSBhd2FpdCB0aGlzLmxvYWRTZXF1ZW5jZU1ldGFkYXRhKCk7XG4gICAgY29uc3QgdmFsdWVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IHNlcXVlbmNlIG9mIHNlcXVlbmNlcykge1xuICAgICAgY29uc3QgdmFsdWUgPSBzZXF1ZW5jZVtmaWVsZF07XG4gICAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICB2YWx1ZXMuYWRkKFN0cmluZyh2YWx1ZSkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBBcnJheS5mcm9tKHZhbHVlcykuc29ydCgpO1xuICB9XG5cbiAgYXN5bmMgZ2V0RmlsdGVyT3B0aW9ucyhmaWx0ZXJUeXBlOiBGaWx0ZXJUeXBlKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIHN3aXRjaCAoZmlsdGVyVHlwZSkge1xuICAgICAgY2FzZSBGaWx0ZXJUeXBlRW51bS5TVEFSVElOR19MRVRURVI6XG4gICAgICAgIHJldHVybiBbXCJBLURcIiwgXCJFLUhcIiwgXCJJLUxcIiwgXCJNLVBcIiwgXCJRLVRcIiwgXCJVLVpcIl07XG4gICAgICBjYXNlIEZpbHRlclR5cGVFbnVtLkxFTkdUSDpcbiAgICAgICAgcmV0dXJuIFtcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOCtcIl07XG4gICAgICBjYXNlIEZpbHRlclR5cGVFbnVtLkRJRkZJQ1VMVFk6XG4gICAgICAgIHJldHVybiBbXCJiZWdpbm5lclwiLCBcImludGVybWVkaWF0ZVwiLCBcImFkdmFuY2VkXCJdO1xuICAgICAgY2FzZSBGaWx0ZXJUeXBlRW51bS5BVVRIT1I6XG4gICAgICAgIHJldHVybiB0aGlzLmdldFVuaXF1ZVZhbHVlcyhcImF1dGhvclwiKTtcbiAgICAgIGNhc2UgRmlsdGVyVHlwZUVudW0uR1JJRF9NT0RFOlxuICAgICAgICByZXR1cm4gW0dyaWRNb2RlLkRJQU1PTkQsIEdyaWRNb2RlLkJPWF07XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuICBwcml2YXRlIGFzeW5jIGxvYWRGcm9tU2VxdWVuY2VJbmRleCgpOiBQcm9taXNlPEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXT4ge1xuICAgIGNvbnNvbGUubG9nKFwi8J+MkCBGZXRjaGluZyBzZXF1ZW5jZS1pbmRleC5qc29uLi4uXCIpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goXCIvc2VxdWVuY2UtaW5kZXguanNvblwiKTtcbiAgICBjb25zb2xlLmxvZyhcIvCfjJAgUmVzcG9uc2Ugc3RhdHVzOlwiLCByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLnN0YXR1c1RleHQpO1xuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBzZXF1ZW5jZSBpbmRleDogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBjb25zb2xlLmxvZyhcIvCfk4QgTG9hZGVkIHNlcXVlbmNlIGluZGV4IGRhdGE6XCIsIGRhdGEpO1xuICAgIGNvbnNvbGUubG9nKFwi8J+ThCBUb3RhbCBzZXF1ZW5jZXMgaW4gaW5kZXg6XCIsIGRhdGEudG90YWxTZXF1ZW5jZXMpO1xuICAgIGNvbnNvbGUubG9nKFwi8J+ThCBTZXF1ZW5jZXMgYXJyYXkgbGVuZ3RoOlwiLCBkYXRhLnNlcXVlbmNlcz8ubGVuZ3RoIHx8IDApO1xuXG4gICAgY29uc3QgcmF3U2VxdWVuY2VzID0gZGF0YS5zZXF1ZW5jZXMgfHwgW107XG5cbiAgICAvLyDinIUgRklYRUQ6IFByb2Nlc3MgcmVhbCBzZXF1ZW5jZXMgYW5kIGZpeCBhbnkgZGF0YSBmb3JtYXQgaXNzdWVzXG4gICAgY29uc3Qgc2VxdWVuY2VzID0gcmF3U2VxdWVuY2VzXG4gICAgICAuZmlsdGVyKChzZXE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB7XG4gICAgICAgIGNvbnN0IHdvcmQgPSBzZXEud29yZCB8fCBzZXEubmFtZSB8fCBzZXEuaWQ7XG5cbiAgICAgICAgLy8gT25seSBmaWx0ZXIgb3V0IHNlcXVlbmNlcyB0aGF0IGFyZSBjbGVhcmx5IGludmFsaWRcbiAgICAgICAgaWYgKCF3b3JkIHx8ICh0eXBlb2Ygd29yZCA9PT0gXCJzdHJpbmdcIiAmJiB3b3JkLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBg8J+aqyBGaWx0ZXJpbmcgc2VxdWVuY2Ugd2l0aCBubyB3b3JkOiAke0pTT04uc3RyaW5naWZ5KHNlcSl9YFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KVxuICAgICAgLm1hcCgoc2VxOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4ge1xuICAgICAgICAvLyBGaXggR3JpZE1vZGUgcmVmZXJlbmNlcyB0aGF0IG1pZ2h0IGJlIHN0cmluZ3NcbiAgICAgICAgbGV0IGdyaWRNb2RlID0gc2VxLmdyaWRNb2RlO1xuICAgICAgICBpZiAodHlwZW9mIGdyaWRNb2RlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgaWYgKGdyaWRNb2RlID09PSBcIkdyaWRNb2RlLkRJQU1PTkRcIiB8fCBncmlkTW9kZSA9PT0gXCJkaWFtb25kXCIpIHtcbiAgICAgICAgICAgIGdyaWRNb2RlID0gR3JpZE1vZGUuRElBTU9ORDtcbiAgICAgICAgICB9IGVsc2UgaWYgKGdyaWRNb2RlID09PSBcIkdyaWRNb2RlLkJPWFwiIHx8IGdyaWRNb2RlID09PSBcImJveFwiKSB7XG4gICAgICAgICAgICBncmlkTW9kZSA9IEdyaWRNb2RlLkJPWDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGaXggZGF0ZSBzdHJpbmdzIHRvIERhdGUgb2JqZWN0c1xuICAgICAgICBsZXQgZGF0ZUFkZGVkID0gc2VxLmRhdGVBZGRlZDtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRlQWRkZWQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBkYXRlQWRkZWQgPSBuZXcgRGF0ZShkYXRlQWRkZWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0OiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhID0ge1xuICAgICAgICAgIGlkOiBTdHJpbmcoc2VxLmlkIHx8IHNlcS53b3JkIHx8IHNlcS5uYW1lKSxcbiAgICAgICAgICBuYW1lOiBTdHJpbmcoc2VxLm5hbWUgfHwgYCR7c2VxLndvcmR9IFNlcXVlbmNlYCksXG4gICAgICAgICAgd29yZDogU3RyaW5nKHNlcS53b3JkIHx8IHNlcS5uYW1lIHx8IHNlcS5pZCksXG4gICAgICAgICAgdGh1bWJuYWlsczogQXJyYXkuaXNBcnJheShzZXEudGh1bWJuYWlscylcbiAgICAgICAgICAgID8gKHNlcS50aHVtYm5haWxzIGFzIHN0cmluZ1tdKVxuICAgICAgICAgICAgOiBbXSxcbiAgICAgICAgICBpc0Zhdm9yaXRlOiBCb29sZWFuKHNlcS5pc0Zhdm9yaXRlKSxcbiAgICAgICAgICBpc0NpcmN1bGFyOiBCb29sZWFuKHNlcS5pc0NpcmN1bGFyKSxcbiAgICAgICAgICB0YWdzOiBBcnJheS5pc0FycmF5KHNlcS50YWdzKVxuICAgICAgICAgICAgPyAoc2VxLnRhZ3MgYXMgc3RyaW5nW10pXG4gICAgICAgICAgICA6IFtcImZsb3dcIiwgXCJwcmFjdGljZVwiXSxcbiAgICAgICAgICBtZXRhZGF0YTpcbiAgICAgICAgICAgIHR5cGVvZiBzZXEubWV0YWRhdGEgPT09IFwib2JqZWN0XCIgJiYgc2VxLm1ldGFkYXRhICE9PSBudWxsXG4gICAgICAgICAgICAgID8gKHNlcS5tZXRhZGF0YSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPilcbiAgICAgICAgICAgICAgOiB7IHNvdXJjZTogXCJ0a2FfZGljdGlvbmFyeVwiIH0sXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gQWRkIG9wdGlvbmFsIHByb3BlcnRpZXMgb25seSBpZiB0aGV5IGhhdmUgdmFsdWVzXG4gICAgICAgIGlmIChzZXEuYXV0aG9yICYmIHR5cGVvZiBzZXEuYXV0aG9yID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHJlc3VsdC5hdXRob3IgPSBzZXEuYXV0aG9yO1xuICAgICAgICBpZiAoZ3JpZE1vZGUgJiYgdHlwZW9mIGdyaWRNb2RlID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHJlc3VsdC5ncmlkTW9kZSA9IGdyaWRNb2RlO1xuICAgICAgICBpZiAoc2VxLmRpZmZpY3VsdHlMZXZlbCAmJiB0eXBlb2Ygc2VxLmRpZmZpY3VsdHlMZXZlbCA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICByZXN1bHQuZGlmZmljdWx0eUxldmVsID0gc2VxLmRpZmZpY3VsdHlMZXZlbDtcbiAgICAgICAgaWYgKHNlcS5zZXF1ZW5jZUxlbmd0aCAmJiB0eXBlb2Ygc2VxLnNlcXVlbmNlTGVuZ3RoID09PSBcIm51bWJlclwiKVxuICAgICAgICAgIHJlc3VsdC5zZXF1ZW5jZUxlbmd0aCA9IHNlcS5zZXF1ZW5jZUxlbmd0aDtcbiAgICAgICAgaWYgKHNlcS5sZXZlbCAmJiB0eXBlb2Ygc2VxLmxldmVsID09PSBcIm51bWJlclwiKVxuICAgICAgICAgIHJlc3VsdC5sZXZlbCA9IHNlcS5sZXZlbDtcbiAgICAgICAgaWYgKGRhdGVBZGRlZCBpbnN0YW5jZW9mIERhdGUpIHJlc3VsdC5kYXRlQWRkZWQgPSBkYXRlQWRkZWQ7XG4gICAgICAgIGlmIChzZXEucHJvcFR5cGUgJiYgdHlwZW9mIHNlcS5wcm9wVHlwZSA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICByZXN1bHQucHJvcFR5cGUgPSBzZXEucHJvcFR5cGU7XG4gICAgICAgIGlmIChzZXEuc3RhcnRpbmdQb3NpdGlvbiAmJiB0eXBlb2Ygc2VxLnN0YXJ0aW5nUG9zaXRpb24gPT09IFwic3RyaW5nXCIpXG4gICAgICAgICAgcmVzdWx0LnN0YXJ0aW5nUG9zaXRpb24gPSBzZXEuc3RhcnRpbmdQb3NpdGlvbjtcblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGDwn5OmIFByb2Nlc3NlZCAke3NlcXVlbmNlcy5sZW5ndGh9IHJlYWwgc2VxdWVuY2VzIGZyb20gZGljdGlvbmFyeWBcbiAgICApO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCLwn5OLIFNhbXBsZSBzZXF1ZW5jZSBJRHM6XCIsXG4gICAgICBzZXF1ZW5jZXMuc2xpY2UoMCwgMTApLm1hcCgoczogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YSkgPT4gcy5pZClcbiAgICApO1xuXG4gICAgcmV0dXJuIHNlcXVlbmNlcztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVTZXF1ZW5jZUluZGV4KCk6IFByb21pc2U8QnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdPiB7XG4gICAgY29uc29sZS5sb2coXCLwn5SnIFNjYW5uaW5nIGRpY3Rpb25hcnkgZm9sZGVyIHRvIGdlbmVyYXRlIHNlcXVlbmNlIGluZGV4Li4uXCIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFNjYW4gdGhlIGRpY3Rpb25hcnkgZm9sZGVyIGZvciByZWFsIHNlcXVlbmNlc1xuICAgICAgY29uc3Qgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10gPSBbXTtcblxuICAgICAgLy8gVGhpcyBpcyBhIGZhbGxiYWNrIG1ldGhvZCAtIGluIHByb2R1Y3Rpb24sIHlvdSBzaG91bGQgcmVnZW5lcmF0ZSB0aGUgc2VxdWVuY2UtaW5kZXguanNvblxuICAgICAgLy8gRm9yIG5vdywgcmV0dXJuIGVtcHR5IGFycmF5IHRvIGZvcmNlIHVzaW5nIHRoZSByZWFsIHNlcXVlbmNlLWluZGV4Lmpzb25cbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgXCLimqDvuI8gRGljdGlvbmFyeSBzY2FubmluZyBub3QgaW1wbGVtZW50ZWQgLSBwbGVhc2UgZW5zdXJlIHNlcXVlbmNlLWluZGV4Lmpzb24gaXMgdXAgdG8gZGF0ZVwiXG4gICAgICApO1xuICAgICAgcmV0dXJuIHNlcXVlbmNlcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBGYWlsZWQgdG8gc2NhbiBkaWN0aW9uYXJ5IGZvbGRlcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZmlsdGVyQnlTdGFydGluZ0xldHRlcihcbiAgICBzZXF1ZW5jZXM6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSxcbiAgICBmaWx0ZXJWYWx1ZTogRmlsdGVyVmFsdWVcbiAgKTogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdIHtcbiAgICBpZiAoIWZpbHRlclZhbHVlIHx8IHR5cGVvZiBmaWx0ZXJWYWx1ZSAhPT0gXCJzdHJpbmdcIikgcmV0dXJuIHNlcXVlbmNlcztcblxuICAgIGlmIChmaWx0ZXJWYWx1ZS5pbmNsdWRlcyhcIi1cIikpIHtcbiAgICAgIGNvbnN0IFtzdGFydCwgZW5kXSA9IGZpbHRlclZhbHVlLnNwbGl0KFwiLVwiKTtcbiAgICAgIHJldHVybiBzZXF1ZW5jZXMuZmlsdGVyKChzKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpcnN0TGV0dGVyID0gcy53b3JkWzBdPy50b1VwcGVyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIGZpcnN0TGV0dGVyICYmXG4gICAgICAgICAgc3RhcnQgJiZcbiAgICAgICAgICBlbmQgJiZcbiAgICAgICAgICBmaXJzdExldHRlciA+PSBzdGFydCAmJlxuICAgICAgICAgIGZpcnN0TGV0dGVyIDw9IGVuZFxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlcXVlbmNlcy5maWx0ZXIoXG4gICAgICAocykgPT4gcy53b3JkWzBdPy50b1VwcGVyQ2FzZSgpID09PSBmaWx0ZXJWYWx1ZS50b1VwcGVyQ2FzZSgpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZmlsdGVyQnlDb250YWluc0xldHRlcnMoXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgZmlsdGVyVmFsdWU6IEZpbHRlclZhbHVlXG4gICk6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSB7XG4gICAgaWYgKCFmaWx0ZXJWYWx1ZSB8fCB0eXBlb2YgZmlsdGVyVmFsdWUgIT09IFwic3RyaW5nXCIpIHJldHVybiBzZXF1ZW5jZXM7XG4gICAgcmV0dXJuIHNlcXVlbmNlcy5maWx0ZXIoKHMpID0+XG4gICAgICBzLndvcmQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZS50b0xvd2VyQ2FzZSgpKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5TGVuZ3RoKFxuICAgIHNlcXVlbmNlczogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdLFxuICAgIGZpbHRlclZhbHVlOiBGaWx0ZXJWYWx1ZVxuICApOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10ge1xuICAgIGlmICghZmlsdGVyVmFsdWUpIHJldHVybiBzZXF1ZW5jZXM7XG5cbiAgICBpZiAoZmlsdGVyVmFsdWUgPT09IFwiOCtcIikge1xuICAgICAgcmV0dXJuIHNlcXVlbmNlcy5maWx0ZXIoKHMpID0+IChzLnNlcXVlbmNlTGVuZ3RoIHx8IDApID49IDgpO1xuICAgIH1cblxuICAgIGNvbnN0IGxlbmd0aCA9IHBhcnNlSW50KFN0cmluZyhmaWx0ZXJWYWx1ZSkpO1xuICAgIGlmIChpc05hTihsZW5ndGgpKSByZXR1cm4gc2VxdWVuY2VzO1xuXG4gICAgcmV0dXJuIHNlcXVlbmNlcy5maWx0ZXIoKHMpID0+IHMuc2VxdWVuY2VMZW5ndGggPT09IGxlbmd0aCk7XG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5RGlmZmljdWx0eShcbiAgICBzZXF1ZW5jZXM6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSxcbiAgICBmaWx0ZXJWYWx1ZTogRmlsdGVyVmFsdWVcbiAgKTogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdIHtcbiAgICBpZiAoIWZpbHRlclZhbHVlKSByZXR1cm4gc2VxdWVuY2VzO1xuICAgIHJldHVybiBzZXF1ZW5jZXMuZmlsdGVyKChzKSA9PiBzLmRpZmZpY3VsdHlMZXZlbCA9PT0gZmlsdGVyVmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeVN0YXJ0aW5nUG9zaXRpb24oXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgZmlsdGVyVmFsdWU6IEZpbHRlclZhbHVlXG4gICk6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSB7XG4gICAgaWYgKCFmaWx0ZXJWYWx1ZSkgcmV0dXJuIHNlcXVlbmNlcztcbiAgICByZXR1cm4gc2VxdWVuY2VzLmZpbHRlcigocykgPT4gcy5zdGFydGluZ1Bvc2l0aW9uID09PSBmaWx0ZXJWYWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5QXV0aG9yKFxuICAgIHNlcXVlbmNlczogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YVtdLFxuICAgIGZpbHRlclZhbHVlOiBGaWx0ZXJWYWx1ZVxuICApOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10ge1xuICAgIGlmICghZmlsdGVyVmFsdWUpIHJldHVybiBzZXF1ZW5jZXM7XG4gICAgcmV0dXJuIHNlcXVlbmNlcy5maWx0ZXIoKHMpID0+IHMuYXV0aG9yID09PSBmaWx0ZXJWYWx1ZSk7XG4gIH1cblxuICBwcml2YXRlIGZpbHRlckJ5R3JpZE1vZGUoXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgZmlsdGVyVmFsdWU6IEZpbHRlclZhbHVlXG4gICk6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSB7XG4gICAgaWYgKCFmaWx0ZXJWYWx1ZSkgcmV0dXJuIHNlcXVlbmNlcztcbiAgICByZXR1cm4gc2VxdWVuY2VzLmZpbHRlcigocykgPT4gcy5ncmlkTW9kZSA9PT0gZmlsdGVyVmFsdWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJCeVJlY2VudChcbiAgICBzZXF1ZW5jZXM6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXVxuICApOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10ge1xuICAgIGNvbnN0IHRoaXJ0eURheXNBZ28gPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICByZXR1cm4gc2VxdWVuY2VzLmZpbHRlcigocykgPT4ge1xuICAgICAgY29uc3QgZGF0ZUFkZGVkID0gcy5kYXRlQWRkZWQgfHwgbmV3IERhdGUoMCk7XG4gICAgICByZXR1cm4gZGF0ZUFkZGVkID49IHRoaXJ0eURheXNBZ287XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldERpZmZpY3VsdHlPcmRlcihkaWZmaWN1bHR5Pzogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBzd2l0Y2ggKGRpZmZpY3VsdHkpIHtcbiAgICAgIGNhc2UgXCJiZWdpbm5lclwiOlxuICAgICAgICByZXR1cm4gMTtcbiAgICAgIGNhc2UgXCJpbnRlcm1lZGlhdGVcIjpcbiAgICAgICAgcmV0dXJuIDI7XG4gICAgICBjYXNlIFwiYWR2YW5jZWRcIjpcbiAgICAgICAgcmV0dXJuIDM7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNlY3Rpb25LZXkoXG4gICAgc2VxdWVuY2U6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGEsXG4gICAgc29ydE1ldGhvZDogU29ydE1ldGhvZFxuICApOiBzdHJpbmcge1xuICAgIHN3aXRjaCAoc29ydE1ldGhvZCkge1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5BTFBIQUJFVElDQUw6XG4gICAgICAgIHJldHVybiBzZXF1ZW5jZS53b3JkWzBdPy50b1VwcGVyQ2FzZSgpIHx8IFwiI1wiO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5ESUZGSUNVTFRZX0xFVkVMOlxuICAgICAgICByZXR1cm4gc2VxdWVuY2UuZGlmZmljdWx0eUxldmVsIHx8IFwiVW5rbm93blwiO1xuICAgICAgY2FzZSBTb3J0TWV0aG9kRW51bS5BVVRIT1I6XG4gICAgICAgIHJldHVybiBzZXF1ZW5jZS5hdXRob3IgfHwgXCJVbmtub3duXCI7XG4gICAgICBjYXNlIFNvcnRNZXRob2RFbnVtLlNFUVVFTkNFX0xFTkdUSDoge1xuICAgICAgICBjb25zdCBsZW5ndGggPSBzZXF1ZW5jZS5zZXF1ZW5jZUxlbmd0aCB8fCAwO1xuICAgICAgICBpZiAobGVuZ3RoIDw9IDQpIHJldHVybiBcIjMtNCBiZWF0c1wiO1xuICAgICAgICBpZiAobGVuZ3RoIDw9IDYpIHJldHVybiBcIjUtNiBiZWF0c1wiO1xuICAgICAgICBpZiAobGVuZ3RoIDw9IDgpIHJldHVybiBcIjctOCBiZWF0c1wiO1xuICAgICAgICByZXR1cm4gXCI5KyBiZWF0c1wiO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwiQWxsXCI7XG4gICAgfVxuICB9XG5cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlZFNlcXVlbmNlcyA9IG51bGw7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICJBQU9BLFNBQVMsZ0JBQWdCO0FBQ3pCO0FBQUEsRUFDRSxjQUFjO0FBQUEsRUFDZCxjQUFjO0FBQUEsT0FDVDtBQVNBLGFBQU0sY0FBd0M7QUFBQSxFQUMzQyxrQkFBbUQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtuRCx3QkFBd0IsVUFBMkM7QUFDekUsVUFBTSxPQUFPLFNBQVMsUUFBUSxTQUFTLFFBQVEsU0FBUyxNQUFNO0FBRzlELFVBQU0sdUJBQXVCO0FBQUEsTUFDM0I7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxJQUNGO0FBRUEsUUFDRSxxQkFBcUIsU0FBUyxJQUFJLEtBQ2xDLHFCQUFxQixTQUFTLFNBQVMsRUFBRSxHQUN6QztBQUNBLGNBQVE7QUFBQSxRQUNOLHNEQUFzRCxJQUFJO0FBQUEsTUFDNUQ7QUFDQSxhQUFPO0FBQUEsSUFDVDtBQUdBLFdBQ0UsS0FBSyxTQUFTLEtBQ2QsS0FBSyxVQUFVO0FBQUEsSUFDZixTQUFTO0FBQUEsSUFDVCxDQUFDLEtBQUssWUFBWSxFQUFFLFNBQVMsTUFBTTtBQUFBLEVBRXZDO0FBQUEsRUFFQSxNQUFNLHVCQUEwRDtBQUM5RCxZQUFRLElBQUksZ0RBQWdEO0FBRTVELFFBQUksS0FBSyxvQkFBb0IsTUFBTTtBQUNqQyxjQUFRO0FBQUEsUUFDTjtBQUFBLFFBQ0EsS0FBSyxnQkFBZ0I7QUFBQSxRQUNyQjtBQUFBLE1BQ0Y7QUFDQSxhQUFPLEtBQUs7QUFBQSxJQUNkO0FBRUEsUUFBSTtBQUVGLGNBQVEsSUFBSSxtQ0FBbUM7QUFDL0MsWUFBTSxZQUFZ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
