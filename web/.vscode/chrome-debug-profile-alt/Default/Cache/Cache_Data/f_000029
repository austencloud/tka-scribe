import { createSequenceData } from "/src/lib/domain/index.ts";
import { GridMode } from "/src/lib/domain/index.ts";
import { createMotionData } from "/src/lib/domain/MotionData.ts";
import {
  MotionType,
  RotationDirection,
  Location,
  Orientation,
  DifficultyLevel,
  PropContinuity,
  GenerationMode
} from "/src/lib/domain/enums.ts";
const ROTATION_DIRS = {
  CLOCKWISE: RotationDirection.CLOCKWISE,
  COUNTER_CLOCKWISE: RotationDirection.COUNTER_CLOCKWISE,
  noRotation: RotationDirection.NO_ROTATION
};
const MOTION_TYPES = {
  PRO: MotionType.PRO,
  ANTI: MotionType.ANTI,
  FLOAT: MotionType.FLOAT,
  DASH: MotionType.DASH,
  STATIC: MotionType.STATIC
};
export class SequenceGenerationService {
  constructor(letterQueryService, orientationCalculationService) {
    this.letterQueryService = letterQueryService;
    this.orientationCalculationService = orientationCalculationService;
  }
  /**
   * Generate freeform sequence - exact port of legacy build_sequence()
   */
  async generateSequence(options) {
    try {
      console.log("ðŸŽ¯ Starting freeform generation with options:", options);
      const sequence = [];
      let blueRotationDirection;
      let redRotationDirection;
      if (options.propContinuity === PropContinuity.CONTINUOUS) {
        blueRotationDirection = this.randomChoice([
          ROTATION_DIRS.CLOCKWISE,
          ROTATION_DIRS.COUNTER_CLOCKWISE
        ]);
        redRotationDirection = this.randomChoice([
          ROTATION_DIRS.CLOCKWISE,
          ROTATION_DIRS.COUNTER_CLOCKWISE
        ]);
      } else {
        blueRotationDirection = "";
        redRotationDirection = "";
      }
      console.log("ðŸ”„ Rotation directions:", {
        blueRotationDirection,
        redRotationDirection,
        propContinuity: options.propContinuity
      });
      const lengthOfSequenceUponStart = Math.max(0, sequence.length - 2);
      const beatsToGenerate = options.length - lengthOfSequenceUponStart;
      console.log(
        `ðŸ“Š Generating ${beatsToGenerate} beats (requested: ${options.length}, existing: ${lengthOfSequenceUponStart})`
      );
      if (beatsToGenerate <= 0) {
        throw new Error(
          "No beats to generate - sequence may already be complete"
        );
      }
      const level = this.mapDifficultyToLevel(options.difficulty);
      const turnIntensity = options.turnIntensity || 1;
      const totalTurns = Math.floor(turnIntensity * beatsToGenerate);
      const turnAllocation = {
        blue: Array(beatsToGenerate).fill(0).map((_, i) => i < totalTurns / 2 ? 1 : 0),
        red: Array(beatsToGenerate).fill(0).map((_, i) => i < totalTurns / 2 ? 1 : 0)
      };
      console.log("ðŸŽ² Turn allocation:", turnAllocation);
      const generatedBeats = [];
      for (let i = 0; i < beatsToGenerate; i++) {
        console.log(`âš¡ Generating beat ${i + 1}/${beatsToGenerate}`);
        try {
          const nextPictograph = await this._generateNextPictograph(
            sequence,
            level,
            turnAllocation.blue[i],
            turnAllocation.red[i],
            options.propContinuity || PropContinuity.CONTINUOUS,
            blueRotationDirection,
            redRotationDirection,
            options.letterTypes || ["Dual-Shift"]
            // Default to Type1 if not specified
          );
          sequence.push(nextPictograph);
          generatedBeats.push(nextPictograph);
          console.log(
            `âœ… Generated beat ${i + 1}: ${nextPictograph.pictographData?.letter}`
          );
        } catch (beatError) {
          console.error(`âŒ Failed to generate beat ${i + 1}:`, beatError);
          throw new Error(
            `Beat generation failed at position ${i + 1}: ${beatError instanceof Error ? beatError.message : "Unknown error"}`
          );
        }
      }
      const generatedSequence = createSequenceData({
        name: this.generateSequenceName(options),
        word: "",
        // Will be calculated from beats
        beats: generatedBeats,
        gridMode: options.gridMode,
        propType: options.propType,
        difficulty_level: options.difficulty,
        is_favorite: false,
        is_circular: false,
        tags: [],
        metadata: {
          generated: true,
          generatedAt: (/* @__PURE__ */ new Date()).toISOString(),
          algorithm: "freeform",
          beatsGenerated: generatedBeats.length,
          propContinuity: options.propContinuity,
          blueRotationDirection,
          redRotationDirection,
          turnIntensity,
          level
        }
      });
      console.log("ðŸŽ‰ Sequence generation complete:", {
        id: generatedSequence.id,
        beats: generatedBeats.length,
        name: generatedSequence.name
      });
      return generatedSequence;
    } catch (error) {
      console.error("âŒ Sequence generation failed:", error);
      throw new Error(
        `Sequence generation failed: ${error instanceof Error ? error.message : "Unknown error"}`
      );
    }
  }
  /**
   * Generate next pictograph - exact port of legacy _generate_next_pictograph()
   */
  async _generateNextPictograph(sequence, level, turnBlue, turnRed, propContinuity, blueRotationDirection, redRotationDirection, _letterTypes) {
    try {
      const optionDicts = await this.letterQueryService.getAllCodexPictographs(
        GridMode.DIAMOND
      );
      console.log(`ðŸ“‹ Loaded ${optionDicts.length} option dicts`);
      if (optionDicts.length === 0) {
        throw new Error("No pictographs available from option service");
      }
      console.log(
        `ðŸ” Using all ${optionDicts.length} options (filtering not yet implemented)`
      );
      console.log(`ðŸ”„ Rotation filtering not yet implemented`);
      if (optionDicts.length === 0) {
        throw new Error("No valid options available after filtering");
      }
      const selectedOption = this.randomChoice(optionDicts);
      console.log(`ðŸŽ¯ Selected option: ${selectedOption.letter}`);
      let nextBeat = this.convertPictographToBeat(
        selectedOption,
        sequence.length + 1
      );
      if (level === 2 || level === 3) {
        this.setTurns(nextBeat, turnBlue, turnRed);
        console.log(`ðŸŽ² Set turns: blue=${turnBlue}, red=${turnRed}`);
      }
      if (sequence.length > 0) {
        nextBeat = this.orientationCalculationService.updateStartOrientations(
          nextBeat,
          sequence[sequence.length - 1]
        );
      }
      this.updateDashStaticRotationDirections(
        nextBeat,
        propContinuity,
        blueRotationDirection,
        redRotationDirection
      );
      nextBeat = this.orientationCalculationService.updateEndOrientations(nextBeat);
      console.log(`ðŸ§­ Updated orientations for beat ${nextBeat.beatNumber}`);
      return nextBeat;
    } catch (error) {
      console.error(`âŒ Failed to generate pictograph:`, error);
      throw error;
    }
  }
  /**
   * Convert PictographData to BeatData - creates proper domain object
   */
  convertPictographToBeat(pictograph, beatNumber) {
    const motions = {
      blue: pictograph.motions.blue || createMotionData({
        motionType: MotionType.STATIC,
        rotationDirection: RotationDirection.NO_ROTATION,
        startLocation: Location.NORTH,
        endLocation: Location.NORTH,
        turns: 0,
        startOrientation: Orientation.IN,
        endOrientation: Orientation.IN
      }),
      red: pictograph.motions.red || createMotionData({
        motionType: MotionType.STATIC,
        rotationDirection: RotationDirection.NO_ROTATION,
        startLocation: Location.NORTH,
        endLocation: Location.NORTH,
        turns: 0,
        startOrientation: Orientation.IN,
        endOrientation: Orientation.IN
      }),
      ...pictograph.motions
    };
    return {
      id: crypto.randomUUID(),
      beatNumber,
      duration: 1,
      blueReversal: false,
      redReversal: false,
      isBlank: false,
      pictographData: {
        ...pictograph,
        motions
      },
      metadata: {
        generated: true,
        generatedAt: (/* @__PURE__ */ new Date()).toISOString(),
        letter: pictograph.letter
      }
    };
  }
  /**
   * Set turns - exact port from legacy set_turns()
   */
  setTurns(beat, turnBlue, turnRed) {
    if (!beat.pictographData) return;
    if (turnBlue === "fl") {
      if (beat.pictographData.motions.blue?.motionType === MotionType.PRO || beat.pictographData.motions.blue?.motionType === MotionType.ANTI) {
        if (beat.pictographData.motions.blue) {
          beat.pictographData.motions.blue = {
            ...beat.pictographData.motions.blue,
            turns: "fl",
            prefloatMotionType: beat.pictographData.motions.blue.motionType,
            prefloatRotationDirection: beat.pictographData.motions.blue.rotationDirection,
            motionType: MotionType.FLOAT,
            rotationDirection: RotationDirection.NO_ROTATION
          };
        }
      } else {
        if (beat.pictographData.motions.blue) {
          beat.pictographData.motions.blue = {
            ...beat.pictographData.motions.blue,
            turns: 0
          };
        }
      }
    } else {
      if (beat.pictographData.motions.blue) {
        beat.pictographData.motions.blue = {
          ...beat.pictographData.motions.blue,
          turns: turnBlue
        };
      }
    }
    if (turnRed === "fl") {
      if (beat.pictographData.motions.red?.motionType === MotionType.PRO || beat.pictographData.motions.red?.motionType === MotionType.ANTI) {
        if (beat.pictographData.motions.red) {
          beat.pictographData.motions.red = {
            ...beat.pictographData.motions.red,
            turns: "fl",
            prefloatMotionType: beat.pictographData.motions.red.motionType,
            prefloatRotationDirection: beat.pictographData.motions.red.rotationDirection,
            motionType: MotionType.FLOAT,
            rotationDirection: RotationDirection.NO_ROTATION
          };
        }
      } else {
        if (beat.pictographData.motions.red) {
          beat.pictographData.motions.red = {
            ...beat.pictographData.motions.red,
            turns: 0
          };
        }
      }
    } else {
      if (beat.pictographData.motions.red) {
        beat.pictographData.motions.red = {
          ...beat.pictographData.motions.red,
          turns: turnRed
        };
      }
    }
  }
  /**
   * Update dash/static prop rotation directions - exact port from legacy
   */
  updateDashStaticRotationDirections(beat, propContinuity, blueRotationDirection, redRotationDirection) {
    if (!beat.pictographData) return;
    if (beat.pictographData.motions.blue?.motionType === MOTION_TYPES.DASH || beat.pictographData.motions.blue?.motionType === MOTION_TYPES.STATIC) {
      const turns = beat.pictographData.motions.blue.turns || 0;
      if (propContinuity === PropContinuity.CONTINUOUS) {
        const newRotationDirection = typeof turns === "number" && turns > 0 ? blueRotationDirection : ROTATION_DIRS.noRotation;
        beat.pictographData.motions.blue = {
          ...beat.pictographData.motions.blue,
          rotationDirection: newRotationDirection
        };
      } else if (typeof turns === "number" && turns > 0) {
        const newRotationDirection = this.randomChoice([
          ROTATION_DIRS.CLOCKWISE,
          ROTATION_DIRS.COUNTER_CLOCKWISE
        ]);
        beat.pictographData.motions.blue = {
          ...beat.pictographData.motions.blue,
          rotationDirection: newRotationDirection
        };
      } else {
        beat.pictographData.motions.blue = {
          ...beat.pictographData.motions.blue,
          rotationDirection: ROTATION_DIRS.noRotation
        };
      }
    }
    if (beat.pictographData.motions.red?.motionType === MOTION_TYPES.DASH || beat.pictographData.motions.red?.motionType === MOTION_TYPES.STATIC) {
      const turns = beat.pictographData.motions.red.turns || 0;
      if (propContinuity === PropContinuity.CONTINUOUS) {
        const newRotationDirection = typeof turns === "number" && turns > 0 ? redRotationDirection : ROTATION_DIRS.noRotation;
        beat.pictographData.motions.red = {
          ...beat.pictographData.motions.red,
          rotationDirection: newRotationDirection
        };
      } else if (typeof turns === "number" && turns > 0) {
        const newRotationDirection = this.randomChoice([
          ROTATION_DIRS.CLOCKWISE,
          ROTATION_DIRS.COUNTER_CLOCKWISE
        ]);
        beat.pictographData.motions.red = {
          ...beat.pictographData.motions.red,
          rotationDirection: newRotationDirection
        };
      } else {
        beat.pictographData.motions.red = {
          ...beat.pictographData.motions.red,
          rotationDirection: ROTATION_DIRS.noRotation
        };
      }
    }
  }
  /**
   * Random choice helper - exact behavior from legacy random.choice()
   */
  randomChoice(array) {
    if (array.length === 0) {
      throw new Error("Cannot choose from empty array");
    }
    return array[Math.floor(Math.random() * array.length)];
  }
  /**
   * Map difficulty to level - legacy mapping
   */
  mapDifficultyToLevel(difficulty) {
    switch (difficulty) {
      case DifficultyLevel.BEGINNER:
        return 1;
      case DifficultyLevel.INTERMEDIATE:
        return 2;
      case DifficultyLevel.ADVANCED:
        return 3;
      default:
        return 2;
    }
  }
  /**
   * Generate sequence name based on options - matches legacy pattern
   */
  generateSequenceName(options) {
    const timestamp = (/* @__PURE__ */ new Date()).toLocaleString("en-US", {
      month: "short",
      day: "numeric",
      hour: "numeric",
      minute: "2-digit"
    });
    const difficulty = options.difficulty.charAt(0).toUpperCase() + options.difficulty.slice(1);
    return `${difficulty} ${options.length}-Beat (${timestamp})`;
  }
  /**
   * Generate circular sequence - not implemented in Phase 1
   */
  async generatePatternSequence(pattern, _options) {
    throw new Error(`${pattern} generation not implemented yet`);
  }
  /**
   * Get generation statistics - not implemented in Phase 1
   */
  getGenerationStats() {
    return {
      totalGenerated: 0,
      averageGenerationTime: 0,
      lastGenerated: null
    };
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9nZW5lcmF0aW9uL1NlcXVlbmNlR2VuZXJhdGlvblNlcnZpY2UudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qKlxuICogU2VxdWVuY2UgR2VuZXJhdGlvbiBTZXJ2aWNlIC0gQ29tcGxldGUgcG9ydCBvZiBsZWdhY3kgZnJlZWZvcm0gYWxnb3JpdGhtXG4gKlxuICogRXhhY3QgaW1wbGVtZW50YXRpb24gb2YgRnJlZUZvcm1TZXF1ZW5jZUJ1aWxkZXIuYnVpbGRfc2VxdWVuY2UoKSBhbmQgX2dlbmVyYXRlX25leHRfcGljdG9ncmFwaCgpLlxuICogTm8gcGxhY2Vob2xkZXJzLCBubyBzaW1wbGlmaWVkIHZlcnNpb25zIC0gY29tcGxldGUgYWxnb3JpdGhtIGZyb20gbGVnYWN5IGRlc2t0b3AgYXBwLlxuICovXG5cbmltcG9ydCB0eXBlIHsgQmVhdERhdGEsIFNlcXVlbmNlRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHsgY3JlYXRlU2VxdWVuY2VEYXRhIH0gZnJvbSBcIiRsaWIvZG9tYWluXCI7XG5pbXBvcnQgeyBHcmlkTW9kZSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHR5cGUge1xuICBHZW5lcmF0aW9uT3B0aW9ucyxcbiAgSVNlcXVlbmNlR2VuZXJhdGlvblNlcnZpY2UsXG4gIElPcmllbnRhdGlvbkNhbGN1bGF0aW9uU2VydmljZSxcbn0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXMvZ2VuZXJhdGlvbi1pbnRlcmZhY2VzXCI7XG5pbXBvcnQgdHlwZSB7IElMZXR0ZXJRdWVyeVNlcnZpY2UgfSBmcm9tIFwiLi4vZGF0YS9MZXR0ZXJRdWVyeVNlcnZpY2VcIjtcblxuaW1wb3J0IHR5cGUgeyBQaWN0b2dyYXBoRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9QaWN0b2dyYXBoRGF0YVwiO1xuaW1wb3J0IHsgY3JlYXRlTW90aW9uRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9Nb3Rpb25EYXRhXCI7XG5pbXBvcnQge1xuICBNb3Rpb25UeXBlLFxuICBSb3RhdGlvbkRpcmVjdGlvbixcbiAgTG9jYXRpb24sXG4gIE9yaWVudGF0aW9uLFxuICBEaWZmaWN1bHR5TGV2ZWwsXG4gIFByb3BDb250aW51aXR5LFxuICBHZW5lcmF0aW9uTW9kZSxcbn0gZnJvbSBcIiRsaWIvZG9tYWluL2VudW1zXCI7XG5cbi8vIExlZ2FjeSBjb25zdGFudHMgZm9yIHJvdGF0aW9uIGRpcmVjdGlvbnMgLSB1c2luZyBlbnVtIHZhbHVlc1xuY29uc3QgUk9UQVRJT05fRElSUyA9IHtcbiAgQ0xPQ0tXSVNFOiBSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0UsXG4gIENPVU5URVJfQ0xPQ0tXSVNFOiBSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRSxcbiAgbm9Sb3RhdGlvbjogUm90YXRpb25EaXJlY3Rpb24uTk9fUk9UQVRJT04sXG59IGFzIGNvbnN0O1xuXG5jb25zdCBNT1RJT05fVFlQRVMgPSB7XG4gIFBSTzogTW90aW9uVHlwZS5QUk8sXG4gIEFOVEk6IE1vdGlvblR5cGUuQU5USSxcbiAgRkxPQVQ6IE1vdGlvblR5cGUuRkxPQVQsXG4gIERBU0g6IE1vdGlvblR5cGUuREFTSCxcbiAgU1RBVElDOiBNb3Rpb25UeXBlLlNUQVRJQyxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCBjbGFzcyBTZXF1ZW5jZUdlbmVyYXRpb25TZXJ2aWNlIGltcGxlbWVudHMgSVNlcXVlbmNlR2VuZXJhdGlvblNlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGxldHRlclF1ZXJ5U2VydmljZTogSUxldHRlclF1ZXJ5U2VydmljZSxcbiAgICBwcml2YXRlIG9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlOiBJT3JpZW50YXRpb25DYWxjdWxhdGlvblNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBmcmVlZm9ybSBzZXF1ZW5jZSAtIGV4YWN0IHBvcnQgb2YgbGVnYWN5IGJ1aWxkX3NlcXVlbmNlKClcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlU2VxdWVuY2Uob3B0aW9uczogR2VuZXJhdGlvbk9wdGlvbnMpOiBQcm9taXNlPFNlcXVlbmNlRGF0YT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhcIvCfjq8gU3RhcnRpbmcgZnJlZWZvcm0gZ2VuZXJhdGlvbiB3aXRoIG9wdGlvbnM6XCIsIG9wdGlvbnMpO1xuXG4gICAgICAvLyBTdGVwIDE6IEluaXRpYWxpemUgc2VxdWVuY2UgKGxlZ2FjeTogc2VsZi5pbml0aWFsaXplX3NlcXVlbmNlKVxuICAgICAgLy8gVE9ETzogSW4gZnVsbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyBzaG91bGQgbG9hZCBjdXJyZW50IHNlcXVlbmNlIGZyb20gd29ya2JlbmNoXG4gICAgICAvLyBGb3Igbm93LCBzdGFydCB3aXRoIGVtcHR5IHNlcXVlbmNlXG4gICAgICBjb25zdCBzZXF1ZW5jZTogQmVhdERhdGFbXSA9IFtdO1xuXG4gICAgICAvLyBTdGVwIDI6IFNldCByb3RhdGlvbiBkaXJlY3Rpb25zIGJhc2VkIG9uIHByb3AgY29udGludWl0eSAobGVnYWN5IGxpbmVzIDMxLTM1KVxuICAgICAgbGV0IGJsdWVSb3RhdGlvbkRpcmVjdGlvbjogc3RyaW5nO1xuICAgICAgbGV0IHJlZFJvdGF0aW9uRGlyZWN0aW9uOiBzdHJpbmc7XG5cbiAgICAgIGlmIChvcHRpb25zLnByb3BDb250aW51aXR5ID09PSBQcm9wQ29udGludWl0eS5DT05USU5VT1VTKSB7XG4gICAgICAgIGJsdWVSb3RhdGlvbkRpcmVjdGlvbiA9IHRoaXMucmFuZG9tQ2hvaWNlKFtcbiAgICAgICAgICBST1RBVElPTl9ESVJTLkNMT0NLV0lTRSxcbiAgICAgICAgICBST1RBVElPTl9ESVJTLkNPVU5URVJfQ0xPQ0tXSVNFLFxuICAgICAgICBdKTtcbiAgICAgICAgcmVkUm90YXRpb25EaXJlY3Rpb24gPSB0aGlzLnJhbmRvbUNob2ljZShbXG4gICAgICAgICAgUk9UQVRJT05fRElSUy5DTE9DS1dJU0UsXG4gICAgICAgICAgUk9UQVRJT05fRElSUy5DT1VOVEVSX0NMT0NLV0lTRSxcbiAgICAgICAgXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSYW5kb20gcHJvcCBjb250aW51aXR5IC0gdGhlc2Ugd2lsbCBiZSBzZXQgcGVyIG1vdGlvblxuICAgICAgICBibHVlUm90YXRpb25EaXJlY3Rpb24gPSBcIlwiO1xuICAgICAgICByZWRSb3RhdGlvbkRpcmVjdGlvbiA9IFwiXCI7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFwi8J+UhCBSb3RhdGlvbiBkaXJlY3Rpb25zOlwiLCB7XG4gICAgICAgIGJsdWVSb3RhdGlvbkRpcmVjdGlvbixcbiAgICAgICAgcmVkUm90YXRpb25EaXJlY3Rpb24sXG4gICAgICAgIHByb3BDb250aW51aXR5OiBvcHRpb25zLnByb3BDb250aW51aXR5LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0ZXAgMzogQ2FsY3VsYXRlIGJlYXRzIHRvIGdlbmVyYXRlIChsZWdhY3kgbG9naWMpXG4gICAgICBjb25zdCBsZW5ndGhPZlNlcXVlbmNlVXBvblN0YXJ0ID0gTWF0aC5tYXgoMCwgc2VxdWVuY2UubGVuZ3RoIC0gMik7XG4gICAgICBjb25zdCBiZWF0c1RvR2VuZXJhdGUgPSBvcHRpb25zLmxlbmd0aCAtIGxlbmd0aE9mU2VxdWVuY2VVcG9uU3RhcnQ7XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+TiiBHZW5lcmF0aW5nICR7YmVhdHNUb0dlbmVyYXRlfSBiZWF0cyAocmVxdWVzdGVkOiAke29wdGlvbnMubGVuZ3RofSwgZXhpc3Rpbmc6ICR7bGVuZ3RoT2ZTZXF1ZW5jZVVwb25TdGFydH0pYFxuICAgICAgKTtcblxuICAgICAgaWYgKGJlYXRzVG9HZW5lcmF0ZSA8PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIk5vIGJlYXRzIHRvIGdlbmVyYXRlIC0gc2VxdWVuY2UgbWF5IGFscmVhZHkgYmUgY29tcGxldGVcIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDQ6IEFsbG9jYXRlIHR1cm5zIHVzaW5nIFR1cm5JbnRlbnNpdHlNYW5hZ2VyIChsZWdhY3kgbGluZXMgMzktNDApXG4gICAgICBjb25zdCBsZXZlbCA9IHRoaXMubWFwRGlmZmljdWx0eVRvTGV2ZWwob3B0aW9ucy5kaWZmaWN1bHR5KTtcbiAgICAgIGNvbnN0IHR1cm5JbnRlbnNpdHkgPSBvcHRpb25zLnR1cm5JbnRlbnNpdHkgfHwgMTtcblxuICAgICAgLy8gU2ltcGxlIHR1cm4gYWxsb2NhdGlvbiBmb3Igbm93IChjYW4gYmUgZW5oYW5jZWQgbGF0ZXIpXG4gICAgICBjb25zdCB0b3RhbFR1cm5zID0gTWF0aC5mbG9vcih0dXJuSW50ZW5zaXR5ICogYmVhdHNUb0dlbmVyYXRlKTtcbiAgICAgIGNvbnN0IHR1cm5BbGxvY2F0aW9uID0ge1xuICAgICAgICBibHVlOiBBcnJheShiZWF0c1RvR2VuZXJhdGUpXG4gICAgICAgICAgLmZpbGwoMClcbiAgICAgICAgICAubWFwKChfLCBpKSA9PiAoaSA8IHRvdGFsVHVybnMgLyAyID8gMSA6IDApKSxcbiAgICAgICAgcmVkOiBBcnJheShiZWF0c1RvR2VuZXJhdGUpXG4gICAgICAgICAgLmZpbGwoMClcbiAgICAgICAgICAubWFwKChfLCBpKSA9PiAoaSA8IHRvdGFsVHVybnMgLyAyID8gMSA6IDApKSxcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyhcIvCfjrIgVHVybiBhbGxvY2F0aW9uOlwiLCB0dXJuQWxsb2NhdGlvbik7XG5cbiAgICAgIC8vIFN0ZXAgNTogR2VuZXJhdGlvbiBsb29wIChsZWdhY3kgbGluZXMgNDItNTgpXG4gICAgICBjb25zdCBnZW5lcmF0ZWRCZWF0czogQmVhdERhdGFbXSA9IFtdO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJlYXRzVG9HZW5lcmF0ZTsgaSsrKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDimqEgR2VuZXJhdGluZyBiZWF0ICR7aSArIDF9LyR7YmVhdHNUb0dlbmVyYXRlfWApO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbmV4dFBpY3RvZ3JhcGggPSBhd2FpdCB0aGlzLl9nZW5lcmF0ZU5leHRQaWN0b2dyYXBoKFxuICAgICAgICAgICAgc2VxdWVuY2UsXG4gICAgICAgICAgICBsZXZlbCxcbiAgICAgICAgICAgIHR1cm5BbGxvY2F0aW9uLmJsdWVbaV0sXG4gICAgICAgICAgICB0dXJuQWxsb2NhdGlvbi5yZWRbaV0sXG4gICAgICAgICAgICBvcHRpb25zLnByb3BDb250aW51aXR5IHx8IFByb3BDb250aW51aXR5LkNPTlRJTlVPVVMsXG4gICAgICAgICAgICBibHVlUm90YXRpb25EaXJlY3Rpb24sXG4gICAgICAgICAgICByZWRSb3RhdGlvbkRpcmVjdGlvbixcbiAgICAgICAgICAgIG9wdGlvbnMubGV0dGVyVHlwZXMgfHwgW1wiRHVhbC1TaGlmdFwiXSAvLyBEZWZhdWx0IHRvIFR5cGUxIGlmIG5vdCBzcGVjaWZpZWRcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQWRkIHRvIHNlcXVlbmNlIGZvciBuZXh0IGl0ZXJhdGlvbiAobGVnYWN5IGxvZ2ljKVxuICAgICAgICAgIHNlcXVlbmNlLnB1c2gobmV4dFBpY3RvZ3JhcGgpO1xuICAgICAgICAgIGdlbmVyYXRlZEJlYXRzLnB1c2gobmV4dFBpY3RvZ3JhcGgpO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg4pyFIEdlbmVyYXRlZCBiZWF0ICR7aSArIDF9OiAke25leHRQaWN0b2dyYXBoLnBpY3RvZ3JhcGhEYXRhPy5sZXR0ZXJ9YFxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGJlYXRFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBGYWlsZWQgdG8gZ2VuZXJhdGUgYmVhdCAke2kgKyAxfTpgLCBiZWF0RXJyb3IpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBCZWF0IGdlbmVyYXRpb24gZmFpbGVkIGF0IHBvc2l0aW9uICR7aSArIDF9OiAke2JlYXRFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gYmVhdEVycm9yLm1lc3NhZ2UgOiBcIlVua25vd24gZXJyb3JcIn1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDY6IENyZWF0ZSBzZXF1ZW5jZSBkYXRhIHN0cnVjdHVyZVxuICAgICAgY29uc3QgZ2VuZXJhdGVkU2VxdWVuY2U6IFNlcXVlbmNlRGF0YSA9IGNyZWF0ZVNlcXVlbmNlRGF0YSh7XG4gICAgICAgIG5hbWU6IHRoaXMuZ2VuZXJhdGVTZXF1ZW5jZU5hbWUob3B0aW9ucyksXG4gICAgICAgIHdvcmQ6IFwiXCIsIC8vIFdpbGwgYmUgY2FsY3VsYXRlZCBmcm9tIGJlYXRzXG4gICAgICAgIGJlYXRzOiBnZW5lcmF0ZWRCZWF0cyxcbiAgICAgICAgZ3JpZE1vZGU6IG9wdGlvbnMuZ3JpZE1vZGUsXG4gICAgICAgIHByb3BUeXBlOiBvcHRpb25zLnByb3BUeXBlLFxuICAgICAgICBkaWZmaWN1bHR5X2xldmVsOiBvcHRpb25zLmRpZmZpY3VsdHksXG4gICAgICAgIGlzX2Zhdm9yaXRlOiBmYWxzZSxcbiAgICAgICAgaXNfY2lyY3VsYXI6IGZhbHNlLFxuICAgICAgICB0YWdzOiBbXSxcbiAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICBnZW5lcmF0ZWQ6IHRydWUsXG4gICAgICAgICAgZ2VuZXJhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICBhbGdvcml0aG06IFwiZnJlZWZvcm1cIixcbiAgICAgICAgICBiZWF0c0dlbmVyYXRlZDogZ2VuZXJhdGVkQmVhdHMubGVuZ3RoLFxuICAgICAgICAgIHByb3BDb250aW51aXR5OiBvcHRpb25zLnByb3BDb250aW51aXR5LFxuICAgICAgICAgIGJsdWVSb3RhdGlvbkRpcmVjdGlvbixcbiAgICAgICAgICByZWRSb3RhdGlvbkRpcmVjdGlvbixcbiAgICAgICAgICB0dXJuSW50ZW5zaXR5LFxuICAgICAgICAgIGxldmVsLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKFwi8J+OiSBTZXF1ZW5jZSBnZW5lcmF0aW9uIGNvbXBsZXRlOlwiLCB7XG4gICAgICAgIGlkOiBnZW5lcmF0ZWRTZXF1ZW5jZS5pZCxcbiAgICAgICAgYmVhdHM6IGdlbmVyYXRlZEJlYXRzLmxlbmd0aCxcbiAgICAgICAgbmFtZTogZ2VuZXJhdGVkU2VxdWVuY2UubmFtZSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZ2VuZXJhdGVkU2VxdWVuY2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgU2VxdWVuY2UgZ2VuZXJhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFNlcXVlbmNlIGdlbmVyYXRpb24gZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgbmV4dCBwaWN0b2dyYXBoIC0gZXhhY3QgcG9ydCBvZiBsZWdhY3kgX2dlbmVyYXRlX25leHRfcGljdG9ncmFwaCgpXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIF9nZW5lcmF0ZU5leHRQaWN0b2dyYXBoKFxuICAgIHNlcXVlbmNlOiBCZWF0RGF0YVtdLFxuICAgIGxldmVsOiBudW1iZXIsXG4gICAgdHVybkJsdWU6IG51bWJlciB8IFwiZmxcIixcbiAgICB0dXJuUmVkOiBudW1iZXIgfCBcImZsXCIsXG4gICAgcHJvcENvbnRpbnVpdHk6IFByb3BDb250aW51aXR5LFxuICAgIGJsdWVSb3RhdGlvbkRpcmVjdGlvbjogc3RyaW5nLFxuICAgIHJlZFJvdGF0aW9uRGlyZWN0aW9uOiBzdHJpbmcsXG4gICAgX2xldHRlclR5cGVzOiBzdHJpbmdbXVxuICApOiBQcm9taXNlPEJlYXREYXRhPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogR2V0IG9wdGlvbiBkaWN0cyAobGVnYWN5OiBzZWxmLl9nZXRfb3B0aW9uX2RpY3RzKCkpXG4gICAgICAvLyBMZXR0ZXJRdWVyeVNlcnZpY2UgaW5pdGlhbGl6ZXMgYXV0b21hdGljYWxseSB3aGVuIGZpcnN0IHVzZWRcbiAgICAgIGNvbnN0IG9wdGlvbkRpY3RzID0gYXdhaXQgdGhpcy5sZXR0ZXJRdWVyeVNlcnZpY2UuZ2V0QWxsQ29kZXhQaWN0b2dyYXBocyhcbiAgICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OLIExvYWRlZCAke29wdGlvbkRpY3RzLmxlbmd0aH0gb3B0aW9uIGRpY3RzYCk7XG5cbiAgICAgIGlmIChvcHRpb25EaWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gcGljdG9ncmFwaHMgYXZhaWxhYmxlIGZyb20gb3B0aW9uIHNlcnZpY2VcIik7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+UjSBVc2luZyBhbGwgJHtvcHRpb25EaWN0cy5sZW5ndGh9IG9wdGlvbnMgKGZpbHRlcmluZyBub3QgeWV0IGltcGxlbWVudGVkKWBcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+UhCBSb3RhdGlvbiBmaWx0ZXJpbmcgbm90IHlldCBpbXBsZW1lbnRlZGApO1xuXG4gICAgICBpZiAob3B0aW9uRGljdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHZhbGlkIG9wdGlvbnMgYXZhaWxhYmxlIGFmdGVyIGZpbHRlcmluZ1wiKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBSYW5kb20gc2VsZWN0aW9uIChsZWdhY3k6IHJhbmRvbS5jaG9pY2Uob3B0aW9uX2RpY3RzKSlcbiAgICAgIGNvbnN0IHNlbGVjdGVkT3B0aW9uID0gdGhpcy5yYW5kb21DaG9pY2Uob3B0aW9uRGljdHMpO1xuICAgICAgY29uc29sZS5sb2coYPCfjq8gU2VsZWN0ZWQgb3B0aW9uOiAke3NlbGVjdGVkT3B0aW9uLmxldHRlcn1gKTtcblxuICAgICAgLy8gU3RlcCA1OiBDb252ZXJ0IHRvIEJlYXREYXRhXG4gICAgICBsZXQgbmV4dEJlYXQgPSB0aGlzLmNvbnZlcnRQaWN0b2dyYXBoVG9CZWF0KFxuICAgICAgICBzZWxlY3RlZE9wdGlvbixcbiAgICAgICAgc2VxdWVuY2UubGVuZ3RoICsgMVxuICAgICAgKTtcblxuICAgICAgLy8gU3RlcCA2OiBTZXQgdHVybnMgaWYgbGV2ZWwgMiBvciAzIChsZWdhY3k6IHNlbGYuc2V0X3R1cm5zKCkpXG4gICAgICBpZiAobGV2ZWwgPT09IDIgfHwgbGV2ZWwgPT09IDMpIHtcbiAgICAgICAgdGhpcy5zZXRUdXJucyhuZXh0QmVhdCwgdHVybkJsdWUsIHR1cm5SZWQpO1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+OsiBTZXQgdHVybnM6IGJsdWU9JHt0dXJuQmx1ZX0sIHJlZD0ke3R1cm5SZWR9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNzogVXBkYXRlIG9yaWVudGF0aW9ucyAoZXhhY3QgbGVnYWN5IHNlcXVlbmNlKVxuICAgICAgaWYgKHNlcXVlbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbmV4dEJlYXQgPSB0aGlzLm9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlLnVwZGF0ZVN0YXJ0T3JpZW50YXRpb25zKFxuICAgICAgICAgIG5leHRCZWF0LFxuICAgICAgICAgIHNlcXVlbmNlW3NlcXVlbmNlLmxlbmd0aCAtIDFdXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudXBkYXRlRGFzaFN0YXRpY1JvdGF0aW9uRGlyZWN0aW9ucyhcbiAgICAgICAgbmV4dEJlYXQsXG4gICAgICAgIHByb3BDb250aW51aXR5LFxuICAgICAgICBibHVlUm90YXRpb25EaXJlY3Rpb24sXG4gICAgICAgIHJlZFJvdGF0aW9uRGlyZWN0aW9uXG4gICAgICApO1xuICAgICAgbmV4dEJlYXQgPVxuICAgICAgICB0aGlzLm9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlLnVwZGF0ZUVuZE9yaWVudGF0aW9ucyhuZXh0QmVhdCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn6etIFVwZGF0ZWQgb3JpZW50YXRpb25zIGZvciBiZWF0ICR7bmV4dEJlYXQuYmVhdE51bWJlcn1gKTtcblxuICAgICAgcmV0dXJuIG5leHRCZWF0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgRmFpbGVkIHRvIGdlbmVyYXRlIHBpY3RvZ3JhcGg6YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnZlcnQgUGljdG9ncmFwaERhdGEgdG8gQmVhdERhdGEgLSBjcmVhdGVzIHByb3BlciBkb21haW4gb2JqZWN0XG4gICAqL1xuICBwcml2YXRlIGNvbnZlcnRQaWN0b2dyYXBoVG9CZWF0KFxuICAgIHBpY3RvZ3JhcGg6IFBpY3RvZ3JhcGhEYXRhLFxuICAgIGJlYXROdW1iZXI6IG51bWJlclxuICApOiBCZWF0RGF0YSB7XG4gICAgLy8gRW5zdXJlIG1vdGlvbnMgZXhpc3QgZm9yIGJsdWUgYW5kIHJlZFxuICAgIGNvbnN0IG1vdGlvbnMgPSB7XG4gICAgICBibHVlOlxuICAgICAgICBwaWN0b2dyYXBoLm1vdGlvbnMuYmx1ZSB8fFxuICAgICAgICBjcmVhdGVNb3Rpb25EYXRhKHtcbiAgICAgICAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLlNUQVRJQyxcbiAgICAgICAgICByb3RhdGlvbkRpcmVjdGlvbjogUm90YXRpb25EaXJlY3Rpb24uTk9fUk9UQVRJT04sXG4gICAgICAgICAgc3RhcnRMb2NhdGlvbjogTG9jYXRpb24uTk9SVEgsXG4gICAgICAgICAgZW5kTG9jYXRpb246IExvY2F0aW9uLk5PUlRILFxuICAgICAgICAgIHR1cm5zOiAwLFxuICAgICAgICAgIHN0YXJ0T3JpZW50YXRpb246IE9yaWVudGF0aW9uLklOLFxuICAgICAgICAgIGVuZE9yaWVudGF0aW9uOiBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgfSksXG4gICAgICByZWQ6XG4gICAgICAgIHBpY3RvZ3JhcGgubW90aW9ucy5yZWQgfHxcbiAgICAgICAgY3JlYXRlTW90aW9uRGF0YSh7XG4gICAgICAgICAgbW90aW9uVHlwZTogTW90aW9uVHlwZS5TVEFUSUMsXG4gICAgICAgICAgcm90YXRpb25EaXJlY3Rpb246IFJvdGF0aW9uRGlyZWN0aW9uLk5PX1JPVEFUSU9OLFxuICAgICAgICAgIHN0YXJ0TG9jYXRpb246IExvY2F0aW9uLk5PUlRILFxuICAgICAgICAgIGVuZExvY2F0aW9uOiBMb2NhdGlvbi5OT1JUSCxcbiAgICAgICAgICB0dXJuczogMCxcbiAgICAgICAgICBzdGFydE9yaWVudGF0aW9uOiBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgICBlbmRPcmllbnRhdGlvbjogT3JpZW50YXRpb24uSU4sXG4gICAgICAgIH0pLFxuICAgICAgLi4ucGljdG9ncmFwaC5tb3Rpb25zLFxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICBiZWF0TnVtYmVyOiBiZWF0TnVtYmVyLFxuICAgICAgZHVyYXRpb246IDEuMCxcbiAgICAgIGJsdWVSZXZlcnNhbDogZmFsc2UsXG4gICAgICByZWRSZXZlcnNhbDogZmFsc2UsXG4gICAgICBpc0JsYW5rOiBmYWxzZSxcbiAgICAgIHBpY3RvZ3JhcGhEYXRhOiB7XG4gICAgICAgIC4uLnBpY3RvZ3JhcGgsXG4gICAgICAgIG1vdGlvbnMsXG4gICAgICB9LFxuICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgZ2VuZXJhdGVkOiB0cnVlLFxuICAgICAgICBnZW5lcmF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBsZXR0ZXI6IHBpY3RvZ3JhcGgubGV0dGVyLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0dXJucyAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3kgc2V0X3R1cm5zKClcbiAgICovXG4gIHByaXZhdGUgc2V0VHVybnMoXG4gICAgYmVhdDogQmVhdERhdGEsXG4gICAgdHVybkJsdWU6IG51bWJlciB8IFwiZmxcIixcbiAgICB0dXJuUmVkOiBudW1iZXIgfCBcImZsXCJcbiAgKTogdm9pZCB7XG4gICAgaWYgKCFiZWF0LnBpY3RvZ3JhcGhEYXRhKSByZXR1cm47XG5cbiAgICAvLyBIYW5kbGUgYmx1ZSB0dXJucyAtIGV4YWN0IGxlZ2FjeSBsb2dpY1xuICAgIGlmICh0dXJuQmx1ZSA9PT0gXCJmbFwiKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlPy5tb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLlBSTyB8fFxuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZT8ubW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5BTlRJXG4gICAgICApIHtcbiAgICAgICAgaWYgKGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlKSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIHVwZGF0ZWQgbW90aW9uIHdpdGggZmxvYXQgcHJvcGVydGllc1xuICAgICAgICAgIGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlID0ge1xuICAgICAgICAgICAgLi4uYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLmJsdWUsXG4gICAgICAgICAgICB0dXJuczogXCJmbFwiLFxuICAgICAgICAgICAgcHJlZmxvYXRNb3Rpb25UeXBlOiBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZS5tb3Rpb25UeXBlLFxuICAgICAgICAgICAgcHJlZmxvYXRSb3RhdGlvbkRpcmVjdGlvbjpcbiAgICAgICAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLmJsdWUucm90YXRpb25EaXJlY3Rpb24sXG4gICAgICAgICAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLkZMT0FULFxuICAgICAgICAgICAgcm90YXRpb25EaXJlY3Rpb246IFJvdGF0aW9uRGlyZWN0aW9uLk5PX1JPVEFUSU9OLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSkge1xuICAgICAgICAgIGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlID0ge1xuICAgICAgICAgICAgLi4uYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLmJsdWUsXG4gICAgICAgICAgICB0dXJuczogMCxcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSkge1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSA9IHtcbiAgICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSxcbiAgICAgICAgICB0dXJuczogdHVybkJsdWUsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIHJlZCB0dXJucyAtIGV4YWN0IGxlZ2FjeSBsb2dpY1xuICAgIGlmICh0dXJuUmVkID09PSBcImZsXCIpIHtcbiAgICAgIGlmIChcbiAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZD8ubW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5QUk8gfHxcbiAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZD8ubW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5BTlRJXG4gICAgICApIHtcbiAgICAgICAgaWYgKGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQpIHtcbiAgICAgICAgICAvLyBDcmVhdGUgdXBkYXRlZCBtb3Rpb24gd2l0aCBmbG9hdCBwcm9wZXJ0aWVzXG4gICAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZCA9IHtcbiAgICAgICAgICAgIC4uLmJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQsXG4gICAgICAgICAgICB0dXJuczogXCJmbFwiLFxuICAgICAgICAgICAgcHJlZmxvYXRNb3Rpb25UeXBlOiBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkLm1vdGlvblR5cGUsXG4gICAgICAgICAgICBwcmVmbG9hdFJvdGF0aW9uRGlyZWN0aW9uOlxuICAgICAgICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkLnJvdGF0aW9uRGlyZWN0aW9uLFxuICAgICAgICAgICAgbW90aW9uVHlwZTogTW90aW9uVHlwZS5GTE9BVCxcbiAgICAgICAgICAgIHJvdGF0aW9uRGlyZWN0aW9uOiBSb3RhdGlvbkRpcmVjdGlvbi5OT19ST1RBVElPTixcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZCkge1xuICAgICAgICAgIGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQgPSB7XG4gICAgICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkLFxuICAgICAgICAgICAgdHVybnM6IDAsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZCkge1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkID0ge1xuICAgICAgICAgIC4uLmJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQsXG4gICAgICAgICAgdHVybnM6IHR1cm5SZWQsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBkYXNoL3N0YXRpYyBwcm9wIHJvdGF0aW9uIGRpcmVjdGlvbnMgLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBwcml2YXRlIHVwZGF0ZURhc2hTdGF0aWNSb3RhdGlvbkRpcmVjdGlvbnMoXG4gICAgYmVhdDogQmVhdERhdGEsXG4gICAgcHJvcENvbnRpbnVpdHk6IHN0cmluZyxcbiAgICBibHVlUm90YXRpb25EaXJlY3Rpb246IHN0cmluZyxcbiAgICByZWRSb3RhdGlvbkRpcmVjdGlvbjogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGlmICghYmVhdC5waWN0b2dyYXBoRGF0YSkgcmV0dXJuO1xuXG4gICAgLy8gVXBkYXRlIGJsdWUgLSBleGFjdCBsZWdhY3kgbG9naWNcbiAgICBpZiAoXG4gICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZT8ubW90aW9uVHlwZSA9PT0gTU9USU9OX1RZUEVTLkRBU0ggfHxcbiAgICAgIGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlPy5tb3Rpb25UeXBlID09PSBNT1RJT05fVFlQRVMuU1RBVElDXG4gICAgKSB7XG4gICAgICBjb25zdCB0dXJucyA9IGJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5ibHVlLnR1cm5zIHx8IDA7XG4gICAgICBpZiAocHJvcENvbnRpbnVpdHkgPT09IFByb3BDb250aW51aXR5LkNPTlRJTlVPVVMpIHtcbiAgICAgICAgY29uc3QgbmV3Um90YXRpb25EaXJlY3Rpb24gPVxuICAgICAgICAgIHR5cGVvZiB0dXJucyA9PT0gXCJudW1iZXJcIiAmJiB0dXJucyA+IDBcbiAgICAgICAgICAgID8gYmx1ZVJvdGF0aW9uRGlyZWN0aW9uXG4gICAgICAgICAgICA6IFJPVEFUSU9OX0RJUlMubm9Sb3RhdGlvbjtcbiAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLmJsdWUgPSB7XG4gICAgICAgICAgLi4uYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLmJsdWUsXG4gICAgICAgICAgcm90YXRpb25EaXJlY3Rpb246IG5ld1JvdGF0aW9uRGlyZWN0aW9uIGFzIFJvdGF0aW9uRGlyZWN0aW9uLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdHVybnMgPT09IFwibnVtYmVyXCIgJiYgdHVybnMgPiAwKSB7XG4gICAgICAgIGNvbnN0IG5ld1JvdGF0aW9uRGlyZWN0aW9uID0gdGhpcy5yYW5kb21DaG9pY2UoW1xuICAgICAgICAgIFJPVEFUSU9OX0RJUlMuQ0xPQ0tXSVNFLFxuICAgICAgICAgIFJPVEFUSU9OX0RJUlMuQ09VTlRFUl9DTE9DS1dJU0UsXG4gICAgICAgIF0pO1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSA9IHtcbiAgICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSxcbiAgICAgICAgICByb3RhdGlvbkRpcmVjdGlvbjogbmV3Um90YXRpb25EaXJlY3Rpb24sXG4gICAgICAgIH07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSA9IHtcbiAgICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMuYmx1ZSxcbiAgICAgICAgICByb3RhdGlvbkRpcmVjdGlvbjogUk9UQVRJT05fRElSUy5ub1JvdGF0aW9uLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFVwZGF0ZSByZWQgLSBleGFjdCBsZWdhY3kgbG9naWNcbiAgICBpZiAoXG4gICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkPy5tb3Rpb25UeXBlID09PSBNT1RJT05fVFlQRVMuREFTSCB8fFxuICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZD8ubW90aW9uVHlwZSA9PT0gTU9USU9OX1RZUEVTLlNUQVRJQ1xuICAgICkge1xuICAgICAgY29uc3QgdHVybnMgPSBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkLnR1cm5zIHx8IDA7XG4gICAgICBpZiAocHJvcENvbnRpbnVpdHkgPT09IFByb3BDb250aW51aXR5LkNPTlRJTlVPVVMpIHtcbiAgICAgICAgY29uc3QgbmV3Um90YXRpb25EaXJlY3Rpb24gPVxuICAgICAgICAgIHR5cGVvZiB0dXJucyA9PT0gXCJudW1iZXJcIiAmJiB0dXJucyA+IDBcbiAgICAgICAgICAgID8gcmVkUm90YXRpb25EaXJlY3Rpb25cbiAgICAgICAgICAgIDogUk9UQVRJT05fRElSUy5ub1JvdGF0aW9uO1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkID0ge1xuICAgICAgICAgIC4uLmJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQsXG4gICAgICAgICAgcm90YXRpb25EaXJlY3Rpb246IG5ld1JvdGF0aW9uRGlyZWN0aW9uIGFzIFJvdGF0aW9uRGlyZWN0aW9uLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdHVybnMgPT09IFwibnVtYmVyXCIgJiYgdHVybnMgPiAwKSB7XG4gICAgICAgIGNvbnN0IG5ld1JvdGF0aW9uRGlyZWN0aW9uID0gdGhpcy5yYW5kb21DaG9pY2UoW1xuICAgICAgICAgIFJPVEFUSU9OX0RJUlMuQ0xPQ0tXSVNFLFxuICAgICAgICAgIFJPVEFUSU9OX0RJUlMuQ09VTlRFUl9DTE9DS1dJU0UsXG4gICAgICAgIF0pO1xuICAgICAgICBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkID0ge1xuICAgICAgICAgIC4uLmJlYXQucGljdG9ncmFwaERhdGEubW90aW9ucy5yZWQsXG4gICAgICAgICAgcm90YXRpb25EaXJlY3Rpb246IG5ld1JvdGF0aW9uRGlyZWN0aW9uLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zLnJlZCA9IHtcbiAgICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMucmVkLFxuICAgICAgICAgIHJvdGF0aW9uRGlyZWN0aW9uOiBST1RBVElPTl9ESVJTLm5vUm90YXRpb24sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJhbmRvbSBjaG9pY2UgaGVscGVyIC0gZXhhY3QgYmVoYXZpb3IgZnJvbSBsZWdhY3kgcmFuZG9tLmNob2ljZSgpXG4gICAqL1xuICBwcml2YXRlIHJhbmRvbUNob2ljZTxUPihhcnJheTogVFtdKTogVCB7XG4gICAgaWYgKGFycmF5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGNob29zZSBmcm9tIGVtcHR5IGFycmF5XCIpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXlbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyYXkubGVuZ3RoKV07XG4gIH1cblxuICAvKipcbiAgICogTWFwIGRpZmZpY3VsdHkgdG8gbGV2ZWwgLSBsZWdhY3kgbWFwcGluZ1xuICAgKi9cbiAgcHJpdmF0ZSBtYXBEaWZmaWN1bHR5VG9MZXZlbChkaWZmaWN1bHR5OiBEaWZmaWN1bHR5TGV2ZWwpOiBudW1iZXIge1xuICAgIHN3aXRjaCAoZGlmZmljdWx0eSkge1xuICAgICAgY2FzZSBEaWZmaWN1bHR5TGV2ZWwuQkVHSU5ORVI6XG4gICAgICAgIHJldHVybiAxO1xuICAgICAgY2FzZSBEaWZmaWN1bHR5TGV2ZWwuSU5URVJNRURJQVRFOlxuICAgICAgICByZXR1cm4gMjtcbiAgICAgIGNhc2UgRGlmZmljdWx0eUxldmVsLkFEVkFOQ0VEOlxuICAgICAgICByZXR1cm4gMztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAyO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBzZXF1ZW5jZSBuYW1lIGJhc2VkIG9uIG9wdGlvbnMgLSBtYXRjaGVzIGxlZ2FjeSBwYXR0ZXJuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlU2VxdWVuY2VOYW1lKG9wdGlvbnM6IEdlbmVyYXRpb25PcHRpb25zKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIiwge1xuICAgICAgbW9udGg6IFwic2hvcnRcIixcbiAgICAgIGRheTogXCJudW1lcmljXCIsXG4gICAgICBob3VyOiBcIm51bWVyaWNcIixcbiAgICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBkaWZmaWN1bHR5ID1cbiAgICAgIG9wdGlvbnMuZGlmZmljdWx0eS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIG9wdGlvbnMuZGlmZmljdWx0eS5zbGljZSgxKTtcbiAgICByZXR1cm4gYCR7ZGlmZmljdWx0eX0gJHtvcHRpb25zLmxlbmd0aH0tQmVhdCAoJHt0aW1lc3RhbXB9KWA7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY2lyY3VsYXIgc2VxdWVuY2UgLSBub3QgaW1wbGVtZW50ZWQgaW4gUGhhc2UgMVxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVQYXR0ZXJuU2VxdWVuY2UoXG4gICAgcGF0dGVybjogR2VuZXJhdGlvbk1vZGUsXG4gICAgX29wdGlvbnM6IEdlbmVyYXRpb25PcHRpb25zXG4gICk6IFByb21pc2U8U2VxdWVuY2VEYXRhPiB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke3BhdHRlcm59IGdlbmVyYXRpb24gbm90IGltcGxlbWVudGVkIHlldGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBnZW5lcmF0aW9uIHN0YXRpc3RpY3MgLSBub3QgaW1wbGVtZW50ZWQgaW4gUGhhc2UgMVxuICAgKi9cbiAgZ2V0R2VuZXJhdGlvblN0YXRzKCk6IHtcbiAgICB0b3RhbEdlbmVyYXRlZDogbnVtYmVyO1xuICAgIGF2ZXJhZ2VHZW5lcmF0aW9uVGltZTogbnVtYmVyO1xuICAgIGxhc3RHZW5lcmF0ZWQ6IHN0cmluZyB8IG51bGw7XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbEdlbmVyYXRlZDogMCxcbiAgICAgIGF2ZXJhZ2VHZW5lcmF0aW9uVGltZTogMCxcbiAgICAgIGxhc3RHZW5lcmF0ZWQ6IG51bGwsXG4gICAgfTtcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIkFBUUEsU0FBUywwQkFBMEI7QUFDbkMsU0FBUyxnQkFBZ0I7QUFTekIsU0FBUyx3QkFBd0I7QUFDakM7QUFBQSxFQUNFO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsT0FDSztBQUdQLE1BQU0sZ0JBQWdCO0FBQUEsRUFDcEIsV0FBVyxrQkFBa0I7QUFBQSxFQUM3QixtQkFBbUIsa0JBQWtCO0FBQUEsRUFDckMsWUFBWSxrQkFBa0I7QUFDaEM7QUFFQSxNQUFNLGVBQWU7QUFBQSxFQUNuQixLQUFLLFdBQVc7QUFBQSxFQUNoQixNQUFNLFdBQVc7QUFBQSxFQUNqQixPQUFPLFdBQVc7QUFBQSxFQUNsQixNQUFNLFdBQVc7QUFBQSxFQUNqQixRQUFRLFdBQVc7QUFDckI7QUFFTyxhQUFNLDBCQUFnRTtBQUFBLEVBQzNFLFlBQ1Usb0JBQ0EsK0JBQ1I7QUFGUTtBQUNBO0FBQUEsRUFDUDtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS0gsTUFBTSxpQkFBaUIsU0FBbUQ7QUFDeEUsUUFBSTtBQUNGLGNBQVEsSUFBSSxpREFBaUQsT0FBTztBQUtwRSxZQUFNLFdBQXVCLENBQUM7QUFHOUIsVUFBSTtBQUNKLFVBQUk7QUFFSixVQUFJLFFBQVEsbUJBQW1CLGVBQWUsWUFBWTtBQUN4RCxnQ0FBd0IsS0FBSyxhQUFhO0FBQUEsVUFDeEMsY0FBYztBQUFBLFVBQ2QsY0FBYztBQUFBLFFBQ2hCLENBQUM7QUFDRCwrQkFBdUIs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
