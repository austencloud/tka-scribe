import { GridMode } from "/src/lib/domain/enums.ts";
export class SequenceIndexService {
  sequenceIndex = null;
  searchIndex = null;
  sequenceMap = /* @__PURE__ */ new Map();
  async loadSequenceIndex() {
    if (this.sequenceIndex !== null) {
      return this.sequenceIndex;
    }
    try {
      if (this.sequenceIndex === null) {
        this.sequenceIndex = await this.scanSequenceDirectory();
      }
      if (this.sequenceIndex) {
        await this.buildSearchIndex(this.sequenceIndex);
      }
      return this.sequenceIndex || [];
    } catch (error) {
      console.error("Failed to load sequence index:", error);
      this.sequenceIndex = [];
      return [];
    }
  }
  async buildSearchIndex(sequences) {
    this.searchIndex = {
      wordIndex: /* @__PURE__ */ new Map(),
      authorIndex: /* @__PURE__ */ new Map(),
      tagIndex: /* @__PURE__ */ new Map(),
      metadataIndex: /* @__PURE__ */ new Map()
    };
    this.sequenceMap.clear();
    for (const sequence of sequences) {
      this.sequenceMap.set(sequence.id, sequence);
      this.addToIndex(
        this.searchIndex.wordIndex,
        sequence.word.toLowerCase(),
        sequence.id
      );
      this.addToIndex(
        this.searchIndex.wordIndex,
        sequence.name.toLowerCase(),
        sequence.id
      );
      if (sequence.author) {
        this.addToIndex(
          this.searchIndex.authorIndex,
          sequence.author.toLowerCase(),
          sequence.id
        );
      }
      for (const tag of sequence.tags) {
        this.addToIndex(
          this.searchIndex.tagIndex,
          tag.toLowerCase(),
          sequence.id
        );
      }
      const searchableText = this.buildSearchableText(sequence);
      for (const term of searchableText.split(/\s+/)) {
        if (term.length > 2) {
          this.addToIndex(
            this.searchIndex.metadataIndex,
            term.toLowerCase(),
            sequence.id
          );
        }
      }
    }
  }
  async searchSequences(query) {
    if (!this.searchIndex || !query.trim()) {
      return this.sequenceIndex || [];
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter((term) => term.length > 0);
    const resultIds = /* @__PURE__ */ new Set();
    for (const term of searchTerms) {
      const matchingIds = this.searchTerm(term);
      if (resultIds.size === 0) {
        matchingIds.forEach((id) => resultIds.add(id));
      } else {
        const currentIds = new Set(resultIds);
        resultIds.clear();
        matchingIds.forEach((id) => {
          if (currentIds.has(id)) {
            resultIds.add(id);
          }
        });
      }
    }
    const results = Array.from(resultIds).map((id) => this.sequenceMap.get(id)).filter((seq) => seq !== void 0);
    return this.sortByRelevance(results, query);
  }
  async refreshIndex() {
    this.sequenceIndex = null;
    this.searchIndex = null;
    this.sequenceMap.clear();
    await this.loadSequenceIndex();
  }
  // Additional utility methods
  getIndexStats() {
    return {
      totalSequences: this.sequenceMap.size,
      indexedWords: this.searchIndex?.wordIndex.size || 0,
      indexedAuthors: this.searchIndex?.authorIndex.size || 0,
      indexedTags: this.searchIndex?.tagIndex.size || 0,
      indexedMetadata: this.searchIndex?.metadataIndex.size || 0
    };
  }
  async getSequenceById(id) {
    if (!this.sequenceMap.has(id)) {
      await this.loadSequenceIndex();
    }
    return this.sequenceMap.get(id) || null;
  }
  async getSuggestions(partialQuery, maxSuggestions = 10) {
    if (!this.searchIndex || partialQuery.length < 2) {
      return [];
    }
    const suggestions = /* @__PURE__ */ new Set();
    const query = partialQuery.toLowerCase();
    for (const [word] of this.searchIndex.wordIndex) {
      if (word.includes(query)) {
        suggestions.add(word);
        if (suggestions.size >= maxSuggestions) break;
      }
    }
    if (suggestions.size < maxSuggestions) {
      for (const [author] of this.searchIndex.authorIndex) {
        if (author.includes(query)) {
          suggestions.add(author);
          if (suggestions.size >= maxSuggestions) break;
        }
      }
    }
    return Array.from(suggestions).slice(0, maxSuggestions);
  }
  // Private helper methods
  addToIndex(index, key, sequenceId) {
    if (!index.has(key)) {
      index.set(key, /* @__PURE__ */ new Set());
    }
    const keySet = index.get(key);
    if (keySet) {
      keySet.add(sequenceId);
    }
  }
  searchTerm(term) {
    const results = /* @__PURE__ */ new Set();
    if (!this.searchIndex) return results;
    const wordMatches = this.searchIndex.wordIndex.get(term) || /* @__PURE__ */ new Set();
    wordMatches.forEach((id) => results.add(id));
    for (const [word, ids] of this.searchIndex.wordIndex) {
      if (word.includes(term)) {
        ids.forEach((id) => results.add(id));
      }
    }
    const authorMatches = this.searchIndex.authorIndex.get(term) || /* @__PURE__ */ new Set();
    authorMatches.forEach((id) => results.add(id));
    const tagMatches = this.searchIndex.tagIndex.get(term) || /* @__PURE__ */ new Set();
    tagMatches.forEach((id) => results.add(id));
    const metadataMatches = this.searchIndex.metadataIndex.get(term) || /* @__PURE__ */ new Set();
    metadataMatches.forEach((id) => results.add(id));
    return results;
  }
  buildSearchableText(sequence) {
    const parts = [
      sequence.word,
      sequence.name,
      sequence.author || "",
      sequence.difficultyLevel || "",
      sequence.gridMode || "",
      sequence.propType || "",
      ...sequence.tags
    ];
    return parts.filter(Boolean).join(" ");
  }
  sortByRelevance(sequences, query) {
    const queryLower = query.toLowerCase();
    return sequences.sort((a, b) => {
      const scoreA = this.calculateRelevanceScore(a, queryLower);
      const scoreB = this.calculateRelevanceScore(b, queryLower);
      return scoreB - scoreA;
    });
  }
  calculateRelevanceScore(sequence, query) {
    let score = 0;
    if (sequence.word.toLowerCase() === query) {
      score += 100;
    }
    if (sequence.word.toLowerCase().startsWith(query)) {
      score += 50;
    }
    if (sequence.word.toLowerCase().includes(query)) {
      score += 25;
    }
    if (sequence.name.toLowerCase().includes(query)) {
      score += 15;
    }
    if (sequence.author?.toLowerCase().includes(query)) {
      score += 10;
    }
    for (const tag of sequence.tags) {
      if (tag.toLowerCase().includes(query)) {
        score += 5;
      }
    }
    if (sequence.isFavorite) {
      score += 2;
    }
    return score;
  }
  async scanSequenceDirectory() {
    console.warn("Scanning directory - using fallback sample data");
    const sequences = [];
    const knownSequences = [
      "A",
      "AABB",
      "AAKE",
      "AB",
      "ABC",
      "AJEΦ-",
      "AKE",
      "AKIΦ",
      "ALFALGGF",
      "B",
      "BA",
      "BBKE",
      "BBLF",
      "BC",
      "BJEA",
      "BJFA",
      "BKEΦ-",
      "C",
      "CAKE",
      "CCCΦ-",
      "CCKE",
      "CCKΦ"
      // Add more as needed...
    ];
    for (let i = 0; i < knownSequences.length; i++) {
      const word = knownSequences[i];
      if (!word) continue;
      const authors = ["TKA User", "Demo Author", "Expert User"];
      const gridModes = [GridMode.DIAMOND, GridMode.BOX];
      const difficulties = ["beginner", "intermediate", "advanced"];
      const author = authors[i % authors.length];
      const gridMode = gridModes[i % gridModes.length];
      const difficulty = difficulties[i % difficulties.length];
      const result = {
        id: word,
        // ✅ FIXED: Keep uppercase to match PNG file names
        name: `${word} Sequence`,
        word,
        thumbnails: [`${word}_ver1.png`],
        isFavorite: Math.random() > 0.8,
        isCircular: false,
        tags: ["flow", "practice", "generated"].slice(
          0,
          Math.floor(Math.random() * 3) + 1
        ),
        metadata: { scanned: true, index: i }
      };
      if (author) result.author = author;
      if (gridMode) result.gridMode = gridMode;
      if (difficulty) result.difficultyLevel = difficulty;
      result.sequenceLength = Math.floor(Math.random() * 8) + 3;
      result.level = Math.floor(Math.random() * 4) + 1;
      result.dateAdded = new Date(
        Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1e3
      );
      result.propType = "fans";
      result.startingPosition = "center";
      sequences.push(result);
    }
    return sequences;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9zZXF1ZW5jZS9TZXF1ZW5jZUluZGV4U2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBTZXF1ZW5jZSBJbmRleCBTZXJ2aWNlIEltcGxlbWVudGF0aW9uXG4gKlxuICogSGFuZGxlcyBsb2FkaW5nLCBidWlsZGluZywgYW5kIHNlYXJjaGluZyBzZXF1ZW5jZSBpbmRpY2VzIGZvciBmYXN0IGJyb3dzZSBvcGVyYXRpb25zLlxuICogUHJvdmlkZXMgc2VhcmNoIGNhcGFiaWxpdGllcyBhY3Jvc3Mgc2VxdWVuY2UgbWV0YWRhdGEuXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhIH0gZnJvbSBcIiRsaWIvc2VydmljZXMvaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgSVNlcXVlbmNlSW5kZXhTZXJ2aWNlIH0gZnJvbSBcIiRsaWIvc2VydmljZXMvaW50ZXJmYWNlcy9icm93c2UtaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgR3JpZE1vZGUgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcblxuaW50ZXJmYWNlIFNlYXJjaEluZGV4IHtcbiAgd29yZEluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIHdvcmQgLT4gc2VxdWVuY2UgSURzXG4gIGF1dGhvckluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIGF1dGhvciAtPiBzZXF1ZW5jZSBJRHNcbiAgdGFnSW5kZXg6IE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+PjsgLy8gdGFnIC0+IHNlcXVlbmNlIElEc1xuICBtZXRhZGF0YUluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIGNvbWJpbmVkIG1ldGFkYXRhIC0+IHNlcXVlbmNlIElEc1xufVxuXG5leHBvcnQgY2xhc3MgU2VxdWVuY2VJbmRleFNlcnZpY2UgaW1wbGVtZW50cyBJU2VxdWVuY2VJbmRleFNlcnZpY2Uge1xuICBwcml2YXRlIHNlcXVlbmNlSW5kZXg6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNlYXJjaEluZGV4OiBTZWFyY2hJbmRleCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNlcXVlbmNlTWFwID0gbmV3IE1hcDxzdHJpbmcsIEJyb3dzZVNlcXVlbmNlTWV0YWRhdGE+KCk7XG5cbiAgYXN5bmMgbG9hZFNlcXVlbmNlSW5kZXgoKTogUHJvbWlzZTxCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10+IHtcbiAgICBpZiAodGhpcy5zZXF1ZW5jZUluZGV4ICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXF1ZW5jZUluZGV4O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBMb2FkIHNlcXVlbmNlcyBpZiBub3QgYWxyZWFkeSBsb2FkZWRcbiAgICAgIGlmICh0aGlzLnNlcXVlbmNlSW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gYXdhaXQgdGhpcy5zY2FuU2VxdWVuY2VEaXJlY3RvcnkoKTtcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgc2VhcmNoIGluZGV4XG4gICAgICBpZiAodGhpcy5zZXF1ZW5jZUluZGV4KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYnVpbGRTZWFyY2hJbmRleCh0aGlzLnNlcXVlbmNlSW5kZXgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5zZXF1ZW5jZUluZGV4IHx8IFtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc2VxdWVuY2UgaW5kZXg6XCIsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBlbXB0eSBhcnJheSBhcyBmYWxsYmFja1xuICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gW107XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYnVpbGRTZWFyY2hJbmRleChzZXF1ZW5jZXM6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuc2VhcmNoSW5kZXggPSB7XG4gICAgICB3b3JkSW5kZXg6IG5ldyBNYXAoKSxcbiAgICAgIGF1dGhvckluZGV4OiBuZXcgTWFwKCksXG4gICAgICB0YWdJbmRleDogbmV3IE1hcCgpLFxuICAgICAgbWV0YWRhdGFJbmRleDogbmV3IE1hcCgpLFxuICAgIH07XG5cbiAgICB0aGlzLnNlcXVlbmNlTWFwLmNsZWFyKCk7XG5cbiAgICBmb3IgKGNvbnN0IHNlcXVlbmNlIG9mIHNlcXVlbmNlcykge1xuICAgICAgdGhpcy5zZXF1ZW5jZU1hcC5zZXQoc2VxdWVuY2UuaWQsIHNlcXVlbmNlKTtcblxuICAgICAgLy8gSW5kZXggYnkgd29yZC9uYW1lXG4gICAgICB0aGlzLmFkZFRvSW5kZXgoXG4gICAgICAgIHRoaXMuc2VhcmNoSW5kZXgud29yZEluZGV4LFxuICAgICAgICBzZXF1ZW5jZS53b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgIHNlcXVlbmNlLmlkXG4gICAgICApO1xuICAgICAgdGhpcy5hZGRUb0luZGV4KFxuICAgICAgICB0aGlzLnNlYXJjaEluZGV4LndvcmRJbmRleCxcbiAgICAgICAgc2VxdWVuY2UubmFtZS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICBzZXF1ZW5jZS5pZFxuICAgICAgKTtcblxuICAgICAgLy8gSW5kZXggYnkgYXV0aG9yXG4gICAgICBpZiAoc2VxdWVuY2UuYXV0aG9yKSB7XG4gICAgICAgIHRoaXMuYWRkVG9JbmRleChcbiAgICAgICAgICB0aGlzLnNlYXJjaEluZGV4LmF1dGhvckluZGV4LFxuICAgICAgICAgIHNlcXVlbmNlLmF1dGhvci50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgIHNlcXVlbmNlLmlkXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluZGV4IGJ5IHRhZ3NcbiAgICAgIGZvciAoY29uc3QgdGFnIG9mIHNlcXVlbmNlLnRhZ3MpIHtcbiAgICAgICAgdGhpcy5hZGRUb0luZGV4KFxuICAgICAgICAgIHRoaXMuc2VhcmNoSW5kZXgudGFnSW5kZXgsXG4gICAgICAgICAgdGFnLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgc2VxdWVuY2UuaWRcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5kZXggYnkgbWV0YWRhdGEgKGNvbWJpbmVkIHNlYXJjaGFibGUgdGV4dClcbiAgICAgIGNvbnN0IHNlYXJjaGFibGVUZXh0ID0gdGhpcy5idWlsZFNlYXJjaGFibGVUZXh0KHNlcXVlbmNlKTtcbiAgICAgIGZvciAoY29uc3QgdGVybSBvZiBzZWFyY2hhYmxlVGV4dC5zcGxpdCgvXFxzKy8pKSB7XG4gICAgICAgIGlmICh0ZXJtLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgICAvLyBPbmx5IGluZGV4IHRlcm1zIGxvbmdlciB0aGFuIDIgY2hhcmFjdGVyc1xuICAgICAgICAgIHRoaXMuYWRkVG9JbmRleChcbiAgICAgICAgICAgIHRoaXMuc2VhcmNoSW5kZXgubWV0YWRhdGFJbmRleCxcbiAgICAgICAgICAgIHRlcm0udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHNlcXVlbmNlLmlkXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlYXJjaFNlcXVlbmNlcyhxdWVyeTogc3RyaW5nKTogUHJvbWlzZTxCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10+IHtcbiAgICBpZiAoIXRoaXMuc2VhcmNoSW5kZXggfHwgIXF1ZXJ5LnRyaW0oKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2VxdWVuY2VJbmRleCB8fCBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBzZWFyY2hUZXJtcyA9IHF1ZXJ5XG4gICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgIC5maWx0ZXIoKHRlcm0pID0+IHRlcm0ubGVuZ3RoID4gMCk7XG4gICAgY29uc3QgcmVzdWx0SWRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBmb3IgKGNvbnN0IHRlcm0gb2Ygc2VhcmNoVGVybXMpIHtcbiAgICAgIGNvbnN0IG1hdGNoaW5nSWRzID0gdGhpcy5zZWFyY2hUZXJtKHRlcm0pO1xuXG4gICAgICAvLyBGb3IgbXVsdGlwbGUgdGVybXMsIHVzZSBpbnRlcnNlY3Rpb24gKEFORCBsb2dpYylcbiAgICAgIGlmIChyZXN1bHRJZHMuc2l6ZSA9PT0gMCkge1xuICAgICAgICBtYXRjaGluZ0lkcy5mb3JFYWNoKChpZCkgPT4gcmVzdWx0SWRzLmFkZChpZCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY3VycmVudElkcyA9IG5ldyBTZXQocmVzdWx0SWRzKTtcbiAgICAgICAgcmVzdWx0SWRzLmNsZWFyKCk7XG4gICAgICAgIG1hdGNoaW5nSWRzLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRJZHMuaGFzKGlkKSkge1xuICAgICAgICAgICAgcmVzdWx0SWRzLmFkZChpZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0IElEcyBiYWNrIHRvIHNlcXVlbmNlcyBhbmQgc29ydCBieSByZWxldmFuY2VcbiAgICBjb25zdCByZXN1bHRzID0gQXJyYXkuZnJvbShyZXN1bHRJZHMpXG4gICAgICAubWFwKChpZCkgPT4gdGhpcy5zZXF1ZW5jZU1hcC5nZXQoaWQpKVxuICAgICAgLmZpbHRlcigoc2VxKTogc2VxIGlzIEJyb3dzZVNlcXVlbmNlTWV0YWRhdGEgPT4gc2VxICE9PSB1bmRlZmluZWQpO1xuXG4gICAgcmV0dXJuIHRoaXMuc29ydEJ5UmVsZXZhbmNlKHJlc3VsdHMsIHF1ZXJ5KTtcbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hJbmRleCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnNlcXVlbmNlSW5kZXggPSBudWxsO1xuICAgIHRoaXMuc2VhcmNoSW5kZXggPSBudWxsO1xuICAgIHRoaXMuc2VxdWVuY2VNYXAuY2xlYXIoKTtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXF1ZW5jZUluZGV4KCk7XG4gIH1cblxuICAvLyBBZGRpdGlvbmFsIHV0aWxpdHkgbWV0aG9kc1xuICBnZXRJbmRleFN0YXRzKCk6IHtcbiAgICB0b3RhbFNlcXVlbmNlczogbnVtYmVyO1xuICAgIGluZGV4ZWRXb3JkczogbnVtYmVyO1xuICAgIGluZGV4ZWRBdXRob3JzOiBudW1iZXI7XG4gICAgaW5kZXhlZFRhZ3M6IG51bWJlcjtcbiAgICBpbmRleGVkTWV0YWRhdGE6IG51bWJlcjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsU2VxdWVuY2VzOiB0aGlzLnNlcXVlbmNlTWFwLnNpemUsXG4gICAgICBpbmRleGVkV29yZHM6IHRoaXMuc2VhcmNoSW5kZXg/LndvcmRJbmRleC5zaXplIHx8IDAsXG4gICAgICBpbmRleGVkQXV0aG9yczogdGhpcy5zZWFyY2hJbmRleD8uYXV0aG9ySW5kZXguc2l6ZSB8fCAwLFxuICAgICAgaW5kZXhlZFRhZ3M6IHRoaXMuc2VhcmNoSW5kZXg/LnRhZ0luZGV4LnNpemUgfHwgMCxcbiAgICAgIGluZGV4ZWRNZXRhZGF0YTogdGhpcy5zZWFyY2hJbmRleD8ubWV0YWRhdGFJbmRleC5zaXplIHx8IDAsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldFNlcXVlbmNlQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxCcm93c2VTZXF1ZW5jZU1ldGFkYXRhIHwgbnVsbD4ge1xuICAgIGlmICghdGhpcy5zZXF1ZW5jZU1hcC5oYXMoaWQpKSB7XG4gICAgICBhd2FpdCB0aGlzLmxvYWRTZXF1ZW5jZUluZGV4KCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnNlcXVlbmNlTWFwLmdldChpZCkgfHwgbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGdldFN1Z2dlc3Rpb25zKFxuICAgIHBhcnRpYWxRdWVyeTogc3RyaW5nLFxuICAgIG1heFN1Z2dlc3Rpb25zID0gMTBcbiAgKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGlmICghdGhpcy5zZWFyY2hJbmRleCB8fCBwYXJ0aWFsUXVlcnkubGVuZ3RoIDwgMikge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IHN1Z2dlc3Rpb25zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgY29uc3QgcXVlcnkgPSBwYXJ0aWFsUXVlcnkudG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIFNlYXJjaCBpbiB3b3Jkcy9uYW1lc1xuICAgIGZvciAoY29uc3QgW3dvcmRdIG9mIHRoaXMuc2VhcmNoSW5kZXgud29yZEluZGV4KSB7XG4gICAgICBpZiAod29yZC5pbmNsdWRlcyhxdWVyeSkpIHtcbiAgICAgICAgc3VnZ2VzdGlvbnMuYWRkKHdvcmQpO1xuICAgICAgICBpZiAoc3VnZ2VzdGlvbnMuc2l6ZSA+PSBtYXhTdWdnZXN0aW9ucykgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2VhcmNoIGluIGF1dGhvcnMgaWYgbm90IGVub3VnaCBzdWdnZXN0aW9uc1xuICAgIGlmIChzdWdnZXN0aW9ucy5zaXplIDwgbWF4U3VnZ2VzdGlvbnMpIHtcbiAgICAgIGZvciAoY29uc3QgW2F1dGhvcl0gb2YgdGhpcy5zZWFyY2hJbmRleC5hdXRob3JJbmRleCkge1xuICAgICAgICBpZiAoYXV0aG9yLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgICAgIHN1Z2dlc3Rpb25zLmFkZChhdXRob3IpO1xuICAgICAgICAgIGlmIChzdWdnZXN0aW9ucy5zaXplID49IG1heFN1Z2dlc3Rpb25zKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBBcnJheS5mcm9tKHN1Z2dlc3Rpb25zKS5zbGljZSgwLCBtYXhTdWdnZXN0aW9ucyk7XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG4gIHByaXZhdGUgYWRkVG9JbmRleChcbiAgICBpbmRleDogTWFwPHN0cmluZywgU2V0PHN0cmluZz4+LFxuICAgIGtleTogc3RyaW5nLFxuICAgIHNlcXVlbmNlSWQ6IHN0cmluZ1xuICApOiB2b2lkIHtcbiAgICBpZiAoIWluZGV4LmhhcyhrZXkpKSB7XG4gICAgICBpbmRleC5zZXQoa2V5LCBuZXcgU2V0KCkpO1xuICAgIH1cbiAgICBjb25zdCBrZXlTZXQgPSBpbmRleC5nZXQoa2V5KTtcbiAgICBpZiAoa2V5U2V0KSB7XG4gICAgICBrZXlTZXQuYWRkKHNlcXVlbmNlSWQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2VhcmNoVGVybSh0ZXJtOiBzdHJpbmcpOiBTZXQ8c3RyaW5nPiB7XG4gICAgY29uc3QgcmVzdWx0cyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgaWYgKCF0aGlzLnNlYXJjaEluZGV4KSByZXR1cm4gcmVzdWx0cztcblxuICAgIC8vIEV4YWN0IG1hdGNoZXMgaW4gd29yZHNcbiAgICBjb25zdCB3b3JkTWF0Y2hlcyA9IHRoaXMuc2VhcmNoSW5kZXgud29yZEluZGV4LmdldCh0ZXJtKSB8fCBuZXcgU2V0KCk7XG4gICAgd29yZE1hdGNoZXMuZm9yRWFjaCgoaWQpID0+IHJlc3VsdHMuYWRkKGlkKSk7XG5cbiAgICAvLyBQYXJ0aWFsIG1hdGNoZXMgaW4gd29yZHNcbiAgICBmb3IgKGNvbnN0IFt3b3JkLCBpZHNdIG9mIHRoaXMuc2VhcmNoSW5kZXgud29yZEluZGV4KSB7XG4gICAgICBpZiAod29yZC5pbmNsdWRlcyh0ZXJtKSkge1xuICAgICAgICBpZHMuZm9yRWFjaCgoaWQpID0+IHJlc3VsdHMuYWRkKGlkKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQXV0aG9yIG1hdGNoZXNcbiAgICBjb25zdCBhdXRob3JNYXRjaGVzID0gdGhpcy5zZWFyY2hJbmRleC5hdXRob3JJbmRleC5nZXQodGVybSkgfHwgbmV3IFNldCgpO1xuICAgIGF1dGhvck1hdGNoZXMuZm9yRWFjaCgoaWQpID0+IHJlc3VsdHMuYWRkKGlkKSk7XG5cbiAgICAvLyBUYWcgbWF0Y2hlc1xuICAgIGNvbnN0IHRhZ01hdGNoZXMgPSB0aGlzLnNlYXJjaEluZGV4LnRhZ0luZGV4LmdldCh0ZXJtKSB8fCBuZXcgU2V0KCk7XG4gICAgdGFnTWF0Y2hlcy5mb3JFYWNoKChpZCkgPT4gcmVzdWx0cy5hZGQoaWQpKTtcblxuICAgIC8vIE1ldGFkYXRhIG1hdGNoZXNcbiAgICBjb25zdCBtZXRhZGF0YU1hdGNoZXMgPVxuICAgICAgdGhpcy5zZWFyY2hJbmRleC5tZXRhZGF0YUluZGV4LmdldCh0ZXJtKSB8fCBuZXcgU2V0KCk7XG4gICAgbWV0YWRhdGFNYXRjaGVzLmZvckVhY2goKGlkKSA9PiByZXN1bHRzLmFkZChpZCkpO1xuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICBwcml2YXRlIGJ1aWxkU2VhcmNoYWJsZVRleHQoc2VxdWVuY2U6IEJyb3dzZVNlcXVlbmNlTWV0YWRhdGEpOiBzdHJpbmcge1xuICAgIGNvbnN0IHBhcnRzID0gW1xuICAgICAgc2VxdWVuY2Uud29yZCxcbiAgICAgIHNlcXVlbmNlLm5hbWUsXG4gICAgICBzZXF1ZW5jZS5hdXRob3IgfHwgXCJcIixcbiAgICAgIHNlcXVlbmNlLmRpZmZpY3VsdHlMZXZlbCB8fCBcIlwiLFxuICAgICAgc2VxdWVuY2UuZ3JpZE1vZGUgfHwgXCJcIixcbiAgICAgIHNlcXVlbmNlLnByb3BUeXBlIHx8IFwiXCIsXG4gICAgICAuLi5zZXF1ZW5jZS50YWdzLFxuICAgIF07XG5cbiAgICByZXR1cm4gcGFydHMuZmlsdGVyKEJvb2xlYW4pLmpvaW4oXCIgXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBzb3J0QnlSZWxldmFuY2UoXG4gICAgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10sXG4gICAgcXVlcnk6IHN0cmluZ1xuICApOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10ge1xuICAgIGNvbnN0IHF1ZXJ5TG93ZXIgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgcmV0dXJuIHNlcXVlbmNlcy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBzY29yZUEgPSB0aGlzLmNhbGN1bGF0ZVJlbGV2YW5jZVNjb3JlKGEsIHF1ZXJ5TG93ZXIpO1xuICAgICAgY29uc3Qgc2NvcmVCID0gdGhpcy5jYWxjdWxhdGVSZWxldmFuY2VTY29yZShiLCBxdWVyeUxvd2VyKTtcbiAgICAgIHJldHVybiBzY29yZUIgLSBzY29yZUE7IC8vIEhpZ2hlciBzY29yZSBmaXJzdFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSZWxldmFuY2VTY29yZShcbiAgICBzZXF1ZW5jZTogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YSxcbiAgICBxdWVyeTogc3RyaW5nXG4gICk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gMDtcblxuICAgIC8vIEV4YWN0IHdvcmQgbWF0Y2ggZ2V0cyBoaWdoZXN0IHNjb3JlXG4gICAgaWYgKHNlcXVlbmNlLndvcmQudG9Mb3dlckNhc2UoKSA9PT0gcXVlcnkpIHtcbiAgICAgIHNjb3JlICs9IDEwMDtcbiAgICB9XG5cbiAgICAvLyBXb3JkIHN0YXJ0cyB3aXRoIHF1ZXJ5XG4gICAgaWYgKHNlcXVlbmNlLndvcmQudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKHF1ZXJ5KSkge1xuICAgICAgc2NvcmUgKz0gNTA7XG4gICAgfVxuXG4gICAgLy8gV29yZCBjb250YWlucyBxdWVyeVxuICAgIGlmIChzZXF1ZW5jZS53b3JkLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKSB7XG4gICAgICBzY29yZSArPSAyNTtcbiAgICB9XG5cbiAgICAvLyBOYW1lIG1hdGNoZXNcbiAgICBpZiAoc2VxdWVuY2UubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgc2NvcmUgKz0gMTU7XG4gICAgfVxuXG4gICAgLy8gQXV0aG9yIG1hdGNoZXNcbiAgICBpZiAoc2VxdWVuY2UuYXV0aG9yPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgc2NvcmUgKz0gMTA7XG4gICAgfVxuXG4gICAgLy8gVGFnIG1hdGNoZXNcbiAgICBmb3IgKGNvbnN0IHRhZyBvZiBzZXF1ZW5jZS50YWdzKSB7XG4gICAgICBpZiAodGFnLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKSB7XG4gICAgICAgIHNjb3JlICs9IDU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRmF2b3JpdGVzIGdldCBib251cyBwb2ludHNcbiAgICBpZiAoc2VxdWVuY2UuaXNGYXZvcml0ZSkge1xuICAgICAgc2NvcmUgKz0gMjtcbiAgICB9XG5cbiAgICByZXR1cm4gc2NvcmU7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNjYW5TZXF1ZW5jZURpcmVjdG9yeSgpOiBQcm9taXNlPEJyb3dzZVNlcXVlbmNlTWV0YWRhdGFbXT4ge1xuICAgIC8vIFRoaXMgaXMgYSBmYWxsYmFjayBtZXRob2QgdGhhdCB3b3VsZCBzY2FuIHRoZSBzdGF0aWMgZGlyZWN0b3J5XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHJlcXVpcmUgc2VydmVyLXNpZGUgc3VwcG9ydFxuICAgIC8vIEZvciBub3csIHJldHVybiBhIGNvbXByZWhlbnNpdmUgc2V0IG9mIHNhbXBsZSBkYXRhIGJhc2VkIG9uIHRoZSBjb3BpZWQgZmlsZXNcblxuICAgIGNvbnNvbGUud2FybihcIlNjYW5uaW5nIGRpcmVjdG9yeSAtIHVzaW5nIGZhbGxiYWNrIHNhbXBsZSBkYXRhXCIpO1xuXG4gICAgLy8gR2VuZXJhdGUgc2VxdWVuY2VzIGJhc2VkIG9uIGNvbW1vbiBwYXR0ZXJuIGZyb20gdGhlIGNvcGllZCBkaWN0aW9uYXJ5XG4gICAgY29uc3Qgc2VxdWVuY2VzOiBCcm93c2VTZXF1ZW5jZU1ldGFkYXRhW10gPSBbXTtcblxuICAgIC8vIFNhbXBsZSBzZXF1ZW5jZXMgdGhhdCBzaG91bGQgZXhpc3QgYmFzZWQgb24gdGhlIGRpY3Rpb25hcnkgY29weVxuICAgIGNvbnN0IGtub3duU2VxdWVuY2VzID0gW1xuICAgICAgXCJBXCIsXG4gICAgICBcIkFBQkJcIixcbiAgICAgIFwiQUFLRVwiLFxuICAgICAgXCJBQlwiLFxuICAgICAgXCJBQkNcIixcbiAgICAgIFwiQUpFzqYtXCIsXG4gICAgICBcIkFLRVwiLFxuICAgICAgXCJBS0nOplwiLFxuICAgICAgXCJBTEZBTEdHRlwiLFxuICAgICAgXCJCXCIsXG4gICAgICBcIkJBXCIsXG4gICAgICBcIkJCS0VcIixcbiAgICAgIFwiQkJMRlwiLFxuICAgICAgXCJCQ1wiLFxuICAgICAgXCJCSkVBXCIsXG4gICAgICBcIkJKRkFcIixcbiAgICAgIFwiQktFzqYtXCIsXG4gICAgICBcIkNcIixcbiAgICAgIFwiQ0FLRVwiLFxuICAgICAgXCJDQ0POpi1cIixcbiAgICAgIFwiQ0NLRVwiLFxuICAgICAgXCJDQ0vOplwiLFxuICAgICAgLy8gQWRkIG1vcmUgYXMgbmVlZGVkLi4uXG4gICAgXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga25vd25TZXF1ZW5jZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHdvcmQgPSBrbm93blNlcXVlbmNlc1tpXTtcbiAgICAgIGlmICghd29yZCkgY29udGludWU7IC8vIFNraXAgdW5kZWZpbmVkIGVudHJpZXNcblxuICAgICAgY29uc3QgYXV0aG9ycyA9IFtcIlRLQSBVc2VyXCIsIFwiRGVtbyBBdXRob3JcIiwgXCJFeHBlcnQgVXNlclwiXTtcbiAgICAgIGNvbnN0IGdyaWRNb2RlcyA9IFtHcmlkTW9kZS5ESUFNT05ELCBHcmlkTW9kZS5CT1hdO1xuICAgICAgY29uc3QgZGlmZmljdWx0aWVzID0gW1wiYmVnaW5uZXJcIiwgXCJpbnRlcm1lZGlhdGVcIiwgXCJhZHZhbmNlZFwiXTtcblxuICAgICAgY29uc3QgYXV0aG9yID0gYXV0aG9yc1tpICUgYXV0aG9ycy5sZW5ndGhdO1xuICAgICAgY29uc3QgZ3JpZE1vZGUgPSBncmlkTW9kZXNbaSAlIGdyaWRNb2Rlcy5sZW5ndGhdO1xuICAgICAgY29uc3QgZGlmZmljdWx0eSA9IGRpZmZpY3VsdGllc1tpICUgZGlmZmljdWx0aWVzLmxlbmd0aF07XG5cbiAgICAgIGNvbnN0IHJlc3VsdDogQnJvd3NlU2VxdWVuY2VNZXRhZGF0YSA9IHtcbiAgICAgICAgaWQ6IHdvcmQsIC8vIOKchSBGSVhFRDogS2VlcCB1cHBlcmNhc2UgdG8gbWF0Y2ggUE5HIGZpbGUgbmFtZXNcbiAgICAgICAgbmFtZTogYCR7d29yZH0gU2VxdWVuY2VgLFxuICAgICAgICB3b3JkLFxuICAgICAgICB0aHVtYm5haWxzOiBbYCR7d29yZH1fdmVyMS5wbmdgXSxcbiAgICAgICAgaXNGYXZvcml0ZTogTWF0aC5yYW5kb20oKSA+IDAuOCxcbiAgICAgICAgaXNDaXJjdWxhcjogZmFsc2UsXG4gICAgICAgIHRhZ3M6IFtcImZsb3dcIiwgXCJwcmFjdGljZVwiLCBcImdlbmVyYXRlZFwiXS5zbGljZShcbiAgICAgICAgICAwLFxuICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDMpICsgMVxuICAgICAgICApLFxuICAgICAgICBtZXRhZGF0YTogeyBzY2FubmVkOiB0cnVlLCBpbmRleDogaSB9LFxuICAgICAgfTtcblxuICAgICAgLy8gQWRkIG9wdGlvbmFsIHByb3BlcnRpZXMgY29uZGl0aW9uYWxseVxuICAgICAgaWYgKGF1dGhvcikgcmVzdWx0LmF1dGhvciA9IGF1dGhvcjtcbiAgICAgIGlmIChncmlkTW9kZSkgcmVzdWx0LmdyaWRNb2RlID0gZ3JpZE1vZGU7XG4gICAgICBpZiAoZGlmZmljdWx0eSkgcmVzdWx0LmRpZmZpY3VsdHlMZXZlbCA9IGRpZmZpY3VsdHk7XG5cbiAgICAgIHJlc3VsdC5zZXF1ZW5jZUxlbmd0aCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDgpICsgMztcbiAgICAgIHJlc3VsdC5sZXZlbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQpICsgMTtcbiAgICAgIHJlc3VsdC5kYXRlQWRkZWQgPSBuZXcgRGF0ZShcbiAgICAgICAgRGF0ZS5ub3coKSAtIE1hdGgucmFuZG9tKCkgKiAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwXG4gICAgICApO1xuICAgICAgcmVzdWx0LnByb3BUeXBlID0gXCJmYW5zXCI7XG4gICAgICByZXN1bHQuc3RhcnRpbmdQb3NpdGlvbiA9IFwiY2VudGVyXCI7XG5cbiAgICAgIHNlcXVlbmNlcy5wdXNoKHJlc3VsdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlcXVlbmNlcztcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIkFBU0EsU0FBUyxnQkFBZ0I7QUFTbEIsYUFBTSxxQkFBc0Q7QUFBQSxFQUN6RCxnQkFBaUQ7QUFBQSxFQUNqRCxjQUFrQztBQUFBLEVBQ2xDLGNBQWMsb0JBQUksSUFBb0M7QUFBQSxFQUU5RCxNQUFNLG9CQUF1RDtBQUMzRCxRQUFJLEtBQUssa0JBQWtCLE1BQU07QUFDL0IsYUFBTyxLQUFLO0FBQUEsSUFDZDtBQUVBLFFBQUk7QUFFRixVQUFJLEtBQUssa0JBQWtCLE1BQU07QUFDL0IsYUFBSyxnQkFBZ0IsTUFBTSxLQUFLLHNCQUFzQjtBQUFBLE1BQ3hEO0FBR0EsVUFBSSxLQUFLLGVBQWU7QUFDdEIsY0FBTSxLQUFLLGlCQUFpQixLQUFLLGFBQWE7QUFBQSxNQUNoRDtBQUVBLGFBQU8sS0FBSyxpQkFBaUIsQ0FBQztBQUFBLElBQ2hDLFNBQVMsT0FBTztBQUNkLGNBQVEsTUFBTSxrQ0FBa0MsS0FBSztBQUVyRCxXQUFLLGdCQUFnQixDQUFDO0FBQ3RCLGFBQU8sQ0FBQztBQUFBLElBQ1Y7QUFBQSxFQUNGO0FBQUEsRUFFQSxNQUFNLGlCQUFpQixXQUFvRDtBQUN6RSxTQUFLLGNBQWM7QUFBQSxNQUNqQixXQUFXLG9CQUFJLElBQUk7QUFBQSxNQUNuQixhQUFhLG9CQUFJLElBQUk7QUFBQSxNQUNyQixVQUFVLG9CQUFJLElBQUk7QUFBQSxNQUNsQixlQUFlLG9CQUFJLElBQUk7QUFBQSxJQUN6QjtBQUVB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
