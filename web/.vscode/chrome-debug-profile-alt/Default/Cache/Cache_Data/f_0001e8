import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/lib/components/MainApplication.svelte");import "/node_modules/.vite/deps/svelte_internal_disclose-version.js?v=474c1bba";

MainApplication[$.FILENAME] = 'src/lib/components/MainApplication.svelte';

import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=474c1bba";
import { resolve } from "/src/lib/services/bootstrap.ts?t=1755803164082";
import { getContext, onMount } from "/node_modules/.vite/deps/svelte.js?v=474c1bba";

import {
	getInitializationError,
	getInitializationProgress,
	getIsInitialized,
	getIsInitializing,
	getSettings,
	getShowSettings,
	hideSettingsDialog,
	restoreApplicationState,
	setInitializationError,
	setInitializationProgress,
	setInitializationState,
	showSettingsDialog,
	switchTab,
	updateSettings
} from "/src/lib/state/appState.svelte.ts";

import ErrorScreen from "/src/lib/components/ErrorScreen.svelte";
import LoadingScreen from "/src/lib/components/LoadingScreen.svelte";
import MainInterface from "/src/lib/components/MainInterface.svelte?t=1755803164082";
import SettingsDialog from "/src/lib/components/SettingsDialog.svelte";

var root_1 = $.add_locations($.from_html(`<meta name="description" content="The Kinetic Alphabet is a revolutionary flow arts choreography toolbox for staffs, fans, and other flow arts. Create, learn, and share movement sequences." class="s-1i_X2rlPKuIr"/>`), MainApplication[$.FILENAME], [[133, 2]]);
var root_5 = $.add_locations($.from_html(`<!> <!>`, 1), MainApplication[$.FILENAME], []);
var root = $.add_locations($.from_html(`<div class="tka-app s-1i_X2rlPKuIr" data-testid="tka-application"><!></div>`), MainApplication[$.FILENAME], [[140, 0]]);

function MainApplication($$anchor, $$props) {
	$.check_target(new.target);
	$.push($$props, true, MainApplication);

	const getContainer = getContext("di-container");
	let initService = $.tag($.state(null), 'initService');
	let settingsService = $.tag($.state(null), 'settingsService');
	let sequenceService = $.tag($.state(null), 'sequenceService');
	let deviceService = $.tag($.state(null), 'deviceService');
	let servicesResolved = $.tag($.state(false), 'servicesResolved');
	let isInitialized = $.tag($.derived(getIsInitialized), 'isInitialized');
	let initializationError = $.tag($.derived(getInitializationError), 'initializationError');
	let initializationProgress = $.tag($.derived(getInitializationProgress), 'initializationProgress');

	$.user_effect(() => {
		const container = getContainer?.();

		if (container && !$.get(servicesResolved)) {
			try {
				$.set(initService, resolve("IApplicationInitializationService"), true);
				$.set(settingsService, resolve("ISettingsService"), true);
				$.set(sequenceService, resolve("ISequenceService"), true);
				$.set(deviceService, resolve("IDeviceDetectionService"), true);
				$.set(servicesResolved, true);
			} catch(error) {
				console.error(...$.log_if_contains_state('error', "Failed to resolve services:", error));
				setInitializationError(`Service resolution failed: ${error}`);
			}
		}
	});

	onMount(async () => {
		const container = getContainer?.();

		if (!container) {
			setInitializationError("No DI container available");

			return;
		}

		let attempts = 0;

		while (!$.get(servicesResolved) && attempts < 10) {
			(await $.track_reactivity_loss(new Promise((resolve2) => setTimeout(resolve2, 100))))();
			attempts++;
		}

		if (!$.get(servicesResolved) || !$.get(initService) || !$.get(settingsService) || !$.get(sequenceService) || !$.get(deviceService)) {
			setInitializationError("Failed to resolve required services");

			return;
		}

		try {
			setInitializationState(false, true, null, 0);
			setInitializationProgress(20);
			(await $.track_reactivity_loss($.get(initService).initialize()))();
			setInitializationProgress(40);
			(await $.track_reactivity_loss($.get(settingsService).loadSettings()))();
			updateSettings($.get(settingsService).currentSettings);
			setInitializationProgress(50);
			setInitializationProgress(70);
			setInitializationProgress(85);
			(await $.track_reactivity_loss(restoreApplicationState()))();
			setInitializationProgress(100);
			setInitializationState(true, false, null, 100);
		} catch(error) {
			console.error(...$.log_if_contains_state('error', "\u274C Application initialization failed:", error));
			setInitializationError(error instanceof Error ? error.message : "Unknown initialization error");
		}
	});

	$.user_effect(() => {
		function handleKeydown(event) {
			if ((event.ctrlKey || event.metaKey) && $.strict_equals(event.key, ",")) {
				event.preventDefault();

				if (getShowSettings()) {
					hideSettingsDialog();
				} else {
					showSettingsDialog();
				}
			}

			if (event.ctrlKey || event.metaKey) {
				switch (event.key) {
					case "1":
						event.preventDefault();
						switchTab("construct");
						break;

					case "2":
						event.preventDefault();
						switchTab("browse");
						break;

					case "3":
						event.preventDefault();
						switchTab("sequence_card");
						break;

					case "4":
						event.preventDefault();
						switchTab("write");
						break;

					case "5":
						event.preventDefault();
						switchTab("learn");
						break;

					case "6":
						event.preventDefault();
						switchTab("motion-tester");
						break;

					case "7":
						event.preventDefault();
						switchTab("arrow-debug");
						break;
				}
			}
		}

		document.addEventListener("keydown", handleKeydown);

		return () => document.removeEventListener("keydown", handleKeydown);
	});

	var div = root();

	$.head(($$anchor) => {
		var meta = root_1();

		$.document.title = 'TKA Constructor - The Kinetic Alphabet';
		$.append($$anchor, meta);
	});

	var node = $.child(div);

	{
		var consequent = ($$anchor) => {
			var fragment = $.comment();
			var node_1 = $.first_child(fragment);

			$.add_svelte_meta(
				() => ErrorScreen(node_1, {
					get error() {
						return $.get(initializationError);
					},

					onRetry: () => window.location.reload()
				}),
				'component',
				MainApplication,
				142,
				4,
				{ componentTag: 'ErrorScreen' }
			);

			$.append($$anchor, fragment);
		};

		var alternate_1 = ($$anchor) => {
			var fragment_1 = $.comment();
			var node_2 = $.first_child(fragment_1);

			{
				var consequent_1 = ($$anchor) => {
					var fragment_2 = $.comment();
					var node_3 = $.first_child(fragment_2);

					$.add_svelte_meta(
						() => LoadingScreen(node_3, {
							get progress() {
								return $.get(initializationProgress);
							},

							message: 'Initializing Constructor...'
						}),
						'component',
						MainApplication,
						147,
						4,
						{ componentTag: 'LoadingScreen' }
					);

					$.append($$anchor, fragment_2);
				};

				var alternate = ($$anchor) => {
					var fragment_3 = root_5();
					var node_4 = $.first_child(fragment_3);

					$.add_svelte_meta(() => MainInterface(node_4, {}), 'component', MainApplication, 153, 4, { componentTag: 'MainInterface' });

					var node_5 = $.sibling(node_4, 2);

					{
						var consequent_2 = ($$anchor) => {
							var fragment_4 = $.comment();
							var node_6 = $.first_child(fragment_4);

							$.add_svelte_meta(() => SettingsDialog(node_6, {}), 'component', MainApplication, 157, 6, { componentTag: 'SettingsDialog' });
							$.append($$anchor, fragment_4);
						};

						$.add_svelte_meta(
							() => $.if(node_5, ($$render) => {
								if (getShowSettings()) $$render(consequent_2);
							}),
							'if',
							MainApplication,
							156,
							4
						);
					}

					$.append($$anchor, fragment_3);
				};

				$.add_svelte_meta(
					() => $.if(
						node_2,
						($$render) => {
							if (!$.get(isInitialized)) $$render(consequent_1); else $$render(alternate, false);
						},
						true
					),
					'if',
					MainApplication,
					146,
					2
				);
			}

			$.append($$anchor, fragment_1);
		};

		$.add_svelte_meta(
			() => $.if(node, ($$render) => {
				if ($.get(initializationError)) $$render(consequent); else $$render(alternate_1, false);
			}),
			'if',
			MainApplication,
			141,
			2
		);
	}

	$.reset(div);
	$.append($$anchor, div);

	return $.pop({ ...$.legacy_api() });
}

if (import.meta.hot) {
	MainApplication = $.hmr(MainApplication, () => MainApplication[$.HMR].source);

	import.meta.hot.acceptExports(["default"],(module) => {
		$.cleanup_styles('s-1i_X2rlPKuIr');
		module.default[$.HMR].source = MainApplication[$.HMR].source;
		$.set(MainApplication[$.HMR].source, module.default[$.HMR].original);
	});
}

export default MainApplication;
import "/src/lib/components/MainApplication.svelte?svelte&type=style&lang.css";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7U0FVVyxlQUFZO1NBVW5COzs7Q0FJQTtDQUNBO0NBQ0E7Q0FDQTtDQUFBO0NBSUY7Q0FDQTtDQUNBO0NBQ0E7Q0FHQTtDQUlJO0NBQ0E7Q0FDQTtDQUNBO09BQ0E7O09BS0E7T0FHSSxtQkFBTTtPQUNOLG1CQUFZO09BQ2Qsb0JBQWM7Ozs7Ozs0Q0F2RHRCLENBQUM7Ozs7T0EyRE8sZUFDQSxXQUEwQixjQUFrQjtLQUk5Qyw0QkFBZ0I7S0FDZCxnQ0FBa0Q7S0FDbEQsZ0NBQXVCLElBQThCO0tBQ3ZEO0tBQ0Y7S0FLQSxnQ0FBa0I7S0FDZCxzQ0FBWTtLQUNkLHlDQUF1Qjs7Q0FLekIsb0JBQUk7UUFDSTs7TUFDTixvQkFBa0IsbUJBQWE7T0FDL0I7VUFJQyxxQkFDQSxtQ0FFQTtVQUdELHlCQUF1QjtVQUN2QjtVQUNGO1VBR0Usa0JBQXVCO0dBR3ZCO0lBQ0EsUUFBTSwwQ0FBWSwrQkFBVztJQUc3QixxREFBNEI7R0FDNUI7RUFDQTtDQUdBOztDQVFBLG9CQUFNO1FBR047O09BQ0E7R0FDRix1QkFBZ0I7OztFQUVkOztNQUdGOztnQkFDRDtzQ0FHYSxTQUFBQSxhQUFBLFdBQUFBLFVBQUE7R0FDWjtFQUVFOzthQUdJLDRCQUNGLHVCQUNFLDJCQUNGLDJCQUNGLGdCQUdBO0dBQ0UsdUJBQW1COzs7RUFFZjs7TUFFQTtHQUFBLHVCQUNHO0dBR0g7d0NBQ0YsYUFBSztHQUdIO3dDQUNGLGlCQUFLO0dBQ0gscUJBQU0saUJBQWU7R0FFckIsMEJBQ0c7R0FHSDtHQUlBO2tDQUNGO0dBR0U7R0FDSjtFQUNGO0dBQ0Y7R0FFQSx1QkFDQSxpQkFBc0Isd0JBQW9CO0VBRTVDOzs7Q0FJQSxvQkFBQztXQUNPLGNBQVc7UUFFbEI7SUFDSyxNQUFLOzs7S0FFUjtJQUNBLE9BQVU7S0FDUjtJQUNGO0dBQ0M7O09BR0csTUFBSSxXQUFhO1lBQ3JCO1VBQ1U7TUFDVCxNQUFTO01BQ1Y7OztVQUVTO01BQ1QsTUFBYTs7OztVQUdUO01BQ0Y7TUFDQzs7O1VBRUg7O01BRUM7OztVQUVPO01BQ0osTUFBUztNQUNWLFVBQWE7OztVQUVQO01BQ0YsTUFBRTtNQUNWLFVBQWtCLGVBQU87OztVQUVsQjtNQUNMLE1BQVk7TUFDTixVQUFVLGFBQVk7OztHQUc3QjtFQUNGOztFQUVILFNBQVMsaUJBQWlCLFdBQVcsYUFBWTs7ZUFDaEMsU0FBTztDQUN4Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O21CQWVJOzs7b0JBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztxQkFJVzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7a0JBRkYsYUFBUTs7Ozs7Ozs7Ozs7Ozs7OztjQUxaLG1CQUFrQjs7Ozs7Ozs7Ozs7OztDQVp6QiIsIm5hbWVzIjpbInJlc29sdmUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiTWFpbkFwcGxpY2F0aW9uLnN2ZWx0ZSJdLCJzb3VyY2VzQ29udGVudCI6WyI8IS0tIE1haW4gQXBwbGljYXRpb24gTGF5b3V0IC0tPlxuPHNjcmlwdCBsYW5nPVwidHNcIj5cbiAgaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gXCIkc2VydmljZXMvYm9vdHN0cmFwXCI7XG4gIGltcG9ydCB0eXBlIHsgU2VydmljZUNvbnRhaW5lciB9IGZyb20gXCIkc2VydmljZXMvZGkvU2VydmljZUNvbnRhaW5lclwiO1xuICBpbXBvcnQgdHlwZSB7XG4gICAgSUFwcGxpY2F0aW9uSW5pdGlhbGl6YXRpb25TZXJ2aWNlLFxuICAgIElTZXR0aW5nc1NlcnZpY2UsXG4gIH0gZnJvbSBcIiRzZXJ2aWNlcy9pbnRlcmZhY2VzL2FwcGxpY2F0aW9uLWludGVyZmFjZXNcIjtcbiAgaW1wb3J0IHR5cGUgeyBJU2VxdWVuY2VTZXJ2aWNlIH0gZnJvbSBcIiRzZXJ2aWNlcy9pbnRlcmZhY2VzL3NlcXVlbmNlLWludGVyZmFjZXNcIjtcbiAgaW1wb3J0IHR5cGUgeyBJRGV2aWNlRGV0ZWN0aW9uU2VydmljZSB9IGZyb20gXCIkc2VydmljZXMvaW50ZXJmYWNlcy9kZXZpY2UtaW50ZXJmYWNlc1wiO1xuICBpbXBvcnQgeyBnZXRDb250ZXh0LCBvbk1vdW50IH0gZnJvbSBcInN2ZWx0ZVwiO1xuXG4gIC8vIEltcG9ydCBhcHAgc3RhdGUgbWFuYWdlbWVudFxuICBpbXBvcnQge1xuICAgIGdldEluaXRpYWxpemF0aW9uRXJyb3IsXG4gICAgZ2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcyxcbiAgICBnZXRJc0luaXRpYWxpemVkLFxuICAgIGdldElzSW5pdGlhbGl6aW5nLFxuICAgIGdldFNldHRpbmdzLFxuICAgIGdldFNob3dTZXR0aW5ncyxcbiAgICBoaWRlU2V0dGluZ3NEaWFsb2csXG4gICAgcmVzdG9yZUFwcGxpY2F0aW9uU3RhdGUsXG4gICAgc2V0SW5pdGlhbGl6YXRpb25FcnJvcixcbiAgICBzZXRJbml0aWFsaXphdGlvblByb2dyZXNzLFxuICAgIHNldEluaXRpYWxpemF0aW9uU3RhdGUsXG4gICAgc2hvd1NldHRpbmdzRGlhbG9nLFxuICAgIHN3aXRjaFRhYixcbiAgICB1cGRhdGVTZXR0aW5ncyxcbiAgfSBmcm9tIFwiJGxpYi9zdGF0ZS9hcHBTdGF0ZS5zdmVsdGVcIjtcblxuICAvLyBJbXBvcnQgY29tcG9uZW50c1xuICBpbXBvcnQgRXJyb3JTY3JlZW4gZnJvbSBcIiRjb21wb25lbnRzL0Vycm9yU2NyZWVuLnN2ZWx0ZVwiO1xuICBpbXBvcnQgTG9hZGluZ1NjcmVlbiBmcm9tIFwiJGNvbXBvbmVudHMvTG9hZGluZ1NjcmVlbi5zdmVsdGVcIjtcbiAgaW1wb3J0IE1haW5JbnRlcmZhY2UgZnJvbSBcIiRjb21wb25lbnRzL01haW5JbnRlcmZhY2Uuc3ZlbHRlXCI7XG4gIGltcG9ydCBTZXR0aW5nc0RpYWxvZyBmcm9tIFwiJGNvbXBvbmVudHMvU2V0dGluZ3NEaWFsb2cuc3ZlbHRlXCI7XG5cbiAgLy8gR2V0IERJIGNvbnRhaW5lciBmcm9tIGNvbnRleHRcbiAgY29uc3QgZ2V0Q29udGFpbmVyID1cbiAgICBnZXRDb250ZXh0PCgpID0+IFNlcnZpY2VDb250YWluZXIgfCBudWxsPihcImRpLWNvbnRhaW5lclwiKTtcblxuICAvLyBTZXJ2aWNlcyAtIHJlc29sdmVkIGxhemlseVxuICBsZXQgaW5pdFNlcnZpY2U6IElBcHBsaWNhdGlvbkluaXRpYWxpemF0aW9uU2VydmljZSB8IG51bGwgPSAkc3RhdGUobnVsbCk7XG4gIGxldCBzZXR0aW5nc1NlcnZpY2U6IElTZXR0aW5nc1NlcnZpY2UgfCBudWxsID0gJHN0YXRlKG51bGwpO1xuICBsZXQgc2VxdWVuY2VTZXJ2aWNlOiBJU2VxdWVuY2VTZXJ2aWNlIHwgbnVsbCA9ICRzdGF0ZShudWxsKTtcbiAgbGV0IGRldmljZVNlcnZpY2U6IElEZXZpY2VEZXRlY3Rpb25TZXJ2aWNlIHwgbnVsbCA9ICRzdGF0ZShudWxsKTtcbiAgbGV0IHNlcnZpY2VzUmVzb2x2ZWQgPSAkc3RhdGUoZmFsc2UpO1xuXG4gIC8vIEFwcCBzdGF0ZVxuICBsZXQgaXNJbml0aWFsaXplZCA9ICRkZXJpdmVkKGdldElzSW5pdGlhbGl6ZWQoKSk7XG4gIGxldCBpbml0aWFsaXphdGlvbkVycm9yID0gJGRlcml2ZWQoZ2V0SW5pdGlhbGl6YXRpb25FcnJvcigpKTtcbiAgbGV0IGluaXRpYWxpemF0aW9uUHJvZ3Jlc3MgPSAkZGVyaXZlZChnZXRJbml0aWFsaXphdGlvblByb2dyZXNzKCkpO1xuXG4gIC8vIFJlc29sdmUgc2VydmljZXMgd2hlbiBjb250YWluZXIgaXMgYXZhaWxhYmxlIC0gT05DRSBPTkxZXG4gICRlZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGdldENvbnRhaW5lcj8uKCk7XG4gICAgaWYgKGNvbnRhaW5lciAmJiAhc2VydmljZXNSZXNvbHZlZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVXNlIHJlc29sdmUgd2hpY2ggd2lsbCB1c2UgdGhlIGdsb2JhbCBjb250YWluZXIgb25jZSBpdCdzIHJlYWR5XG4gICAgICAgIGluaXRTZXJ2aWNlID0gcmVzb2x2ZShcIklBcHBsaWNhdGlvbkluaXRpYWxpemF0aW9uU2VydmljZVwiKTtcbiAgICAgICAgc2V0dGluZ3NTZXJ2aWNlID0gcmVzb2x2ZShcIklTZXR0aW5nc1NlcnZpY2VcIik7XG4gICAgICAgIHNlcXVlbmNlU2VydmljZSA9IHJlc29sdmUoXCJJU2VxdWVuY2VTZXJ2aWNlXCIpO1xuICAgICAgICBkZXZpY2VTZXJ2aWNlID0gcmVzb2x2ZShcIklEZXZpY2VEZXRlY3Rpb25TZXJ2aWNlXCIpO1xuXG4gICAgICAgIHNlcnZpY2VzUmVzb2x2ZWQgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZXNvbHZlIHNlcnZpY2VzOlwiLCBlcnJvcik7XG4gICAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoYFNlcnZpY2UgcmVzb2x1dGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyBJbml0aWFsaXplIGFwcGxpY2F0aW9uXG4gIG9uTW91bnQoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGdldENvbnRhaW5lcj8uKCk7XG4gICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoXCJObyBESSBjb250YWluZXIgYXZhaWxhYmxlXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFdhaXQgZm9yIHNlcnZpY2VzIHRvIGJlIHJlc29sdmVkXG4gICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICB3aGlsZSAoIXNlcnZpY2VzUmVzb2x2ZWQgJiYgYXR0ZW1wdHMgPCAxMCkge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICBhdHRlbXB0cysrO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFzZXJ2aWNlc1Jlc29sdmVkIHx8XG4gICAgICAhaW5pdFNlcnZpY2UgfHxcbiAgICAgICFzZXR0aW5nc1NlcnZpY2UgfHxcbiAgICAgICFzZXF1ZW5jZVNlcnZpY2UgfHxcbiAgICAgICFkZXZpY2VTZXJ2aWNlXG4gICAgKSB7XG4gICAgICBzZXRJbml0aWFsaXphdGlvbkVycm9yKFwiRmFpbGVkIHRvIHJlc29sdmUgcmVxdWlyZWQgc2VydmljZXNcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uU3RhdGUoZmFsc2UsIHRydWUsIG51bGwsIDApO1xuXG4gICAgICAvLyBTdGVwIDE6IEluaXRpYWxpemUgYXBwbGljYXRpb24gc2VydmljZXNcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoMjApO1xuICAgICAgYXdhaXQgaW5pdFNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAvLyBTdGVwIDI6IExvYWQgc2V0dGluZ3NcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoNDApO1xuICAgICAgYXdhaXQgc2V0dGluZ3NTZXJ2aWNlLmxvYWRTZXR0aW5ncygpO1xuICAgICAgdXBkYXRlU2V0dGluZ3Moc2V0dGluZ3NTZXJ2aWNlLmN1cnJlbnRTZXR0aW5ncyk7XG5cbiAgICAgIC8vIFN0ZXAgMzogSW5pdGlhbGl6ZSBkZXZpY2UgZGV0ZWN0aW9uXG4gICAgICBzZXRJbml0aWFsaXphdGlvblByb2dyZXNzKDUwKTtcblxuICAgICAgLy8gU3RlcCA0OiBMb2FkIGluaXRpYWwgZGF0YVxuICAgICAgc2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcyg3MCk7XG4gICAgICAvLyBUT0RPOiBJbmRpdmlkdWFsIGNvbXBvbmVudHMgc2hvdWxkIGxvYWQgdGhlaXIgb3duIGRhdGEgYXMgbmVlZGVkXG5cbiAgICAgIC8vIFN0ZXAgNTogUmVzdG9yZSBhcHBsaWNhdGlvbiBzdGF0ZSAodGFiIG1lbW9yeSlcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoODUpO1xuICAgICAgYXdhaXQgcmVzdG9yZUFwcGxpY2F0aW9uU3RhdGUoKTtcblxuICAgICAgLy8gU3RlcCA2OiBDb21wbGV0ZSBpbml0aWFsaXphdGlvblxuICAgICAgc2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcygxMDApO1xuICAgICAgc2V0SW5pdGlhbGl6YXRpb25TdGF0ZSh0cnVlLCBmYWxzZSwgbnVsbCwgMTAwKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBBcHBsaWNhdGlvbiBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGluaXRpYWxpemF0aW9uIGVycm9yXCJcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvLyBIYW5kbGUga2V5Ym9hcmQgc2hvcnRjdXRzXG4gICRlZmZlY3QoKCkgPT4ge1xuICAgIGZ1bmN0aW9uIGhhbmRsZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgIC8vIFNldHRpbmdzIGRpYWxvZyB0b2dnbGUgKEN0cmwvQ21kICsgLClcbiAgICAgIGlmICgoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSAmJiBldmVudC5rZXkgPT09IFwiLFwiKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChnZXRTaG93U2V0dGluZ3MoKSkge1xuICAgICAgICAgIGhpZGVTZXR0aW5nc0RpYWxvZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNob3dTZXR0aW5nc0RpYWxvZygpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRhYiBuYXZpZ2F0aW9uIChDdHJsL0NtZCArIDEtNSlcbiAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHtcbiAgICAgICAgc3dpdGNoIChldmVudC5rZXkpIHtcbiAgICAgICAgICBjYXNlIFwiMVwiOlxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN3aXRjaFRhYihcImNvbnN0cnVjdFwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCIyXCI6XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3dpdGNoVGFiKFwiYnJvd3NlXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIjNcIjpcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBzd2l0Y2hUYWIoXCJzZXF1ZW5jZV9jYXJkXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIjRcIjpcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBzd2l0Y2hUYWIoXCJ3cml0ZVwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCI1XCI6XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3dpdGNoVGFiKFwibGVhcm5cIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiNlwiOlxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN3aXRjaFRhYihcIm1vdGlvbi10ZXN0ZXJcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiN1wiOlxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN3aXRjaFRhYihcImFycm93LWRlYnVnXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVLZXlkb3duKTtcbiAgICByZXR1cm4gKCkgPT4gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlS2V5ZG93bik7XG4gIH0pO1xuPC9zY3JpcHQ+XG5cbjxzdmVsdGU6aGVhZD5cbiAgPHRpdGxlPlRLQSBDb25zdHJ1Y3RvciAtIFRoZSBLaW5ldGljIEFscGhhYmV0PC90aXRsZT5cbiAgPG1ldGFcbiAgICBuYW1lPVwiZGVzY3JpcHRpb25cIlxuICAgIGNvbnRlbnQ9XCJUaGUgS2luZXRpYyBBbHBoYWJldCBpcyBhIHJldm9sdXRpb25hcnkgZmxvdyBhcnRzIGNob3Jlb2dyYXBoeSB0b29sYm94IGZvciBzdGFmZnMsIGZhbnMsIGFuZCBvdGhlciBmbG93IGFydHMuIENyZWF0ZSwgbGVhcm4sIGFuZCBzaGFyZSBtb3ZlbWVudCBzZXF1ZW5jZXMuXCJcbiAgLz5cbjwvc3ZlbHRlOmhlYWQ+XG5cbjwhLS0gQXBwbGljYXRpb24gQ29udGFpbmVyIC0tPlxuPGRpdiBjbGFzcz1cInRrYS1hcHBcIiBkYXRhLXRlc3RpZD1cInRrYS1hcHBsaWNhdGlvblwiPlxuICB7I2lmIGluaXRpYWxpemF0aW9uRXJyb3J9XG4gICAgPEVycm9yU2NyZWVuXG4gICAgICBlcnJvcj17aW5pdGlhbGl6YXRpb25FcnJvcn1cbiAgICAgIG9uUmV0cnk9eygpID0+IHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKX1cbiAgICAvPlxuICB7OmVsc2UgaWYgIWlzSW5pdGlhbGl6ZWR9XG4gICAgPExvYWRpbmdTY3JlZW5cbiAgICAgIHByb2dyZXNzPXtpbml0aWFsaXphdGlvblByb2dyZXNzfVxuICAgICAgbWVzc2FnZT1cIkluaXRpYWxpemluZyBDb25zdHJ1Y3Rvci4uLlwiXG4gICAgLz5cbiAgezplbHNlfVxuICAgIDwhLS0gTWFpbiBJbnRlcmZhY2UgLS0+XG4gICAgPE1haW5JbnRlcmZhY2UgLz5cblxuICAgIDwhLS0gU2V0dGluZ3MgZGlhbG9nIC0tPlxuICAgIHsjaWYgZ2V0U2hvd1NldHRpbmdzKCl9XG4gICAgICA8U2V0dGluZ3NEaWFsb2cgLz5cbiAgICB7L2lmfVxuICB7L2lmfVxuPC9kaXY+XG5cbjxzdHlsZT5cbiAgLnRrYS1hcHAge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBtaW4taGVpZ2h0OiAxMDB2aDtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlO1xuICAgIGJhY2tncm91bmQ6IHRyYW5zcGFyZW50O1xuICAgIC0tdGV4dC1jb2xvcjogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjk1KTtcbiAgICAtLWZvcmVncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC45NSk7XG4gICAgLS1tdXRlZC1mb3JlZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyk7XG4gIH1cblxuICAvKiBSZXNwb25zaXZlIGFkanVzdG1lbnRzICovXG4gIEBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkge1xuICAgIC50a2EtYXBwIHtcbiAgICAgIC8qIER5bmFtaWMgdmlld3BvcnQgaGVpZ2h0IGZvciBtb2JpbGUgYXBwICovXG4gICAgICBtaW4taGVpZ2h0OiAxMDBkdmg7XG4gICAgfVxuICB9XG5cbiAgLyogUmVkdWNlZCBtb3Rpb24gc3VwcG9ydCAqL1xuICBAbWVkaWEgKHByZWZlcnMtcmVkdWNlZC1tb3Rpb246IHJlZHVjZSkge1xuICAgIC50a2EtYXBwIHtcbiAgICAgIHRyYW5zaXRpb246IG5vbmU7XG4gICAgfVxuICB9XG5cbiAgLyogSGlnaCBjb250cmFzdCBtb2RlICovXG4gIEBtZWRpYSAocHJlZmVycy1jb250cmFzdDogaGlnaCkge1xuICAgIC50a2EtYXBwIHtcbiAgICAgIC0tdGV4dC1jb2xvcjogd2hpdGU7XG4gICAgICAtLWZvcmVncm91bmQ6IHdoaXRlO1xuICAgIH1cbiAgfVxuXG4gIC8qIFByaW50IHN0eWxlcyAqL1xuICBAbWVkaWEgcHJpbnQge1xuICAgIC50a2EtYXBwIHtcbiAgICAgIG1pbi1oZWlnaHQ6IGF1dG87XG4gICAgICBvdmVyZmxvdzogdmlzaWJsZTtcbiAgICB9XG4gIH1cbjwvc3R5bGU+XG4iXSwiZmlsZSI6IkM6L1RLQS93ZWIvc3JjL2xpYi9jb21wb25lbnRzL01haW5BcHBsaWNhdGlvbi5zdmVsdGUifQ==