import {
  GridMode as DomainGridMode,
  Orientation,
  MotionColor,
  Location
} from "/src/lib/domain/enums.ts";
import { DefaultPropPositioner } from "/src/lib/services/DefaultPropPositioner.ts";
import { PropRotAngleManager } from "/src/lib/services/PropRotAngleManager.ts";
export class PropRenderingService {
  svgCache = /* @__PURE__ */ new Map();
  SUPPORTED_PROPS = ["staff", "hand", "fan"];
  // Color transformation constants (matching desktop)
  COLOR_TRANSFORMATIONS = {
    [MotionColor.BLUE]: "#2E3192",
    [MotionColor.RED]: "#ED1C24"
  };
  constructor() {
  }
  /**
   * Render a prop as an SVG element
   * DISABLED: Props are now rendered by Prop.svelte components to avoid duplicates
   */
  async renderProp(_propType, _color, _motionData, _gridMode = DomainGridMode.DIAMOND) {
    const group = document.createElementNS("http://www.w3.org/2000/svg", "g");
    group.setAttribute("class", "prop-service-disabled");
    return group;
  }
  /**
   * Calculate prop position based on motion data using real grid coordinates
   */
  async calculatePropPosition(motionData, color, gridMode = DomainGridMode.DIAMOND) {
    try {
      const location = motionData?.endLocation || "s";
      const basePosition = DefaultPropPositioner.calculatePosition(
        location,
        gridMode
      );
      const rotation = this.calculatePropRotation(motionData, location);
      const offset = this.getColorOffset(color);
      return {
        x: basePosition.x + offset.x,
        y: basePosition.y + offset.y,
        rotation
      };
    } catch (error) {
      console.error("❌ Error calculating prop position:", error);
      return { x: 475, y: 475, rotation: 0 };
    }
  }
  /**
   * Load prop SVG with color transformation
   */
  async loadPropSVG(propType, color) {
    const cacheKey = `${propType}_${color}`;
    if (this.svgCache.has(cacheKey)) {
      const cached = this.svgCache.get(cacheKey);
      if (cached) return cached;
    }
    try {
      const response = await fetch(`/images/props/${propType}.svg`);
      if (!response.ok) {
        throw new Error(`Failed to load ${propType}.svg: ${response.status}`);
      }
      let svgContent = await response.text();
      svgContent = this.applyColorTransformation(svgContent, color);
      this.svgCache.set(cacheKey, svgContent);
      return svgContent;
    } catch (error) {
      console.error(`❌ Error loading ${propType} SVG:`, error);
      return this.createFallbackSVG(propType, color);
    }
  }
  /**
   * Get supported prop types
   */
  getSupportedPropTypes() {
    return [...this.SUPPORTED_PROPS];
  }
  /**
   * Apply color transformation to SVG content
   */
  applyColorTransformation(svgContent, color) {
    const targetColor = this.COLOR_TRANSFORMATIONS[color];
    svgContent = svgContent.replace(/fill="[^"]*"/g, `fill="${targetColor}"`);
    svgContent = svgContent.replace(/fill:[^;]*/g, `fill:${targetColor}`);
    svgContent = svgContent.replace(
      /stroke="[^"]*"/g,
      `stroke="${targetColor}"`
    );
    svgContent = svgContent.replace(/stroke:[^;]*/g, `stroke:${targetColor}`);
    return svgContent;
  }
  /**
   * Get coordinates for a location on the grid using real grid data
   */
  // getLocationCoordinates removed (unused)
  /**
   * Convert string location to Location enum
   */
  stringToLocation(locationStr) {
    if (typeof locationStr !== "string") {
      return locationStr;
    }
    const locationMap = {
      n: Location.NORTH,
      e: Location.EAST,
      s: Location.SOUTH,
      w: Location.WEST,
      ne: Location.NORTHEAST,
      se: Location.SOUTHEAST,
      sw: Location.SOUTHWEST,
      nw: Location.NORTHWEST,
      north: Location.NORTH,
      east: Location.EAST,
      south: Location.SOUTH,
      west: Location.WEST,
      northeast: Location.NORTHEAST,
      southeast: Location.SOUTHEAST,
      southwest: Location.SOUTHWEST,
      northwest: Location.NORTHWEST
    };
    return locationMap[locationStr.toLowerCase()] || Location.SOUTH;
  }
  /**
   * Calculate prop rotation based on motion data using PropRotAngleManager for parity
   */
  calculatePropRotation(motionData, location, gridMode = DomainGridMode.DIAMOND) {
    const endLocationStr = location || motionData?.endLocation || "s";
    const endLocation = this.stringToLocation(endLocationStr);
    const endOrientation = motionData?.endOrientation || "in";
    let orientation;
    switch (endOrientation) {
      case "in":
        orientation = Orientation.IN;
        break;
      case "out":
        orientation = Orientation.OUT;
        break;
      case "clock":
        orientation = Orientation.CLOCK;
        break;
      case "counter":
        orientation = Orientation.COUNTER;
        break;
      default:
        orientation = Orientation.IN;
    }
    return PropRotAngleManager.calculateRotation(
      endLocation,
      orientation,
      gridMode
    );
  }
  getColorOffset(color) {
    return color === MotionColor.BLUE ? { x: -8, y: -8 } : { x: 8, y: 8 };
  }
  /**
   * Create fallback SVG for missing props
   */
  createFallbackSVG(propType, color) {
    const fillColor = this.COLOR_TRANSFORMATIONS[color];
    return `
			<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
				<rect x="10" y="10" width="80" height="80" fill="${fillColor}" opacity="0.5"/>
				<text x="50" y="55" text-anchor="middle" font-size="12" fill="white">${propType}</text>
			</svg>
		`;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9yZW5kZXJpbmcvUHJvcFJlbmRlcmluZ1NlcnZpY2UudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qKlxuICogUHJvcCBSZW5kZXJpbmcgU2VydmljZSAtIFdlYiBJbXBsZW1lbnRhdGlvblxuICpcbiAqIFRoaXMgc2VydmljZSBoYW5kbGVzIHByb3AgcmVuZGVyaW5nIGZvciB0aGUgd2ViIGFwcCwgaW5jbHVkaW5nOlxuICogLSBMb2FkaW5nIGFuZCBjYWNoaW5nIHByb3AgU1ZHIGFzc2V0c1xuICogLSBBcHBseWluZyBjb2xvciB0cmFuc2Zvcm1hdGlvbnNcbiAqIC0gQ2FsY3VsYXRpbmcgcHJvcCBwb3NpdGlvbnMgYmFzZWQgb24gbW90aW9uIGRhdGFcbiAqIC0gUmVuZGVyaW5nIHByb3BzIGFzIFNWRyBlbGVtZW50c1xuICovXG5cbmltcG9ydCB7XG4gIEdyaWRNb2RlIGFzIERvbWFpbkdyaWRNb2RlLFxuICBPcmllbnRhdGlvbixcbiAgTW90aW9uQ29sb3IsXG4gIExvY2F0aW9uLFxufSBmcm9tIFwiLi4vLi4vLi4vZG9tYWluL2VudW1zXCI7XG5pbXBvcnQgeyBEZWZhdWx0UHJvcFBvc2l0aW9uZXIgfSBmcm9tIFwiLi4vLi4vRGVmYXVsdFByb3BQb3NpdGlvbmVyXCI7XG5pbXBvcnQgdHlwZSB7IE1vdGlvbkRhdGEgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgR3JpZE1vZGUsIFByb3BQb3NpdGlvbiB9IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzL2NvcmUtdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgSVByb3BSZW5kZXJpbmdTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXMvcG9zaXRpb25pbmctaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHsgUHJvcFJvdEFuZ2xlTWFuYWdlciB9IGZyb20gXCIuLi8uLi9Qcm9wUm90QW5nbGVNYW5hZ2VyXCI7XG5cbmV4cG9ydCBjbGFzcyBQcm9wUmVuZGVyaW5nU2VydmljZSBpbXBsZW1lbnRzIElQcm9wUmVuZGVyaW5nU2VydmljZSB7XG4gIHByaXZhdGUgc3ZnQ2FjaGUgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IFNVUFBPUlRFRF9QUk9QUyA9IFtcInN0YWZmXCIsIFwiaGFuZFwiLCBcImZhblwiXTtcblxuICAvLyBDb2xvciB0cmFuc2Zvcm1hdGlvbiBjb25zdGFudHMgKG1hdGNoaW5nIGRlc2t0b3ApXG4gIHByaXZhdGUgcmVhZG9ubHkgQ09MT1JfVFJBTlNGT1JNQVRJT05TID0ge1xuICAgIFtNb3Rpb25Db2xvci5CTFVFXTogXCIjMkUzMTkyXCIsXG4gICAgW01vdGlvbkNvbG9yLlJFRF06IFwiI0VEMUMyNFwiLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIFByb3BSZW5kZXJpbmdTZXJ2aWNlIGluaXRpYWxpemVkXG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGEgcHJvcCBhcyBhbiBTVkcgZWxlbWVudFxuICAgKiBESVNBQkxFRDogUHJvcHMgYXJlIG5vdyByZW5kZXJlZCBieSBQcm9wLnN2ZWx0ZSBjb21wb25lbnRzIHRvIGF2b2lkIGR1cGxpY2F0ZXNcbiAgICovXG4gIGFzeW5jIHJlbmRlclByb3AoXG4gICAgX3Byb3BUeXBlOiBzdHJpbmcsXG4gICAgX2NvbG9yOiBNb3Rpb25Db2xvcixcbiAgICBfbW90aW9uRGF0YTogTW90aW9uRGF0YSxcbiAgICBfZ3JpZE1vZGU6IEdyaWRNb2RlID0gRG9tYWluR3JpZE1vZGUuRElBTU9ORFxuICApOiBQcm9taXNlPFNWR0VsZW1lbnQ+IHtcbiAgICAvLyBQcm9wcyBhcmUgbm93IGhhbmRsZWQgYnkgUGljdG9ncmFwaC5zdmVsdGUgLT4gUHJvcC5zdmVsdGUgY29tcG9uZW50c1xuICAgIC8vIFRoaXMgc2VydmljZS1sZXZlbCByZW5kZXJpbmcgaXMgZGlzYWJsZWQgdG8gcHJldmVudCBkdXBsaWNhdGUgQ0lSQ0xFX1BST1AgZWxlbWVudHNcblxuICAgIC8vIFJldHVybiBlbXB0eSBncm91cCB0byBwcmV2ZW50IGVycm9yc1xuICAgIGNvbnN0IGdyb3VwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJnXCIpO1xuICAgIGdyb3VwLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicHJvcC1zZXJ2aWNlLWRpc2FibGVkXCIpO1xuICAgIHJldHVybiBncm91cDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcHJvcCBwb3NpdGlvbiBiYXNlZCBvbiBtb3Rpb24gZGF0YSB1c2luZyByZWFsIGdyaWQgY29vcmRpbmF0ZXNcbiAgICovXG4gIGFzeW5jIGNhbGN1bGF0ZVByb3BQb3NpdGlvbihcbiAgICBtb3Rpb25EYXRhOiBNb3Rpb25EYXRhLFxuICAgIGNvbG9yOiBNb3Rpb25Db2xvcixcbiAgICBncmlkTW9kZTogR3JpZE1vZGUgPSBEb21haW5HcmlkTW9kZS5ESUFNT05EXG4gICk6IFByb21pc2U8UHJvcFBvc2l0aW9uPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBlbmQgbG9jYXRpb24gZm9yIHByb3AgcG9zaXRpb25pbmcgKGRvbWFpbiB1c2VzIGVuZExvY2F0aW9uKVxuICAgICAgY29uc3QgbG9jYXRpb24gPSAobW90aW9uRGF0YT8uZW5kTG9jYXRpb24gYXMgdW5rbm93biBhcyBzdHJpbmcpIHx8IFwic1wiO1xuXG4gICAgICAvLyBVc2UgRGVmYXVsdFByb3BQb3NpdGlvbmVyIGZvciBjb25zaXN0ZW50IHBvc2l0aW9uaW5nXG4gICAgICBjb25zdCBiYXNlUG9zaXRpb24gPSBEZWZhdWx0UHJvcFBvc2l0aW9uZXIuY2FsY3VsYXRlUG9zaXRpb24oXG4gICAgICAgIGxvY2F0aW9uLFxuICAgICAgICBncmlkTW9kZVxuICAgICAgKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHJvdGF0aW9uIHVzaW5nIFByb3BSb3RBbmdsZU1hbmFnZXIgZm9yIHBhcml0eSB3aXRoIGxlZ2FjeVxuICAgICAgY29uc3Qgcm90YXRpb24gPSB0aGlzLmNhbGN1bGF0ZVByb3BSb3RhdGlvbihtb3Rpb25EYXRhLCBsb2NhdGlvbik7XG5cbiAgICAgIC8vIEFwcGx5IHNtYWxsIG9mZnNldCBmb3IgY29sb3Igc2VwYXJhdGlvblxuICAgICAgY29uc3Qgb2Zmc2V0ID0gdGhpcy5nZXRDb2xvck9mZnNldChjb2xvcik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IGJhc2VQb3NpdGlvbi54ICsgb2Zmc2V0LngsXG4gICAgICAgIHk6IGJhc2VQb3NpdGlvbi55ICsgb2Zmc2V0LnksXG4gICAgICAgIHJvdGF0aW9uLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBjYWxjdWxhdGluZyBwcm9wIHBvc2l0aW9uOlwiLCBlcnJvcik7XG4gICAgICAvLyBSZXR1cm4gY2VudGVyIHBvc2l0aW9uIGFzIGZhbGxiYWNrICg5NTB4OTUwIHNjZW5lKVxuICAgICAgcmV0dXJuIHsgeDogNDc1LCB5OiA0NzUsIHJvdGF0aW9uOiAwIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgcHJvcCBTVkcgd2l0aCBjb2xvciB0cmFuc2Zvcm1hdGlvblxuICAgKi9cbiAgYXN5bmMgbG9hZFByb3BTVkcocHJvcFR5cGU6IHN0cmluZywgY29sb3I6IE1vdGlvbkNvbG9yKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGAke3Byb3BUeXBlfV8ke2NvbG9yfWA7XG5cbiAgICBpZiAodGhpcy5zdmdDYWNoZS5oYXMoY2FjaGVLZXkpKSB7XG4gICAgICBjb25zdCBjYWNoZWQgPSB0aGlzLnN2Z0NhY2hlLmdldChjYWNoZUtleSk7XG4gICAgICBpZiAoY2FjaGVkKSByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBMb2FkIGJhc2UgU1ZHXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAvaW1hZ2VzL3Byb3BzLyR7cHJvcFR5cGV9LnN2Z2ApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkICR7cHJvcFR5cGV9LnN2ZzogJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICB9XG5cbiAgICAgIGxldCBzdmdDb250ZW50ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuXG4gICAgICAvLyBBcHBseSBjb2xvciB0cmFuc2Zvcm1hdGlvblxuICAgICAgc3ZnQ29udGVudCA9IHRoaXMuYXBwbHlDb2xvclRyYW5zZm9ybWF0aW9uKHN2Z0NvbnRlbnQsIGNvbG9yKTtcblxuICAgICAgLy8gQ2FjaGUgdGhlIHJlc3VsdFxuICAgICAgdGhpcy5zdmdDYWNoZS5zZXQoY2FjaGVLZXksIHN2Z0NvbnRlbnQpO1xuXG4gICAgICByZXR1cm4gc3ZnQ29udGVudDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIGxvYWRpbmcgJHtwcm9wVHlwZX0gU1ZHOmAsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBmYWxsYmFjayBTVkdcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUZhbGxiYWNrU1ZHKHByb3BUeXBlLCBjb2xvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzdXBwb3J0ZWQgcHJvcCB0eXBlc1xuICAgKi9cbiAgZ2V0U3VwcG9ydGVkUHJvcFR5cGVzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuU1VQUE9SVEVEX1BST1BTXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBjb2xvciB0cmFuc2Zvcm1hdGlvbiB0byBTVkcgY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBhcHBseUNvbG9yVHJhbnNmb3JtYXRpb24oXG4gICAgc3ZnQ29udGVudDogc3RyaW5nLFxuICAgIGNvbG9yOiBNb3Rpb25Db2xvclxuICApOiBzdHJpbmcge1xuICAgIGNvbnN0IHRhcmdldENvbG9yID0gdGhpcy5DT0xPUl9UUkFOU0ZPUk1BVElPTlNbY29sb3JdO1xuXG4gICAgLy8gUmVwbGFjZSBjb21tb24gZmlsbCBwYXR0ZXJuc1xuICAgIHN2Z0NvbnRlbnQgPSBzdmdDb250ZW50LnJlcGxhY2UoL2ZpbGw9XCJbXlwiXSpcIi9nLCBgZmlsbD1cIiR7dGFyZ2V0Q29sb3J9XCJgKTtcbiAgICBzdmdDb250ZW50ID0gc3ZnQ29udGVudC5yZXBsYWNlKC9maWxsOlteO10qL2csIGBmaWxsOiR7dGFyZ2V0Q29sb3J9YCk7XG5cbiAgICAvLyBSZXBsYWNlIHN0cm9rZSBwYXR0ZXJucyBmb3Igb3V0bGluZXNcbiAgICBzdmdDb250ZW50ID0gc3ZnQ29udGVudC5yZXBsYWNlKFxuICAgICAgL3N0cm9rZT1cIlteXCJdKlwiL2csXG4gICAgICBgc3Ryb2tlPVwiJHt0YXJnZXRDb2xvcn1cImBcbiAgICApO1xuICAgIHN2Z0NvbnRlbnQgPSBzdmdDb250ZW50LnJlcGxhY2UoL3N0cm9rZTpbXjtdKi9nLCBgc3Ryb2tlOiR7dGFyZ2V0Q29sb3J9YCk7XG5cbiAgICByZXR1cm4gc3ZnQ29udGVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY29vcmRpbmF0ZXMgZm9yIGEgbG9jYXRpb24gb24gdGhlIGdyaWQgdXNpbmcgcmVhbCBncmlkIGRhdGFcbiAgICovXG4gIC8vIGdldExvY2F0aW9uQ29vcmRpbmF0ZXMgcmVtb3ZlZCAodW51c2VkKVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0IHN0cmluZyBsb2NhdGlvbiB0byBMb2NhdGlvbiBlbnVtXG4gICAqL1xuICBwcml2YXRlIHN0cmluZ1RvTG9jYXRpb24obG9jYXRpb25TdHI6IHN0cmluZyB8IExvY2F0aW9uKTogTG9jYXRpb24ge1xuICAgIGlmICh0eXBlb2YgbG9jYXRpb25TdHIgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVybiBsb2NhdGlvblN0cjtcbiAgICB9XG5cbiAgICBjb25zdCBsb2NhdGlvbk1hcDogUmVjb3JkPHN0cmluZywgTG9jYXRpb24+ID0ge1xuICAgICAgbjogTG9jYXRpb24uTk9SVEgsXG4gICAgICBlOiBMb2NhdGlvbi5FQVNULFxuICAgICAgczogTG9jYXRpb24uU09VVEgsXG4gICAgICB3OiBMb2NhdGlvbi5XRVNULFxuICAgICAgbmU6IExvY2F0aW9uLk5PUlRIRUFTVCxcbiAgICAgIHNlOiBMb2NhdGlvbi5TT1VUSEVBU1QsXG4gICAgICBzdzogTG9jYXRpb24uU09VVEhXRVNULFxuICAgICAgbnc6IExvY2F0aW9uLk5PUlRIV0VTVCxcbiAgICAgIG5vcnRoOiBMb2NhdGlvbi5OT1JUSCxcbiAgICAgIGVhc3Q6IExvY2F0aW9uLkVBU1QsXG4gICAgICBzb3V0aDogTG9jYXRpb24uU09VVEgsXG4gICAgICB3ZXN0OiBMb2NhdGlvbi5XRVNULFxuICAgICAgbm9ydGhlYXN0OiBMb2NhdGlvbi5OT1JUSEVBU1QsXG4gICAgICBzb3V0aGVhc3Q6IExvY2F0aW9uLlNPVVRIRUFTVCxcbiAgICAgIHNvdXRod2VzdDogTG9jYXRpb24uU09VVEhXRVNULFxuICAgICAgbm9ydGh3ZXN0OiBMb2NhdGlvbi5OT1JUSFdFU1QsXG4gICAgfTtcblxuICAgIHJldHVybiBsb2NhdGlvbk1hcFtsb2NhdGlvblN0ci50b0xvd2VyQ2FzZSgpXSB8fCBMb2NhdGlvbi5TT1VUSDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcHJvcCByb3RhdGlvbiBiYXNlZCBvbiBtb3Rpb24gZGF0YSB1c2luZyBQcm9wUm90QW5nbGVNYW5hZ2VyIGZvciBwYXJpdHlcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlUHJvcFJvdGF0aW9uKFxuICAgIG1vdGlvbkRhdGE6IE1vdGlvbkRhdGEsXG4gICAgbG9jYXRpb24/OiBzdHJpbmcsXG4gICAgZ3JpZE1vZGU6IERvbWFpbkdyaWRNb2RlID0gRG9tYWluR3JpZE1vZGUuRElBTU9ORFxuICApOiBudW1iZXIge1xuICAgIC8vIFVzZSBQcm9wUm90QW5nbGVNYW5hZ2VyIGZvciBjb25zaXN0ZW50IHJvdGF0aW9uIGNhbGN1bGF0aW9uIHdpdGggbGVnYWN5XG4gICAgY29uc3QgZW5kTG9jYXRpb25TdHIgPVxuICAgICAgbG9jYXRpb24gfHwgKG1vdGlvbkRhdGE/LmVuZExvY2F0aW9uIGFzIHVua25vd24gYXMgc3RyaW5nKSB8fCBcInNcIjtcbiAgICBjb25zdCBlbmRMb2NhdGlvbiA9IHRoaXMuc3RyaW5nVG9Mb2NhdGlvbihlbmRMb2NhdGlvblN0cik7XG4gICAgY29uc3QgZW5kT3JpZW50YXRpb24gPVxuICAgICAgKG1vdGlvbkRhdGEgYXMgdW5rbm93biBhcyB7IGVuZE9yaWVudGF0aW9uPzogc3RyaW5nIH0pPy5lbmRPcmllbnRhdGlvbiB8fFxuICAgICAgXCJpblwiO1xuXG4gICAgLy8gQ29udmVydCBzdHJpbmcgb3JpZW50YXRpb24gdG8gZW51bVxuICAgIGxldCBvcmllbnRhdGlvbjogT3JpZW50YXRpb247XG4gICAgc3dpdGNoIChlbmRPcmllbnRhdGlvbikge1xuICAgICAgY2FzZSBcImluXCI6XG4gICAgICAgIG9yaWVudGF0aW9uID0gT3JpZW50YXRpb24uSU47XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm91dFwiOlxuICAgICAgICBvcmllbnRhdGlvbiA9IE9yaWVudGF0aW9uLk9VVDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY2xvY2tcIjpcbiAgICAgICAgb3JpZW50YXRpb24gPSBPcmllbnRhdGlvbi5DTE9DSztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiY291bnRlclwiOlxuICAgICAgICBvcmllbnRhdGlvbiA9IE9yaWVudGF0aW9uLkNPVU5URVI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgb3JpZW50YXRpb24gPSBPcmllbnRhdGlvbi5JTjtcbiAgICB9XG5cbiAgICAvLyBEZWxlZ2F0ZSB0byBhbmdsZSBtYW5hZ2VyXG4gICAgcmV0dXJuIFByb3BSb3RBbmdsZU1hbmFnZXIuY2FsY3VsYXRlUm90YXRpb24oXG4gICAgICBlbmRMb2NhdGlvbixcbiAgICAgIG9yaWVudGF0aW9uLFxuICAgICAgZ3JpZE1vZGVcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb2xvck9mZnNldChjb2xvcjogTW90aW9uQ29sb3IpOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0ge1xuICAgIC8vIFNtYWxsIG9mZnNldCB0byBwcmV2ZW50IHByb3BzIGZyb20gb3ZlcmxhcHBpbmdcbiAgICByZXR1cm4gY29sb3IgPT09IE1vdGlvbkNvbG9yLkJMVUUgPyB7IHg6IC04LCB5OiAtOCB9IDogeyB4OiA4LCB5OiA4IH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGZhbGxiYWNrIFNWRyBmb3IgbWlzc2luZyBwcm9wc1xuICAgKi9cbiAgcHJpdmF0ZSBjcmVhdGVGYWxsYmFja1NWRyhwcm9wVHlwZTogc3RyaW5nLCBjb2xvcjogTW90aW9uQ29sb3IpOiBzdHJpbmcge1xuICAgIGNvbnN0IGZpbGxDb2xvciA9IHRoaXMuQ09MT1JfVFJBTlNGT1JNQVRJT05TW2NvbG9yXTtcbiAgICByZXR1cm4gYFxuXHRcdFx0PHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgdmlld0JveD1cIjAgMCAxMDAgMTAwXCI+XG5cdFx0XHRcdDxyZWN0IHg9XCIxMFwiIHk9XCIxMFwiIHdpZHRoPVwiODBcIiBoZWlnaHQ9XCI4MFwiIGZpbGw9XCIke2ZpbGxDb2xvcn1cIiBvcGFjaXR5PVwiMC41XCIvPlxuXHRcdFx0XHQ8dGV4dCB4PVwiNTBcIiB5PVwiNTVcIiB0ZXh0LWFuY2hvcj1cIm1pZGRsZVwiIGZvbnQtc2l6ZT1cIjEyXCIgZmlsbD1cIndoaXRlXCI+JHtwcm9wVHlwZX08L3RleHQ+XG5cdFx0XHQ8L3N2Zz5cblx0XHRgO1xuICB9XG59XG4iXSwKICAi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
