export class OptionFilteringService {
  constructor(enumMappingService) {
    this.enumMappingService = enumMappingService;
  }
  /**
   * Filter options by start position
   */
  filterByStartPosition(options, startPosition) {
    if (!startPosition) return options;
    return options.filter((option) => {
      const optionStartPos = option.startPosition?.toString().toLowerCase();
      const targetStartPos = startPosition.toLowerCase();
      return optionStartPos === targetStartPos;
    });
  }
  /**
   * Filter options by end position
   */
  filterByEndPosition(options, endPosition) {
    if (!endPosition) return options;
    return options.filter((option) => {
      const optionEndPos = option.endPosition?.toString().toLowerCase();
      const targetEndPos = endPosition.toLowerCase();
      return optionEndPos === targetEndPos;
    });
  }
  /**
   * Filter options by letter types
   */
  filterByLetterTypes(options, letterTypes) {
    if (!letterTypes || letterTypes.length === 0) return options;
    return options.filter((option) => {
      if (!option.letter) return false;
      const letterType = this.enumMappingService.getLetterType(option.letter);
      return letterTypes.includes(letterType);
    });
  }
  /**
   * Filter options by rotation directions
   */
  filterByRotation(options, blueRotationDirection, redRotationDirection) {
    return options.filter((option) => {
      let matches = true;
      if (blueRotationDirection && blueRotationDirection !== "any") {
        const blueRotation = option.motions?.blue?.rotationDirection?.toString().toLowerCase();
        const targetBlueRotation = blueRotationDirection.toLowerCase();
        matches = matches && blueRotation === targetBlueRotation;
      }
      if (redRotationDirection && redRotationDirection !== "any") {
        const redRotation = option.motions?.red?.rotationDirection?.toString().toLowerCase();
        const targetRedRotation = redRotationDirection.toLowerCase();
        matches = matches && redRotation === targetRedRotation;
      }
      return matches;
    });
  }
  /**
   * Filter options by multiple criteria with detailed result
   */
  filterByCriteria(options, criteria) {
    let filtered = [...options];
    const appliedFilters = [];
    const totalOriginal = options.length;
    if (criteria.startPosition) {
      filtered = this.filterByStartPosition(filtered, criteria.startPosition);
      appliedFilters.push(`startPosition: ${criteria.startPosition}`);
    }
    if (criteria.endPosition) {
      filtered = this.filterByEndPosition(filtered, criteria.endPosition);
      appliedFilters.push(`endPosition: ${criteria.endPosition}`);
    }
    if (criteria.letterTypes && criteria.letterTypes.length > 0) {
      filtered = this.filterByLetterTypes(filtered, criteria.letterTypes);
      appliedFilters.push(`letterTypes: ${criteria.letterTypes.join(", ")}`);
    }
    if (criteria.blueRotationDirection || criteria.redRotationDirection) {
      filtered = this.filterByRotation(
        filtered,
        criteria.blueRotationDirection || "",
        criteria.redRotationDirection || ""
      );
      appliedFilters.push(
        `rotation: blue=${criteria.blueRotationDirection || "any"}, red=${criteria.redRotationDirection || "any"}`
      );
    }
    if (criteria.motionTypes && criteria.motionTypes.length > 0) {
      filtered = this.filterByMotionTypes(filtered, criteria.motionTypes);
      appliedFilters.push(`motionTypes: ${criteria.motionTypes.join(", ")}`);
    }
    if (criteria.excludeLetters && criteria.excludeLetters.length > 0) {
      filtered = this.filterExcludeLetters(filtered, criteria.excludeLetters);
      appliedFilters.push(
        `excludeLetters: ${criteria.excludeLetters.join(", ")}`
      );
    }
    return {
      filtered,
      totalOriginal,
      totalFiltered: filtered.length,
      appliedFilters
    };
  }
  /**
   * Extract end position from the last beat in a sequence
   */
  extractEndPosition(lastBeat) {
    try {
      if (!lastBeat || !lastBeat.pictographData) {
        return null;
      }
      const endPosition = lastBeat.pictographData.endPosition;
      return endPosition ? endPosition.toString() : null;
    } catch (error) {
      console.warn("⚠️ Failed to extract end position from beat:", error);
      return null;
    }
  }
  /**
   * Filter by motion types
   */
  filterByMotionTypes(options, motionTypes) {
    return options.filter((option) => {
      const blueMotionType = option.motions?.blue?.motionType?.toString().toLowerCase();
      const redMotionType = option.motions?.red?.motionType?.toString().toLowerCase();
      const normalizedMotionTypes = motionTypes.map((mt) => mt.toLowerCase());
      return normalizedMotionTypes.includes(blueMotionType || "") || normalizedMotionTypes.includes(redMotionType || "");
    });
  }
  /**
   * Filter to exclude specific letters
   */
  filterExcludeLetters(options, excludeLetters) {
    return options.filter((option) => {
      return !excludeLetters.includes(option.letter || "");
    });
  }
  /**
   * Get filtering statistics for debugging
   */
  getFilteringStats(originalOptions, criteria) {
    let current = [...originalOptions];
    const afterEachFilter = [];
    if (criteria.startPosition) {
      current = this.filterByStartPosition(current, criteria.startPosition);
      afterEachFilter.push({
        filterName: "startPosition",
        count: current.length,
        criteria: criteria.startPosition
      });
    }
    if (criteria.endPosition) {
      current = this.filterByEndPosition(current, criteria.endPosition);
      afterEachFilter.push({
        filterName: "endPosition",
        count: current.length,
        criteria: criteria.endPosition
      });
    }
    if (criteria.letterTypes && criteria.letterTypes.length > 0) {
      current = this.filterByLetterTypes(current, criteria.letterTypes);
      afterEachFilter.push({
        filterName: "letterTypes",
        count: current.length,
        criteria: criteria.letterTypes.join(", ")
      });
    }
    return {
      originalCount: originalOptions.length,
      afterEachFilter,
      finalCount: current.length
    };
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9kYXRhL09wdGlvbkZpbHRlcmluZ1NlcnZpY2UudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qKlxuICogT3B0aW9uRmlsdGVyaW5nU2VydmljZSAtIENlbnRyYWxpemVkIG9wdGlvbiBmaWx0ZXJpbmcgdXRpbGl0aWVzXG4gKlxuICogSGFuZGxlcyBmaWx0ZXJpbmcgb2YgcGljdG9ncmFwaCBvcHRpb25zIGJ5IHZhcmlvdXMgY3JpdGVyaWEgaW5jbHVkaW5nXG4gKiBwb3NpdGlvbiwgbGV0dGVyIHR5cGVzLCByb3RhdGlvbiwgYW5kIG90aGVyIG1vdGlvbiBwYXJhbWV0ZXJzLlxuICovXG5cbmltcG9ydCB0eXBlIHsgUGljdG9ncmFwaERhdGEgfSBmcm9tIFwiJGxpYi9kb21haW4vUGljdG9ncmFwaERhdGFcIjtcbmltcG9ydCB0eXBlIHsgQmVhdERhdGEgfSBmcm9tIFwiJGxpYi9kb21haW4vQmVhdERhdGFcIjtcbmltcG9ydCB0eXBlIHsgSUVudW1NYXBwaW5nU2VydmljZSB9IGZyb20gXCIuL0VudW1NYXBwaW5nU2VydmljZVwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIEZpbHRlckNyaXRlcmlhIHtcbiAgc3RhcnRQb3NpdGlvbj86IHN0cmluZztcbiAgZW5kUG9zaXRpb24/OiBzdHJpbmc7XG4gIGxldHRlclR5cGVzPzogc3RyaW5nW107XG4gIGJsdWVSb3RhdGlvbkRpcmVjdGlvbj86IHN0cmluZztcbiAgcmVkUm90YXRpb25EaXJlY3Rpb24/OiBzdHJpbmc7XG4gIG1vdGlvblR5cGVzPzogc3RyaW5nW107XG4gIGRpZmZpY3VsdHk/OiBzdHJpbmc7XG4gIGV4Y2x1ZGVMZXR0ZXJzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmlsdGVyUmVzdWx0IHtcbiAgZmlsdGVyZWQ6IFBpY3RvZ3JhcGhEYXRhW107XG4gIHRvdGFsT3JpZ2luYWw6IG51bWJlcjtcbiAgdG90YWxGaWx0ZXJlZDogbnVtYmVyO1xuICBhcHBsaWVkRmlsdGVyczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU9wdGlvbkZpbHRlcmluZ1NlcnZpY2Uge1xuICBmaWx0ZXJCeVN0YXJ0UG9zaXRpb24oXG4gICAgb3B0aW9uczogUGljdG9ncmFwaERhdGFbXSxcbiAgICBzdGFydFBvc2l0aW9uOiBzdHJpbmdcbiAgKTogUGljdG9ncmFwaERhdGFbXTtcbiAgZmlsdGVyQnlFbmRQb3NpdGlvbihcbiAgICBvcHRpb25zOiBQaWN0b2dyYXBoRGF0YVtdLFxuICAgIGVuZFBvc2l0aW9uOiBzdHJpbmdcbiAgKTogUGljdG9ncmFwaERhdGFbXTtcbiAgZmlsdGVyQnlMZXR0ZXJUeXBlcyhcbiAgICBvcHRpb25zOiBQaWN0b2dyYXBoRGF0YVtdLFxuICAgIGxldHRlclR5cGVzOiBzdHJpbmdbXVxuICApOiBQaWN0b2dyYXBoRGF0YVtdO1xuICBmaWx0ZXJCeVJvdGF0aW9uKFxuICAgIG9wdGlvbnM6IFBpY3RvZ3JhcGhEYXRhW10sXG4gICAgYmx1ZVJvdGF0aW9uRGlyZWN0aW9uOiBzdHJpbmcsXG4gICAgcmVkUm90YXRpb25EaXJlY3Rpb246IHN0cmluZ1xuICApOiBQaWN0b2dyYXBoRGF0YVtdO1xuICBmaWx0ZXJCeUNyaXRlcmlhKFxuICAgIG9wdGlvbnM6IFBpY3RvZ3JhcGhEYXRhW10sXG4gICAgY3JpdGVyaWE6IEZpbHRlckNyaXRlcmlhXG4gICk6IEZpbHRlclJlc3VsdDtcbiAgZXh0cmFjdEVuZFBvc2l0aW9uKGxhc3RCZWF0OiBCZWF0RGF0YSk6IHN0cmluZyB8IG51bGw7XG59XG5cbmV4cG9ydCBjbGFzcyBPcHRpb25GaWx0ZXJpbmdTZXJ2aWNlIGltcGxlbWVudHMgSU9wdGlvbkZpbHRlcmluZ1NlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVudW1NYXBwaW5nU2VydmljZTogSUVudW1NYXBwaW5nU2VydmljZSkge31cblxuICAvKipcbiAgICogRmlsdGVyIG9wdGlvbnMgYnkgc3RhcnQgcG9zaXRpb25cbiAgICovXG4gIGZpbHRlckJ5U3RhcnRQb3NpdGlvbihcbiAgICBvcHRpb25zOiBQaWN0b2dyYXBoRGF0YVtdLFxuICAgIHN0YXJ0UG9zaXRpb246IHN0cmluZ1xuICApOiBQaWN0b2dyYXBoRGF0YVtdIHtcbiAgICBpZiAoIXN0YXJ0UG9zaXRpb24pIHJldHVybiBvcHRpb25zO1xuXG4gICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvblN0YXJ0UG9zID0gb3B0aW9uLnN0YXJ0UG9zaXRpb24/LnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IHRhcmdldFN0YXJ0UG9zID0gc3RhcnRQb3NpdGlvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIG9wdGlvblN0YXJ0UG9zID09PSB0YXJnZXRTdGFydFBvcztcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWx0ZXIgb3B0aW9ucyBieSBlbmQgcG9zaXRpb25cbiAgICovXG4gIGZpbHRlckJ5RW5kUG9zaXRpb24oXG4gICAgb3B0aW9uczogUGljdG9ncmFwaERhdGFbXSxcbiAgICBlbmRQb3NpdGlvbjogc3RyaW5nXG4gICk6IFBpY3RvZ3JhcGhEYXRhW10ge1xuICAgIGlmICghZW5kUG9zaXRpb24pIHJldHVybiBvcHRpb25zO1xuXG4gICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+IHtcbiAgICAgIGNvbnN0IG9wdGlvbkVuZFBvcyA9IG9wdGlvbi5lbmRQb3NpdGlvbj8udG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgdGFyZ2V0RW5kUG9zID0gZW5kUG9zaXRpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgIHJldHVybiBvcHRpb25FbmRQb3MgPT09IHRhcmdldEVuZFBvcztcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWx0ZXIgb3B0aW9ucyBieSBsZXR0ZXIgdHlwZXNcbiAgICovXG4gIGZpbHRlckJ5TGV0dGVyVHlwZXMoXG4gICAgb3B0aW9uczogUGljdG9ncmFwaERhdGFbXSxcbiAgICBsZXR0ZXJUeXBlczogc3RyaW5nW11cbiAgKTogUGljdG9ncmFwaERhdGFbXSB7XG4gICAgaWYgKCFsZXR0ZXJUeXBlcyB8fCBsZXR0ZXJUeXBlcy5sZW5ndGggPT09IDApIHJldHVybiBvcHRpb25zO1xuXG4gICAgcmV0dXJuIG9wdGlvbnMuZmlsdGVyKChvcHRpb24pID0+IHtcbiAgICAgIGlmICghb3B0aW9uLmxldHRlcikgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBjb25zdCBsZXR0ZXJUeXBlID0gdGhpcy5lbnVtTWFwcGluZ1NlcnZpY2UuZ2V0TGV0dGVyVHlwZShvcHRpb24ubGV0dGVyKTtcbiAgICAgIHJldHVybiBsZXR0ZXJUeXBlcy5pbmNsdWRlcyhsZXR0ZXJUeXBlKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWx0ZXIgb3B0aW9ucyBieSByb3RhdGlvbiBkaXJlY3Rpb25zXG4gICAqL1xuICBmaWx0ZXJCeVJvdGF0aW9uKFxuICAgIG9wdGlvbnM6IFBpY3RvZ3JhcGhEYXRhW10sXG4gICAgYmx1ZVJvdGF0aW9uRGlyZWN0aW9uOiBzdHJpbmcsXG4gICAgcmVkUm90YXRpb25EaXJlY3Rpb246IHN0cmluZ1xuICApOiBQaWN0b2dyYXBoRGF0YVtdIHtcbiAgICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4ge1xuICAgICAgbGV0IG1hdGNoZXMgPSB0cnVlO1xuXG4gICAgICAvLyBDaGVjayBibHVlIHJvdGF0aW9uIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKGJsdWVSb3RhdGlvbkRpcmVjdGlvbiAmJiBibHVlUm90YXRpb25EaXJlY3Rpb24gIT09IFwiYW55XCIpIHtcbiAgICAgICAgY29uc3QgYmx1ZVJvdGF0aW9uID0gb3B0aW9uLm1vdGlvbnM/LmJsdWU/LnJvdGF0aW9uRGlyZWN0aW9uXG4gICAgICAgICAgPy50b1N0cmluZygpXG4gICAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHRhcmdldEJsdWVSb3RhdGlvbiA9IGJsdWVSb3RhdGlvbkRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBtYXRjaGVzID0gbWF0Y2hlcyAmJiBibHVlUm90YXRpb24gPT09IHRhcmdldEJsdWVSb3RhdGlvbjtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcmVkIHJvdGF0aW9uIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKHJlZFJvdGF0aW9uRGlyZWN0aW9uICYmIHJlZFJvdGF0aW9uRGlyZWN0aW9uICE9PSBcImFueVwiKSB7XG4gICAgICAgIGNvbnN0IHJlZFJvdGF0aW9uID0gb3B0aW9uLm1vdGlvbnM/LnJlZD8ucm90YXRpb25EaXJlY3Rpb25cbiAgICAgICAgICA/LnRvU3RyaW5nKClcbiAgICAgICAgICAudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0UmVkUm90YXRpb24gPSByZWRSb3RhdGlvbkRpcmVjdGlvbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBtYXRjaGVzID0gbWF0Y2hlcyAmJiByZWRSb3RhdGlvbiA9PT0gdGFyZ2V0UmVkUm90YXRpb247XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtYXRjaGVzO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbHRlciBvcHRpb25zIGJ5IG11bHRpcGxlIGNyaXRlcmlhIHdpdGggZGV0YWlsZWQgcmVzdWx0XG4gICAqL1xuICBmaWx0ZXJCeUNyaXRlcmlhKFxuICAgIG9wdGlvbnM6IFBpY3RvZ3JhcGhEYXRhW10sXG4gICAgY3JpdGVyaWE6IEZpbHRlckNyaXRlcmlhXG4gICk6IEZpbHRlclJlc3VsdCB7XG4gICAgbGV0IGZpbHRlcmVkID0gWy4uLm9wdGlvbnNdO1xuICAgIGNvbnN0IGFwcGxpZWRGaWx0ZXJzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHRvdGFsT3JpZ2luYWwgPSBvcHRpb25zLmxlbmd0aDtcblxuICAgIC8vIEFwcGx5IHN0YXJ0IHBvc2l0aW9uIGZpbHRlclxuICAgIGlmIChjcml0ZXJpYS5zdGFydFBvc2l0aW9uKSB7XG4gICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlTdGFydFBvc2l0aW9uKGZpbHRlcmVkLCBjcml0ZXJpYS5zdGFydFBvc2l0aW9uKTtcbiAgICAgIGFwcGxpZWRGaWx0ZXJzLnB1c2goYHN0YXJ0UG9zaXRpb246ICR7Y3JpdGVyaWEuc3RhcnRQb3NpdGlvbn1gKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBlbmQgcG9zaXRpb24gZmlsdGVyXG4gICAgaWYgKGNyaXRlcmlhLmVuZFBvc2l0aW9uKSB7XG4gICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlFbmRQb3NpdGlvbihmaWx0ZXJlZCwgY3JpdGVyaWEuZW5kUG9zaXRpb24pO1xuICAgICAgYXBwbGllZEZpbHRlcnMucHVzaChgZW5kUG9zaXRpb246ICR7Y3JpdGVyaWEuZW5kUG9zaXRpb259YCk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgbGV0dGVyIHR5cGVzIGZpbHRlclxuICAgIGlmIChjcml0ZXJpYS5sZXR0ZXJUeXBlcyAmJiBjcml0ZXJpYS5sZXR0ZXJUeXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyQnlMZXR0ZXJUeXBlcyhmaWx0ZXJlZCwgY3JpdGVyaWEubGV0dGVyVHlwZXMpO1xuICAgICAgYXBwbGllZEZpbHRlcnMucHVzaChgbGV0dGVyVHlwZXM6ICR7Y3JpdGVyaWEubGV0dGVyVHlwZXMuam9pbihcIiwgXCIpfWApO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IHJvdGF0aW9uIGZpbHRlclxuICAgIGlmIChjcml0ZXJpYS5ibHVlUm90YXRpb25EaXJlY3Rpb24gfHwgY3JpdGVyaWEucmVkUm90YXRpb25EaXJlY3Rpb24pIHtcbiAgICAgIGZpbHRlcmVkID0gdGhpcy5maWx0ZXJCeVJvdGF0aW9uKFxuICAgICAgICBmaWx0ZXJlZCxcbiAgICAgICAgY3JpdGVyaWEuYmx1ZVJvdGF0aW9uRGlyZWN0aW9uIHx8IFwiXCIsXG4gICAgICAgIGNyaXRlcmlhLnJlZFJvdGF0aW9uRGlyZWN0aW9uIHx8IFwiXCJcbiAgICAgICk7XG4gICAgICBhcHBsaWVkRmlsdGVycy5wdXNoKFxuICAgICAgICBgcm90YXRpb246IGJsdWU9JHtjcml0ZXJpYS5ibHVlUm90YXRpb25EaXJlY3Rpb24gfHwgXCJhbnlcIn0sIHJlZD0ke2NyaXRlcmlhLnJlZFJvdGF0aW9uRGlyZWN0aW9uIHx8IFwiYW55XCJ9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBcHBseSBtb3Rpb24gdHlwZXMgZmlsdGVyXG4gICAgaWYgKGNyaXRlcmlhLm1vdGlvblR5cGVzICYmIGNyaXRlcmlhLm1vdGlvblR5cGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGZpbHRlcmVkID0gdGhpcy5maWx0ZXJCeU1vdGlvblR5cGVzKGZpbHRlcmVkLCBjcml0ZXJpYS5tb3Rpb25UeXBlcyk7XG4gICAgICBhcHBsaWVkRmlsdGVycy5wdXNoKGBtb3Rpb25UeXBlczogJHtjcml0ZXJpYS5tb3Rpb25UeXBlcy5qb2luKFwiLCBcIil9YCk7XG4gICAgfVxuXG4gICAgLy8gQXBwbHkgZXhjbHVkZSBsZXR0ZXJzIGZpbHRlclxuICAgIGlmIChjcml0ZXJpYS5leGNsdWRlTGV0dGVycyAmJiBjcml0ZXJpYS5leGNsdWRlTGV0dGVycy5sZW5ndGggPiAwKSB7XG4gICAgICBmaWx0ZXJlZCA9IHRoaXMuZmlsdGVyRXhjbHVkZUxldHRlcnMoZmlsdGVyZWQsIGNyaXRlcmlhLmV4Y2x1ZGVMZXR0ZXJzKTtcbiAgICAgIGFwcGxpZWRGaWx0ZXJzLnB1c2goXG4gICAgICAgIGBleGNsdWRlTGV0dGVyczogJHtjcml0ZXJpYS5leGNsdWRlTGV0dGVycy5qb2luKFwiLCBcIil9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZmlsdGVyZWQsXG4gICAgICB0b3RhbE9yaWdpbmFsLFxuICAgICAgdG90YWxGaWx0ZXJlZDogZmlsdGVyZWQubGVuZ3RoLFxuICAgICAgYXBwbGllZEZpbHRlcnMsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGVuZCBwb3NpdGlvbiBmcm9tIHRoZSBsYXN0IGJlYXQgaW4gYSBzZXF1ZW5jZVxuICAgKi9cbiAgZXh0cmFjdEVuZFBvc2l0aW9uKGxhc3RCZWF0OiBCZWF0RGF0YSk6IHN0cmluZyB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIWxhc3RCZWF0IHx8ICFsYXN0QmVhdC5waWN0b2dyYXBoRGF0YSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZW5kUG9zaXRpb24gPSBsYXN0QmVhdC5waWN0b2dyYXBoRGF0YS5lbmRQb3NpdGlvbjtcbiAgICAgIHJldHVybiBlbmRQb3NpdGlvbiA/IGVuZFBvc2l0aW9uLnRvU3RyaW5nKCkgOiBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gRmFpbGVkIHRvIGV4dHJhY3QgZW5kIHBvc2l0aW9uIGZyb20gYmVhdDpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbHRlciBieSBtb3Rpb24gdHlwZXNcbiAgICovXG4gIHByaXZhdGUgZmlsdGVyQnlNb3Rpb25UeXBlcyhcbiAgICBvcHRpb25zOiBQaWN0b2dyYXBoRGF0YVtdLFxuICAgIG1vdGlvblR5cGVzOiBzdHJpbmdbXVxuICApOiBQaWN0b2dyYXBoRGF0YVtdIHtcbiAgICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4ge1xuICAgICAgY29uc3QgYmx1ZU1vdGlvblR5cGUgPSBvcHRpb24ubW90aW9ucz8uYmx1ZT8ubW90aW9uVHlwZVxuICAgICAgICA/LnRvU3RyaW5nKClcbiAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG4gICAgICBjb25zdCByZWRNb3Rpb25UeXBlID0gb3B0aW9uLm1vdGlvbnM/LnJlZD8ubW90aW9uVHlwZVxuICAgICAgICA/LnRvU3RyaW5nKClcbiAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRNb3Rpb25UeXBlcyA9IG1vdGlvblR5cGVzLm1hcCgobXQpID0+IG10LnRvTG93ZXJDYXNlKCkpO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICBub3JtYWxpemVkTW90aW9uVHlwZXMuaW5jbHVkZXMoYmx1ZU1vdGlvblR5cGUgfHwgXCJcIikgfHxcbiAgICAgICAgbm9ybWFsaXplZE1vdGlvblR5cGVzLmluY2x1ZGVzKHJlZE1vdGlvblR5cGUgfHwgXCJcIilcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIHRvIGV4Y2x1ZGUgc3BlY2lmaWMgbGV0dGVyc1xuICAgKi9cbiAgcHJpdmF0ZSBmaWx0ZXJFeGNsdWRlTGV0dGVycyhcbiAgICBvcHRpb25zOiBQaWN0b2dyYXBoRGF0YVtdLFxuICAgIGV4Y2x1ZGVMZXR0ZXJzOiBzdHJpbmdbXVxuICApOiBQaWN0b2dyYXBoRGF0YVtdIHtcbiAgICByZXR1cm4gb3B0aW9ucy5maWx0ZXIoKG9wdGlvbikgPT4ge1xuICAgICAgcmV0dXJuICFleGNsdWRlTGV0dGVycy5pbmNsdWRlcyhvcHRpb24ubGV0dGVyIHx8IFwiXCIpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBmaWx0ZXJpbmcgc3RhdGlzdGljcyBmb3IgZGVidWdnaW5nXG4gICAqL1xuICBnZXRGaWx0ZXJpbmdTdGF0cyhcbiAgICBvcmlnaW5hbE9wdGlvbnM6IFBpY3RvZ3JhcGhEYXRhW10sXG4gICAgY3JpdGVyaWE6IEZpbHRlckNyaXRlcmlhXG4gICk6IHtcbiAgICBvcmlnaW5hbENvdW50OiBudW1iZXI7XG4gICAgYWZ0ZXJFYWNoRmlsdGVyOiBBcnJheTx7XG4gICAgICBmaWx0ZXJOYW1lOiBzdHJpbmc7XG4gICAgICBjb3VudDogbnVtYmVyO1xuICAgICAgY3JpdGVyaWE6IHN0cmluZztcbiAgICB9PjtcbiAgICBmaW5hbENvdW50OiBudW1iZXI7XG4gIH0ge1xuICAgIGxldCBjdXJyZW50ID0gWy4uLm9yaWdpbmFsT3B0aW9uc107XG4gICAgY29uc3QgYWZ0ZXJFYWNoRmlsdGVyOiBBcnJheTx7XG4gICAgICBmaWx0ZXJOYW1lOiBzdHJpbmc7XG4gICAgICBjb3VudDogbnVtYmVyO1xuICAgICAgY3JpdGVyaWE6IHN0cmluZztcbiAgICB9PiA9IFtdO1xuXG4gICAgLy8gVHJhY2sgZWFjaCBmaWx0ZXIgc3RlcFxuICAgIGlmIChjcml0ZXJpYS5zdGFydFBvc2l0aW9uKSB7XG4gICAgICBjdXJyZW50ID0gdGhpcy5maWx0ZXJCeVN0YXJ0UG9zaXRpb24oY3VycmVudCwgY3JpdGVyaWEuc3RhcnRQb3NpdGlvbik7XG4gICAgICBhZnRlckVhY2hGaWx0ZXIucHVzaCh7XG4gICAgICAgIGZpbHRlck5hbWU6IFwic3RhcnRQb3NpdGlvblwiLFxuICAgICAgICBjb3VudDogY3VycmVudC5sZW5ndGgsXG4gICAgICAgIGNyaXRlcmlhOiBjcml0ZXJpYS5zdGFydFBvc2l0aW9uLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGNyaXRlcmlhLmVuZFBvc2l0aW9uKSB7XG4gICAgICBjdXJyZW50ID0gdGhpcy5maWx0ZXJCeUVuZFBvc2l0aW9uKGN1cnJlbnQsIGNyaXRlcmlhLmVuZFBvc2l0aW9uKTtcbiAgICAgIGFmdGVyRWFjaEZpbHRlci5wdXNoKHtcbiAgICAgICAgZmlsdGVyTmFtZTogXCJlbmRQb3NpdGlvblwiLFxuICAgICAgICBjb3VudDogY3VycmVudC5sZW5ndGgsXG4gICAgICAgIGNyaXRlcmlhOiBjcml0ZXJpYS5lbmRQb3NpdGlvbixcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChjcml0ZXJpYS5sZXR0ZXJUeXBlcyAmJiBjcml0ZXJpYS5sZXR0ZXJUeXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICBjdXJyZW50ID0gdGhpcy5maWx0ZXJCeUxldHRlclR5cGVzKGN1cnJlbnQsIGNyaXRlcmlhLmxldHRlclR5cGVzKTtcbiAgICAgIGFmdGVyRWFjaEZpbHRlci5wdXNoKHtcbiAgICAgICAgZmlsdGVyTmFtZTogXCJsZXR0ZXJUeXBlc1wiLFxuICAgICAgICBjb3VudDogY3VycmVudC5sZW5ndGgsXG4gICAgICAgIGNyaXRlcmlhOiBjcml0ZXJpYS5sZXR0ZXJUeXBlcy5qb2luKFwiLCBcIiksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3JpZ2luYWxDb3VudDogb3JpZ2luYWxPcHRpb25zLmxlbmd0aCxcbiAgICAgIGFmdGVyRWFjaEZpbHRlcixcbiAgICAgIGZpbmFsQ291bnQ6IGN1cnJlbnQubGVuZ3RoLFxuICAgIH07XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICJBQXNETyxhQUFNLHVCQUEwRDtBQUFBLEVBQ3JFLFlBQW9CLG9CQUF5QztBQUF6QztBQUFBLEVBQTBDO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLOUQsc0JBQ0UsU0FDQSxlQUNrQjtBQUNsQixRQUFJLENBQUMsY0FBZSxRQUFPO0FBRTNCLFdBQU8sUUFBUSxPQUFPLENBQUMsV0FBVztBQUNoQyxZQUFNLGlCQUFpQixPQUFPLGVBQWUsU0FBUyxFQUFFLFlBQVk7QUFDcEUsWUFBTSxpQkFBaUIsY0FBYyxZQUFZO0FBQ2pELGFBQU8sbUJBQW1CO0FBQUEsSUFDNUIsQ0FBQztBQUFBLEVBQ0g7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLG9CQUNFLFNBQ0EsYUFDa0I7QUFDbEIsUUFBSSxDQUFDLFlBQWEsUUFBTztBQUV6QixXQUFPLFFBQVEsT0FBTyxDQUFDLFdBQVc7QUFDaEMsWUFBTSxlQUFlLE9BQU8sYUFBYSxTQUFTLEVBQUUsWUFBWTtBQUNoRSxZQUFNLGVBQWUsWUFBWSxZQUFZO0FBQzdDLGFBQU8saUJBQWlCO0FBQUEsSUFDMUIsQ0FBQztBQUFBLEVBQ0g7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLG9CQUNFLFNBQ0Es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
