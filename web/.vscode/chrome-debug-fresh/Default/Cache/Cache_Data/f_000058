import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/lib/components/MainApplication.svelte");import "/node_modules/.vite/deps/svelte_internal_disclose-version.js?v=608ae08a";

MainApplication[$.FILENAME] = 'src/lib/components/MainApplication.svelte';

import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=608ae08a";
import { resolve } from "/src/lib/services/bootstrap.ts";
import { getContext, onMount } from "/node_modules/.vite/deps/svelte.js?v=608ae08a";

import {
	getInitializationError,
	getInitializationProgress,
	getIsInitialized,
	getShowSettings,
	hideSettingsDialog,
	restoreApplicationState,
	setInitializationError,
	setInitializationProgress,
	setInitializationState,
	showSettingsDialog,
	switchTab,
	updateSettings
} from "/src/lib/state/app-state.svelte.ts";

import ErrorScreen from "/src/lib/components/ErrorScreen.svelte";
import LoadingScreen from "/src/lib/components/LoadingScreen.svelte";
import MainInterface from "/src/lib/components/MainInterface.svelte";
import SettingsDialog from "/src/lib/components/SettingsDialog.svelte";

var root_1 = $.add_locations($.from_html(`<meta name="description" content="The Kinetic Alphabet is a revolutionary flow arts choreography toolbox for staffs, fans, and other flow arts. Create, learn, and share movement sequences." class="s-1i_X2rlPKuIr"/>`), MainApplication[$.FILENAME], [[127, 2]]);
var root_5 = $.add_locations($.from_html(`<!> <!>`, 1), MainApplication[$.FILENAME], []);
var root = $.add_locations($.from_html(`<div class="tka-app s-1i_X2rlPKuIr" data-testid="tka-application"><!></div>`), MainApplication[$.FILENAME], [[134, 0]]);

function MainApplication($$anchor, $$props) {
	$.check_target(new.target);
	$.push($$props, true, MainApplication);

	const getContainer = getContext("di-container");
	let initService = $.tag($.state(null), 'initService');
	let settingsService = $.tag($.state(null), 'settingsService');
	let sequenceService = $.tag($.state(null), 'sequenceService');
	let deviceService = $.tag($.state(null), 'deviceService');
	let servicesResolved = $.tag($.state(false), 'servicesResolved');
	let isInitialized = $.tag($.derived(getIsInitialized), 'isInitialized');
	let initializationError = $.tag($.derived(getInitializationError), 'initializationError');
	let initializationProgress = $.tag($.derived(getInitializationProgress), 'initializationProgress');

	$.user_effect(() => {
		const container = getContainer?.();

		if (container && !$.get(servicesResolved)) {
			try {
				$.set(initService, resolve("IApplicationInitializationService"), true);
				$.set(settingsService, resolve("ISettingsService"), true);
				$.set(sequenceService, resolve("ISequenceService"), true);
				$.set(deviceService, resolve("IDeviceDetectionService"), true);
				$.set(servicesResolved, true);
			} catch(error) {
				console.error(...$.log_if_contains_state('error', "Failed to resolve services:", error));
				setInitializationError(`Service resolution failed: ${error}`);
			}
		}
	});

	onMount(async () => {
		const container = getContainer?.();

		if (!container) {
			setInitializationError("No DI container available");

			return;
		}

		let attempts = 0;

		while (!$.get(servicesResolved) && attempts < 10) {
			(await $.track_reactivity_loss(new Promise((resolve2) => setTimeout(resolve2, 100))))();
			attempts++;
		}

		if (!$.get(servicesResolved) || !$.get(initService) || !$.get(settingsService) || !$.get(sequenceService) || !$.get(deviceService)) {
			setInitializationError("Failed to resolve required services");

			return;
		}

		try {
			setInitializationState(false, true, null, 0);
			setInitializationProgress(20);
			(await $.track_reactivity_loss($.get(initService).initialize()))();
			setInitializationProgress(40);
			(await $.track_reactivity_loss($.get(settingsService).loadSettings()))();
			updateSettings($.get(settingsService).currentSettings);
			setInitializationProgress(50);
			setInitializationProgress(70);
			setInitializationProgress(85);
			(await $.track_reactivity_loss(restoreApplicationState()))();
			setInitializationProgress(100);
			setInitializationState(true, false, null, 100);
		} catch(error) {
			console.error(...$.log_if_contains_state('error', "\u274C Application initialization failed:", error));
			setInitializationError(error instanceof Error ? error.message : "Unknown initialization error");
		}
	});

	$.user_effect(() => {
		function handleKeydown(event) {
			if ((event.ctrlKey || event.metaKey) && $.strict_equals(event.key, ",")) {
				event.preventDefault();

				if (getShowSettings()) {
					hideSettingsDialog();
				} else {
					showSettingsDialog();
				}
			}

			if (event.ctrlKey || event.metaKey) {
				switch (event.key) {
					case "1":
						event.preventDefault();
						switchTab("construct");
						break;

					case "2":
						event.preventDefault();
						switchTab("browse");
						break;

					case "3":
						event.preventDefault();
						switchTab("sequence_card");
						break;

					case "4":
						event.preventDefault();
						switchTab("write");
						break;

					case "5":
						event.preventDefault();
						switchTab("learn");
						break;

					case "6":
						event.preventDefault();
						switchTab("motion-tester");
						break;
				}
			}
		}

		document.addEventListener("keydown", handleKeydown);

		return () => document.removeEventListener("keydown", handleKeydown);
	});

	var div = root();

	$.head(($$anchor) => {
		var meta = root_1();

		$.document.title = 'TKA Constructor - The Kinetic Alphabet';
		$.append($$anchor, meta);
	});

	var node = $.child(div);

	{
		var consequent = ($$anchor) => {
			var fragment = $.comment();
			var node_1 = $.first_child(fragment);

			$.add_svelte_meta(
				() => ErrorScreen(node_1, {
					get error() {
						return $.get(initializationError);
					},

					onRetry: () => window.location.reload()
				}),
				'component',
				MainApplication,
				136,
				4,
				{ componentTag: 'ErrorScreen' }
			);

			$.append($$anchor, fragment);
		};

		var alternate_1 = ($$anchor) => {
			var fragment_1 = $.comment();
			var node_2 = $.first_child(fragment_1);

			{
				var consequent_1 = ($$anchor) => {
					var fragment_2 = $.comment();
					var node_3 = $.first_child(fragment_2);

					$.add_svelte_meta(
						() => LoadingScreen(node_3, {
							get progress() {
								return $.get(initializationProgress);
							},

							message: 'Initializing Constructor...'
						}),
						'component',
						MainApplication,
						141,
						4,
						{ componentTag: 'LoadingScreen' }
					);

					$.append($$anchor, fragment_2);
				};

				var alternate = ($$anchor) => {
					var fragment_3 = root_5();
					var node_4 = $.first_child(fragment_3);

					$.add_svelte_meta(() => MainInterface(node_4, {}), 'component', MainApplication, 147, 4, { componentTag: 'MainInterface' });

					var node_5 = $.sibling(node_4, 2);

					{
						var consequent_2 = ($$anchor) => {
							var fragment_4 = $.comment();
							var node_6 = $.first_child(fragment_4);

							$.add_svelte_meta(() => SettingsDialog(node_6, {}), 'component', MainApplication, 151, 6, { componentTag: 'SettingsDialog' });
							$.append($$anchor, fragment_4);
						};

						$.add_svelte_meta(
							() => $.if(node_5, ($$render) => {
								if (getShowSettings()) $$render(consequent_2);
							}),
							'if',
							MainApplication,
							150,
							4
						);
					}

					$.append($$anchor, fragment_3);
				};

				$.add_svelte_meta(
					() => $.if(
						node_2,
						($$render) => {
							if (!$.get(isInitialized)) $$render(consequent_1); else $$render(alternate, false);
						},
						true
					),
					'if',
					MainApplication,
					140,
					2
				);
			}

			$.append($$anchor, fragment_1);
		};

		$.add_svelte_meta(
			() => $.if(node, ($$render) => {
				if ($.get(initializationError)) $$render(consequent); else $$render(alternate_1, false);
			}),
			'if',
			MainApplication,
			135,
			2
		);
	}

	$.reset(div);
	$.append($$anchor, div);

	return $.pop({ ...$.legacy_api() });
}

if (import.meta.hot) {
	MainApplication = $.hmr(MainApplication, () => MainApplication[$.HMR].source);

	import.meta.hot.acceptExports(["default"],(module) => {
		$.cleanup_styles('s-1i_X2rlPKuIr');
		module.default[$.HMR].source = MainApplication[$.HMR].source;
		$.set(MainApplication[$.HMR].source, module.default[$.HMR].original);
	});
}

export default MainApplication;
import "/src/lib/components/MainApplication.svelte?svelte&type=style&lang.css";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7U0FVVyxlQUFZO1NBU25COzs7Q0FHQTtDQUNBO0NBQ0E7Q0FBQTtDQUdGO0NBQ0E7Q0FDQTtDQUNBO0NBR0E7Q0FJSTtDQUNBO0NBQ0E7T0FDQTs7T0FJQSxpQkFBZ0I7T0FDaEIsbUJBQXNCO09BQ3RCO09BR0ksb0JBQU07Ozs7Ozs0Q0FqRGhCLENBQUM7Ozs7T0FvRFMsZUFFRixXQUFzQjtLQUd0Qiw0QkFBaUQ7S0FFakQsZ0NBQW1CO0tBQ3JCLGdDQUFnQjtLQUNkLDhCQUFrRDtLQUNsRCxpQ0FBdUI7S0FHNUI7S0FHRCxzQ0FBb0I7S0FDbEIseUNBQWlDOztDQUcvQjtRQUNGOztNQUdJLG9CQUFXO09BQ1A7VUFFTjtVQUNGO1VBR0cseUJBQ0Esa0JBQ0E7VUFJRCx1QkFBdUI7VUFFekI7R0FFSTtJQUNGLGlGQUEyQztJQUczQyxxREFBNEI7R0FDNUI7RUFHQTtDQUNBOztDQU9BO1FBSUE7O09BQ0EsV0FBTTtHQUdOLGtEQUE2Qjs7O0VBRS9COztNQUdJOztnQkFDRjtzQ0FDRixTQUFBQSxhQUFBLFdBQUFBLFVBQUE7R0FDRDtFQUdEOzthQUlNLDRCQUNBLHVCQUNFLDJCQUNGLDJCQUNFLGdCQUNGO0dBQ0Y7OztFQUlFOztNQUVJO0dBQ0EsdUJBQVUsT0FBVztHQUdyQiwwQkFBcUI7d0NBQ3JCLGFBQVU7R0FHViwwQkFBcUI7d0NBQ3JCLGlCQUFVO0dBQ1Y7R0FHQSwwQkFBaUI7R0FHakIsMEJBQXFCO0dBSXJCLDBCQUFxQjtrQ0FDckI7R0FHTjtHQUNGO0VBRUEsUUFBUztHQUNULFFBQU8sMENBQU0sNkNBQXdDO0dBQ3RELHVCQUNLO0VBRVA7Q0FDQyxDQUFDOztDQUdILG9CQUFnQjtXQUNiOztJQUdFOztRQUNPLG1CQUFjO0tBQ25CO0lBQ0Y7S0FDQztJQUNBO0dBQ0Q7O09BR0MsTUFBVSwwQkFBc0I7WUFDdkI7VUFDVjtNQUNHO01BQ0MsVUFBSyxXQUFZOzs7O01BR2pCLE1BQVM7TUFDVCxrQkFBaUI7OztVQUVsQjtNQUNGO01BQ0Q7OztVQUVDO01BQ0s7TUFDQyxVQUFLOzs7VUFFRjtNQUNKLE1BQUk7TUFDSCxVQUFVOzs7VUFFUDtNQUNYLE1BQVk7TUFDTCxVQUFXLGVBQWU7OztHQUduQzs7O0VBR0MsU0FBVSxpQkFBZTs7ZUFDZjtDQUNiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7bUJBZWEsbUJBQVk7OztvQkFDTCxNQUFLOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7cUJBSWQsc0JBQVE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2tCQUZqQjs7Ozs7Ozs7Ozs7Ozs7OztjQUxDLG1CQUF1Qjs7Ozs7Ozs7Ozs7OztDQVoxQiIsIm5hbWVzIjpbInJlc29sdmUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiTWFpbkFwcGxpY2F0aW9uLnN2ZWx0ZSJdLCJzb3VyY2VzQ29udGVudCI6WyI8IS0tIE1haW4gQXBwbGljYXRpb24gTGF5b3V0IC0tPlxuPHNjcmlwdCBsYW5nPVwidHNcIj5cbiAgaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gXCIkc2VydmljZXMvYm9vdHN0cmFwXCI7XG4gIGltcG9ydCB0eXBlIHsgU2VydmljZUNvbnRhaW5lciB9IGZyb20gXCIkc2VydmljZXMvZGkvU2VydmljZUNvbnRhaW5lclwiO1xuICBpbXBvcnQgdHlwZSB7XG4gICAgSUFwcGxpY2F0aW9uSW5pdGlhbGl6YXRpb25TZXJ2aWNlLFxuICAgIElTZXR0aW5nc1NlcnZpY2UsXG4gIH0gZnJvbSBcIiRzZXJ2aWNlcy9pbnRlcmZhY2VzL2FwcGxpY2F0aW9uLWludGVyZmFjZXNcIjtcbiAgaW1wb3J0IHR5cGUgeyBJRGV2aWNlRGV0ZWN0aW9uU2VydmljZSB9IGZyb20gXCIkc2VydmljZXMvaW50ZXJmYWNlcy9kZXZpY2UtaW50ZXJmYWNlc1wiO1xuICBpbXBvcnQgdHlwZSB7IElTZXF1ZW5jZVNlcnZpY2UgfSBmcm9tIFwiJHNlcnZpY2VzL2ludGVyZmFjZXMvc2VxdWVuY2UtaW50ZXJmYWNlc1wiO1xuICBpbXBvcnQgeyBnZXRDb250ZXh0LCBvbk1vdW50IH0gZnJvbSBcInN2ZWx0ZVwiO1xuICAvLyBJbXBvcnQgYXBwIHN0YXRlIG1hbmFnZW1lbnRcbiAgaW1wb3J0IHtcbiAgICBnZXRJbml0aWFsaXphdGlvbkVycm9yLFxuICAgIGdldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MsXG4gICAgZ2V0SXNJbml0aWFsaXplZCxcbiAgICBnZXRTaG93U2V0dGluZ3MsXG4gICAgaGlkZVNldHRpbmdzRGlhbG9nLFxuICAgIHJlc3RvcmVBcHBsaWNhdGlvblN0YXRlLFxuICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IsXG4gICAgc2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcyxcbiAgICBzZXRJbml0aWFsaXphdGlvblN0YXRlLFxuICAgIHNob3dTZXR0aW5nc0RpYWxvZyxcbiAgICBzd2l0Y2hUYWIsXG4gICAgdXBkYXRlU2V0dGluZ3MsXG4gIH0gZnJvbSBcIiRsaWIvc3RhdGUvYXBwLXN0YXRlLnN2ZWx0ZVwiO1xuICAvLyBJbXBvcnQgY29tcG9uZW50c1xuICBpbXBvcnQgRXJyb3JTY3JlZW4gZnJvbSBcIiRjb21wb25lbnRzL0Vycm9yU2NyZWVuLnN2ZWx0ZVwiO1xuICBpbXBvcnQgTG9hZGluZ1NjcmVlbiBmcm9tIFwiJGNvbXBvbmVudHMvTG9hZGluZ1NjcmVlbi5zdmVsdGVcIjtcbiAgaW1wb3J0IE1haW5JbnRlcmZhY2UgZnJvbSBcIiRjb21wb25lbnRzL01haW5JbnRlcmZhY2Uuc3ZlbHRlXCI7XG4gIGltcG9ydCBTZXR0aW5nc0RpYWxvZyBmcm9tIFwiJGNvbXBvbmVudHMvU2V0dGluZ3NEaWFsb2cuc3ZlbHRlXCI7XG5cbiAgLy8gR2V0IERJIGNvbnRhaW5lciBmcm9tIGNvbnRleHRcbiAgY29uc3QgZ2V0Q29udGFpbmVyID1cbiAgICBnZXRDb250ZXh0PCgpID0+IFNlcnZpY2VDb250YWluZXIgfCBudWxsPihcImRpLWNvbnRhaW5lclwiKTtcblxuICAvLyBTZXJ2aWNlcyAtIHJlc29sdmVkIGxhemlseVxuICBsZXQgaW5pdFNlcnZpY2U6IElBcHBsaWNhdGlvbkluaXRpYWxpemF0aW9uU2VydmljZSB8IG51bGwgPSAkc3RhdGUobnVsbCk7XG4gIGxldCBzZXR0aW5nc1NlcnZpY2U6IElTZXR0aW5nc1NlcnZpY2UgfCBudWxsID0gJHN0YXRlKG51bGwpO1xuICBsZXQgc2VxdWVuY2VTZXJ2aWNlOiBJU2VxdWVuY2VTZXJ2aWNlIHwgbnVsbCA9ICRzdGF0ZShudWxsKTtcbiAgbGV0IGRldmljZVNlcnZpY2U6IElEZXZpY2VEZXRlY3Rpb25TZXJ2aWNlIHwgbnVsbCA9ICRzdGF0ZShudWxsKTtcbiAgbGV0IHNlcnZpY2VzUmVzb2x2ZWQgPSAkc3RhdGUoZmFsc2UpO1xuXG4gIC8vIEFwcCBzdGF0ZVxuICBsZXQgaXNJbml0aWFsaXplZCA9ICRkZXJpdmVkKGdldElzSW5pdGlhbGl6ZWQoKSk7XG4gIGxldCBpbml0aWFsaXphdGlvbkVycm9yID0gJGRlcml2ZWQoZ2V0SW5pdGlhbGl6YXRpb25FcnJvcigpKTtcbiAgbGV0IGluaXRpYWxpemF0aW9uUHJvZ3Jlc3MgPSAkZGVyaXZlZChnZXRJbml0aWFsaXphdGlvblByb2dyZXNzKCkpO1xuXG4gIC8vIFJlc29sdmUgc2VydmljZXMgd2hlbiBjb250YWluZXIgaXMgYXZhaWxhYmxlIC0gT05DRSBPTkxZXG4gICRlZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGdldENvbnRhaW5lcj8uKCk7XG4gICAgaWYgKGNvbnRhaW5lciAmJiAhc2VydmljZXNSZXNvbHZlZCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVXNlIHJlc29sdmUgd2hpY2ggd2lsbCB1c2UgdGhlIGdsb2JhbCBjb250YWluZXIgb25jZSBpdCdzIHJlYWR5XG4gICAgICAgIGluaXRTZXJ2aWNlID0gcmVzb2x2ZShcIklBcHBsaWNhdGlvbkluaXRpYWxpemF0aW9uU2VydmljZVwiKTtcbiAgICAgICAgc2V0dGluZ3NTZXJ2aWNlID0gcmVzb2x2ZShcIklTZXR0aW5nc1NlcnZpY2VcIik7XG4gICAgICAgIHNlcXVlbmNlU2VydmljZSA9IHJlc29sdmUoXCJJU2VxdWVuY2VTZXJ2aWNlXCIpO1xuICAgICAgICBkZXZpY2VTZXJ2aWNlID0gcmVzb2x2ZShcIklEZXZpY2VEZXRlY3Rpb25TZXJ2aWNlXCIpO1xuXG4gICAgICAgIHNlcnZpY2VzUmVzb2x2ZWQgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZXNvbHZlIHNlcnZpY2VzOlwiLCBlcnJvcik7XG4gICAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoYFNlcnZpY2UgcmVzb2x1dGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyBJbml0aWFsaXplIGFwcGxpY2F0aW9uXG4gIG9uTW91bnQoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGdldENvbnRhaW5lcj8uKCk7XG4gICAgaWYgKCFjb250YWluZXIpIHtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoXCJObyBESSBjb250YWluZXIgYXZhaWxhYmxlXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFdhaXQgZm9yIHNlcnZpY2VzIHRvIGJlIHJlc29sdmVkXG4gICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICB3aGlsZSAoIXNlcnZpY2VzUmVzb2x2ZWQgJiYgYXR0ZW1wdHMgPCAxMCkge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICBhdHRlbXB0cysrO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFzZXJ2aWNlc1Jlc29sdmVkIHx8XG4gICAgICAhaW5pdFNlcnZpY2UgfHxcbiAgICAgICFzZXR0aW5nc1NlcnZpY2UgfHxcbiAgICAgICFzZXF1ZW5jZVNlcnZpY2UgfHxcbiAgICAgICFkZXZpY2VTZXJ2aWNlXG4gICAgKSB7XG4gICAgICBzZXRJbml0aWFsaXphdGlvbkVycm9yKFwiRmFpbGVkIHRvIHJlc29sdmUgcmVxdWlyZWQgc2VydmljZXNcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uU3RhdGUoZmFsc2UsIHRydWUsIG51bGwsIDApO1xuXG4gICAgICAvLyBTdGVwIDE6IEluaXRpYWxpemUgYXBwbGljYXRpb24gc2VydmljZXNcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoMjApO1xuICAgICAgYXdhaXQgaW5pdFNlcnZpY2UuaW5pdGlhbGl6ZSgpO1xuXG4gICAgICAvLyBTdGVwIDI6IExvYWQgc2V0dGluZ3NcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoNDApO1xuICAgICAgYXdhaXQgc2V0dGluZ3NTZXJ2aWNlLmxvYWRTZXR0aW5ncygpO1xuICAgICAgdXBkYXRlU2V0dGluZ3Moc2V0dGluZ3NTZXJ2aWNlLmN1cnJlbnRTZXR0aW5ncyk7XG5cbiAgICAgIC8vIFN0ZXAgMzogSW5pdGlhbGl6ZSBkZXZpY2UgZGV0ZWN0aW9uXG4gICAgICBzZXRJbml0aWFsaXphdGlvblByb2dyZXNzKDUwKTtcblxuICAgICAgLy8gU3RlcCA0OiBMb2FkIGluaXRpYWwgZGF0YVxuICAgICAgc2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcyg3MCk7XG4gICAgICAvLyBUT0RPOiBJbmRpdmlkdWFsIGNvbXBvbmVudHMgc2hvdWxkIGxvYWQgdGhlaXIgb3duIGRhdGEgYXMgbmVlZGVkXG5cbiAgICAgIC8vIFN0ZXAgNTogUmVzdG9yZSBhcHBsaWNhdGlvbiBzdGF0ZSAodGFiIG1lbW9yeSlcbiAgICAgIHNldEluaXRpYWxpemF0aW9uUHJvZ3Jlc3MoODUpO1xuICAgICAgYXdhaXQgcmVzdG9yZUFwcGxpY2F0aW9uU3RhdGUoKTtcblxuICAgICAgLy8gU3RlcCA2OiBDb21wbGV0ZSBpbml0aWFsaXphdGlvblxuICAgICAgc2V0SW5pdGlhbGl6YXRpb25Qcm9ncmVzcygxMDApO1xuICAgICAgc2V0SW5pdGlhbGl6YXRpb25TdGF0ZSh0cnVlLCBmYWxzZSwgbnVsbCwgMTAwKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBBcHBsaWNhdGlvbiBpbml0aWFsaXphdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHNldEluaXRpYWxpemF0aW9uRXJyb3IoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGluaXRpYWxpemF0aW9uIGVycm9yXCJcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvLyBIYW5kbGUga2V5Ym9hcmQgc2hvcnRjdXRzXG4gICRlZmZlY3QoKCkgPT4ge1xuICAgIGZ1bmN0aW9uIGhhbmRsZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAgIC8vIFNldHRpbmdzIGRpYWxvZyB0b2dnbGUgKEN0cmwvQ21kICsgLClcbiAgICAgIGlmICgoZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5KSAmJiBldmVudC5rZXkgPT09IFwiLFwiKSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmIChnZXRTaG93U2V0dGluZ3MoKSkge1xuICAgICAgICAgIGhpZGVTZXR0aW5nc0RpYWxvZygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNob3dTZXR0aW5nc0RpYWxvZygpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRhYiBuYXZpZ2F0aW9uIChDdHJsL0NtZCArIDEtNSlcbiAgICAgIGlmIChldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpIHtcbiAgICAgICAgc3dpdGNoIChldmVudC5rZXkpIHtcbiAgICAgICAgICBjYXNlIFwiMVwiOlxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN3aXRjaFRhYihcImNvbnN0cnVjdFwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCIyXCI6XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3dpdGNoVGFiKFwiYnJvd3NlXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIjNcIjpcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBzd2l0Y2hUYWIoXCJzZXF1ZW5jZV9jYXJkXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIjRcIjpcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBzd2l0Y2hUYWIoXCJ3cml0ZVwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCI1XCI6XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgc3dpdGNoVGFiKFwibGVhcm5cIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwiNlwiOlxuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIHN3aXRjaFRhYihcIm1vdGlvbi10ZXN0ZXJcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUtleWRvd24pO1xuICAgIHJldHVybiAoKSA9PiBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVLZXlkb3duKTtcbiAgfSk7XG48L3NjcmlwdD5cblxuPHN2ZWx0ZTpoZWFkPlxuICA8dGl0bGU+VEtBIENvbnN0cnVjdG9yIC0gVGhlIEtpbmV0aWMgQWxwaGFiZXQ8L3RpdGxlPlxuICA8bWV0YVxuICAgIG5hbWU9XCJkZXNjcmlwdGlvblwiXG4gICAgY29udGVudD1cIlRoZSBLaW5ldGljIEFscGhhYmV0IGlzIGEgcmV2b2x1dGlvbmFyeSBmbG93IGFydHMgY2hvcmVvZ3JhcGh5IHRvb2xib3ggZm9yIHN0YWZmcywgZmFucywgYW5kIG90aGVyIGZsb3cgYXJ0cy4gQ3JlYXRlLCBsZWFybiwgYW5kIHNoYXJlIG1vdmVtZW50IHNlcXVlbmNlcy5cIlxuICAvPlxuPC9zdmVsdGU6aGVhZD5cblxuPCEtLSBBcHBsaWNhdGlvbiBDb250YWluZXIgLS0+XG48ZGl2IGNsYXNzPVwidGthLWFwcFwiIGRhdGEtdGVzdGlkPVwidGthLWFwcGxpY2F0aW9uXCI+XG4gIHsjaWYgaW5pdGlhbGl6YXRpb25FcnJvcn1cbiAgICA8RXJyb3JTY3JlZW5cbiAgICAgIGVycm9yPXtpbml0aWFsaXphdGlvbkVycm9yfVxuICAgICAgb25SZXRyeT17KCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpfVxuICAgIC8+XG4gIHs6ZWxzZSBpZiAhaXNJbml0aWFsaXplZH1cbiAgICA8TG9hZGluZ1NjcmVlblxuICAgICAgcHJvZ3Jlc3M9e2luaXRpYWxpemF0aW9uUHJvZ3Jlc3N9XG4gICAgICBtZXNzYWdlPVwiSW5pdGlhbGl6aW5nIENvbnN0cnVjdG9yLi4uXCJcbiAgICAvPlxuICB7OmVsc2V9XG4gICAgPCEtLSBNYWluIEludGVyZmFjZSAtLT5cbiAgICA8TWFpbkludGVyZmFjZSAvPlxuXG4gICAgPCEtLSBTZXR0aW5ncyBkaWFsb2cgLS0+XG4gICAgeyNpZiBnZXRTaG93U2V0dGluZ3MoKX1cbiAgICAgIDxTZXR0aW5nc0RpYWxvZyAvPlxuICAgIHsvaWZ9XG4gIHsvaWZ9XG48L2Rpdj5cblxuPHN0eWxlPlxuICAudGthLWFwcCB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgIG1pbi1oZWlnaHQ6IDEwMHZoO1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2U7XG4gICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XG4gICAgLS10ZXh0LWNvbG9yOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOTUpO1xuICAgIC0tZm9yZWdyb3VuZDogcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjk1KTtcbiAgICAtLW11dGVkLWZvcmVncm91bmQ6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC43KTtcbiAgfVxuXG4gIC8qIFJlc3BvbnNpdmUgYWRqdXN0bWVudHMgKi9cbiAgQG1lZGlhIChtYXgtd2lkdGg6IDc2OHB4KSB7XG4gICAgLnRrYS1hcHAge1xuICAgICAgLyogRHluYW1pYyB2aWV3cG9ydCBoZWlnaHQgZm9yIG1vYmlsZSBhcHAgKi9cbiAgICAgIG1pbi1oZWlnaHQ6IDEwMGR2aDtcbiAgICB9XG4gIH1cblxuICAvKiBSZWR1Y2VkIG1vdGlvbiBzdXBwb3J0ICovXG4gIEBtZWRpYSAocHJlZmVycy1yZWR1Y2VkLW1vdGlvbjogcmVkdWNlKSB7XG4gICAgLnRrYS1hcHAge1xuICAgICAgdHJhbnNpdGlvbjogbm9uZTtcbiAgICB9XG4gIH1cblxuICAvKiBIaWdoIGNvbnRyYXN0IG1vZGUgKi9cbiAgQG1lZGlhIChwcmVmZXJzLWNvbnRyYXN0OiBoaWdoKSB7XG4gICAgLnRrYS1hcHAge1xuICAgICAgLS10ZXh0LWNvbG9yOiB3aGl0ZTtcbiAgICAgIC0tZm9yZWdyb3VuZDogd2hpdGU7XG4gICAgfVxuICB9XG5cbiAgLyogUHJpbnQgc3R5bGVzICovXG4gIEBtZWRpYSBwcmludCB7XG4gICAgLnRrYS1hcHAge1xuICAgICAgbWluLWhlaWdodDogYXV0bztcbiAgICAgIG92ZXJmbG93OiB2aXNpYmxlO1xuICAgIH1cbiAgfVxuPC9zdHlsZT5cbiJdLCJmaWxlIjoiQzovVEtBL3dlYi9zcmMvbGliL2NvbXBvbmVudHMvTWFpbkFwcGxpY2F0aW9uLnN2ZWx0ZSJ9