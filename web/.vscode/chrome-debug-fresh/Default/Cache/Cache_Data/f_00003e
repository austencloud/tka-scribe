import { createSequenceData } from "/src/lib/domain/index.ts";
import { GridMode, PropType, GridPositionGroup } from "/src/lib/domain/enums.ts";
export class SequenceIndexService {
  sequenceIndex = null;
  searchIndex = null;
  sequenceMap = /* @__PURE__ */ new Map();
  async loadSequenceIndex() {
    if (this.sequenceIndex !== null) {
      return this.sequenceIndex;
    }
    try {
      if (this.sequenceIndex === null) {
        this.sequenceIndex = await this.scanSequenceDirectory();
      }
      if (this.sequenceIndex) {
        await this.buildSearchIndex(this.sequenceIndex);
      }
      return this.sequenceIndex || [];
    } catch (error) {
      console.error("Failed to load sequence index:", error);
      this.sequenceIndex = [];
      return [];
    }
  }
  async buildSearchIndex(sequences) {
    this.searchIndex = {
      wordIndex: /* @__PURE__ */ new Map(),
      authorIndex: /* @__PURE__ */ new Map(),
      tagIndex: /* @__PURE__ */ new Map(),
      metadataIndex: /* @__PURE__ */ new Map()
    };
    this.sequenceMap.clear();
    for (const sequence of sequences) {
      this.sequenceMap.set(sequence.id, sequence);
      this.addToIndex(
        this.searchIndex.wordIndex,
        sequence.word.toLowerCase(),
        sequence.id
      );
      this.addToIndex(
        this.searchIndex.wordIndex,
        sequence.name.toLowerCase(),
        sequence.id
      );
      if (sequence.author) {
        this.addToIndex(
          this.searchIndex.authorIndex,
          sequence.author.toLowerCase(),
          sequence.id
        );
      }
      for (const tag of sequence.tags) {
        this.addToIndex(
          this.searchIndex.tagIndex,
          tag.toLowerCase(),
          sequence.id
        );
      }
      const searchableText = this.buildSearchableText(sequence);
      for (const term of searchableText.split(/\s+/)) {
        if (term.length > 2) {
          this.addToIndex(
            this.searchIndex.metadataIndex,
            term.toLowerCase(),
            sequence.id
          );
        }
      }
    }
  }
  async searchSequences(query) {
    if (!this.searchIndex || !query.trim()) {
      return this.sequenceIndex || [];
    }
    const searchTerms = query.toLowerCase().split(/\s+/).filter((term) => term.length > 0);
    const resultIds = /* @__PURE__ */ new Set();
    for (const term of searchTerms) {
      const matchingIds = this.searchTerm(term);
      if (resultIds.size === 0) {
        matchingIds.forEach((id) => resultIds.add(id));
      } else {
        const currentIds = new Set(resultIds);
        resultIds.clear();
        matchingIds.forEach((id) => {
          if (currentIds.has(id)) {
            resultIds.add(id);
          }
        });
      }
    }
    const results = Array.from(resultIds).map((id) => this.sequenceMap.get(id)).filter((seq) => seq !== void 0);
    return this.sortByRelevance(results, query);
  }
  async refreshIndex() {
    this.sequenceIndex = null;
    this.searchIndex = null;
    this.sequenceMap.clear();
    await this.loadSequenceIndex();
  }
  // Additional utility methods
  getIndexStats() {
    return {
      totalSequences: this.sequenceMap.size,
      indexedWords: this.searchIndex?.wordIndex.size || 0,
      indexedAuthors: this.searchIndex?.authorIndex.size || 0,
      indexedTags: this.searchIndex?.tagIndex.size || 0,
      indexedMetadata: this.searchIndex?.metadataIndex.size || 0
    };
  }
  async getSequenceById(id) {
    if (!this.sequenceMap.has(id)) {
      await this.loadSequenceIndex();
    }
    return this.sequenceMap.get(id) || null;
  }
  async getSuggestions(partialQuery, maxSuggestions = 10) {
    if (!this.searchIndex || partialQuery.length < 2) {
      return [];
    }
    const suggestions = /* @__PURE__ */ new Set();
    const query = partialQuery.toLowerCase();
    for (const [word] of this.searchIndex.wordIndex) {
      if (word.includes(query)) {
        suggestions.add(word);
        if (suggestions.size >= maxSuggestions) break;
      }
    }
    if (suggestions.size < maxSuggestions) {
      for (const [author] of this.searchIndex.authorIndex) {
        if (author.includes(query)) {
          suggestions.add(author);
          if (suggestions.size >= maxSuggestions) break;
        }
      }
    }
    return Array.from(suggestions).slice(0, maxSuggestions);
  }
  // Private helper methods
  addToIndex(index, key, sequenceId) {
    if (!index.has(key)) {
      index.set(key, /* @__PURE__ */ new Set());
    }
    const keySet = index.get(key);
    if (keySet) {
      keySet.add(sequenceId);
    }
  }
  searchTerm(term) {
    const results = /* @__PURE__ */ new Set();
    if (!this.searchIndex) return results;
    const wordMatches = this.searchIndex.wordIndex.get(term) || /* @__PURE__ */ new Set();
    wordMatches.forEach((id) => results.add(id));
    for (const [word, ids] of this.searchIndex.wordIndex) {
      if (word.includes(term)) {
        ids.forEach((id) => results.add(id));
      }
    }
    const authorMatches = this.searchIndex.authorIndex.get(term) || /* @__PURE__ */ new Set();
    authorMatches.forEach((id) => results.add(id));
    const tagMatches = this.searchIndex.tagIndex.get(term) || /* @__PURE__ */ new Set();
    tagMatches.forEach((id) => results.add(id));
    const metadataMatches = this.searchIndex.metadataIndex.get(term) || /* @__PURE__ */ new Set();
    metadataMatches.forEach((id) => results.add(id));
    return results;
  }
  buildSearchableText(sequence) {
    const parts = [
      sequence.word,
      sequence.name,
      sequence.author || "",
      sequence.difficultyLevel || "",
      sequence.gridMode || "",
      sequence.propType || "",
      ...sequence.tags
    ];
    return parts.filter(Boolean).join(" ");
  }
  sortByRelevance(sequences, query) {
    const queryLower = query.toLowerCase();
    return sequences.sort((a, b) => {
      const scoreA = this.calculateRelevanceScore(a, queryLower);
      const scoreB = this.calculateRelevanceScore(b, queryLower);
      return scoreB - scoreA;
    });
  }
  calculateRelevanceScore(sequence, query) {
    let score = 0;
    if (sequence.word.toLowerCase() === query) {
      score += 100;
    }
    if (sequence.word.toLowerCase().startsWith(query)) {
      score += 50;
    }
    if (sequence.word.toLowerCase().includes(query)) {
      score += 25;
    }
    if (sequence.name.toLowerCase().includes(query)) {
      score += 15;
    }
    if (sequence.author?.toLowerCase().includes(query)) {
      score += 10;
    }
    for (const tag of sequence.tags) {
      if (tag.toLowerCase().includes(query)) {
        score += 5;
      }
    }
    if (sequence.isFavorite) {
      score += 2;
    }
    return score;
  }
  async scanSequenceDirectory() {
    console.warn("Scanning directory - using fallback sample data");
    const sequences = [];
    const knownSequences = [
      "A",
      "AABB",
      "AAKE",
      "AB",
      "ABC",
      "AJEΦ-",
      "AKE",
      "AKIΦ",
      "ALFALGGF",
      "B",
      "BA",
      "BBKE",
      "BBLF",
      "BC",
      "BJEA",
      "BJFA",
      "BKEΦ-",
      "C",
      "CAKE",
      "CCCΦ-",
      "CCKE",
      "CCKΦ"
      // Add more as needed...
    ];
    for (let i = 0; i < knownSequences.length; i++) {
      const word = knownSequences[i];
      if (!word) continue;
      const authors = ["TKA User", "Demo Author", "Expert User"];
      const gridModes = [GridMode.DIAMOND, GridMode.BOX];
      const difficulties = ["beginner", "intermediate", "advanced"];
      const author = authors[i % authors.length];
      const gridMode = gridModes[i % gridModes.length];
      const difficulty = difficulties[i % difficulties.length];
      const result = createSequenceData({
        id: word,
        // ✅ FIXED: Keep uppercase to match PNG file names
        name: `${word} Sequence`,
        word,
        beats: [],
        // Empty beats for index service
        thumbnails: [`${word}_ver1.png`],
        isFavorite: Math.random() > 0.8,
        isCircular: false,
        tags: ["flow", "practice", "generated"].slice(
          0,
          Math.floor(Math.random() * 3) + 1
        ),
        metadata: { scanned: true, index: i },
        // Include all properties in the creation to avoid readonly issues
        ...author && { author },
        ...gridMode && { gridMode },
        ...difficulty && { difficultyLevel: difficulty },
        sequenceLength: Math.floor(Math.random() * 8) + 3,
        level: Math.floor(Math.random() * 4) + 1,
        dateAdded: new Date(
          Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1e3
        ),
        propType: PropType.FAN,
        startingPositionGroup: GridPositionGroup.ALPHA
      });
      sequences.push(result);
    }
    return sequences;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9zZXF1ZW5jZS9TZXF1ZW5jZUluZGV4U2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBTZXF1ZW5jZSBJbmRleCBTZXJ2aWNlIEltcGxlbWVudGF0aW9uXG4gKlxuICogSGFuZGxlcyBsb2FkaW5nLCBidWlsZGluZywgYW5kIHNlYXJjaGluZyBzZXF1ZW5jZSBpbmRpY2VzIGZvciBmYXN0IGJyb3dzZSBvcGVyYXRpb25zLlxuICogUHJvdmlkZXMgc2VhcmNoIGNhcGFiaWxpdGllcyBhY3Jvc3Mgc2VxdWVuY2UgbWV0YWRhdGEuXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBTZXF1ZW5jZURhdGEgfSBmcm9tIFwiJGxpYi9zZXJ2aWNlcy9pbnRlcmZhY2VzL2RvbWFpbi10eXBlc1wiO1xuaW1wb3J0IHsgY3JlYXRlU2VxdWVuY2VEYXRhIH0gZnJvbSBcIiRsaWIvZG9tYWluXCI7XG5pbXBvcnQgdHlwZSB7IElTZXF1ZW5jZUluZGV4U2VydmljZSB9IGZyb20gXCIkbGliL3NlcnZpY2VzL2ludGVyZmFjZXMvYnJvd3NlLWludGVyZmFjZXNcIjtcbmltcG9ydCB7IEdyaWRNb2RlLCBQcm9wVHlwZSwgR3JpZFBvc2l0aW9uR3JvdXAgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcblxuaW50ZXJmYWNlIFNlYXJjaEluZGV4IHtcbiAgd29yZEluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIHdvcmQgLT4gc2VxdWVuY2UgSURzXG4gIGF1dGhvckluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIGF1dGhvciAtPiBzZXF1ZW5jZSBJRHNcbiAgdGFnSW5kZXg6IE1hcDxzdHJpbmcsIFNldDxzdHJpbmc+PjsgLy8gdGFnIC0+IHNlcXVlbmNlIElEc1xuICBtZXRhZGF0YUluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj47IC8vIGNvbWJpbmVkIG1ldGFkYXRhIC0+IHNlcXVlbmNlIElEc1xufVxuXG5leHBvcnQgY2xhc3MgU2VxdWVuY2VJbmRleFNlcnZpY2UgaW1wbGVtZW50cyBJU2VxdWVuY2VJbmRleFNlcnZpY2Uge1xuICBwcml2YXRlIHNlcXVlbmNlSW5kZXg6IFNlcXVlbmNlRGF0YVtdIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2VhcmNoSW5kZXg6IFNlYXJjaEluZGV4IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2VxdWVuY2VNYXAgPSBuZXcgTWFwPHN0cmluZywgU2VxdWVuY2VEYXRhPigpO1xuXG4gIGFzeW5jIGxvYWRTZXF1ZW5jZUluZGV4KCk6IFByb21pc2U8U2VxdWVuY2VEYXRhW10+IHtcbiAgICBpZiAodGhpcy5zZXF1ZW5jZUluZGV4ICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXF1ZW5jZUluZGV4O1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBMb2FkIHNlcXVlbmNlcyBpZiBub3QgYWxyZWFkeSBsb2FkZWRcbiAgICAgIGlmICh0aGlzLnNlcXVlbmNlSW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gYXdhaXQgdGhpcy5zY2FuU2VxdWVuY2VEaXJlY3RvcnkoKTtcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgc2VhcmNoIGluZGV4XG4gICAgICBpZiAodGhpcy5zZXF1ZW5jZUluZGV4KSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYnVpbGRTZWFyY2hJbmRleCh0aGlzLnNlcXVlbmNlSW5kZXgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5zZXF1ZW5jZUluZGV4IHx8IFtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc2VxdWVuY2UgaW5kZXg6XCIsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBlbXB0eSBhcnJheSBhcyBmYWxsYmFja1xuICAgICAgdGhpcy5zZXF1ZW5jZUluZGV4ID0gW107XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYnVpbGRTZWFyY2hJbmRleChzZXF1ZW5jZXM6IFNlcXVlbmNlRGF0YVtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5zZWFyY2hJbmRleCA9IHtcbiAgICAgIHdvcmRJbmRleDogbmV3IE1hcCgpLFxuICAgICAgYXV0aG9ySW5kZXg6IG5ldyBNYXAoKSxcbiAgICAgIHRhZ0luZGV4OiBuZXcgTWFwKCksXG4gICAgICBtZXRhZGF0YUluZGV4OiBuZXcgTWFwKCksXG4gICAgfTtcblxuICAgIHRoaXMuc2VxdWVuY2VNYXAuY2xlYXIoKTtcblxuICAgIGZvciAoY29uc3Qgc2VxdWVuY2Ugb2Ygc2VxdWVuY2VzKSB7XG4gICAgICB0aGlzLnNlcXVlbmNlTWFwLnNldChzZXF1ZW5jZS5pZCwgc2VxdWVuY2UpO1xuXG4gICAgICAvLyBJbmRleCBieSB3b3JkL25hbWVcbiAgICAgIHRoaXMuYWRkVG9JbmRleChcbiAgICAgICAgdGhpcy5zZWFyY2hJbmRleC53b3JkSW5kZXgsXG4gICAgICAgIHNlcXVlbmNlLndvcmQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgc2VxdWVuY2UuaWRcbiAgICAgICk7XG4gICAgICB0aGlzLmFkZFRvSW5kZXgoXG4gICAgICAgIHRoaXMuc2VhcmNoSW5kZXgud29yZEluZGV4LFxuICAgICAgICBzZXF1ZW5jZS5uYW1lLnRvTG93ZXJDYXNlKCksXG4gICAgICAgIHNlcXVlbmNlLmlkXG4gICAgICApO1xuXG4gICAgICAvLyBJbmRleCBieSBhdXRob3JcbiAgICAgIGlmIChzZXF1ZW5jZS5hdXRob3IpIHtcbiAgICAgICAgdGhpcy5hZGRUb0luZGV4KFxuICAgICAgICAgIHRoaXMuc2VhcmNoSW5kZXguYXV0aG9ySW5kZXgsXG4gICAgICAgICAgc2VxdWVuY2UuYXV0aG9yLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgc2VxdWVuY2UuaWRcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5kZXggYnkgdGFnc1xuICAgICAgZm9yIChjb25zdCB0YWcgb2Ygc2VxdWVuY2UudGFncykge1xuICAgICAgICB0aGlzLmFkZFRvSW5kZXgoXG4gICAgICAgICAgdGhpcy5zZWFyY2hJbmRleC50YWdJbmRleCxcbiAgICAgICAgICB0YWcudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICBzZXF1ZW5jZS5pZFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBJbmRleCBieSBtZXRhZGF0YSAoY29tYmluZWQgc2VhcmNoYWJsZSB0ZXh0KVxuICAgICAgY29uc3Qgc2VhcmNoYWJsZVRleHQgPSB0aGlzLmJ1aWxkU2VhcmNoYWJsZVRleHQoc2VxdWVuY2UpO1xuICAgICAgZm9yIChjb25zdCB0ZXJtIG9mIHNlYXJjaGFibGVUZXh0LnNwbGl0KC9cXHMrLykpIHtcbiAgICAgICAgaWYgKHRlcm0ubGVuZ3RoID4gMikge1xuICAgICAgICAgIC8vIE9ubHkgaW5kZXggdGVybXMgbG9uZ2VyIHRoYW4gMiBjaGFyYWN0ZXJzXG4gICAgICAgICAgdGhpcy5hZGRUb0luZGV4KFxuICAgICAgICAgICAgdGhpcy5zZWFyY2hJbmRleC5tZXRhZGF0YUluZGV4LFxuICAgICAgICAgICAgdGVybS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgc2VxdWVuY2UuaWRcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VhcmNoU2VxdWVuY2VzKHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlPFNlcXVlbmNlRGF0YVtdPiB7XG4gICAgaWYgKCF0aGlzLnNlYXJjaEluZGV4IHx8ICFxdWVyeS50cmltKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlcXVlbmNlSW5kZXggfHwgW107XG4gICAgfVxuXG4gICAgY29uc3Qgc2VhcmNoVGVybXMgPSBxdWVyeVxuICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgIC5zcGxpdCgvXFxzKy8pXG4gICAgICAuZmlsdGVyKCh0ZXJtKSA9PiB0ZXJtLmxlbmd0aCA+IDApO1xuICAgIGNvbnN0IHJlc3VsdElkcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgZm9yIChjb25zdCB0ZXJtIG9mIHNlYXJjaFRlcm1zKSB7XG4gICAgICBjb25zdCBtYXRjaGluZ0lkcyA9IHRoaXMuc2VhcmNoVGVybSh0ZXJtKTtcblxuICAgICAgLy8gRm9yIG11bHRpcGxlIHRlcm1zLCB1c2UgaW50ZXJzZWN0aW9uIChBTkQgbG9naWMpXG4gICAgICBpZiAocmVzdWx0SWRzLnNpemUgPT09IDApIHtcbiAgICAgICAgbWF0Y2hpbmdJZHMuZm9yRWFjaCgoaWQpID0+IHJlc3VsdElkcy5hZGQoaWQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRJZHMgPSBuZXcgU2V0KHJlc3VsdElkcyk7XG4gICAgICAgIHJlc3VsdElkcy5jbGVhcigpO1xuICAgICAgICBtYXRjaGluZ0lkcy5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgICAgIGlmIChjdXJyZW50SWRzLmhhcyhpZCkpIHtcbiAgICAgICAgICAgIHJlc3VsdElkcy5hZGQoaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29udmVydCBJRHMgYmFjayB0byBzZXF1ZW5jZXMgYW5kIHNvcnQgYnkgcmVsZXZhbmNlXG4gICAgY29uc3QgcmVzdWx0cyA9IEFycmF5LmZyb20ocmVzdWx0SWRzKVxuICAgICAgLm1hcCgoaWQpID0+IHRoaXMuc2VxdWVuY2VNYXAuZ2V0KGlkKSlcbiAgICAgIC5maWx0ZXIoKHNlcSk6IHNlcSBpcyBTZXF1ZW5jZURhdGEgPT4gc2VxICE9PSB1bmRlZmluZWQpO1xuXG4gICAgcmV0dXJuIHRoaXMuc29ydEJ5UmVsZXZhbmNlKHJlc3VsdHMsIHF1ZXJ5KTtcbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hJbmRleCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnNlcXVlbmNlSW5kZXggPSBudWxsO1xuICAgIHRoaXMuc2VhcmNoSW5kZXggPSBudWxsO1xuICAgIHRoaXMuc2VxdWVuY2VNYXAuY2xlYXIoKTtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXF1ZW5jZUluZGV4KCk7XG4gIH1cblxuICAvLyBBZGRpdGlvbmFsIHV0aWxpdHkgbWV0aG9kc1xuICBnZXRJbmRleFN0YXRzKCk6IHtcbiAgICB0b3RhbFNlcXVlbmNlczogbnVtYmVyO1xuICAgIGluZGV4ZWRXb3JkczogbnVtYmVyO1xuICAgIGluZGV4ZWRBdXRob3JzOiBudW1iZXI7XG4gICAgaW5kZXhlZFRhZ3M6IG51bWJlcjtcbiAgICBpbmRleGVkTWV0YWRhdGE6IG51bWJlcjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsU2VxdWVuY2VzOiB0aGlzLnNlcXVlbmNlTWFwLnNpemUsXG4gICAgICBpbmRleGVkV29yZHM6IHRoaXMuc2VhcmNoSW5kZXg/LndvcmRJbmRleC5zaXplIHx8IDAsXG4gICAgICBpbmRleGVkQXV0aG9yczogdGhpcy5zZWFyY2hJbmRleD8uYXV0aG9ySW5kZXguc2l6ZSB8fCAwLFxuICAgICAgaW5kZXhlZFRhZ3M6IHRoaXMuc2VhcmNoSW5kZXg/LnRhZ0luZGV4LnNpemUgfHwgMCxcbiAgICAgIGluZGV4ZWRNZXRhZGF0YTogdGhpcy5zZWFyY2hJbmRleD8ubWV0YWRhdGFJbmRleC5zaXplIHx8IDAsXG4gICAgfTtcbiAgfVxuXG4gIGFzeW5jIGdldFNlcXVlbmNlQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxTZXF1ZW5jZURhdGEgfCBudWxsPiB7XG4gICAgaWYgKCF0aGlzLnNlcXVlbmNlTWFwLmhhcyhpZCkpIHtcbiAgICAgIGF3YWl0IHRoaXMubG9hZFNlcXVlbmNlSW5kZXgoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuc2VxdWVuY2VNYXAuZ2V0KGlkKSB8fCBudWxsO1xuICB9XG5cbiAgYXN5bmMgZ2V0U3VnZ2VzdGlvbnMoXG4gICAgcGFydGlhbFF1ZXJ5OiBzdHJpbmcsXG4gICAgbWF4U3VnZ2VzdGlvbnMgPSAxMFxuICApOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgaWYgKCF0aGlzLnNlYXJjaEluZGV4IHx8IHBhcnRpYWxRdWVyeS5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3Qgc3VnZ2VzdGlvbnMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICBjb25zdCBxdWVyeSA9IHBhcnRpYWxRdWVyeS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgLy8gU2VhcmNoIGluIHdvcmRzL25hbWVzXG4gICAgZm9yIChjb25zdCBbd29yZF0gb2YgdGhpcy5zZWFyY2hJbmRleC53b3JkSW5kZXgpIHtcbiAgICAgIGlmICh3b3JkLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgICBzdWdnZXN0aW9ucy5hZGQod29yZCk7XG4gICAgICAgIGlmIChzdWdnZXN0aW9ucy5zaXplID49IG1heFN1Z2dlc3Rpb25zKSBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZWFyY2ggaW4gYXV0aG9ycyBpZiBub3QgZW5vdWdoIHN1Z2dlc3Rpb25zXG4gICAgaWYgKHN1Z2dlc3Rpb25zLnNpemUgPCBtYXhTdWdnZXN0aW9ucykge1xuICAgICAgZm9yIChjb25zdCBbYXV0aG9yXSBvZiB0aGlzLnNlYXJjaEluZGV4LmF1dGhvckluZGV4KSB7XG4gICAgICAgIGlmIChhdXRob3IuaW5jbHVkZXMocXVlcnkpKSB7XG4gICAgICAgICAgc3VnZ2VzdGlvbnMuYWRkKGF1dGhvcik7XG4gICAgICAgICAgaWYgKHN1Z2dlc3Rpb25zLnNpemUgPj0gbWF4U3VnZ2VzdGlvbnMpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIEFycmF5LmZyb20oc3VnZ2VzdGlvbnMpLnNsaWNlKDAsIG1heFN1Z2dlc3Rpb25zKTtcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcbiAgcHJpdmF0ZSBhZGRUb0luZGV4KFxuICAgIGluZGV4OiBNYXA8c3RyaW5nLCBTZXQ8c3RyaW5nPj4sXG4gICAga2V5OiBzdHJpbmcsXG4gICAgc2VxdWVuY2VJZDogc3RyaW5nXG4gICk6IHZvaWQge1xuICAgIGlmICghaW5kZXguaGFzKGtleSkpIHtcbiAgICAgIGluZGV4LnNldChrZXksIG5ldyBTZXQoKSk7XG4gICAgfVxuICAgIGNvbnN0IGtleVNldCA9IGluZGV4LmdldChrZXkpO1xuICAgIGlmIChrZXlTZXQpIHtcbiAgICAgIGtleVNldC5hZGQoc2VxdWVuY2VJZCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZWFyY2hUZXJtKHRlcm06IHN0cmluZyk6IFNldDxzdHJpbmc+IHtcbiAgICBjb25zdCByZXN1bHRzID0gbmV3IFNldDxzdHJpbmc+KCk7XG5cbiAgICBpZiAoIXRoaXMuc2VhcmNoSW5kZXgpIHJldHVybiByZXN1bHRzO1xuXG4gICAgLy8gRXhhY3QgbWF0Y2hlcyBpbiB3b3Jkc1xuICAgIGNvbnN0IHdvcmRNYXRjaGVzID0gdGhpcy5zZWFyY2hJbmRleC53b3JkSW5kZXguZ2V0KHRlcm0pIHx8IG5ldyBTZXQoKTtcbiAgICB3b3JkTWF0Y2hlcy5mb3JFYWNoKChpZCkgPT4gcmVzdWx0cy5hZGQoaWQpKTtcblxuICAgIC8vIFBhcnRpYWwgbWF0Y2hlcyBpbiB3b3Jkc1xuICAgIGZvciAoY29uc3QgW3dvcmQsIGlkc10gb2YgdGhpcy5zZWFyY2hJbmRleC53b3JkSW5kZXgpIHtcbiAgICAgIGlmICh3b3JkLmluY2x1ZGVzKHRlcm0pKSB7XG4gICAgICAgIGlkcy5mb3JFYWNoKChpZCkgPT4gcmVzdWx0cy5hZGQoaWQpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBBdXRob3IgbWF0Y2hlc1xuICAgIGNvbnN0IGF1dGhvck1hdGNoZXMgPSB0aGlzLnNlYXJjaEluZGV4LmF1dGhvckluZGV4LmdldCh0ZXJtKSB8fCBuZXcgU2V0KCk7XG4gICAgYXV0aG9yTWF0Y2hlcy5mb3JFYWNoKChpZCkgPT4gcmVzdWx0cy5hZGQoaWQpKTtcblxuICAgIC8vIFRhZyBtYXRjaGVzXG4gICAgY29uc3QgdGFnTWF0Y2hlcyA9IHRoaXMuc2VhcmNoSW5kZXgudGFnSW5kZXguZ2V0KHRlcm0pIHx8IG5ldyBTZXQoKTtcbiAgICB0YWdNYXRjaGVzLmZvckVhY2goKGlkKSA9PiByZXN1bHRzLmFkZChpZCkpO1xuXG4gICAgLy8gTWV0YWRhdGEgbWF0Y2hlc1xuICAgIGNvbnN0IG1ldGFkYXRhTWF0Y2hlcyA9XG4gICAgICB0aGlzLnNlYXJjaEluZGV4Lm1ldGFkYXRhSW5kZXguZ2V0KHRlcm0pIHx8IG5ldyBTZXQoKTtcbiAgICBtZXRhZGF0YU1hdGNoZXMuZm9yRWFjaCgoaWQpID0+IHJlc3VsdHMuYWRkKGlkKSk7XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRTZWFyY2hhYmxlVGV4dChzZXF1ZW5jZTogU2VxdWVuY2VEYXRhKTogc3RyaW5nIHtcbiAgICBjb25zdCBwYXJ0cyA9IFtcbiAgICAgIHNlcXVlbmNlLndvcmQsXG4gICAgICBzZXF1ZW5jZS5uYW1lLFxuICAgICAgc2VxdWVuY2UuYXV0aG9yIHx8IFwiXCIsXG4gICAgICBzZXF1ZW5jZS5kaWZmaWN1bHR5TGV2ZWwgfHwgXCJcIixcbiAgICAgIHNlcXVlbmNlLmdyaWRNb2RlIHx8IFwiXCIsXG4gICAgICBzZXF1ZW5jZS5wcm9wVHlwZSB8fCBcIlwiLFxuICAgICAgLi4uc2VxdWVuY2UudGFncyxcbiAgICBdO1xuXG4gICAgcmV0dXJuIHBhcnRzLmZpbHRlcihCb29sZWFuKS5qb2luKFwiIFwiKTtcbiAgfVxuXG4gIHByaXZhdGUgc29ydEJ5UmVsZXZhbmNlKFxuICAgIHNlcXVlbmNlczogU2VxdWVuY2VEYXRhW10sXG4gICAgcXVlcnk6IHN0cmluZ1xuICApOiBTZXF1ZW5jZURhdGFbXSB7XG4gICAgY29uc3QgcXVlcnlMb3dlciA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG5cbiAgICByZXR1cm4gc2VxdWVuY2VzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IHNjb3JlQSA9IHRoaXMuY2FsY3VsYXRlUmVsZXZhbmNlU2NvcmUoYSwgcXVlcnlMb3dlcik7XG4gICAgICBjb25zdCBzY29yZUIgPSB0aGlzLmNhbGN1bGF0ZVJlbGV2YW5jZVNjb3JlKGIsIHF1ZXJ5TG93ZXIpO1xuICAgICAgcmV0dXJuIHNjb3JlQiAtIHNjb3JlQTsgLy8gSGlnaGVyIHNjb3JlIGZpcnN0XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJlbGV2YW5jZVNjb3JlKFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEsXG4gICAgcXVlcnk6IHN0cmluZ1xuICApOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDA7XG5cbiAgICAvLyBFeGFjdCB3b3JkIG1hdGNoIGdldHMgaGlnaGVzdCBzY29yZVxuICAgIGlmIChzZXF1ZW5jZS53b3JkLnRvTG93ZXJDYXNlKCkgPT09IHF1ZXJ5KSB7XG4gICAgICBzY29yZSArPSAxMDA7XG4gICAgfVxuXG4gICAgLy8gV29yZCBzdGFydHMgd2l0aCBxdWVyeVxuICAgIGlmIChzZXF1ZW5jZS53b3JkLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChxdWVyeSkpIHtcbiAgICAgIHNjb3JlICs9IDUwO1xuICAgIH1cblxuICAgIC8vIFdvcmQgY29udGFpbnMgcXVlcnlcbiAgICBpZiAoc2VxdWVuY2Uud29yZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgc2NvcmUgKz0gMjU7XG4gICAgfVxuXG4gICAgLy8gTmFtZSBtYXRjaGVzXG4gICAgaWYgKHNlcXVlbmNlLm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxdWVyeSkpIHtcbiAgICAgIHNjb3JlICs9IDE1O1xuICAgIH1cblxuICAgIC8vIEF1dGhvciBtYXRjaGVzXG4gICAgaWYgKHNlcXVlbmNlLmF1dGhvcj8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhxdWVyeSkpIHtcbiAgICAgIHNjb3JlICs9IDEwO1xuICAgIH1cblxuICAgIC8vIFRhZyBtYXRjaGVzXG4gICAgZm9yIChjb25zdCB0YWcgb2Ygc2VxdWVuY2UudGFncykge1xuICAgICAgaWYgKHRhZy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHF1ZXJ5KSkge1xuICAgICAgICBzY29yZSArPSA1O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZhdm9yaXRlcyBnZXQgYm9udXMgcG9pbnRzXG4gICAgaWYgKHNlcXVlbmNlLmlzRmF2b3JpdGUpIHtcbiAgICAgIHNjb3JlICs9IDI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNjb3JlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzY2FuU2VxdWVuY2VEaXJlY3RvcnkoKTogUHJvbWlzZTxTZXF1ZW5jZURhdGFbXT4ge1xuICAgIC8vIFRoaXMgaXMgYSBmYWxsYmFjayBtZXRob2QgdGhhdCB3b3VsZCBzY2FuIHRoZSBzdGF0aWMgZGlyZWN0b3J5XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHJlcXVpcmUgc2VydmVyLXNpZGUgc3VwcG9ydFxuICAgIC8vIEZvciBub3csIHJldHVybiBhIGNvbXByZWhlbnNpdmUgc2V0IG9mIHNhbXBsZSBkYXRhIGJhc2VkIG9uIHRoZSBjb3BpZWQgZmlsZXNcblxuICAgIGNvbnNvbGUud2FybihcIlNjYW5uaW5nIGRpcmVjdG9yeSAtIHVzaW5nIGZhbGxiYWNrIHNhbXBsZSBkYXRhXCIpO1xuXG4gICAgLy8gR2VuZXJhdGUgc2VxdWVuY2VzIGJhc2VkIG9uIGNvbW1vbiBwYXR0ZXJuIGZyb20gdGhlIGNvcGllZCBkaWN0aW9uYXJ5XG4gICAgY29uc3Qgc2VxdWVuY2VzOiBTZXF1ZW5jZURhdGFbXSA9IFtdO1xuXG4gICAgLy8gU2FtcGxlIHNlcXVlbmNlcyB0aGF0IHNob3VsZCBleGlzdCBiYXNlZCBvbiB0aGUgZGljdGlvbmFyeSBjb3B5XG4gICAgY29uc3Qga25vd25TZXF1ZW5jZXMgPSBbXG4gICAgICBcIkFcIixcbiAgICAgIFwiQUFCQlwiLFxuICAgICAgXCJBQUtFXCIsXG4gICAgICBcIkFCXCIsXG4gICAgICBcIkFCQ1wiLFxuICAgICAgXCJBSkXOpi1cIixcbiAgICAgIFwiQUtFXCIsXG4gICAgICBcIkFLSc6mXCIsXG4gICAgICBcIkFMRkFMR0dGXCIsXG4gICAgICBcIkJcIixcbiAgICAgIFwiQkFcIixcbiAgICAgIFwiQkJLRVwiLFxuICAgICAgXCJCQkxGXCIsXG4gICAgICBcIkJDXCIsXG4gICAgICBcIkJKRUFcIixcbiAgICAgIFwiQkpGQVwiLFxuICAgICAgXCJCS0XOpi1cIixcbiAgICAgIFwiQ1wiLFxuICAgICAgXCJDQUtFXCIsXG4gICAgICBcIkNDQ86mLVwiLFxuICAgICAgXCJDQ0tFXCIsXG4gICAgICBcIkNDS86mXCIsXG4gICAgICAvLyBBZGQgbW9yZSBhcyBuZWVkZWQuLi5cbiAgICBdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrbm93blNlcXVlbmNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgd29yZCA9IGtub3duU2VxdWVuY2VzW2ldO1xuICAgICAgaWYgKCF3b3JkKSBjb250aW51ZTsgLy8gU2tpcCB1bmRlZmluZWQgZW50cmllc1xuXG4gICAgICBjb25zdCBhdXRob3JzID0gW1wiVEtBIFVzZXJcIiwgXCJEZW1vIEF1dGhvclwiLCBcIkV4cGVydCBVc2VyXCJdO1xuICAgICAgY29uc3QgZ3JpZE1vZGVzID0gW0dyaWRNb2RlLkRJQU1PTkQsIEdyaWRNb2RlLkJPWF07XG4gICAgICBjb25zdCBkaWZmaWN1bHRpZXMgPSBbXCJiZWdpbm5lclwiLCBcImludGVybWVkaWF0ZVwiLCBcImFkdmFuY2VkXCJdO1xuXG4gICAgICBjb25zdCBhdXRob3IgPSBhdXRob3JzW2kgJSBhdXRob3JzLmxlbmd0aF07XG4gICAgICBjb25zdCBncmlkTW9kZSA9IGdyaWRNb2Rlc1tpICUgZ3JpZE1vZGVzLmxlbmd0aF07XG4gICAgICBjb25zdCBkaWZmaWN1bHR5ID0gZGlmZmljdWx0aWVzW2kgJSBkaWZmaWN1bHRpZXMubGVuZ3RoXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gY3JlYXRlU2VxdWVuY2VEYXRhKHtcbiAgICAgICAgaWQ6IHdvcmQsIC8vIOKchSBGSVhFRDogS2VlcCB1cHBlcmNhc2UgdG8gbWF0Y2ggUE5HIGZpbGUgbmFtZXNcbiAgICAgICAgbmFtZTogYCR7d29yZH0gU2VxdWVuY2VgLFxuICAgICAgICB3b3JkLFxuICAgICAgICBiZWF0czogW10sIC8vIEVtcHR5IGJlYXRzIGZvciBpbmRleCBzZXJ2aWNlXG4gICAgICAgIHRodW1ibmFpbHM6IFtgJHt3b3JkfV92ZXIxLnBuZ2BdLFxuICAgICAgICBpc0Zhdm9yaXRlOiBNYXRoLnJhbmRvbSgpID4gMC44LFxuICAgICAgICBpc0NpcmN1bGFyOiBmYWxzZSxcbiAgICAgICAgdGFnczogW1wiZmxvd1wiLCBcInByYWN0aWNlXCIsIFwiZ2VuZXJhdGVkXCJdLnNsaWNlKFxuICAgICAgICAgIDAsXG4gICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMykgKyAxXG4gICAgICAgICksXG4gICAgICAgIG1ldGFkYXRhOiB7IHNjYW5uZWQ6IHRydWUsIGluZGV4OiBpIH0sXG4gICAgICAgIC8vIEluY2x1ZGUgYWxsIHByb3BlcnRpZXMgaW4gdGhlIGNyZWF0aW9uIHRvIGF2b2lkIHJlYWRvbmx5IGlzc3Vlc1xuICAgICAgICAuLi4oYXV0aG9yICYmIHsgYXV0aG9yIH0pLFxuICAgICAgICAuLi4oZ3JpZE1vZGUgJiYgeyBncmlkTW9kZSB9KSxcbiAgICAgICAgLi4uKGRpZmZpY3VsdHkgJiYgeyBkaWZmaWN1bHR5TGV2ZWw6IGRpZmZpY3VsdHkgfSksXG4gICAgICAgIHNlcXVlbmNlTGVuZ3RoOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA4KSArIDMsXG4gICAgICAgIGxldmVsOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KSArIDEsXG4gICAgICAgIGRhdGVBZGRlZDogbmV3IERhdGUoXG4gICAgICAgICAgRGF0ZS5ub3coKSAtIE1hdGgucmFuZG9tKCkgKiAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwXG4gICAgICAgICksXG4gICAgICAgIHByb3BUeXBlOiBQcm9wVHlwZS5GQU4sXG4gICAgICAgIHN0YXJ0aW5nUG9zaXRpb25Hcm91cDogR3JpZFBvc2l0aW9uR3JvdXAuQUxQSEEsXG4gICAgICB9KTtcblxuICAgICAgc2VxdWVuY2VzLnB1c2gocmVzdWx0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VxdWVuY2VzO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiQUFRQSxTQUFTLDBCQUEwQjtBQUVuQyxTQUFTLFVBQVUsVUFBVSx5QkFBeUI7QUFTL0MsYUFBTSxxQkFBc0Q7QUFBQSxFQUN6RCxnQkFBdUM7QUFBQSxFQUN2QyxjQUFrQztBQUFBLEVBQ2xDLGNBQWMsb0JBQUksSUFBMEI7QUFBQSxFQUVwRCxNQUFNLG9CQUE2QztBQUNqRCxRQUFJLEtBQUssa0JBQWtCLE1BQU07QUFDL0IsYUFBTyxLQUFLO0FBQUEsSUFDZDtBQUVBLFFBQUk7QUFFRixVQUFJLEtBQUssa0JBQWtCLE1BQU07QUFDL0IsYUFBSyxnQkFBZ0IsTUFBTSxLQUFLLHNCQUFzQjtBQUFBLE1BQ3hEO0FBR0EsVUFBSSxLQUFLLGVBQWU7QUFDdEIsY0FBTSxLQUFLLGlCQUFpQixLQUFLLGFBQWE7QUFBQSxNQUNoRDtBQUVBLGFBQU8sS0FBSyxpQkFBaUIsQ0FBQztBQUFBLElBQ2hDLFNBQVMsT0FBTztBQUNkLGNBQVEsTUFBTSxrQ0FBa0MsS0FBSztBQUVyRCxXQUFLLGdCQUFnQixDQUFDO0FBQ3RCLGFBQU8sQ0FBQztBQUFBLElBQ1Y7QUFBQSxFQUNGO0FBQUEsRUFFQSxNQUFNLGlCQUFpQixXQUEwQztBQUMvRCxTQUFLLGNBQWM7QUFBQSxNQUNqQixXQUFXLG9CQUFJLElBQUk7QUFBQSxNQUNuQixhQUFhLG9CQUFJLElBQUk7QUFBQSxNQUNyQixVQUFVLG9CQUFJLElBQUk7QUFBQSxNQUNsQixlQUFlLG9C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QTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQTtBQUFBLElBRUY7QUFFQSxhQUFTLElBQUksR0FBRyxJQUFJLGVBQWUsUUFBUSxLQUFLO0FBQzlDLFlBQU0sT0FBTyxlQUFlLENBQUM7QUFDN0IsVUFBSSxDQUFDLEtBQU07QUFFWCxZQUFNLFVBQVUsQ0FBQyxZQUFZLGVBQWUsYUFBYTtBQUN6RCxZQUFNLFlBQVksQ0FBQyxTQUFTLFNBQVMsU0FBUyxHQUFHO0FBQ2pELFlBQU0sZUFBZSxDQUFDLFlBQVksZ0JBQWdCLFVBQVU7QUFFNUQsWUFBTSxTQUFTLFFBQVEsSUFBSSxRQUFRLE1BQU07QUFDekMsWUFBTSxXQUFXLFVBQVUsSUFBSSxVQUFVLE1BQU07QUFDL0MsWUFBTSxhQUFhLGFBQWEsSUFBSSxhQUFhLE1BQU07QUFFdkQsWUFBTSxTQUFTLG1CQUFtQjtBQUFBLFFBQ2hDLElBQUk7QUFBQTtBQUFBLFFBQ0osTUFBTSxHQUFHLElBQUk7QUFBQSxRQUNiO0FBQUEsUUFDQSxPQUFPLENBQUM7QUFBQTtBQUFBLFFBQ1IsWUFBWSxDQUFDLEdBQUcsSUFBSSxXQUFXO0FBQUEsUUFDL0IsWUFBWSxLQUFLLE9BQU8sSUFBSTtBQUFBLFFBQzVCLFlBQVk7QUFBQSxRQUNaLE1BQU0sQ0FBQyxRQUFRLFlBQVksV0FBVyxFQUFFO0FBQUEsVUFDdEM7QUFBQSxVQUNBLEtBQUssTUFBTSxLQUFLLE9BQU8sSUFBSSxDQUFDLElBQUk7QUFBQSxRQUNsQztBQUFBLFFBQ0EsVUFBVSxFQUFFLFNBQVMsTUFBTSxPQUFPLEVBQUU7QUFBQTtBQUFBLFFBRXBDLEdBQUksVUFBVSxFQUFFLE9BQU87QUFBQSxRQUN2QixHQUFJLFlBQVksRUFBRSxTQUFTO0FBQUEsUUFDM0IsR0FBSSxjQUFjLEVBQUUsaUJBQWlCLFdBQVc7QUFBQSxRQUNoRCxnQkFBZ0IsS0FBSyxNQUFNLEtBQUssT0FBTyxJQUFJLENBQUMsSUFBSTtBQUFBLFFBQ2hELE9BQU8sS0FBSyxNQUFNLEtBQUssT0FBTyxJQUFJLENBQUMsSUFBSTtBQUFBLFFBQ3ZDLFdBQVcsSUFBSTtBQUFBLFVBQ2IsS0FBSyxJQUFJLElBQUksS0FBSyxPQUFPLElBQUksTUFBTSxLQUFLLEtBQUssS0FBSztBQUFBLFFBQ3BEO0FBQUEsUUFDQSxVQUFVLFNBQVM7QUFBQSxRQUNuQix1QkFBdUIsa0JBQWtCO0FBQUEsTUFDM0MsQ0FBQztBQUVELGdCQUFVLEtBQUssTUFBTTtBQUFBLElBQ3ZCO0FBRUEsV0FBTztBQUFBLEVBQ1Q7QUFDRjsiLAogICJuYW1lcyI6IFtdCn0K
