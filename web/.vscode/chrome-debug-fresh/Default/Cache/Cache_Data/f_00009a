import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/lib/components/construct/OptionPickerContainer.svelte");import "/node_modules/.vite/deps/svelte_internal_disclose-version.js?v=608ae08a";

OptionPickerContainer[$.FILENAME] = 'src/lib/components/construct/OptionPickerContainer.svelte';

import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=608ae08a";
import { createErrorState } from "/src/lib/utils/error-handling.svelte.ts";
import { onMount } from "/node_modules/.vite/deps/svelte.js?v=608ae08a";
import ErrorBanner from "/src/lib/components/construct/ErrorBanner.svelte";
import LoadingOverlay from "/src/lib/components/construct/LoadingOverlay.svelte";
import OptionPickerHeader from "/src/lib/components/construct/option-picker/OptionPickerHeader.svelte";
import OptionPickerScroll from "/src/lib/components/construct/option-picker/OptionPickerScroll.svelte";
import { createOptionDataState } from "/src/lib/components/construct/option-picker/state/focused/option-data-state.svelte.ts";
import { createOptionFilterState } from "/src/lib/components/construct/option-picker/state/focused/option-filter-state.svelte.ts";
import { createOptionPersistenceState } from "/src/lib/components/construct/option-picker/state/focused/option-persistence-state.svelte.ts";
import { createOptionUIState } from "/src/lib/components/construct/option-picker/state/focused/option-ui-state.svelte.ts";

var on_click = (_, loadOptionsForSequence, initialSequence) => loadOptionsForSequence(initialSequence());
var root_4 = $.add_locations($.from_html(`<div class="error-state s-wTVbQp2v1syv"><p class="s-wTVbQp2v1syv"> </p> <button class="s-wTVbQp2v1syv">Retry</button></div>`), OptionPickerContainer[$.FILENAME], [[115, 6, [[116, 8], [117, 8]]]]);
var root_6 = $.add_locations($.from_html(`<div class="empty-state s-wTVbQp2v1syv"><p class="s-wTVbQp2v1syv">No options available for the current sequence.</p></div>`), OptionPickerContainer[$.FILENAME], [[122, 6, [[123, 8]]]]);
var root = $.add_locations($.from_html(`<div class="option-picker-container s-wTVbQp2v1syv" data-testid="option-picker-container"><!> <!> <div class="option-picker-content s-wTVbQp2v1syv"><!></div></div>`), OptionPickerContainer[$.FILENAME], [[94, 0, [[111, 2]]]]);

function OptionPickerContainer($$anchor, $$props) {
	$.check_target(new.target);
	$.push($$props, true, OptionPickerContainer);

	const onOptionSelected = $.prop($$props, 'onOptionSelected', 3, () => {}),
		initialSequence = $.prop($$props, 'initialSequence', 19, () => []);

	const dataState = createOptionDataState();
	const uiState = createOptionUIState();
	const filterState = createOptionFilterState(dataState, uiState);
	const persistenceState = createOptionPersistenceState();
	const errorState = createErrorState();
	let containerElement;
	let containerWidth = $.tag($.state(800), 'containerWidth');
	let containerHeight = $.tag($.state(600), 'containerHeight');

	onMount(() => {
		if (containerElement) {
			const resizeObserver = new ResizeObserver((entries) => {
				for (const entry of entries) {
					$.set(containerWidth, entry.contentRect.width, true);
					$.set(containerHeight, entry.contentRect.height, true);
				}
			});

			resizeObserver.observe(containerElement);

			return () => resizeObserver.disconnect();
		}
	});

	let hasLoadedInitialSequence = $.tag($.state(false), 'hasLoadedInitialSequence');

	$.user_effect(() => {
		if (initialSequence().length >= 0 && !$.get(hasLoadedInitialSequence)) {
			$.set(hasLoadedInitialSequence, true);
			loadOptionsForSequence(initialSequence());
		}
	});

	async function loadOptionsForSequence(sequence) {
		try {
			errorState.clearError();
			dataState.setSequence(sequence);

			const preloadedOptions = persistenceState.checkPreloadedOptions();

			if (preloadedOptions) {
				dataState.setOptions(preloadedOptions);
				uiState.setLoading(false);
				uiState.setError(null);

				if (!uiState.lastSelectedTab[uiState.sortMethod] || $.strict_equals(uiState.lastSelectedTab[uiState.sortMethod], null)) {
					uiState.setLastSelectedTabForSort(uiState.sortMethod, "all");
				}

				return;
			}

			const targetEndPosition = persistenceState.getTargetEndPosition(sequence);

			if (targetEndPosition) {
				const bulkOptions = persistenceState.checkBulkPreloadedOptions(targetEndPosition);

				if (bulkOptions && bulkOptions.length > 0) {
					dataState.setOptions(bulkOptions);
					uiState.setLoading(false);
					uiState.setError(null);

					if (!uiState.lastSelectedTab[uiState.sortMethod] || $.strict_equals(uiState.lastSelectedTab[uiState.sortMethod], null)) {
						uiState.setLastSelectedTabForSort(uiState.sortMethod, "all");
					}

					return;
				}
			}

			(await $.track_reactivity_loss(dataState.loadOptionsFromServices(sequence)))();
		} catch(error) {
			errorState.setError(error, "OPTION_LOAD_FAILED");
		}
	}

	async function handleOptionSelected(option) {
		try {
			(await $.track_reactivity_loss(dataState.selectOption(option)))();
			onOptionSelected()(option);
		} catch(error) {
			errorState.setError(error, "OPTION_SELECT_FAILED");
		}
	}

	function handleSortMethodChanged(method) {
		uiState.setSortMethod(method);
	}

	var div = root();
	var node = $.child(div);

	$.add_svelte_meta(() => OptionPickerHeader(node, {}), 'component', OptionPickerContainer, 100, 2, { componentTag: 'OptionPickerHeader' });

	var node_1 = $.sibling(node, 2);

	{
		var consequent = ($$anchor) => {
			var fragment = $.comment();
			var node_2 = $.first_child(fragment);

			{
				let $0 = $.derived(() => errorState.state.errorMessage || "An error occurred");

				$.add_svelte_meta(
					() => ErrorBanner(node_2, {
						get message() {
							return $.get($0);
						},

						get onDismiss() {
							return errorState.clearError;
						}
					}),
					'component',
					OptionPickerContainer,
					104,
					4,
					{ componentTag: 'ErrorBanner' }
				);
			}

			$.append($$anchor, fragment);
		};

		$.add_svelte_meta(
			() => $.if(node_1, ($$render) => {
				if (errorState.state.hasError) $$render(consequent);
			}),
			'if',
			OptionPickerContainer,
			103,
			2
		);
	}

	var div_1 = $.sibling(node_1, 2);
	var node_3 = $.child(div_1);

	{
		var consequent_1 = ($$anchor) => {
			var fragment_1 = $.comment();
			var node_4 = $.first_child(fragment_1);

			$.add_svelte_meta(() => LoadingOverlay(node_4, { message: 'Loading options...' }), 'component', OptionPickerContainer, 113, 6, { componentTag: 'LoadingOverlay' });
			$.append($$anchor, fragment_1);
		};

		var alternate_2 = ($$anchor) => {
			var fragment_2 = $.comment();
			var node_5 = $.first_child(fragment_2);

			{
				var consequent_2 = ($$anchor) => {
					var div_2 = root_4();
					var p = $.child(div_2);
					var text = $.child(p);

					$.reset(p);

					var button = $.sibling(p, 2);

					button.__click = [on_click, loadOptionsForSequence, initialSequence];
					$.reset(div_2);
					$.template_effect(() => $.set_text(text, `Error loading options: ${uiState.error ?? ''}`));
					$.append($$anchor, div_2);
				};

				var alternate_1 = ($$anchor) => {
					var fragment_3 = $.comment();
					var node_6 = $.first_child(fragment_3);

					{
						var consequent_3 = ($$anchor) => {
							var div_3 = root_6();

							$.append($$anchor, div_3);
						};

						var alternate = ($$anchor) => {
							var fragment_4 = $.comment();
							var node_7 = $.first_child(fragment_4);

							$.add_svelte_meta(
								() => OptionPickerScroll(node_7, {
									get pictographs() {
										return filterState.filteredOptions;
									},

									onPictographSelected: handleOptionSelected,

									get containerWidth() {
										return $.get(containerWidth);
									},

									get containerHeight() {
										return $.get(containerHeight);
									}
								}),
								'component',
								OptionPickerContainer,
								126,
								6,
								{ componentTag: 'OptionPickerScroll' }
							);

							$.append($$anchor, fragment_4);
						};

						$.add_svelte_meta(
							() => $.if(
								node_6,
								($$render) => {
									if ($.strict_equals(filterState.filteredOptions.length, 0)) $$render(consequent_3); else $$render(alternate, false);
								},
								true
							),
							'if',
							OptionPickerContainer,
							121,
							4
						);
					}

					$.append($$anchor, fragment_3);
				};

				$.add_svelte_meta(
					() => $.if(
						node_5,
						($$render) => {
							if (uiState.error) $$render(consequent_2); else $$render(alternate_1, false);
						},
						true
					),
					'if',
					OptionPickerContainer,
					114,
					4
				);
			}

			$.append($$anchor, fragment_2);
		};

		$.add_svelte_meta(
			() => $.if(node_3, ($$render) => {
				if (uiState.isLoading) $$render(consequent_1); else $$render(alternate_2, false);
			}),
			'if',
			OptionPickerContainer,
			112,
			4
		);
	}

	$.reset(div_1);
	$.reset(div);
	$.bind_this(div, ($$value) => containerElement = $$value, () => containerElement);
	$.append($$anchor, div);

	return $.pop({ ...$.legacy_api() });
}

if (import.meta.hot) {
	OptionPickerContainer = $.hmr(OptionPickerContainer, () => OptionPickerContainer[$.HMR].source);

	import.meta.hot.acceptExports(["default"],(module) => {
		$.cleanup_styles('s-wTVbQp2v1syv');
		module.default[$.HMR].source = OptionPickerContainer[$.HMR].source;
		$.set(OptionPickerContainer[$.HMR].source, module.default[$.HMR].original);
	});
}

export default OptionPickerContainer;

$.delegate(['click']);
import "/src/lib/components/construct/OptionPickerContainer.svelte?svelte&type=style&lang.css";

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Ijs7Ozs7U0FhUyx3QkFBaUI7U0FDakI7T0FDQTtPQUNBO09BQ0U7T0FDQTtTQUNBO1NBQ0EsK0JBQTJCO1NBRzVCLG9DQUF5QjtTQUFJLDJCQUdsQzs7K0RBMEtzQjs7Ozs7a0RBcE0zQixDQUFDOzs7O09BK0JPLGdFQUFjO0VBQUE7O09BVVosWUFBTTtPQUVSO09BQ0YsY0FBTSx3QkFBb0MsV0FBQyxPQUFZO09BQ3JELG1CQUFvQjtPQUNsQjtLQUdIO0tBQ0QsK0JBQXVCO0tBRXZCLGdDQUFhLEdBQWU7O0NBS2hDLGNBQUk7TUFJRSxrQkFBZ0I7U0FDbEIscUJBQTJCO2VBQzNCLFNBQXVCO1dBQ3pCO1dBQ0Q7SUFHRDtHQUNNOztHQUNGLGVBQVcsUUFBVzs7Z0JBSWhCLGVBQW1CO0VBQ3pCO0NBQ0U7O0tBS0EseUNBQzJCLEtBQVE7O0NBS25DO01BQ0Y7U0FHQSwwQkFBMEI7R0FDMUIsdUJBQXVCO0VBQ3JCO0NBRUE7O2dCQUdVLHVCQUFhO01BRXJCO0dBSUU7R0FBMkQsVUFDN0Q7O1NBR0o7O09BR00sa0JBQVU7SUFDbEIsVUFBZ0I7SUFDZCxRQUFXLFdBQVMsS0FBTztJQUM3Qjs7U0FNUSx3QkFBdUIsUUFBTSwrQkFDbkMsd0JBQXVCLDRCQUN6QjtLQUNFLFFBQVcsMEJBQWdCLG9CQUFzQjtJQUNuRDs7O0dBSUY7O1NBR007OztVQUVQLGNBQ1EsaUJBQWMsMEJBQVM7O1FBQ3BCLGVBQUMsWUFBZ0I7S0FDdEIsVUFBUSxXQUFjLFdBQVM7S0FDdEM7S0FDTyxRQUFXLFNBQVM7O1VBR2QsUUFBUSxnQkFBQyx1Q0FDZixRQUFXLGdCQUFjLDRCQUMzQjtNQUNDLFFBQVMsMEJBQStCLFFBQU0sWUFBYyxLQUFDO0tBQzdEOzs7SUFFQTs7O2tDQUlHLFVBQVEsd0JBQVM7RUFDMUIsUUFBTztHQUNELFdBQVEsU0FBUSxPQUFLO0VBQzNCO0NBQ0E7O2dCQUdnQjtNQUNSO2tDQUNHLFVBQUcsYUFBWSxNQUFlO0dBQ25DLG1CQUFpQixNQUFNO0VBQzdCLFFBQWEsT0FBQztHQUNSLFdBQUs7RUFDUDtDQUNKOztVQUdTLHdCQUFjO0VBQ3ZCLFFBQVMsY0FBZTtDQUN4Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2NBZWlCLFVBQVE7Ozs7Ozs7Ozs7Ozs7Ozs7UUFIckIsVUFBVSxNQUFNOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O3dFQWFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O2lCQVdGLFdBQVM7OzsrQkFDTCxvQkFBVzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzZCQVB0QixXQUFTLGdCQUFXOzs7Ozs7Ozs7Ozs7Ozs7Ozs7V0FQckIsT0FBSTs7Ozs7Ozs7Ozs7Ozs7OztRQUZSLE9BQUs7Ozs7Ozs7Ozs7OytCQWhCUjs7OztDQUpOIiwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJPcHRpb25QaWNrZXJDb250YWluZXIuc3ZlbHRlIl0sInNvdXJjZXNDb250ZW50IjpbIjwhLS1cbk9wdGlvblBpY2tlckNvbnRhaW5lci5zdmVsdGUgLSBNYWluIGNvbnRhaW5lciBmb3IgdGhlIG9wdGlvbiBwaWNrZXJcblxuSW50ZWdyYXRlcyBhbGwgb3B0aW9uIHBpY2tlciBjb21wb25lbnRzOlxuLSBVc2VzIG9wdGlvblBpY2tlclJ1bmVzIGZvciBzdGF0ZSBtYW5hZ2VtZW50XG4tIEhhbmRsZXMgc2Nyb2xsaW5nIHdpdGggT3B0aW9uUGlja2VyU2Nyb2xsXG4tIE1hbmFnZXMgbGF5b3V0IHJlc3BvbnNpdmVseVxuLSBDb29yZGluYXRlcyB3aXRoIHNlcXVlbmNlIHN0YXRlXG4tLT5cbjxzY3JpcHQgbGFuZz1cInRzXCI+XG4gIGltcG9ydCB0eXBlIHsgUGljdG9ncmFwaERhdGEgfSBmcm9tIFwiJGxpYi9kb21haW4vUGljdG9ncmFwaERhdGFcIjtcbiAgaW1wb3J0IHsgY3JlYXRlRXJyb3JTdGF0ZSB9IGZyb20gXCIkbGliL3V0aWxzL2Vycm9yLWhhbmRsaW5nLnN2ZWx0ZVwiO1xuICBpbXBvcnQgeyBvbk1vdW50IH0gZnJvbSBcInN2ZWx0ZVwiO1xuICBpbXBvcnQgRXJyb3JCYW5uZXIgZnJvbSBcIi4vRXJyb3JCYW5uZXIuc3ZlbHRlXCI7XG4gIGltcG9ydCBMb2FkaW5nT3ZlcmxheSBmcm9tIFwiLi9Mb2FkaW5nT3ZlcmxheS5zdmVsdGVcIjtcbiAgaW1wb3J0IE9wdGlvblBpY2tlckhlYWRlciBmcm9tIFwiLi9vcHRpb24tcGlja2VyL09wdGlvblBpY2tlckhlYWRlci5zdmVsdGVcIjtcbiAgaW1wb3J0IE9wdGlvblBpY2tlclNjcm9sbCBmcm9tIFwiLi9vcHRpb24tcGlja2VyL09wdGlvblBpY2tlclNjcm9sbC5zdmVsdGVcIjtcbiAgaW1wb3J0IHsgY3JlYXRlT3B0aW9uRGF0YVN0YXRlIH0gZnJvbSBcIi4vb3B0aW9uLXBpY2tlci9zdGF0ZS9mb2N1c2VkL29wdGlvbi1kYXRhLXN0YXRlLnN2ZWx0ZVwiO1xuICBpbXBvcnQgeyBjcmVhdGVPcHRpb25GaWx0ZXJTdGF0ZSB9IGZyb20gXCIuL29wdGlvbi1waWNrZXIvc3RhdGUvZm9jdXNlZC9vcHRpb24tZmlsdGVyLXN0YXRlLnN2ZWx0ZVwiO1xuICBpbXBvcnQgeyBjcmVhdGVPcHRpb25QZXJzaXN0ZW5jZVN0YXRlIH0gZnJvbSBcIi4vb3B0aW9uLXBpY2tlci9zdGF0ZS9mb2N1c2VkL29wdGlvbi1wZXJzaXN0ZW5jZS1zdGF0ZS5zdmVsdGVcIjtcbiAgaW1wb3J0IHsgY3JlYXRlT3B0aW9uVUlTdGF0ZSB9IGZyb20gXCIuL29wdGlvbi1waWNrZXIvc3RhdGUvZm9jdXNlZC9vcHRpb24tdWktc3RhdGUuc3ZlbHRlXCI7XG5cbiAgLy8gUHJvcHNcbiAgY29uc3QgeyBvbk9wdGlvblNlbGVjdGVkID0gKCkgPT4ge30sIGluaXRpYWxTZXF1ZW5jZSA9IFtdIH0gPSAkcHJvcHM8e1xuICAgIG9uT3B0aW9uU2VsZWN0ZWQ/OiAob3B0aW9uOiBQaWN0b2dyYXBoRGF0YSkgPT4gdm9pZDtcbiAgICBpbml0aWFsU2VxdWVuY2U/OiBQaWN0b2dyYXBoRGF0YVtdO1xuICB9PigpO1xuXG4gIC8vIENyZWF0ZSBtaWNyb3NlcnZpY2Ugc3RhdGVzXG4gIGNvbnN0IGRhdGFTdGF0ZSA9IGNyZWF0ZU9wdGlvbkRhdGFTdGF0ZSgpO1xuICBjb25zdCB1aVN0YXRlID0gY3JlYXRlT3B0aW9uVUlTdGF0ZSgpO1xuICBjb25zdCBmaWx0ZXJTdGF0ZSA9IGNyZWF0ZU9wdGlvbkZpbHRlclN0YXRlKGRhdGFTdGF0ZSwgdWlTdGF0ZSk7XG4gIGNvbnN0IHBlcnNpc3RlbmNlU3RhdGUgPSBjcmVhdGVPcHRpb25QZXJzaXN0ZW5jZVN0YXRlKCk7XG4gIGNvbnN0IGVycm9yU3RhdGUgPSBjcmVhdGVFcnJvclN0YXRlKCk7XG5cbiAgLy8gQ29udGFpbmVyIGRpbWVuc2lvbnMgZm9yIHJlc3BvbnNpdmUgbGF5b3V0XG4gIGxldCBjb250YWluZXJFbGVtZW50OiBIVE1MRWxlbWVudDtcbiAgbGV0IGNvbnRhaW5lcldpZHRoID0gJHN0YXRlKDgwMCk7XG4gIGxldCBjb250YWluZXJIZWlnaHQgPSAkc3RhdGUoNjAwKTtcblxuICAvLyBJbml0aWFsaXplIGNvbXBvbmVudFxuICBvbk1vdW50KCgpID0+IHtcbiAgICAvLyBTZXQgdXAgcmVzaXplIG9ic2VydmVyIGZvciByZXNwb25zaXZlIGJlaGF2aW9yXG4gICAgaWYgKGNvbnRhaW5lckVsZW1lbnQpIHtcbiAgICAgIGNvbnN0IHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykge1xuICAgICAgICAgIGNvbnRhaW5lcldpZHRoID0gZW50cnkuY29udGVudFJlY3Qud2lkdGg7XG4gICAgICAgICAgY29udGFpbmVySGVpZ2h0ID0gZW50cnkuY29udGVudFJlY3QuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUoY29udGFpbmVyRWxlbWVudCk7XG5cbiAgICAgIHJldHVybiAoKSA9PiByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgfVxuICB9KTtcblxuICAvLyBUcmFjayBpZiB3ZSd2ZSBsb2FkZWQgdG8gcHJldmVudCBpbmZpbml0ZSBsb29wXG4gIGxldCBoYXNMb2FkZWRJbml0aWFsU2VxdWVuY2UgPSAkc3RhdGUoZmFsc2UpO1xuXG4gIC8vIExvYWQgb3B0aW9ucyB3aGVuIHNlcXVlbmNlIGNoYW5nZXMgLSBwcmV2ZW50IGluZmluaXRlIGxvb3BcbiAgJGVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGluaXRpYWxTZXF1ZW5jZS5sZW5ndGggPj0gMCAmJiAhaGFzTG9hZGVkSW5pdGlhbFNlcXVlbmNlKSB7XG4gICAgICBoYXNMb2FkZWRJbml0aWFsU2VxdWVuY2UgPSB0cnVlO1xuICAgICAgbG9hZE9wdGlvbnNGb3JTZXF1ZW5jZShpbml0aWFsU2VxdWVuY2UpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQ29vcmRpbmF0ZWQgbG9hZGluZyBsb2dpYyAobW92ZWQgZnJvbSBjb21wb3NpdGlvbiBsYXllcilcbiAgYXN5bmMgZnVuY3Rpb24gbG9hZE9wdGlvbnNGb3JTZXF1ZW5jZShzZXF1ZW5jZTogUGljdG9ncmFwaERhdGFbXSkge1xuICAgIHRyeSB7XG4gICAgICBlcnJvclN0YXRlLmNsZWFyRXJyb3IoKTtcbiAgICAgIGRhdGFTdGF0ZS5zZXRTZXF1ZW5jZShzZXF1ZW5jZSk7XG5cbiAgICAgIC8vIENoZWNrIGZvciBwcmVsb2FkZWQgb3B0aW9ucyBmaXJzdCB0byBhdm9pZCBsb2FkaW5nIHN0YXRlXG4gICAgICBjb25zdCBwcmVsb2FkZWRPcHRpb25zID0gcGVyc2lzdGVuY2VTdGF0ZS5jaGVja1ByZWxvYWRlZE9wdGlvbnMoKTtcbiAgICAgIGlmIChwcmVsb2FkZWRPcHRpb25zKSB7XG4gICAgICAgIGRhdGFTdGF0ZS5zZXRPcHRpb25zKHByZWxvYWRlZE9wdGlvbnMpO1xuICAgICAgICB1aVN0YXRlLnNldExvYWRpbmcoZmFsc2UpO1xuICAgICAgICB1aVN0YXRlLnNldEVycm9yKG51bGwpO1xuXG4gICAgICAgIC8vIFNldCBkZWZhdWx0IHRhYiBpZiBuZWVkZWRcbiAgICAgICAgaWYgKFxuICAgICAgICAgICF1aVN0YXRlLmxhc3RTZWxlY3RlZFRhYlt1aVN0YXRlLnNvcnRNZXRob2RdIHx8XG4gICAgICAgICAgdWlTdGF0ZS5sYXN0U2VsZWN0ZWRUYWJbdWlTdGF0ZS5zb3J0TWV0aG9kXSA9PT0gbnVsbFxuICAgICAgICApIHtcbiAgICAgICAgICB1aVN0YXRlLnNldExhc3RTZWxlY3RlZFRhYkZvclNvcnQodWlTdGF0ZS5zb3J0TWV0aG9kLCBcImFsbFwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciBidWxrIHByZWxvYWRlZCBvcHRpb25zXG4gICAgICBjb25zdCB0YXJnZXRFbmRQb3NpdGlvbiA9IHBlcnNpc3RlbmNlU3RhdGUuZ2V0VGFyZ2V0RW5kUG9zaXRpb24oc2VxdWVuY2UpO1xuICAgICAgaWYgKHRhcmdldEVuZFBvc2l0aW9uKSB7XG4gICAgICAgIGNvbnN0IGJ1bGtPcHRpb25zID1cbiAgICAgICAgICBwZXJzaXN0ZW5jZVN0YXRlLmNoZWNrQnVsa1ByZWxvYWRlZE9wdGlvbnModGFyZ2V0RW5kUG9zaXRpb24pO1xuICAgICAgICBpZiAoYnVsa09wdGlvbnMgJiYgYnVsa09wdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGRhdGFTdGF0ZS5zZXRPcHRpb25zKGJ1bGtPcHRpb25zKTtcbiAgICAgICAgICB1aVN0YXRlLnNldExvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgIHVpU3RhdGUuc2V0RXJyb3IobnVsbCk7XG5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhdWlTdGF0ZS5sYXN0U2VsZWN0ZWRUYWJbdWlTdGF0ZS5zb3J0TWV0aG9kXSB8fFxuICAgICAgICAgICAgdWlTdGF0ZS5sYXN0U2VsZWN0ZWRUYWJbdWlTdGF0ZS5zb3J0TWV0aG9kXSA9PT0gbnVsbFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgdWlTdGF0ZS5zZXRMYXN0U2VsZWN0ZWRUYWJGb3JTb3J0KHVpU3RhdGUuc29ydE1ldGhvZCwgXCJhbGxcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBMb2FkIGZyb20gc2VydmljZXNcbiAgICAgIGF3YWl0IGRhdGFTdGF0ZS5sb2FkT3B0aW9uc0Zyb21TZXJ2aWNlcyhzZXF1ZW5jZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9yU3RhdGUuc2V0RXJyb3IoZXJyb3IsIFwiT1BUSU9OX0xPQURfRkFJTEVEXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEhhbmRsZSBvcHRpb24gc2VsZWN0aW9uXG4gIGFzeW5jIGZ1bmN0aW9uIGhhbmRsZU9wdGlvblNlbGVjdGVkKG9wdGlvbjogUGljdG9ncmFwaERhdGEpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZGF0YVN0YXRlLnNlbGVjdE9wdGlvbihvcHRpb24pO1xuICAgICAgb25PcHRpb25TZWxlY3RlZChvcHRpb24pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvclN0YXRlLnNldEVycm9yKGVycm9yLCBcIk9QVElPTl9TRUxFQ1RfRkFJTEVEXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEhhbmRsZSBzb3J0IG1ldGhvZCBjaGFuZ2VzXG4gIGZ1bmN0aW9uIGhhbmRsZVNvcnRNZXRob2RDaGFuZ2VkKG1ldGhvZDogc3RyaW5nKSB7XG4gICAgdWlTdGF0ZS5zZXRTb3J0TWV0aG9kKG1ldGhvZCBhcyBhbnkpOyAvLyBUeXBlIGFzc2VydGlvbiBmb3Igbm93XG4gIH1cbjwvc2NyaXB0PlxuXG48ZGl2XG4gIGNsYXNzPVwib3B0aW9uLXBpY2tlci1jb250YWluZXJcIlxuICBiaW5kOnRoaXM9e2NvbnRhaW5lckVsZW1lbnR9XG4gIGRhdGEtdGVzdGlkPVwib3B0aW9uLXBpY2tlci1jb250YWluZXJcIlxuPlxuICA8IS0tIEhlYWRlciB3aXRoIHNvcnRpbmcgY29udHJvbHMgLS0+XG4gIDxPcHRpb25QaWNrZXJIZWFkZXIgLz5cblxuICA8IS0tIEVycm9yIGJhbm5lciAtLT5cbiAgeyNpZiBlcnJvclN0YXRlLnN0YXRlLmhhc0Vycm9yfVxuICAgIDxFcnJvckJhbm5lclxuICAgICAgbWVzc2FnZT17ZXJyb3JTdGF0ZS5zdGF0ZS5lcnJvck1lc3NhZ2UgfHwgXCJBbiBlcnJvciBvY2N1cnJlZFwifVxuICAgICAgb25EaXNtaXNzPXtlcnJvclN0YXRlLmNsZWFyRXJyb3J9XG4gICAgLz5cbiAgey9pZn1cblxuICA8IS0tIE1haW4gY29udGVudCAtLT5cbiAgPGRpdiBjbGFzcz1cIm9wdGlvbi1waWNrZXItY29udGVudFwiPlxuICAgIHsjaWYgdWlTdGF0ZS5pc0xvYWRpbmd9XG4gICAgICA8TG9hZGluZ092ZXJsYXkgbWVzc2FnZT1cIkxvYWRpbmcgb3B0aW9ucy4uLlwiIC8+XG4gICAgezplbHNlIGlmIHVpU3RhdGUuZXJyb3J9XG4gICAgICA8ZGl2IGNsYXNzPVwiZXJyb3Itc3RhdGVcIj5cbiAgICAgICAgPHA+RXJyb3IgbG9hZGluZyBvcHRpb25zOiB7dWlTdGF0ZS5lcnJvcn08L3A+XG4gICAgICAgIDxidXR0b24gb25jbGljaz17KCkgPT4gbG9hZE9wdGlvbnNGb3JTZXF1ZW5jZShpbml0aWFsU2VxdWVuY2UpfT5cbiAgICAgICAgICBSZXRyeVxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIHs6ZWxzZSBpZiBmaWx0ZXJTdGF0ZS5maWx0ZXJlZE9wdGlvbnMubGVuZ3RoID09PSAwfVxuICAgICAgPGRpdiBjbGFzcz1cImVtcHR5LXN0YXRlXCI+XG4gICAgICAgIDxwPk5vIG9wdGlvbnMgYXZhaWxhYmxlIGZvciB0aGUgY3VycmVudCBzZXF1ZW5jZS48L3A+XG4gICAgICA8L2Rpdj5cbiAgICB7OmVsc2V9XG4gICAgICA8T3B0aW9uUGlja2VyU2Nyb2xsXG4gICAgICAgIHBpY3RvZ3JhcGhzPXtmaWx0ZXJTdGF0ZS5maWx0ZXJlZE9wdGlvbnN9XG4gICAgICAgIG9uUGljdG9ncmFwaFNlbGVjdGVkPXtoYW5kbGVPcHRpb25TZWxlY3RlZH1cbiAgICAgICAge2NvbnRhaW5lcldpZHRofVxuICAgICAgICB7Y29udGFpbmVySGVpZ2h0fVxuICAgICAgLz5cbiAgICB7L2lmfVxuICA8L2Rpdj5cbjwvZGl2PlxuXG48c3R5bGU+XG4gIC5vcHRpb24tcGlja2VyLWNvbnRhaW5lciB7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICAgIGhlaWdodDogMTAwJTtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xuICB9XG5cbiAgLm9wdGlvbi1waWNrZXItY29udGVudCB7XG4gICAgZmxleDogMTtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgfVxuXG4gIC5lcnJvci1zdGF0ZSxcbiAgLmVtcHR5LXN0YXRlIHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgcGFkZGluZzogdmFyKC0tc3BhY2luZy14bCk7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIGNvbG9yOiB2YXIoLS1tdXRlZC1mb3JlZ3JvdW5kKTtcbiAgfVxuXG4gIC5lcnJvci1zdGF0ZSBidXR0b24ge1xuICAgIG1hcmdpbi10b3A6IHZhcigtLXNwYWNpbmctbWQpO1xuICAgIHBhZGRpbmc6IHZhcigtLXNwYWNpbmctc20pIHZhcigtLXNwYWNpbmctbWQpO1xuICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnkpO1xuICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWZvcmVncm91bmQpO1xuICAgIGJvcmRlcjogbm9uZTtcbiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yYWRpdXMpO1xuICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuICB9XG5cbiAgLmVycm9yLXN0YXRlIGJ1dHRvbjpob3ZlciB7XG4gICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1ob3Zlcik7XG4gIH1cbjwvc3R5bGU+XG4iXSwiZmlsZSI6IkM6L1RLQS93ZWIvc3JjL2xpYi9jb21wb25lbnRzL2NvbnN0cnVjdC9PcHRpb25QaWNrZXJDb250YWluZXIuc3ZlbHRlIn0=