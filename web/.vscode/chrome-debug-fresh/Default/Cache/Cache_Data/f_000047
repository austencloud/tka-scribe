var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __decorateClass = (decorators, target, key, kind) => {
  var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target;
  for (var i = decorators.length - 1, decorator; i >= 0; i--)
    if (decorator = decorators[i])
      result = (kind ? decorator(target, key, result) : decorator(result)) || result;
  if (kind && result) __defProp(target, key, result);
  return result;
};
import { injectable } from "/node_modules/.vite/deps/inversify.js?v=608ae08a";
import { createMotionData } from "/src/lib/domain/MotionData.ts";
import {
  Orientation,
  MotionType,
  Location,
  PropType,
  RotationDirection,
  HandPath,
  MotionColor
} from "/src/lib/domain/enums.ts";
export let OrientationCalculationService = class {
  handpathCalculator;
  constructor() {
    this.handpathCalculator = new HandpathCalculator();
  }
  /**
   * Calculate end orientation - exact port from legacy calculate_end_ori()
   */
  calculateEndOrientation(motion, _color) {
    const motionType = motion.motionType;
    const turns = motion.turns;
    const startOrientation = motion.startOrientation;
    const propRotDir = motion.rotationDirection;
    const startLocation = motion.startLocation;
    const endLocation = motion.endLocation;
    let endOrientation;
    if (motionType === MotionType.FLOAT) {
      const handpathDirection = this.handpathCalculator.getHandRotDir(
        startLocation,
        endLocation
      );
      endOrientation = this.calculateFloatOrientation(
        startOrientation,
        handpathDirection
      );
    } else {
      endOrientation = this.calculateTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir,
        startLocation,
        endLocation
      );
    }
    if (endOrientation === null || endOrientation === void 0) {
      throw new Error(
        "Calculated end orientation cannot be None. Please check the input data and orientation calculator."
      );
    }
    return endOrientation;
  }
  /**
   * Calculate turn orientation - exact port from legacy
   */
  calculateTurnOrientation(motionType, turns, startOrientation, propRotDir, startLocation, endLocation) {
    if (turns === 0 || turns === 1 || turns === 2 || turns === 3) {
      return this.calculateWholeTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir
      );
    } else if (turns === "fl") {
      const handpathDirection = this.handpathCalculator.getHandRotDir(
        startLocation,
        endLocation
      );
      return this.calculateFloatOrientation(
        startOrientation,
        handpathDirection
      );
    } else {
      return this.calculateHalfTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir
      );
    }
  }
  /**
   * Calculate whole turn orientation - exact port from legacy
   */
  calculateWholeTurnOrientation(motionType, turns, startOrientation, _propRotDir) {
    if (motionType === MotionType.PRO || motionType === MotionType.STATIC) {
      if (turns % 2 === 0) {
        return startOrientation;
      } else {
        return this.switchOrientation(startOrientation);
      }
    } else if (motionType === MotionType.ANTI || motionType === MotionType.DASH) {
      if (turns % 2 === 0) {
        return this.switchOrientation(startOrientation);
      } else {
        return startOrientation;
      }
    }
    return startOrientation;
  }
  /**
   * Calculate half turn orientation - exact port from legacy
   */
  calculateHalfTurnOrientation(motionType, turns, startOrientation, propRotDir) {
    let orientationMap;
    if (motionType === MotionType.ANTI || motionType === MotionType.DASH) {
      orientationMap = {
        [`${Orientation.IN}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.IN}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.OUT}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.OUT}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.CLOCK}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.CLOCK}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.COUNTER}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.COUNTER}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN
      };
    } else if (motionType === MotionType.PRO || motionType === MotionType.STATIC) {
      orientationMap = {
        [`${Orientation.IN}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.IN}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.OUT}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.OUT}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.CLOCK}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.CLOCK}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.COUNTER}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.COUNTER}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT
      };
    } else {
      return startOrientation;
    }
    const key = `${startOrientation}_${propRotDir}`;
    return orientationMap[key] || startOrientation;
  }
  /**
   * Calculate float orientation - exact port from legacy
   */
  calculateFloatOrientation(startOrientation, handpathDirection) {
    const orientationMap = {
      [`${Orientation.IN}_${HandPath.CLOCKWISE}`]: Orientation.CLOCK,
      [`${Orientation.IN}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.COUNTER,
      [`${Orientation.OUT}_${HandPath.CLOCKWISE}`]: Orientation.COUNTER,
      [`${Orientation.OUT}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.CLOCK,
      [`${Orientation.CLOCK}_${HandPath.CLOCKWISE}`]: Orientation.OUT,
      [`${Orientation.CLOCK}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.IN,
      [`${Orientation.COUNTER}_${HandPath.CLOCKWISE}`]: Orientation.IN,
      [`${Orientation.COUNTER}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.OUT
    };
    const key = `${startOrientation}_${handpathDirection}`;
    return orientationMap[key] || startOrientation;
  }
  /**
   * Switch orientation - exact port from legacy
   */
  switchOrientation(ori) {
    const switchMap = {
      [Orientation.IN]: Orientation.OUT,
      [Orientation.OUT]: Orientation.IN,
      [Orientation.CLOCK]: Orientation.COUNTER,
      [Orientation.COUNTER]: Orientation.CLOCK
    };
    return switchMap[ori] || ori;
  }
  /**
   * Update start orientations - returns updated beat data
   */
  updateStartOrientations(nextBeat, lastBeat) {
    if (!nextBeat.pictographData || !lastBeat.pictographData) {
      throw new Error("Both beats must have pictographData");
    }
    const lastBlueMotion = lastBeat.pictographData.motions?.["blue"];
    const lastRedMotion = lastBeat.pictographData.motions?.["red"];
    if (!lastBlueMotion?.endOrientation || !lastRedMotion?.endOrientation) {
      throw new Error(
        "End orientations cannot be None. Ensure the previous beat has valid orientations."
      );
    }
    const updatedMotions = { ...nextBeat.pictographData.motions };
    if (updatedMotions.blue) {
      updatedMotions.blue = {
        ...updatedMotions.blue,
        startOrientation: lastBlueMotion.endOrientation
      };
    }
    if (updatedMotions.red) {
      updatedMotions.red = {
        ...updatedMotions.red,
        startOrientation: lastRedMotion.endOrientation
      };
    }
    return {
      ...nextBeat,
      pictographData: {
        ...nextBeat.pictographData,
        motions: updatedMotions
      }
    };
  }
  /**
   * Update end orientations - returns updated beat data
   */
  updateEndOrientations(beat) {
    if (!beat.pictographData) {
      throw new Error("Beat must have pictographData");
    }
    const updatedMotions = { ...beat.pictographData.motions };
    const blueMotion = beat.pictographData.motions?.["blue"];
    if (blueMotion) {
      const blueMotionData = createMotionData({
        motionType: blueMotion.motionType || MotionType.STATIC,
        rotationDirection: blueMotion.rotationDirection || RotationDirection.NO_ROTATION,
        startLocation: blueMotion.startLocation || Location.NORTH,
        endLocation: blueMotion.endLocation || Location.NORTH,
        turns: blueMotion.turns || 0,
        startOrientation: blueMotion.startOrientation || Orientation.IN,
        endOrientation: blueMotion.endOrientation || Orientation.IN,
        isVisible: blueMotion.isVisible ?? true,
        color: MotionColor.BLUE,
        propType: PropType.STAFF,
        // Default prop type
        arrowLocation: blueMotion.startLocation || Location.NORTH
        // Will be calculated
      });
      const calculatedEndOri = this.calculateEndOrientation(
        blueMotionData,
        MotionColor.BLUE
      );
      updatedMotions.blue = {
        ...blueMotion,
        endOrientation: calculatedEndOri
      };
    }
    const redMotion = beat.pictographData.motions?.["red"];
    if (redMotion) {
      const redMotionData = createMotionData({
        motionType: redMotion.motionType || MotionType.STATIC,
        rotationDirection: redMotion.rotationDirection || RotationDirection.NO_ROTATION,
        startLocation: redMotion.startLocation || Location.NORTH,
        endLocation: redMotion.endLocation || Location.NORTH,
        turns: redMotion.turns || 0,
        startOrientation: redMotion.startOrientation || Orientation.IN,
        endOrientation: redMotion.endOrientation || Orientation.IN,
        isVisible: redMotion.isVisible ?? true,
        color: MotionColor.RED,
        propType: PropType.STAFF,
        // Default prop type
        arrowLocation: redMotion.startLocation || Location.NORTH
        // Will be calculated
      });
      const calculatedEndOri = this.calculateEndOrientation(
        redMotionData,
        MotionColor.RED
      );
      updatedMotions.red = {
        ...redMotion,
        endOrientation: calculatedEndOri
      };
    }
    return {
      ...beat,
      pictographData: {
        ...beat.pictographData,
        motions: updatedMotions
      }
    };
  }
};
OrientationCalculationService = __decorateClass([
  injectable()
], OrientationCalculationService);
class HandpathCalculator {
  handRotDirMap;
  constructor() {
    const clockwisePairs = [
      [Location.SOUTH, Location.WEST],
      [Location.WEST, Location.NORTH],
      [Location.NORTH, Location.EAST],
      [Location.EAST, Location.SOUTH]
    ];
    const counterClockwisePairs = [
      [Location.WEST, Location.SOUTH],
      [Location.NORTH, Location.WEST],
      [Location.EAST, Location.NORTH],
      [Location.SOUTH, Location.EAST]
    ];
    const diagonalClockwise = [
      [Location.NORTHEAST, Location.SOUTHEAST],
      [Location.SOUTHEAST, Location.SOUTHWEST],
      [Location.SOUTHWEST, Location.NORTHWEST],
      [Location.NORTHWEST, Location.NORTHEAST]
    ];
    const diagonalCounterClockwise = [
      [Location.NORTHEAST, Location.NORTHWEST],
      [Location.NORTHWEST, Location.SOUTHWEST],
      [Location.SOUTHWEST, Location.SOUTHEAST],
      [Location.SOUTHEAST, Location.NORTHEAST]
    ];
    const dashPairs = [
      [Location.SOUTH, Location.NORTH],
      [Location.WEST, Location.EAST],
      [Location.NORTH, Location.SOUTH],
      [Location.EAST, Location.WEST],
      [Location.NORTHEAST, Location.SOUTHWEST],
      [Location.SOUTHEAST, Location.NORTHWEST],
      [Location.SOUTHWEST, Location.NORTHEAST],
      [Location.NORTHWEST, Location.SOUTHEAST]
    ];
    const staticPairs = [
      [Location.NORTH, Location.NORTH],
      [Location.EAST, Location.EAST],
      [Location.SOUTH, Location.SOUTH],
      [Location.WEST, Location.WEST],
      [Location.NORTHEAST, Location.NORTHEAST],
      [Location.SOUTHEAST, Location.SOUTHEAST],
      [Location.SOUTHWEST, Location.SOUTHWEST],
      [Location.NORTHWEST, Location.NORTHWEST]
    ];
    this.handRotDirMap = /* @__PURE__ */ new Map();
    clockwisePairs.concat(diagonalClockwise).forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.CLOCKWISE);
    });
    counterClockwisePairs.concat(diagonalCounterClockwise).forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.COUNTER_CLOCKWISE);
    });
    dashPairs.forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.DASH);
    });
    staticPairs.forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.STATIC);
    });
  }
  /**
   * Get hand rotation direction - exact port from legacy
   */
  getHandRotDir(startLocation, endLocation) {
    const key = `${startLocation}_${endLocation}`;
    return this.handRotDirMap.get(key) || "NO HAND ROTATION FOUND";
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9wb3NpdGlvbmluZy9PcmllbnRhdGlvbkNhbGN1bGF0aW9uU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBPcmllbnRhdGlvbiBDYWxjdWxhdGlvbiBTZXJ2aWNlIC0gQ29tcGxldGUgcG9ydCBmcm9tIGxlZ2FjeSBKc29uT3JpQ2FsY3VsYXRvclxuICpcbiAqIEV4YWN0IGltcGxlbWVudGF0aW9uIG9mIGxlZ2FjeSBvcmllbnRhdGlvbiBjYWxjdWxhdGlvbiBhbGdvcml0aG1zIGluY2x1ZGluZzpcbiAqIC0gQ29tcGxldGUgZmxvYXQgb3JpZW50YXRpb24gY2FsY3VsYXRpb24gd2l0aCBoYW5kcGF0aCBkaXJlY3Rpb25cbiAqIC0gRnVsbCB0dXJuIG9yaWVudGF0aW9uIGNhbGN1bGF0aW9uIGZvciB3aG9sZSBhbmQgaGFsZiB0dXJuc1xuICogLSBFeGFjdCBtb3Rpb24gdHlwZSBkaWZmZXJlbnRpYXRpb24gKFBSTy9TVEFUSUMgdnMgQU5USS9EQVNIKVxuICogLSBDb21wbGV0ZSBoYW5kcGF0aCBjYWxjdWxhdGlvbiBmb3IgYWxsIGxvY2F0aW9uIHBhaXJzXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBCZWF0RGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9CZWF0RGF0YVwiO1xuaW1wb3J0IHsgaW5qZWN0YWJsZSB9IGZyb20gXCJpbnZlcnNpZnlcIjtcbmltcG9ydCB0eXBlIHsgTW90aW9uRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9Nb3Rpb25EYXRhXCI7XG5pbXBvcnQgeyBjcmVhdGVNb3Rpb25EYXRhIH0gZnJvbSBcIiRsaWIvZG9tYWluL01vdGlvbkRhdGFcIjtcbmltcG9ydCB7XG4gIE9yaWVudGF0aW9uLFxuICBNb3Rpb25UeXBlLFxuICBMb2NhdGlvbixcbiAgUHJvcFR5cGUsXG4gIFJvdGF0aW9uRGlyZWN0aW9uLFxuICBIYW5kUGF0aCxcbiAgTW90aW9uQ29sb3IsXG59IGZyb20gXCIkbGliL2RvbWFpbi9lbnVtc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlSW50ZXJmYWNlIHtcbiAgY2FsY3VsYXRlRW5kT3JpZW50YXRpb24obW90aW9uOiBNb3Rpb25EYXRhLCBjb2xvcjogTW90aW9uQ29sb3IpOiBPcmllbnRhdGlvbjtcbiAgdXBkYXRlU3RhcnRPcmllbnRhdGlvbnMobmV4dEJlYXQ6IEJlYXREYXRhLCBsYXN0QmVhdDogQmVhdERhdGEpOiBCZWF0RGF0YTtcbiAgdXBkYXRlRW5kT3JpZW50YXRpb25zKGJlYXQ6IEJlYXREYXRhKTogQmVhdERhdGE7XG59XG5cbkBpbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBPcmllbnRhdGlvbkNhbGN1bGF0aW9uU2VydmljZVxuICBpbXBsZW1lbnRzIE9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlSW50ZXJmYWNlXG57XG4gIHByaXZhdGUgaGFuZHBhdGhDYWxjdWxhdG9yOiBIYW5kcGF0aENhbGN1bGF0b3I7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5oYW5kcGF0aENhbGN1bGF0b3IgPSBuZXcgSGFuZHBhdGhDYWxjdWxhdG9yKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGVuZCBvcmllbnRhdGlvbiAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3kgY2FsY3VsYXRlX2VuZF9vcmkoKVxuICAgKi9cbiAgY2FsY3VsYXRlRW5kT3JpZW50YXRpb24oXG4gICAgbW90aW9uOiBNb3Rpb25EYXRhLFxuICAgIF9jb2xvcjogTW90aW9uQ29sb3JcbiAgKTogT3JpZW50YXRpb24ge1xuICAgIGNvbnN0IG1vdGlvblR5cGUgPSBtb3Rpb24ubW90aW9uVHlwZTtcbiAgICBjb25zdCB0dXJucyA9IG1vdGlvbi50dXJucztcbiAgICBjb25zdCBzdGFydE9yaWVudGF0aW9uID0gbW90aW9uLnN0YXJ0T3JpZW50YXRpb247XG4gICAgY29uc3QgcHJvcFJvdERpciA9IG1vdGlvbi5yb3RhdGlvbkRpcmVjdGlvbjtcbiAgICBjb25zdCBzdGFydExvY2F0aW9uID0gbW90aW9uLnN0YXJ0TG9jYXRpb247XG4gICAgY29uc3QgZW5kTG9jYXRpb24gPSBtb3Rpb24uZW5kTG9jYXRpb247XG5cbiAgICBsZXQgZW5kT3JpZW50YXRpb246IE9yaWVudGF0aW9uO1xuXG4gICAgaWYgKG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuRkxPQVQpIHtcbiAgICAgIGNvbnN0IGhhbmRwYXRoRGlyZWN0aW9uID0gdGhpcy5oYW5kcGF0aENhbGN1bGF0b3IuZ2V0SGFuZFJvdERpcihcbiAgICAgICAgc3RhcnRMb2NhdGlvbixcbiAgICAgICAgZW5kTG9jYXRpb25cbiAgICAgICkgYXMgSGFuZFBhdGg7XG4gICAgICBlbmRPcmllbnRhdGlvbiA9IHRoaXMuY2FsY3VsYXRlRmxvYXRPcmllbnRhdGlvbihcbiAgICAgICAgc3RhcnRPcmllbnRhdGlvbixcbiAgICAgICAgaGFuZHBhdGhEaXJlY3Rpb25cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVuZE9yaWVudGF0aW9uID0gdGhpcy5jYWxjdWxhdGVUdXJuT3JpZW50YXRpb24oXG4gICAgICAgIG1vdGlvblR5cGUsXG4gICAgICAgIHR1cm5zLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uLFxuICAgICAgICBwcm9wUm90RGlyLFxuICAgICAgICBzdGFydExvY2F0aW9uLFxuICAgICAgICBlbmRMb2NhdGlvblxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoZW5kT3JpZW50YXRpb24gPT09IG51bGwgfHwgZW5kT3JpZW50YXRpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbGN1bGF0ZWQgZW5kIG9yaWVudGF0aW9uIGNhbm5vdCBiZSBOb25lLiBcIiArXG4gICAgICAgICAgXCJQbGVhc2UgY2hlY2sgdGhlIGlucHV0IGRhdGEgYW5kIG9yaWVudGF0aW9uIGNhbGN1bGF0b3IuXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuZE9yaWVudGF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0dXJuIG9yaWVudGF0aW9uIC0gZXhhY3QgcG9ydCBmcm9tIGxlZ2FjeVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUdXJuT3JpZW50YXRpb24oXG4gICAgbW90aW9uVHlwZTogTW90aW9uVHlwZSxcbiAgICB0dXJuczogbnVtYmVyIHwgXCJmbFwiLFxuICAgIHN0YXJ0T3JpZW50YXRpb246IE9yaWVudGF0aW9uLFxuICAgIHByb3BSb3REaXI6IFJvdGF0aW9uRGlyZWN0aW9uLFxuICAgIHN0YXJ0TG9jYXRpb246IExvY2F0aW9uLFxuICAgIGVuZExvY2F0aW9uOiBMb2NhdGlvblxuICApOiBPcmllbnRhdGlvbiB7XG4gICAgaWYgKHR1cm5zID09PSAwIHx8IHR1cm5zID09PSAxIHx8IHR1cm5zID09PSAyIHx8IHR1cm5zID09PSAzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVXaG9sZVR1cm5PcmllbnRhdGlvbihcbiAgICAgICAgbW90aW9uVHlwZSxcbiAgICAgICAgdHVybnMgYXMgbnVtYmVyLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uLFxuICAgICAgICBwcm9wUm90RGlyXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAodHVybnMgPT09IFwiZmxcIikge1xuICAgICAgY29uc3QgaGFuZHBhdGhEaXJlY3Rpb24gPSB0aGlzLmhhbmRwYXRoQ2FsY3VsYXRvci5nZXRIYW5kUm90RGlyKFxuICAgICAgICBzdGFydExvY2F0aW9uLFxuICAgICAgICBlbmRMb2NhdGlvblxuICAgICAgKSBhcyBIYW5kUGF0aDtcbiAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZUZsb2F0T3JpZW50YXRpb24oXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb24sXG4gICAgICAgIGhhbmRwYXRoRGlyZWN0aW9uXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVIYWxmVHVybk9yaWVudGF0aW9uKFxuICAgICAgICBtb3Rpb25UeXBlLFxuICAgICAgICB0dXJucyBhcyBudW1iZXIsXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb24sXG4gICAgICAgIHByb3BSb3REaXJcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB3aG9sZSB0dXJuIG9yaWVudGF0aW9uIC0gZXhhY3QgcG9ydCBmcm9tIGxlZ2FjeVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVXaG9sZVR1cm5PcmllbnRhdGlvbihcbiAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLFxuICAgIHR1cm5zOiBudW1iZXIsXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgX3Byb3BSb3REaXI6IFJvdGF0aW9uRGlyZWN0aW9uXG4gICk6IE9yaWVudGF0aW9uIHtcbiAgICBpZiAobW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5QUk8gfHwgbW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5TVEFUSUMpIHtcbiAgICAgIGlmICh0dXJucyAlIDIgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5zd2l0Y2hPcmllbnRhdGlvbihzdGFydE9yaWVudGF0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKFxuICAgICAgbW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5BTlRJIHx8XG4gICAgICBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLkRBU0hcbiAgICApIHtcbiAgICAgIGlmICh0dXJucyAlIDIgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3dpdGNoT3JpZW50YXRpb24oc3RhcnRPcmllbnRhdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gc3RhcnRPcmllbnRhdGlvbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGhhbGYgdHVybiBvcmllbnRhdGlvbiAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3lcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlSGFsZlR1cm5PcmllbnRhdGlvbihcbiAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLFxuICAgIHR1cm5zOiBudW1iZXIsXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgcHJvcFJvdERpcjogUm90YXRpb25EaXJlY3Rpb25cbiAgKTogT3JpZW50YXRpb24ge1xuICAgIGxldCBvcmllbnRhdGlvbk1hcDogUmVjb3JkPHN0cmluZywgT3JpZW50YXRpb24+O1xuXG4gICAgaWYgKG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuQU5USSB8fCBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLkRBU0gpIHtcbiAgICAgIG9yaWVudGF0aW9uTWFwID0ge1xuICAgICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ0xPQ0sgOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ09VTlRFUiA6IE9yaWVudGF0aW9uLkNMT0NLLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uT1VUfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ0xPQ0sgOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ0xPQ0t9XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uT1VUIDogT3JpZW50YXRpb24uSU4sXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DTE9DS31fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLklOIDogT3JpZW50YXRpb24uT1VULFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5JTiA6IE9yaWVudGF0aW9uLk9VVCxcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLkNPVU5URVJ9XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5PVVQgOiBPcmllbnRhdGlvbi5JTixcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuUFJPIHx8XG4gICAgICBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLlNUQVRJQ1xuICAgICkge1xuICAgICAgb3JpZW50YXRpb25NYXAgPSB7XG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5JTn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5JTn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLkNMT0NLIDogT3JpZW50YXRpb24uQ09VTlRFUixcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLk9VVH1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DTE9DSyA6IE9yaWVudGF0aW9uLkNPVU5URVIsXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DTE9DS31fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5JTiA6IE9yaWVudGF0aW9uLk9VVCxcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uT1VUIDogT3JpZW50YXRpb24uSU4sXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DT1VOVEVSfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLk9VVCA6IE9yaWVudGF0aW9uLklOLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLklOIDogT3JpZW50YXRpb24uT1VULFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gICAgfVxuXG4gICAgY29uc3Qga2V5ID0gYCR7c3RhcnRPcmllbnRhdGlvbn1fJHtwcm9wUm90RGlyfWA7XG4gICAgcmV0dXJuIG9yaWVudGF0aW9uTWFwW2tleV0gfHwgc3RhcnRPcmllbnRhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZmxvYXQgb3JpZW50YXRpb24gLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUZsb2F0T3JpZW50YXRpb24oXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgaGFuZHBhdGhEaXJlY3Rpb246IEhhbmRQYXRoXG4gICk6IE9yaWVudGF0aW9uIHtcbiAgICBjb25zdCBvcmllbnRhdGlvbk1hcDogUmVjb3JkPHN0cmluZywgT3JpZW50YXRpb24+ID0ge1xuICAgICAgW2Ake09yaWVudGF0aW9uLklOfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7SGFuZFBhdGguQ09VTlRFUl9DTE9DS1dJU0V9YF06IE9yaWVudGF0aW9uLkNPVU5URVIsXG4gICAgICBbYCR7T3JpZW50YXRpb24uT1VUfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uQ09VTlRFUixcbiAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7SGFuZFBhdGguQ09VTlRFUl9DTE9DS1dJU0V9YF06IE9yaWVudGF0aW9uLkNMT0NLLFxuICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uT1VULFxuICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke0hhbmRQYXRoLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOiBPcmllbnRhdGlvbi5JTixcbiAgICAgIFtgJHtPcmllbnRhdGlvbi5DT1VOVEVSfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uSU4sXG4gICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtIYW5kUGF0aC5DT1VOVEVSX0NMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uT1VULFxuICAgIH07XG5cbiAgICBjb25zdCBrZXkgPSBgJHtzdGFydE9yaWVudGF0aW9ufV8ke2hhbmRwYXRoRGlyZWN0aW9ufWA7XG4gICAgcmV0dXJuIG9yaWVudGF0aW9uTWFwW2tleV0gfHwgc3RhcnRPcmllbnRhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTd2l0Y2ggb3JpZW50YXRpb24gLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBwcml2YXRlIHN3aXRjaE9yaWVudGF0aW9uKG9yaTogT3JpZW50YXRpb24pOiBPcmllbnRhdGlvbiB7XG4gICAgY29uc3Qgc3dpdGNoTWFwOiBSZWNvcmQ8c3RyaW5nLCBPcmllbnRhdGlvbj4gPSB7XG4gICAgICBbT3JpZW50YXRpb24uSU5dOiBPcmllbnRhdGlvbi5PVVQsXG4gICAgICBbT3JpZW50YXRpb24uT1VUXTogT3JpZW50YXRpb24uSU4sXG4gICAgICBbT3JpZW50YXRpb24uQ0xPQ0tdOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgW09yaWVudGF0aW9uLkNPVU5URVJdOiBPcmllbnRhdGlvbi5DTE9DSyxcbiAgICB9O1xuICAgIHJldHVybiBzd2l0Y2hNYXBbb3JpXSB8fCBvcmk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHN0YXJ0IG9yaWVudGF0aW9ucyAtIHJldHVybnMgdXBkYXRlZCBiZWF0IGRhdGFcbiAgICovXG4gIHVwZGF0ZVN0YXJ0T3JpZW50YXRpb25zKG5leHRCZWF0OiBCZWF0RGF0YSwgbGFzdEJlYXQ6IEJlYXREYXRhKTogQmVhdERhdGEge1xuICAgIGlmICghbmV4dEJlYXQucGljdG9ncmFwaERhdGEgfHwgIWxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCb3RoIGJlYXRzIG11c3QgaGF2ZSBwaWN0b2dyYXBoRGF0YVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0Qmx1ZU1vdGlvbiA9IGxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcImJsdWVcIl07XG4gICAgY29uc3QgbGFzdFJlZE1vdGlvbiA9IGxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcInJlZFwiXTtcblxuICAgIGlmICghbGFzdEJsdWVNb3Rpb24/LmVuZE9yaWVudGF0aW9uIHx8ICFsYXN0UmVkTW90aW9uPy5lbmRPcmllbnRhdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkVuZCBvcmllbnRhdGlvbnMgY2Fubm90IGJlIE5vbmUuIEVuc3VyZSB0aGUgcHJldmlvdXMgYmVhdCBoYXMgdmFsaWQgb3JpZW50YXRpb25zLlwiXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB1cGRhdGVkIG1vdGlvbnMgd2l0aCBuZXcgc3RhcnQgb3JpZW50YXRpb25zXG4gICAgY29uc3QgdXBkYXRlZE1vdGlvbnMgPSB7IC4uLm5leHRCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMgfTtcblxuICAgIGlmICh1cGRhdGVkTW90aW9ucy5ibHVlKSB7XG4gICAgICB1cGRhdGVkTW90aW9ucy5ibHVlID0ge1xuICAgICAgICAuLi51cGRhdGVkTW90aW9ucy5ibHVlLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uOiBsYXN0Qmx1ZU1vdGlvbi5lbmRPcmllbnRhdGlvbixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHVwZGF0ZWRNb3Rpb25zLnJlZCkge1xuICAgICAgdXBkYXRlZE1vdGlvbnMucmVkID0ge1xuICAgICAgICAuLi51cGRhdGVkTW90aW9ucy5yZWQsXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb246IGxhc3RSZWRNb3Rpb24uZW5kT3JpZW50YXRpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFJldHVybiB1cGRhdGVkIGJlYXQgZGF0YVxuICAgIHJldHVybiB7XG4gICAgICAuLi5uZXh0QmVhdCxcbiAgICAgIHBpY3RvZ3JhcGhEYXRhOiB7XG4gICAgICAgIC4uLm5leHRCZWF0LnBpY3RvZ3JhcGhEYXRhLFxuICAgICAgICBtb3Rpb25zOiB1cGRhdGVkTW90aW9ucyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZW5kIG9yaWVudGF0aW9ucyAtIHJldHVybnMgdXBkYXRlZCBiZWF0IGRhdGFcbiAgICovXG4gIHVwZGF0ZUVuZE9yaWVudGF0aW9ucyhiZWF0OiBCZWF0RGF0YSk6IEJlYXREYXRhIHtcbiAgICBpZiAoIWJlYXQucGljdG9ncmFwaERhdGEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkJlYXQgbXVzdCBoYXZlIHBpY3RvZ3JhcGhEYXRhXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRNb3Rpb25zID0geyAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMgfTtcblxuICAgIC8vIENhbGN1bGF0ZSBibHVlIGVuZCBvcmllbnRhdGlvblxuICAgIGNvbnN0IGJsdWVNb3Rpb24gPSBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcImJsdWVcIl07XG4gICAgaWYgKGJsdWVNb3Rpb24pIHtcbiAgICAgIGNvbnN0IGJsdWVNb3Rpb25EYXRhOiBNb3Rpb25EYXRhID0gY3JlYXRlTW90aW9uRGF0YSh7XG4gICAgICAgIG1vdGlvblR5cGU6IGJsdWVNb3Rpb24ubW90aW9uVHlwZSB8fCBNb3Rpb25UeXBlLlNUQVRJQyxcbiAgICAgICAgcm90YXRpb25EaXJlY3Rpb246XG4gICAgICAgICAgYmx1ZU1vdGlvbi5yb3RhdGlvbkRpcmVjdGlvbiB8fCBSb3RhdGlvbkRpcmVjdGlvbi5OT19ST1RBVElPTixcbiAgICAgICAgc3RhcnRMb2NhdGlvbjogYmx1ZU1vdGlvbi5zdGFydExvY2F0aW9uIHx8IExvY2F0aW9uLk5PUlRILFxuICAgICAgICBlbmRMb2NhdGlvbjogYmx1ZU1vdGlvbi5lbmRMb2NhdGlvbiB8fCBMb2NhdGlvbi5OT1JUSCxcbiAgICAgICAgdHVybnM6IGJsdWVNb3Rpb24udHVybnMgfHwgMCxcbiAgICAgICAgc3RhcnRPcmllbnRhdGlvbjogYmx1ZU1vdGlvbi5zdGFydE9yaWVudGF0aW9uIHx8IE9yaWVudGF0aW9uLklOLFxuICAgICAgICBlbmRPcmllbnRhdGlvbjogYmx1ZU1vdGlvbi5lbmRPcmllbnRhdGlvbiB8fCBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgaXNWaXNpYmxlOiBibHVlTW90aW9uLmlzVmlzaWJsZSA/PyB0cnVlLFxuICAgICAgICBjb2xvcjogTW90aW9uQ29sb3IuQkxVRSxcbiAgICAgICAgcHJvcFR5cGU6IFByb3BUeXBlLlNUQUZGLCAvLyBEZWZhdWx0IHByb3AgdHlwZVxuICAgICAgICBhcnJvd0xvY2F0aW9uOiBibHVlTW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEgsIC8vIFdpbGwgYmUgY2FsY3VsYXRlZFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNhbGN1bGF0ZWRFbmRPcmkgPSB0aGlzLmNhbGN1bGF0ZUVuZE9yaWVudGF0aW9uKFxuICAgICAgICBibHVlTW90aW9uRGF0YSxcbiAgICAgICAgTW90aW9uQ29sb3IuQkxVRVxuICAgICAgKTtcblxuICAgICAgdXBkYXRlZE1vdGlvbnMuYmx1ZSA9IHtcbiAgICAgICAgLi4uYmx1ZU1vdGlvbixcbiAgICAgICAgZW5kT3JpZW50YXRpb246IGNhbGN1bGF0ZWRFbmRPcmksXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSByZWQgZW5kIG9yaWVudGF0aW9uXG4gICAgY29uc3QgcmVkTW90aW9uID0gYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zPy5bXCJyZWRcIl07XG4gICAgaWYgKHJlZE1vdGlvbikge1xuICAgICAgY29uc3QgcmVkTW90aW9uRGF0YTogTW90aW9uRGF0YSA9IGNyZWF0ZU1vdGlvbkRhdGEoe1xuICAgICAgICBtb3Rpb25UeXBlOiByZWRNb3Rpb24ubW90aW9uVHlwZSB8fCBNb3Rpb25UeXBlLlNUQVRJQyxcbiAgICAgICAgcm90YXRpb25EaXJlY3Rpb246XG4gICAgICAgICAgcmVkTW90aW9uLnJvdGF0aW9uRGlyZWN0aW9uIHx8IFJvdGF0aW9uRGlyZWN0aW9uLk5PX1JPVEFUSU9OLFxuICAgICAgICBzdGFydExvY2F0aW9uOiByZWRNb3Rpb24uc3RhcnRMb2NhdGlvbiB8fCBMb2NhdGlvbi5OT1JUSCxcbiAgICAgICAgZW5kTG9jYXRpb246IHJlZE1vdGlvbi5lbmRMb2NhdGlvbiB8fCBMb2NhdGlvbi5OT1JUSCxcbiAgICAgICAgdHVybnM6IHJlZE1vdGlvbi50dXJucyB8fCAwLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uOiByZWRNb3Rpb24uc3RhcnRPcmllbnRhdGlvbiB8fCBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgZW5kT3JpZW50YXRpb246IHJlZE1vdGlvbi5lbmRPcmllbnRhdGlvbiB8fCBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgaXNWaXNpYmxlOiByZWRNb3Rpb24uaXNWaXNpYmxlID8/IHRydWUsXG4gICAgICAgIGNvbG9yOiBNb3Rpb25Db2xvci5SRUQsXG4gICAgICAgIHByb3BUeXBlOiBQcm9wVHlwZS5TVEFGRiwgLy8gRGVmYXVsdCBwcm9wIHR5cGVcbiAgICAgICAgYXJyb3dMb2NhdGlvbjogcmVkTW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEgsIC8vIFdpbGwgYmUgY2FsY3VsYXRlZFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNhbGN1bGF0ZWRFbmRPcmkgPSB0aGlzLmNhbGN1bGF0ZUVuZE9yaWVudGF0aW9uKFxuICAgICAgICByZWRNb3Rpb25EYXRhLFxuICAgICAgICBNb3Rpb25Db2xvci5SRURcbiAgICAgICk7XG5cbiAgICAgIHVwZGF0ZWRNb3Rpb25zLnJlZCA9IHtcbiAgICAgICAgLi4ucmVkTW90aW9uLFxuICAgICAgICBlbmRPcmllbnRhdGlvbjogY2FsY3VsYXRlZEVuZE9yaSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUmV0dXJuIHVwZGF0ZWQgYmVhdCBkYXRhXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLmJlYXQsXG4gICAgICBwaWN0b2dyYXBoRGF0YToge1xuICAgICAgICAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLFxuICAgICAgICBtb3Rpb25zOiB1cGRhdGVkTW90aW9ucyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEhhbmRwYXRoIENhbGN1bGF0b3IgLSBFeGFjdCBwb3J0IGZyb20gbGVnYWN5IEhhbmRwYXRoQ2FsY3VsYXRvclxuICpcbiAqIENhbGN1bGF0ZXMgaGFuZCByb3RhdGlvbiBkaXJlY3Rpb24gYmFzZWQgb24gc3RhcnQgYW5kIGVuZCBsb2NhdGlvbnMuXG4gKiBDb21wbGV0ZSBtYXBwaW5nIG9mIGFsbCBsb2NhdGlvbiBwYWlycyB0byBoYW5kcGF0aCBkaXJlY3Rpb25zLlxuICovXG5jbGFzcyBIYW5kcGF0aENhbGN1bGF0b3Ige1xuICBwcml2YXRlIGhhbmRSb3REaXJNYXA6IE1hcDxzdHJpbmcsIHN0cmluZz47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gRXhhY3QgcGFpcnMgZnJvbSBsZWdhY3kgSGFuZHBhdGhDYWxjdWxhdG9yXG4gICAgY29uc3QgY2xvY2t3aXNlUGFpcnMgPSBbXG4gICAgICBbTG9jYXRpb24uU09VVEgsIExvY2F0aW9uLldFU1RdLFxuICAgICAgW0xvY2F0aW9uLldFU1QsIExvY2F0aW9uLk5PUlRIXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSCwgTG9jYXRpb24uRUFTVF0sXG4gICAgICBbTG9jYXRpb24uRUFTVCwgTG9jYXRpb24uU09VVEhdLFxuICAgIF07XG5cbiAgICBjb25zdCBjb3VudGVyQ2xvY2t3aXNlUGFpcnMgPSBbXG4gICAgICBbTG9jYXRpb24uV0VTVCwgTG9jYXRpb24uU09VVEhdLFxuICAgICAgW0xvY2F0aW9uLk5PUlRILCBMb2NhdGlvbi5XRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5FQVNULCBMb2NhdGlvbi5OT1JUSF0sXG4gICAgICBbTG9jYXRpb24uU09VVEgsIExvY2F0aW9uLkVBU1RdLFxuICAgIF07XG5cbiAgICBjb25zdCBkaWFnb25hbENsb2Nrd2lzZSA9IFtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1QsIExvY2F0aW9uLlNPVVRIRUFTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEhFQVNULCBMb2NhdGlvbi5TT1VUSFdFU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIV0VTVCwgTG9jYXRpb24uTk9SVEhXRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1QsIExvY2F0aW9uLk5PUlRIRUFTVF0sXG4gICAgXTtcblxuICAgIGNvbnN0IGRpYWdvbmFsQ291bnRlckNsb2Nrd2lzZSA9IFtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1QsIExvY2F0aW9uLk5PUlRIV0VTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEhXRVNULCBMb2NhdGlvbi5TT1VUSFdFU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIV0VTVCwgTG9jYXRpb24uU09VVEhFQVNUXSxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSEVBU1QsIExvY2F0aW9uLk5PUlRIRUFTVF0sXG4gICAgXTtcblxuICAgIGNvbnN0IGRhc2hQYWlycyA9IFtcbiAgICAgIFtMb2NhdGlvbi5TT1VUSCwgTG9jYXRpb24uTk9SVEhdLFxuICAgICAgW0xvY2F0aW9uLldFU1QsIExvY2F0aW9uLkVBU1RdLFxuICAgICAgW0xvY2F0aW9uLk5PUlRILCBMb2NhdGlvbi5TT1VUSF0sXG4gICAgICBbTG9jYXRpb24uRUFTVCwgTG9jYXRpb24uV0VTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEhFQVNULCBMb2NhdGlvbi5TT1VUSFdFU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIRUFTVCwgTG9jYXRpb24uTk9SVEhXRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSFdFU1QsIExvY2F0aW9uLk5PUlRIRUFTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEhXRVNULCBMb2NhdGlvbi5TT1VUSEVBU1RdLFxuICAgIF07XG5cbiAgICBjb25zdCBzdGF0aWNQYWlycyA9IFtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSCwgTG9jYXRpb24uTk9SVEhdLFxuICAgICAgW0xvY2F0aW9uLkVBU1QsIExvY2F0aW9uLkVBU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRILCBMb2NhdGlvbi5TT1VUSF0sXG4gICAgICBbTG9jYXRpb24uV0VTVCwgTG9jYXRpb24uV0VTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEhFQVNULCBMb2NhdGlvbi5OT1JUSEVBU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIRUFTVCwgTG9jYXRpb24uU09VVEhFQVNUXSxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSFdFU1QsIExvY2F0aW9uLlNPVVRIV0VTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEhXRVNULCBMb2NhdGlvbi5OT1JUSFdFU1RdLFxuICAgIF07XG5cbiAgICAvLyBCdWlsZCB0aGUgY29tcGxldGUgbWFwXG4gICAgdGhpcy5oYW5kUm90RGlyTWFwID0gbmV3IE1hcCgpO1xuXG4gICAgLy8gQWRkIGFsbCBtYXBwaW5nc1xuICAgIGNsb2Nrd2lzZVBhaXJzLmNvbmNhdChkaWFnb25hbENsb2Nrd2lzZSkuZm9yRWFjaCgoW3N0YXJ0LCBlbmRdKSA9PiB7XG4gICAgICB0aGlzLmhhbmRSb3REaXJNYXAuc2V0KGAke3N0YXJ0fV8ke2VuZH1gLCBIYW5kUGF0aC5DTE9DS1dJU0UpO1xuICAgIH0pO1xuXG4gICAgY291bnRlckNsb2Nrd2lzZVBhaXJzXG4gICAgICAuY29uY2F0KGRpYWdvbmFsQ291bnRlckNsb2Nrd2lzZSlcbiAgICAgIC5mb3JFYWNoKChbc3RhcnQsIGVuZF0pID0+IHtcbiAgICAgICAgdGhpcy5oYW5kUm90RGlyTWFwLnNldChgJHtzdGFydH1fJHtlbmR9YCwgSGFuZFBhdGguQ09VTlRFUl9DTE9DS1dJU0UpO1xuICAgICAgfSk7XG5cbiAgICBkYXNoUGFpcnMuZm9yRWFjaCgoW3N0YXJ0LCBlbmRdKSA9PiB7XG4gICAgICB0aGlzLmhhbmRSb3REaXJNYXAuc2V0KGAke3N0YXJ0fV8ke2VuZH1gLCBIYW5kUGF0aC5EQVNIKTtcbiAgICB9KTtcblxuICAgIHN0YXRpY1BhaXJzLmZvckVhY2goKFtzdGFydCwgZW5kXSkgPT4ge1xuICAgICAgdGhpcy5oYW5kUm90RGlyTWFwLnNldChgJHtzdGFydH1fJHtlbmR9YCwgSGFuZFBhdGguU1RBVElDKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaGFuZCByb3RhdGlvbiBkaXJlY3Rpb24gLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBnZXRIYW5kUm90RGlyKHN0YXJ0TG9jYXRpb246IHN0cmluZywgZW5kTG9jYXRpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3Qga2V5ID0gYCR7c3RhcnRMb2NhdGlvbn1fJHtlbmRMb2NhdGlvbn1gO1xuICAgIHJldHVybiB0aGlzLmhhbmRSb3REaXJNYXAuZ2V0KGtleSkgfHwgXCJOTyBIQU5EIFJPVEFUSU9OIEZPVU5EXCI7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7QUFXQSxTQUFTLGtCQUFrQjtBQUUzQixTQUFTLHdCQUF3QjtBQUNqQztBQUFBLEVBQ0U7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxPQUNLO0FBU0EsV0FBTSxnQ0FBTixNQUVQO0FBQUEs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
