import { GridMode } from "/src/lib/domain/index.ts";
export class CodexService {
  constructor(letterMappingRepository, lessonRepository, operationsService, letterQueryService) {
    this.letterMappingRepository = letterMappingRepository;
    this.lessonRepository = lessonRepository;
    this.operationsService = operationsService;
    this.letterQueryService = letterQueryService;
    console.log(
      "ðŸ”§ Clean CodexService initialized with proper dependency injection"
    );
  }
  initialized = false;
  /**
   * Initialize the service and all dependencies
   */
  async initialize() {
    if (this.initialized) return;
    try {
      console.log("ðŸš€ Initializing clean CodexService...");
      await Promise.all([
        this.letterMappingRepository.initialize(),
        this.lessonRepository.initialize()
        // LetterQueryService initializes automatically when first used
      ]);
      this.initialized = true;
      console.log("âœ… Clean CodexService fully initialized");
    } catch (error) {
      console.error("âŒ Failed to initialize clean CodexService:", error);
      throw error;
    }
  }
  /**
   * Load all pictographs in alphabetical order
   */
  async loadAllPictographs() {
    await this.initialize();
    console.log("ðŸ” Loading all codex pictographs...");
    const pictographs = await this.letterQueryService.getAllCodexPictographs(
      GridMode.DIAMOND
    );
    console.log(
      `ðŸ“Š Loaded ${pictographs.length} pictographs from codex query service`
    );
    const sortedPictographs = this.sortPictographsAlphabetically(pictographs);
    console.log(
      `âœ… Sorted ${sortedPictographs.length} pictographs alphabetically`
    );
    return sortedPictographs;
  }
  /**
   * Search pictographs by letter or pattern
   */
  async searchPictographs(searchTerm) {
    await this.initialize();
    const pictographs = await this.letterQueryService.searchPictographs(
      searchTerm,
      GridMode.DIAMOND
    );
    return this.sortPictographsAlphabetically(pictographs);
  }
  /**
   * Get a specific pictograph by letter
   */
  async getPictographByLetter(letter) {
    await this.initialize();
    return this.letterQueryService.getPictographByLetter(
      letter,
      GridMode.DIAMOND
    );
  }
  /**
   * Get pictographs for a specific lesson type
   */
  async getPictographsForLesson(lessonType) {
    await this.initialize();
    console.log(`ðŸ“š Getting pictographs for lesson type: ${lessonType}`);
    const letters = this.lessonRepository.getLettersForLesson(lessonType);
    if (letters.length === 0) {
      console.warn(`No letters found for lesson type: ${lessonType}`);
      return [];
    }
    const pictographs = await this.letterQueryService.getPictographsByLetters(
      letters,
      GridMode.DIAMOND
    );
    return this.sortPictographsAlphabetically(pictographs);
  }
  /**
   * Get letters organized by rows for grid display
   */
  getLettersByRow() {
    this.ensureInitialized();
    const rows = this.letterMappingRepository.getLetterRows();
    return rows.map((row) => [...row.letters]);
  }
  /**
   * Apply rotate operation to all pictographs
   */
  async rotateAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.rotateAllPictographs(pictographs);
  }
  /**
   * Apply mirror operation to all pictographs
   */
  async mirrorAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.mirrorAllPictographs(pictographs);
  }
  /**
   * Apply color swap operation to all pictographs
   */
  async colorSwapAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.colorSwapAllPictographs(pictographs);
  }
  /**
   * Get all pictograph data organized by letter
   */
  async getAllPictographData() {
    await this.initialize();
    const allLetters = this.letterMappingRepository.getAllLetters();
    const result = {};
    allLetters.forEach((letter) => {
      result[letter] = null;
    });
    const pictographs = await this.loadAllPictographs();
    pictographs.forEach((pictograph) => {
      if (pictograph.letter) {
        result[pictograph.letter] = pictograph;
      }
    });
    return result;
  }
  // Additional clean helper methods
  /**
   * Get available lesson types
   */
  async getAvailableLessonTypes() {
    await this.initialize();
    return this.lessonRepository.getAllLessonTypes();
  }
  /**
   * Get letters by category
   */
  getLettersByCategory(category) {
    this.ensureInitialized();
    return this.letterMappingRepository.getLettersByCategory(category);
  }
  /**
   * Check if a letter is valid in the codex
   */
  isValidLetter(letter) {
    this.ensureInitialized();
    return this.letterMappingRepository.isValidLetter(letter);
  }
  // Private helper methods
  sortPictographsAlphabetically(pictographs) {
    return [...pictographs].sort((a, b) => {
      const letterA = a.letter || "";
      const letterB = b.letter || "";
      return letterA.localeCompare(letterB);
    });
  }
  ensureInitialized() {
    if (!this.initialized) {
      throw new Error(
        "CodexService not initialized. Methods will auto-initialize, but sync methods require prior initialization."
      );
    }
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2NvZGV4L0NvZGV4U2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBDbGVhbiBDb2RleCBTZXJ2aWNlIEltcGxlbWVudGF0aW9uXG4gKlxuICogQSBjbGVhbiwgbWFpbnRhaW5hYmxlIGltcGxlbWVudGF0aW9uIHRoYXQgdXNlcyBwcm9wZXIgc2VwYXJhdGlvbiBvZiBjb25jZXJucy5cbiAqIE5vIG1vcmUgaGFyZGNvZGVkIG1hcHBpbmdzIG9yIG1peGVkIHJlc3BvbnNpYmlsaXRpZXMhXG4gKi9cblxuaW1wb3J0IHsgR3JpZE1vZGUgfSBmcm9tIFwiJGxpYi9kb21haW5cIjtcbmltcG9ydCB0eXBlIHsgUGljdG9ncmFwaERhdGEgfSBmcm9tIFwiJGxpYi9kb21haW4vUGljdG9ncmFwaERhdGFcIjtcbmltcG9ydCB0eXBlIHsgTGV0dGVyQ2F0ZWdvcnkgfSBmcm9tIFwiJGxpYi9kb21haW4vY29kZXgvdHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgSUxldHRlck1hcHBpbmdSZXBvc2l0b3J5IH0gZnJvbSBcIiRsaWIvcmVwb3NpdG9yaWVzL0xldHRlck1hcHBpbmdSZXBvc2l0b3J5XCI7XG5pbXBvcnQgdHlwZSB7IElMZXNzb25SZXBvc2l0b3J5IH0gZnJvbSBcIiRsaWIvcmVwb3NpdG9yaWVzL0xlc3NvblJlcG9zaXRvcnlcIjtcblxuaW1wb3J0IHR5cGUgeyBJUGljdG9ncmFwaE9wZXJhdGlvbnNTZXJ2aWNlIH0gZnJvbSBcIi4vUGljdG9ncmFwaE9wZXJhdGlvbnNTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSB7IElDb2RleFNlcnZpY2UgfSBmcm9tIFwiLi9JQ29kZXhTZXJ2aWNlXCI7XG5pbXBvcnQgdHlwZSB7IElMZXR0ZXJRdWVyeVNlcnZpY2UgfSBmcm9tIFwiLi4vaW1wbGVtZW50YXRpb25zL2RhdGEvTGV0dGVyUXVlcnlTZXJ2aWNlXCI7XG5cbi8vIFJlLWV4cG9ydCB0aGUgaW50ZXJmYWNlIGZvciBjb252ZW5pZW5jZVxuZXhwb3J0IHR5cGUgeyBJQ29kZXhTZXJ2aWNlIH0gZnJvbSBcIi4vSUNvZGV4U2VydmljZVwiO1xuXG5leHBvcnQgY2xhc3MgQ29kZXhTZXJ2aWNlIGltcGxlbWVudHMgSUNvZGV4U2VydmljZSB7XG4gIHByaXZhdGUgaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGxldHRlck1hcHBpbmdSZXBvc2l0b3J5OiBJTGV0dGVyTWFwcGluZ1JlcG9zaXRvcnksXG4gICAgcHJpdmF0ZSBsZXNzb25SZXBvc2l0b3J5OiBJTGVzc29uUmVwb3NpdG9yeSxcbiAgICBwcml2YXRlIG9wZXJhdGlvbnNTZXJ2aWNlOiBJUGljdG9ncmFwaE9wZXJhdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgbGV0dGVyUXVlcnlTZXJ2aWNlOiBJTGV0dGVyUXVlcnlTZXJ2aWNlXG4gICkge1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCLwn5SnIENsZWFuIENvZGV4U2VydmljZSBpbml0aWFsaXplZCB3aXRoIHByb3BlciBkZXBlbmRlbmN5IGluamVjdGlvblwiXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBzZXJ2aWNlIGFuZCBhbGwgZGVwZW5kZW5jaWVzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhcIvCfmoAgSW5pdGlhbGl6aW5nIGNsZWFuIENvZGV4U2VydmljZS4uLlwiKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBhbGwgcmVwb3NpdG9yaWVzIGFuZCBzZXJ2aWNlc1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICB0aGlzLmxldHRlck1hcHBpbmdSZXBvc2l0b3J5LmluaXRpYWxpemUoKSxcbiAgICAgICAgdGhpcy5sZXNzb25SZXBvc2l0b3J5LmluaXRpYWxpemUoKSxcbiAgICAgICAgLy8gTGV0dGVyUXVlcnlTZXJ2aWNlIGluaXRpYWxpemVzIGF1dG9tYXRpY2FsbHkgd2hlbiBmaXJzdCB1c2VkXG4gICAgICBdKTtcblxuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBDbGVhbiBDb2RleFNlcnZpY2UgZnVsbHkgaW5pdGlhbGl6ZWRcIik7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIGluaXRpYWxpemUgY2xlYW4gQ29kZXhTZXJ2aWNlOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBhbGwgcGljdG9ncmFwaHMgaW4gYWxwaGFiZXRpY2FsIG9yZGVyXG4gICAqL1xuICBhc3luYyBsb2FkQWxsUGljdG9ncmFwaHMoKTogUHJvbWlzZTxQaWN0b2dyYXBoRGF0YVtdPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIvCflI0gTG9hZGluZyBhbGwgY29kZXggcGljdG9ncmFwaHMuLi5cIik7XG4gICAgY29uc3QgcGljdG9ncmFwaHMgPSBhd2FpdCB0aGlzLmxldHRlclF1ZXJ5U2VydmljZS5nZXRBbGxDb2RleFBpY3RvZ3JhcGhzKFxuICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICk7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBg8J+TiiBMb2FkZWQgJHtwaWN0b2dyYXBocy5sZW5ndGh9IHBpY3RvZ3JhcGhzIGZyb20gY29kZXggcXVlcnkgc2VydmljZWBcbiAgICApO1xuICAgIGNvbnN0IHNvcnRlZFBpY3RvZ3JhcGhzID0gdGhpcy5zb3J0UGljdG9ncmFwaHNBbHBoYWJldGljYWxseShwaWN0b2dyYXBocyk7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBg4pyFIFNvcnRlZCAke3NvcnRlZFBpY3RvZ3JhcGhzLmxlbmd0aH0gcGljdG9ncmFwaHMgYWxwaGFiZXRpY2FsbHlgXG4gICAgKTtcbiAgICByZXR1cm4gc29ydGVkUGljdG9ncmFwaHM7XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoIHBpY3RvZ3JhcGhzIGJ5IGxldHRlciBvciBwYXR0ZXJuXG4gICAqL1xuICBhc3luYyBzZWFyY2hQaWN0b2dyYXBocyhzZWFyY2hUZXJtOiBzdHJpbmcpOiBQcm9taXNlPFBpY3RvZ3JhcGhEYXRhW10+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgIGNvbnN0IHBpY3RvZ3JhcGhzID0gYXdhaXQgdGhpcy5sZXR0ZXJRdWVyeVNlcnZpY2Uuc2VhcmNoUGljdG9ncmFwaHMoXG4gICAgICBzZWFyY2hUZXJtLFxuICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuc29ydFBpY3RvZ3JhcGhzQWxwaGFiZXRpY2FsbHkocGljdG9ncmFwaHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHNwZWNpZmljIHBpY3RvZ3JhcGggYnkgbGV0dGVyXG4gICAqL1xuICBhc3luYyBnZXRQaWN0b2dyYXBoQnlMZXR0ZXIobGV0dGVyOiBzdHJpbmcpOiBQcm9taXNlPFBpY3RvZ3JhcGhEYXRhIHwgbnVsbD4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgcmV0dXJuIHRoaXMubGV0dGVyUXVlcnlTZXJ2aWNlLmdldFBpY3RvZ3JhcGhCeUxldHRlcihcbiAgICAgIGxldHRlcixcbiAgICAgIEdyaWRNb2RlLkRJQU1PTkRcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwaWN0b2dyYXBocyBmb3IgYSBzcGVjaWZpYyBsZXNzb24gdHlwZVxuICAgKi9cbiAgYXN5bmMgZ2V0UGljdG9ncmFwaHNGb3JMZXNzb24obGVzc29uVHlwZTogc3RyaW5nKTogUHJvbWlzZTxQaWN0b2dyYXBoRGF0YVtdPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+TmiBHZXR0aW5nIHBpY3RvZ3JhcGhzIGZvciBsZXNzb24gdHlwZTogJHtsZXNzb25UeXBlfWApO1xuXG4gICAgY29uc3QgbGV0dGVycyA9IHRoaXMubGVzc29uUmVwb3NpdG9yeS5nZXRMZXR0ZXJzRm9yTGVzc29uKGxlc3NvblR5cGUpO1xuICAgIGlmIChsZXR0ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS53YXJuKGBObyBsZXR0ZXJzIGZvdW5kIGZvciBsZXNzb24gdHlwZTogJHtsZXNzb25UeXBlfWApO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGNvbnN0IHBpY3RvZ3JhcGhzID0gYXdhaXQgdGhpcy5sZXR0ZXJRdWVyeVNlcnZpY2UuZ2V0UGljdG9ncmFwaHNCeUxldHRlcnMoXG4gICAgICBsZXR0ZXJzLFxuICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuc29ydFBpY3RvZ3JhcGhzQWxwaGFiZXRpY2FsbHkocGljdG9ncmFwaHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBsZXR0ZXJzIG9yZ2FuaXplZCBieSByb3dzIGZvciBncmlkIGRpc3BsYXlcbiAgICovXG4gIGdldExldHRlcnNCeVJvdygpOiBzdHJpbmdbXVtdIHtcbiAgICB0aGlzLmVuc3VyZUluaXRpYWxpemVkKCk7XG5cbiAgICBjb25zdCByb3dzID0gdGhpcy5sZXR0ZXJNYXBwaW5nUmVwb3NpdG9yeS5nZXRMZXR0ZXJSb3dzKCk7XG4gICAgcmV0dXJuIHJvd3MubWFwKChyb3cpID0+IFsuLi5yb3cubGV0dGVyc10pOyAvLyBSZXR1cm4gY29weSB0byBwcmV2ZW50IG11dGF0aW9uXG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgcm90YXRlIG9wZXJhdGlvbiB0byBhbGwgcGljdG9ncmFwaHNcbiAgICovXG4gIGFzeW5jIHJvdGF0ZUFsbFBpY3RvZ3JhcGhzKFxuICAgIHBpY3RvZ3JhcGhzOiBQaWN0b2dyYXBoRGF0YVtdXG4gICk6IFByb21pc2U8UGljdG9ncmFwaERhdGFbXT4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgcmV0dXJuIHRoaXMub3BlcmF0aW9uc1NlcnZpY2Uucm90YXRlQWxsUGljdG9ncmFwaHMocGljdG9ncmFwaHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IG1pcnJvciBvcGVyYXRpb24gdG8gYWxsIHBpY3RvZ3JhcGhzXG4gICAqL1xuICBhc3luYyBtaXJyb3JBbGxQaWN0b2dyYXBocyhcbiAgICBwaWN0b2dyYXBoczogUGljdG9ncmFwaERhdGFbXVxuICApOiBQcm9taXNlPFBpY3RvZ3JhcGhEYXRhW10+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbnNTZXJ2aWNlLm1pcnJvckFsbFBpY3RvZ3JhcGhzKHBpY3RvZ3JhcGhzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBjb2xvciBzd2FwIG9wZXJhdGlvbiB0byBhbGwgcGljdG9ncmFwaHNcbiAgICovXG4gIGFzeW5jIGNvbG9yU3dhcEFsbFBpY3RvZ3JhcGhzKFxuICAgIHBpY3RvZ3JhcGhzOiBQaWN0b2dyYXBoRGF0YVtdXG4gICk6IFByb21pc2U8UGljdG9ncmFwaERhdGFbXT4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgcmV0dXJuIHRoaXMub3BlcmF0aW9uc1NlcnZpY2UuY29sb3JTd2FwQWxsUGljdG9ncmFwaHMocGljdG9ncmFwaHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgcGljdG9ncmFwaCBkYXRhIG9yZ2FuaXplZCBieSBsZXR0ZXJcbiAgICovXG4gIGFzeW5jIGdldEFsbFBpY3RvZ3JhcGhEYXRhKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgUGljdG9ncmFwaERhdGEgfCBudWxsPj4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgY29uc3QgYWxsTGV0dGVycyA9IHRoaXMubGV0dGVyTWFwcGluZ1JlcG9zaXRvcnkuZ2V0QWxsTGV0dGVycygpO1xuICAgIGNvbnN0IHJlc3VsdDogUmVjb3JkPHN0cmluZywgUGljdG9ncmFwaERhdGEgfCBudWxsPiA9IHt9O1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBhbGwgbGV0dGVycyB0byBudWxsXG4gICAgYWxsTGV0dGVycy5mb3JFYWNoKChsZXR0ZXIpID0+IHtcbiAgICAgIHJlc3VsdFtsZXR0ZXJdID0gbnVsbDtcbiAgICB9KTtcblxuICAgIC8vIExvYWQgYWN0dWFsIHBpY3RvZ3JhcGhzXG4gICAgY29uc3QgcGljdG9ncmFwaHMgPSBhd2FpdCB0aGlzLmxvYWRBbGxQaWN0b2dyYXBocygpO1xuICAgIHBpY3RvZ3JhcGhzLmZvckVhY2goKHBpY3RvZ3JhcGgpID0+IHtcbiAgICAgIGlmIChwaWN0b2dyYXBoLmxldHRlcikge1xuICAgICAgICByZXN1bHRbcGljdG9ncmFwaC5sZXR0ZXJdID0gcGljdG9ncmFwaDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBBZGRpdGlvbmFsIGNsZWFuIGhlbHBlciBtZXRob2RzXG5cbiAgLyoqXG4gICAqIEdldCBhdmFpbGFibGUgbGVzc29uIHR5cGVzXG4gICAqL1xuICBhc3luYyBnZXRBdmFpbGFibGVMZXNzb25UeXBlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICByZXR1cm4gdGhpcy5sZXNzb25SZXBvc2l0b3J5LmdldEFsbExlc3NvblR5cGVzKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGxldHRlcnMgYnkgY2F0ZWdvcnlcbiAgICovXG4gIGdldExldHRlcnNCeUNhdGVnb3J5KGNhdGVnb3J5OiBMZXR0ZXJDYXRlZ29yeSk6IHN0cmluZ1tdIHtcbiAgICB0aGlzLmVuc3VyZUluaXRpYWxpemVkKCk7XG5cbiAgICByZXR1cm4gdGhpcy5sZXR0ZXJNYXBwaW5nUmVwb3NpdG9yeS5nZXRMZXR0ZXJzQnlDYXRlZ29yeShjYXRlZ29yeSk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgYSBsZXR0ZXIgaXMgdmFsaWQgaW4gdGhlIGNvZGV4XG4gICAqL1xuICBpc1ZhbGlkTGV0dGVyKGxldHRlcjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgdGhpcy5lbnN1cmVJbml0aWFsaXplZCgpO1xuXG4gICAgcmV0dXJuIHRoaXMubGV0dGVyTWFwcGluZ1JlcG9zaXRvcnkuaXNWYWxpZExldHRlcihsZXR0ZXIpO1xuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gIHByaXZhdGUgc29ydFBpY3RvZ3JhcGhzQWxwaGFiZXRpY2FsbHkoXG4gICAgcGljdG9ncmFwaHM6IFBpY3RvZ3JhcGhEYXRhW11cbiAgKTogUGljdG9ncmFwaERhdGFbXSB7XG4gICAgcmV0dXJuIFsuLi5waWN0b2dyYXBoc10uc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgbGV0dGVyQSA9IGEubGV0dGVyIHx8IFwiXCI7XG4gICAgICBjb25zdCBsZXR0ZXJCID0gYi5sZXR0ZXIgfHwgXCJcIjtcbiAgICAgIHJldHVybiBsZXR0ZXJBLmxvY2FsZUNvbXBhcmUobGV0dGVyQik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGVuc3VyZUluaXRpYWxpemVkKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNvZGV4U2VydmljZSBub3QgaW5pdGlhbGl6ZWQuIE1ldGhvZHMgd2lsbCBhdXRvLWluaXRpYWxpemUsIGJ1dCBzeW5jIG1ldGhvZHMgcmVxdWlyZSBwcmlvciBpbml0aWFsaXphdGlvbi5cIlxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICJBQU9BLFNBQVMsZ0JBQWdCO0FBYWxCLGFBQU0s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
