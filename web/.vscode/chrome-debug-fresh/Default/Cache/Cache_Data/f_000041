import { createBeatData, createPictographData, GridMode } from "/src/lib/domain/index.ts";
import { Letter } from "/src/lib/domain/Letter.ts";
export class WorkbenchService {
  // ============================================================================
  // INITIALIZATION
  // ============================================================================
  initialize() {
    return {
      mode: "construct",
      isInitialized: true
    };
  }
  isInitialized(config) {
    return config.isInitialized;
  }
  // ============================================================================
  // MODE MANAGEMENT
  // ============================================================================
  setMode(config, mode) {
    return {
      ...config,
      mode
    };
  }
  canEditInMode(mode) {
    return mode === "construct" || mode === "edit";
  }
  // ============================================================================
  // BEAT INTERACTION LOGIC
  // ============================================================================
  shouldSelectBeatOnClick(mode, beatIndex) {
    return beatIndex >= 0;
  }
  shouldEditBeatOnDoubleClick(mode, beatIndex) {
    return this.canEditInMode(mode) && beatIndex >= 0;
  }
  // ============================================================================
  // BEAT EDITING OPERATIONS
  // ============================================================================
  createEditBeatOperation(beatIndex, sequence) {
    if (!this.isValidBeatIndex(sequence, beatIndex)) {
      return null;
    }
    return {
      beatIndex,
      operation: "edit"
    };
  }
  createClearBeatOperation(beatIndex, sequence) {
    if (!this.isValidBeatIndex(sequence, beatIndex)) {
      return null;
    }
    return {
      beatIndex,
      operation: "clear"
    };
  }
  // ============================================================================
  // BEAT DATA CREATION
  // ============================================================================
  createDefaultPictographData(letter = Letter.A) {
    return createPictographData({
      letter
    });
  }
  createEditedBeatData(originalBeat, pictographData) {
    return createBeatData({
      ...originalBeat,
      isBlank: false,
      pictographData
    });
  }
  createClearedBeatData(originalBeat) {
    return createBeatData({
      ...originalBeat,
      isBlank: true,
      pictographData: null
    });
  }
  // ============================================================================
  // SEQUENCE OPERATIONS
  // ============================================================================
  validateSequenceCreation(name, length) {
    const errors = [];
    const warnings = [];
    if (!name.trim()) {
      errors.push("Sequence name is required");
    }
    if (length < 1) {
      errors.push("Sequence length must be at least 1");
    }
    if (length > 64) {
      errors.push("Sequence length cannot exceed 64 beats");
    }
    if (length > 32) {
      warnings.push("Large sequences may impact performance");
    }
    return {
      isValid: errors.length === 0,
      errors,
      warnings
    };
  }
  createSequenceCreationParams(name = "New Sequence", length = 16) {
    return {
      name: name.trim() || "New Sequence",
      length: Math.max(1, Math.min(64, length))
    };
  }
  // ============================================================================
  // CONFIGURATION OPERATIONS
  // ============================================================================
  validateGridModeChange(currentMode, newMode) {
    return Object.values(GridMode).includes(newMode);
  }
  validateBeatSizeChange(currentSize, newSize) {
    return newSize >= 50 && newSize <= 300;
  }
  // ============================================================================
  // VALIDATION HELPERS
  // ============================================================================
  isValidBeatIndex(sequence, beatIndex) {
    if (!sequence) return false;
    return beatIndex >= 0 && beatIndex < sequence.beats.length;
  }
  canEditBeat(sequence, beatIndex, mode) {
    return this.canEditInMode(mode) && this.isValidBeatIndex(sequence, beatIndex);
  }
  canClearBeat(sequence, beatIndex) {
    if (!this.isValidBeatIndex(sequence, beatIndex)) {
      return false;
    }
    if (!sequence) {
      return false;
    }
    const beat = sequence.beats[beatIndex];
    return !beat.isBlank;
  }
  // ============================================================================
  // BEAT OPERATION HELPERS
  // ============================================================================
  /**
   * Determines if a beat should be edited or toggled based on its current state
   */
  getBeatEditAction(beat) {
    return beat.isBlank ? "edit" : "clear";
  }
  /**
   * Creates appropriate beat data based on the edit action
   */
  applyBeatEditAction(beat, action) {
    if (action === "edit") {
      const pictographData = this.createDefaultPictographData();
      return this.createEditedBeatData(beat, pictographData);
    } else {
      return this.createClearedBeatData(beat);
    }
  }
  /**
   * Validates that a beat edit operation can be performed
   */
  validateBeatEditOperation(operation, sequence, mode) {
    const errors = [];
    if (!this.isValidBeatIndex(sequence, operation.beatIndex)) {
      errors.push(`Invalid beat index: ${operation.beatIndex}`);
    }
    if (!this.canEditInMode(mode)) {
      errors.push(`Cannot edit beats in ${mode} mode`);
    }
    if (operation.operation === "clear" && sequence) {
      const beat = sequence.beats[operation.beatIndex];
      if (beat?.isBlank) {
        errors.push("Cannot clear an already blank beat");
      }
    }
    return {
      isValid: errors.length === 0,
      errors,
      warnings: []
    };
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy93b3JrYmVuY2gvV29ya2JlbmNoU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBQdXJlIFdvcmtiZW5jaCBTZXJ2aWNlIEltcGxlbWVudGF0aW9uXG4gKlxuICogRXh0cmFjdGVkIGJ1c2luZXNzIGxvZ2ljIGZyb20gV29ya2JlbmNoU2VydmljZS5zdmVsdGUudHNcbiAqIENvbnRhaW5zIG9ubHkgcHVyZSBmdW5jdGlvbnMgd2l0aCBubyByZWFjdGl2ZSBzdGF0ZS5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IEJlYXREYXRhLCBQaWN0b2dyYXBoRGF0YSwgU2VxdWVuY2VEYXRhIH0gZnJvbSBcIiRsaWIvZG9tYWluXCI7XG5pbXBvcnQgeyBjcmVhdGVCZWF0RGF0YSwgY3JlYXRlUGljdG9ncmFwaERhdGEsIEdyaWRNb2RlIH0gZnJvbSBcIiRsaWIvZG9tYWluXCI7XG5pbXBvcnQgeyBMZXR0ZXIgfSBmcm9tIFwiJGxpYi9kb21haW4vTGV0dGVyXCI7XG5pbXBvcnQgdHlwZSB7XG4gIEJlYXRFZGl0T3BlcmF0aW9uLFxuICBJV29ya2JlbmNoU2VydmljZSxcbiAgU2VxdWVuY2VDcmVhdGlvblBhcmFtcyxcbiAgVmFsaWRhdGlvblJlc3VsdCxcbiAgV29ya2JlbmNoQ29uZmlnLFxuICBXb3JrYmVuY2hNb2RlLFxufSBmcm9tIFwiJGxpYi9zZXJ2aWNlcy9pbnRlcmZhY2VzL3dvcmtiZW5jaC1pbnRlcmZhY2VzXCI7XG5cbmV4cG9ydCBjbGFzcyBXb3JrYmVuY2hTZXJ2aWNlIGltcGxlbWVudHMgSVdvcmtiZW5jaFNlcnZpY2Uge1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIElOSVRJQUxJWkFUSU9OXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBpbml0aWFsaXplKCk6IFdvcmtiZW5jaENvbmZpZyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1vZGU6IFwiY29uc3RydWN0XCIsXG4gICAgICBpc0luaXRpYWxpemVkOiB0cnVlLFxuICAgIH07XG4gIH1cblxuICBpc0luaXRpYWxpemVkKGNvbmZpZzogV29ya2JlbmNoQ29uZmlnKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGNvbmZpZy5pc0luaXRpYWxpemVkO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBNT0RFIE1BTkFHRU1FTlRcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIHNldE1vZGUoY29uZmlnOiBXb3JrYmVuY2hDb25maWcsIG1vZGU6IFdvcmtiZW5jaE1vZGUpOiBXb3JrYmVuY2hDb25maWcge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBtb2RlLFxuICAgIH07XG4gIH1cblxuICBjYW5FZGl0SW5Nb2RlKG1vZGU6IFdvcmtiZW5jaE1vZGUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gbW9kZSA9PT0gXCJjb25zdHJ1Y3RcIiB8fCBtb2RlID09PSBcImVkaXRcIjtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQkVBVCBJTlRFUkFDVElPTiBMT0dJQ1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgc2hvdWxkU2VsZWN0QmVhdE9uQ2xpY2sobW9kZTogV29ya2JlbmNoTW9kZSwgYmVhdEluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gYmVhdEluZGV4ID49IDA7IC8vIEFsd2F5cyBzZWxlY3QgdmFsaWQgYmVhdHNcbiAgfVxuXG4gIHNob3VsZEVkaXRCZWF0T25Eb3VibGVDbGljayhtb2RlOiBXb3JrYmVuY2hNb2RlLCBiZWF0SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmNhbkVkaXRJbk1vZGUobW9kZSkgJiYgYmVhdEluZGV4ID49IDA7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEJFQVQgRURJVElORyBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICBjcmVhdGVFZGl0QmVhdE9wZXJhdGlvbihcbiAgICBiZWF0SW5kZXg6IG51bWJlcixcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhIHwgbnVsbFxuICApOiBCZWF0RWRpdE9wZXJhdGlvbiB8IG51bGwge1xuICAgIGlmICghdGhpcy5pc1ZhbGlkQmVhdEluZGV4KHNlcXVlbmNlLCBiZWF0SW5kZXgpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgYmVhdEluZGV4LFxuICAgICAgb3BlcmF0aW9uOiBcImVkaXRcIixcbiAgICB9O1xuICB9XG5cbiAgY3JlYXRlQ2xlYXJCZWF0T3BlcmF0aW9uKFxuICAgIGJlYXRJbmRleDogbnVtYmVyLFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEgfCBudWxsXG4gICk6IEJlYXRFZGl0T3BlcmF0aW9uIHwgbnVsbCB7XG4gICAgaWYgKCF0aGlzLmlzVmFsaWRCZWF0SW5kZXgoc2VxdWVuY2UsIGJlYXRJbmRleCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBiZWF0SW5kZXgsXG4gICAgICBvcGVyYXRpb246IFwiY2xlYXJcIixcbiAgICB9O1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBCRUFUIERBVEEgQ1JFQVRJT05cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNyZWF0ZURlZmF1bHRQaWN0b2dyYXBoRGF0YShsZXR0ZXI6IExldHRlciA9IExldHRlci5BKTogUGljdG9ncmFwaERhdGEge1xuICAgIHJldHVybiBjcmVhdGVQaWN0b2dyYXBoRGF0YSh7XG4gICAgICBsZXR0ZXIsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVFZGl0ZWRCZWF0RGF0YShcbiAgICBvcmlnaW5hbEJlYXQ6IEJlYXREYXRhLFxuICAgIHBpY3RvZ3JhcGhEYXRhOiBQaWN0b2dyYXBoRGF0YVxuICApOiBCZWF0RGF0YSB7XG4gICAgcmV0dXJuIGNyZWF0ZUJlYXREYXRhKHtcbiAgICAgIC4uLm9yaWdpbmFsQmVhdCxcbiAgICAgIGlzQmxhbms6IGZhbHNlLFxuICAgICAgcGljdG9ncmFwaERhdGEsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVDbGVhcmVkQmVhdERhdGEob3JpZ2luYWxCZWF0OiBCZWF0RGF0YSk6IEJlYXREYXRhIHtcbiAgICByZXR1cm4gY3JlYXRlQmVhdERhdGEoe1xuICAgICAgLi4ub3JpZ2luYWxCZWF0LFxuICAgICAgaXNCbGFuazogdHJ1ZSxcbiAgICAgIHBpY3RvZ3JhcGhEYXRhOiBudWxsLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBTRVFVRU5DRSBPUEVSQVRJT05TXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICB2YWxpZGF0ZVNlcXVlbmNlQ3JlYXRpb24obmFtZTogc3RyaW5nLCBsZW5ndGg6IG51bWJlcik6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICghbmFtZS50cmltKCkpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiU2VxdWVuY2UgbmFtZSBpcyByZXF1aXJlZFwiKTtcbiAgICB9XG5cbiAgICBpZiAobGVuZ3RoIDwgMSkge1xuICAgICAgZXJyb3JzLnB1c2goXCJTZXF1ZW5jZSBsZW5ndGggbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgIH1cblxuICAgIGlmIChsZW5ndGggPiA2NCkge1xuICAgICAgZXJyb3JzLnB1c2goXCJTZXF1ZW5jZSBsZW5ndGggY2Fubm90IGV4Y2VlZCA2NCBiZWF0c1wiKTtcbiAgICB9XG5cbiAgICBpZiAobGVuZ3RoID4gMzIpIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goXCJMYXJnZSBzZXF1ZW5jZXMgbWF5IGltcGFjdCBwZXJmb3JtYW5jZVwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzLFxuICAgIH07XG4gIH1cblxuICBjcmVhdGVTZXF1ZW5jZUNyZWF0aW9uUGFyYW1zKFxuICAgIG5hbWU6IHN0cmluZyA9IFwiTmV3IFNlcXVlbmNlXCIsXG4gICAgbGVuZ3RoOiBudW1iZXIgPSAxNlxuICApOiBTZXF1ZW5jZUNyZWF0aW9uUGFyYW1zIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogbmFtZS50cmltKCkgfHwgXCJOZXcgU2VxdWVuY2VcIixcbiAgICAgIGxlbmd0aDogTWF0aC5tYXgoMSwgTWF0aC5taW4oNjQsIGxlbmd0aCkpLFxuICAgIH07XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENPTkZJR1VSQVRJT04gT1BFUkFUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgdmFsaWRhdGVHcmlkTW9kZUNoYW5nZShjdXJyZW50TW9kZTogR3JpZE1vZGUsIG5ld01vZGU6IEdyaWRNb2RlKTogYm9vbGVhbiB7XG4gICAgLy8gQWxsIGdyaWQgbW9kZSBjaGFuZ2VzIGFyZSB2YWxpZFxuICAgIHJldHVybiBPYmplY3QudmFsdWVzKEdyaWRNb2RlKS5pbmNsdWRlcyhuZXdNb2RlKTtcbiAgfVxuXG4gIHZhbGlkYXRlQmVhdFNpemVDaGFuZ2UoY3VycmVudFNpemU6IG51bWJlciwgbmV3U2l6ZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIG5ld1NpemUgPj0gNTAgJiYgbmV3U2l6ZSA8PSAzMDA7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFZBTElEQVRJT04gSEVMUEVSU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgaXNWYWxpZEJlYXRJbmRleChzZXF1ZW5jZTogU2VxdWVuY2VEYXRhIHwgbnVsbCwgYmVhdEluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBpZiAoIXNlcXVlbmNlKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIGJlYXRJbmRleCA+PSAwICYmIGJlYXRJbmRleCA8IHNlcXVlbmNlLmJlYXRzLmxlbmd0aDtcbiAgfVxuXG4gIGNhbkVkaXRCZWF0KFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEgfCBudWxsLFxuICAgIGJlYXRJbmRleDogbnVtYmVyLFxuICAgIG1vZGU6IFdvcmtiZW5jaE1vZGVcbiAgKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuY2FuRWRpdEluTW9kZShtb2RlKSAmJiB0aGlzLmlzVmFsaWRCZWF0SW5kZXgoc2VxdWVuY2UsIGJlYXRJbmRleClcbiAgICApO1xuICB9XG5cbiAgY2FuQ2xlYXJCZWF0KHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEgfCBudWxsLCBiZWF0SW5kZXg6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGlmICghdGhpcy5pc1ZhbGlkQmVhdEluZGV4KHNlcXVlbmNlLCBiZWF0SW5kZXgpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCFzZXF1ZW5jZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGJlYXQgPSBzZXF1ZW5jZS5iZWF0c1tiZWF0SW5kZXhdO1xuICAgIHJldHVybiAhYmVhdC5pc0JsYW5rOyAvLyBDYW4gb25seSBjbGVhciBub24tYmxhbmsgYmVhdHNcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQkVBVCBPUEVSQVRJT04gSEVMUEVSU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIERldGVybWluZXMgaWYgYSBiZWF0IHNob3VsZCBiZSBlZGl0ZWQgb3IgdG9nZ2xlZCBiYXNlZCBvbiBpdHMgY3VycmVudCBzdGF0ZVxuICAgKi9cbiAgZ2V0QmVhdEVkaXRBY3Rpb24oYmVhdDogQmVhdERhdGEpOiBcImVkaXRcIiB8IFwiY2xlYXJcIiB7XG4gICAgcmV0dXJuIGJlYXQuaXNCbGFuayA/IFwiZWRpdFwiIDogXCJjbGVhclwiO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYXBwcm9wcmlhdGUgYmVhdCBkYXRhIGJhc2VkIG9uIHRoZSBlZGl0IGFjdGlvblxuICAgKi9cbiAgYXBwbHlCZWF0RWRpdEFjdGlvbihiZWF0OiBCZWF0RGF0YSwgYWN0aW9uOiBcImVkaXRcIiB8IFwiY2xlYXJcIik6IEJlYXREYXRhIHtcbiAgICBpZiAoYWN0aW9uID09PSBcImVkaXRcIikge1xuICAgICAgY29uc3QgcGljdG9ncmFwaERhdGEgPSB0aGlzLmNyZWF0ZURlZmF1bHRQaWN0b2dyYXBoRGF0YSgpO1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlRWRpdGVkQmVhdERhdGEoYmVhdCwgcGljdG9ncmFwaERhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVDbGVhcmVkQmVhdERhdGEoYmVhdCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyB0aGF0IGEgYmVhdCBlZGl0IG9wZXJhdGlvbiBjYW4gYmUgcGVyZm9ybWVkXG4gICAqL1xuICB2YWxpZGF0ZUJlYXRFZGl0T3BlcmF0aW9uKFxuICAgIG9wZXJhdGlvbjogQmVhdEVkaXRPcGVyYXRpb24sXG4gICAgc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSB8IG51bGwsXG4gICAgbW9kZTogV29ya2JlbmNoTW9kZVxuICApOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoIXRoaXMuaXNWYWxpZEJlYXRJbmRleChzZXF1ZW5jZSwgb3BlcmF0aW9uLmJlYXRJbmRleCkpIHtcbiAgICAgIGVycm9ycy5wdXNoKGBJbnZhbGlkIGJlYXQgaW5kZXg6ICR7b3BlcmF0aW9uLmJlYXRJbmRleH1gKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuY2FuRWRpdEluTW9kZShtb2RlKSkge1xuICAgICAgZXJyb3JzLnB1c2goYENhbm5vdCBlZGl0IGJlYXRzIGluICR7bW9kZX0gbW9kZWApO1xuICAgIH1cblxuICAgIGlmIChvcGVyYXRpb24ub3BlcmF0aW9uID09PSBcImNsZWFyXCIgJiYgc2VxdWVuY2UpIHtcbiAgICAgIGNvbnN0IGJlYXQgPSBzZXF1ZW5jZS5iZWF0c1tvcGVyYXRpb24uYmVhdEluZGV4XTtcbiAgICAgIGlmIChiZWF0Py5pc0JsYW5rKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKFwiQ2Fubm90IGNsZWFyIGFuIGFscmVhZHkgYmxhbmsgYmVhdFwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICB9O1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiQUFRQSxTQUFTLGdCQUFnQixzQkFBc0IsZ0JBQWdCO0FBQy9ELFNBQVMsY0FBYztBQVVoQixhQUFNLGlCQUE4QztBQUFBO0FBQUE7QUFBQTtBQUFBLEVBS3pELGFBQThCO0FBQzVCLFdBQU87QUFBQSxNQUNMLE1BQU07QUFBQSxNQUNOLGVBQWU7QUFBQSxJQUNqQjtBQUFBLEVBQ0Y7QUFBQSxFQUVBLGNBQWMsUUFBa0M7QUFDOUMsV0FBTyxPQUFPO0FBQUEsRUFDaEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQU1BLFFBQVEsUUFBeUIsTUFBc0M7QUFDckUsV0FBTztBQUFBLE1BQ0wsR0FBRztBQUFBLE1BQ0g7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUFBLEVBRUEsY0FBYyxNQUE4QjtBQUMxQyxX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
