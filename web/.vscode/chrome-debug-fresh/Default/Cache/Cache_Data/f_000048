import { MotionColor } from "/src/lib/domain/enums.ts";
import { PropPlacementService } from "/src/lib/services/implementations/positioning/PropPlacementService.ts";
export class PropCoordinatorService {
  svgCache = /* @__PURE__ */ new Map();
  placementService;
  constructor() {
    this.placementService = new PropPlacementService();
  }
  async calculatePropRenderData(PropPlacementData, motionData, pictographData) {
    try {
      if (!pictographData) {
        throw new Error(
          "PictographData is required for prop placement calculation"
        );
      }
      if (!motionData) {
        throw new Error(
          "MotionData is required for prop placement calculation"
        );
      }
      const placementData = this.placementService.calculatePlacement(
        pictographData,
        motionData
      );
      console.log("‚úÖ About to load SVG data");
      const svgData = await this.loadSvgData(PropPlacementData, motionData);
      console.log("‚úÖ SVG data loaded:", svgData);
      const result = {
        position: { x: placementData.positionX, y: placementData.positionY },
        rotation: placementData.rotationAngle,
        svgData,
        loaded: true,
        error: null
      };
      console.log(
        "‚úÖ PropCoordinatorService.calculatePropRenderData returning:",
        result
      );
      return result;
    } catch (error) {
      console.error(
        "‚ùå PropCoordinatorService.calculatePropRenderData error:",
        error
      );
      return {
        position: { x: 475, y: 475 },
        rotation: 0,
        svgData: null,
        loaded: false,
        error: error instanceof Error ? error.message : "Unknown error"
      };
    }
  }
  async loadSvgData(propData, motionData) {
    const color = motionData?.color || MotionColor.BLUE;
    const cacheKey = `${motionData?.propType || "staff"}_${color}`;
    if (this.svgCache.has(cacheKey)) {
      console.log(
        `‚úÖ PropCoordinatorService: Using cached SVG for ${cacheKey}`
      );
      const cachedData = this.svgCache.get(cacheKey);
      if (cachedData) {
        return cachedData;
      }
    }
    console.log(`üîÑ PropCoordinatorService: Creating new SVG for ${cacheKey}`);
    const response = await fetch(
      `/images/props/${motionData?.propType || "staff"}.svg`
    );
    if (!response.ok) throw new Error("Failed to fetch SVG");
    const originalSvgText = await response.text();
    const { viewBox, center } = this.parsePropSvg(originalSvgText);
    const coloredSvgText = this.applyColorToSvg(originalSvgText, color);
    const svgContent = this.extractSvgContent(coloredSvgText);
    const svgData = {
      svgContent,
      viewBox,
      center
    };
    console.log(`üíæ PropCoordinatorService: Caching SVG for ${cacheKey}`);
    this.svgCache.set(cacheKey, svgData);
    return svgData;
  }
  parsePropSvg(svgText) {
    const doc = new DOMParser().parseFromString(svgText, "image/svg+xml");
    const svg = doc.documentElement;
    const viewBoxValues = svg.getAttribute("viewBox")?.split(/\s+/) || [
      "0",
      "0",
      "252.8",
      "77.8"
    ];
    const viewBox = {
      width: parseFloat(viewBoxValues[2] || "252.8") || 252.8,
      height: parseFloat(viewBoxValues[3] || "77.8") || 77.8
    };
    let center = { x: viewBox.width / 2, y: viewBox.height / 2 };
    try {
      const centerElement = doc.getElementById("centerPoint");
      if (centerElement) {
        center = {
          x: parseFloat(centerElement.getAttribute("cx") || "0") || center.x,
          y: parseFloat(centerElement.getAttribute("cy") || "0") || center.y
        };
      }
    } catch {
    }
    return { viewBox, center };
  }
  applyColorToSvg(svgText, color) {
    const colorMap = /* @__PURE__ */ new Map([
      [MotionColor.BLUE, "#2E3192"],
      [MotionColor.RED, "#ED1C24"]
    ]);
    const targetColor = colorMap.get(color) || "#2E3192";
    let coloredSvg = svgText.replace(
      /fill="#[0-9A-Fa-f]{6}"/g,
      `fill="${targetColor}"`
    );
    coloredSvg = coloredSvg.replace(
      /fill:\s*#[0-9A-Fa-f]{6}/g,
      `fill:${targetColor}`
    );
    const colorSuffix = color.toLowerCase();
    coloredSvg = coloredSvg.replace(/\.st(\d+)/g, `.st$1-${colorSuffix}`);
    coloredSvg = coloredSvg.replace(
      /class="st(\d+)"/g,
      `class="st$1-${colorSuffix}"`
    );
    coloredSvg = coloredSvg.replace(
      /<circle[^>]*id="centerPoint"[^>]*\/?>/g,
      ""
    );
    console.log(
      `üîß PropCoordinatorService: Applied unique class names with suffix -${colorSuffix}`
    );
    return coloredSvg;
  }
  extractSvgContent(svgText) {
    console.log(
      `üîç PropCoordinatorService: Extracting SVG content from: ${svgText.substring(0, 200)}...`
    );
    const svgContentMatch = svgText.match(/<svg[^>]*>(.*)<\/svg>/s);
    if (!svgContentMatch) {
      console.warn("Could not extract SVG content");
      console.log(
        `üö´ PropCoordinatorService: SVG text that failed to match: ${svgText}`
      );
      return svgText;
    }
    const extractedContent = svgContentMatch[1];
    console.log(
      `‚úÖ PropCoordinatorService: Extracted SVG content: ${extractedContent.substring(0, 200)}...`
    );
    return extractedContent;
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9yZW5kZXJpbmcvUHJvcENvb3JkaW5hdG9yU2VydmljZS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLyoqXG4gKiBQcm9wIENvb3JkaW5hdG9yIFNlcnZpY2VcbiAqXG4gKiBPcmNoZXN0cmF0ZXMgcHJvcCByZW5kZXJpbmcgYnkgY29vcmRpbmF0aW5nIHBsYWNlbWVudCBjYWxjdWxhdGlvbiBhbmQgU1ZHIGxvYWRpbmcuXG4gKiBGb2N1c2VzIG9uIHJlbmRlcmluZyBjb29yZGluYXRpb24gcmF0aGVyIHRoYW4gcGxhY2VtZW50IGNhbGN1bGF0aW9uIGxvZ2ljLlxuICogVXNlcyBQcm9wUGxhY2VtZW50U2VydmljZSBmb3IgcGxhY2VtZW50IGNhbGN1bGF0aW9ucyBmb2xsb3dpbmcgc2VwYXJhdGlvbiBvZiBjb25jZXJucy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7XG4gIFByb3BQbGFjZW1lbnREYXRhLFxuICBNb3Rpb25EYXRhLFxuICBQaWN0b2dyYXBoRGF0YSxcbn0gZnJvbSBcIiRsaWIvZG9tYWluXCI7XG5pbXBvcnQgeyBNb3Rpb25Db2xvciB9IGZyb20gXCIkbGliL2RvbWFpbi9lbnVtc1wiO1xuaW1wb3J0IHsgUHJvcFBsYWNlbWVudFNlcnZpY2UgfSBmcm9tIFwiLi4vcG9zaXRpb25pbmcvUHJvcFBsYWNlbWVudFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIHsgSVByb3BQbGFjZW1lbnRTZXJ2aWNlIH0gZnJvbSBcIi4uL3Bvc2l0aW9uaW5nL1Byb3BQbGFjZW1lbnRTZXJ2aWNlXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvcFJlbmRlckRhdGEge1xuICBwb3NpdGlvbjogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9O1xuICByb3RhdGlvbjogbnVtYmVyO1xuICBzdmdEYXRhOiB7XG4gICAgc3ZnQ29udGVudDogc3RyaW5nO1xuICAgIHZpZXdCb3g6IHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXIgfTtcbiAgICBjZW50ZXI6IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfTtcbiAgfSB8IG51bGw7XG4gIGxvYWRlZDogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVByb3BDb29yZGluYXRvclNlcnZpY2Uge1xuICBjYWxjdWxhdGVQcm9wUmVuZGVyRGF0YShcbiAgICBQcm9wUGxhY2VtZW50RGF0YTogUHJvcFBsYWNlbWVudERhdGEsXG4gICAgbW90aW9uRGF0YT86IE1vdGlvbkRhdGEsXG4gICAgcGljdG9ncmFwaERhdGE/OiBQaWN0b2dyYXBoRGF0YSAvLyDinIUgU0lNUExJRklFRDogQ29tcGxldGUgcGljdG9ncmFwaCBkYXRhIGNvbnRhaW5zIGdyaWRNb2RlXG4gICk6IFByb21pc2U8UHJvcFJlbmRlckRhdGE+O1xufVxuXG5leHBvcnQgY2xhc3MgUHJvcENvb3JkaW5hdG9yU2VydmljZSBpbXBsZW1lbnRzIElQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdmdDYWNoZSA9IG5ldyBNYXA8XG4gICAgc3RyaW5nLFxuICAgIHtcbiAgICAgIHN2Z0NvbnRlbnQ6IHN0cmluZztcbiAgICAgIHZpZXdCb3g6IHsgd2lkdGg6IG51bWJlcjsgaGVpZ2h0OiBudW1iZXIgfTtcbiAgICAgIGNlbnRlcjogeyB4OiBudW1iZXI7IHk6IG51bWJlciB9O1xuICAgIH1cbiAgPigpO1xuICBwcml2YXRlIHBsYWNlbWVudFNlcnZpY2U6IElQcm9wUGxhY2VtZW50U2VydmljZTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnBsYWNlbWVudFNlcnZpY2UgPSBuZXcgUHJvcFBsYWNlbWVudFNlcnZpY2UoKTtcbiAgfVxuXG4gIGFzeW5jIGNhbGN1bGF0ZVByb3BSZW5kZXJEYXRhKFxuICAgIFByb3BQbGFjZW1lbnREYXRhOiBQcm9wUGxhY2VtZW50RGF0YSxcbiAgICBtb3Rpb25EYXRhPzogTW90aW9uRGF0YSxcbiAgICBwaWN0b2dyYXBoRGF0YT86IFBpY3RvZ3JhcGhEYXRhXG4gICk6IFByb21pc2U8UHJvcFJlbmRlckRhdGE+IHtcbiAgICAvLyBEZWJ1ZyBsb2dnaW5nIHJlbW92ZWQgZm9yIHBlcmZvcm1hbmNlXG5cbiAgICB0cnkge1xuICAgICAgLy8g4pyFIFNJTVBMSUZJRUQ6IE9ubHkgbmVlZCBwaWN0b2dyYXBoRGF0YSBhbmQgbW90aW9uRGF0YSBmb3IgcGxhY2VtZW50IGNhbGN1bGF0aW9uXG4gICAgICBpZiAoIXBpY3RvZ3JhcGhEYXRhKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlBpY3RvZ3JhcGhEYXRhIGlzIHJlcXVpcmVkIGZvciBwcm9wIHBsYWNlbWVudCBjYWxjdWxhdGlvblwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghbW90aW9uRGF0YSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJNb3Rpb25EYXRhIGlzIHJlcXVpcmVkIGZvciBwcm9wIHBsYWNlbWVudCBjYWxjdWxhdGlvblwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBsYWNlbWVudERhdGEgPSB0aGlzLnBsYWNlbWVudFNlcnZpY2UuY2FsY3VsYXRlUGxhY2VtZW50KFxuICAgICAgICBwaWN0b2dyYXBoRGF0YSxcbiAgICAgICAgbW90aW9uRGF0YVxuICAgICAgKTtcblxuICAgICAgLy8gTG9hZCBTVkcgZGF0YSB1c2luZyBtb3Rpb24gZGF0YSBmb3IgY29sb3IgKHNpbmdsZSBzb3VyY2Ugb2YgdHJ1dGgpXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBBYm91dCB0byBsb2FkIFNWRyBkYXRhXCIpO1xuICAgICAgY29uc3Qgc3ZnRGF0YSA9IGF3YWl0IHRoaXMubG9hZFN2Z0RhdGEoUHJvcFBsYWNlbWVudERhdGEsIG1vdGlvbkRhdGEpO1xuICAgICAgY29uc29sZS5sb2coXCLinIUgU1ZHIGRhdGEgbG9hZGVkOlwiLCBzdmdEYXRhKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICBwb3NpdGlvbjogeyB4OiBwbGFjZW1lbnREYXRhLnBvc2l0aW9uWCwgeTogcGxhY2VtZW50RGF0YS5wb3NpdGlvblkgfSxcbiAgICAgICAgcm90YXRpb246IHBsYWNlbWVudERhdGEucm90YXRpb25BbmdsZSxcbiAgICAgICAgc3ZnRGF0YSxcbiAgICAgICAgbG9hZGVkOiB0cnVlLFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBcIuKchSBQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlLmNhbGN1bGF0ZVByb3BSZW5kZXJEYXRhIHJldHVybmluZzpcIixcbiAgICAgICAgcmVzdWx0XG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgXCLinYwgUHJvcENvb3JkaW5hdG9yU2VydmljZS5jYWxjdWxhdGVQcm9wUmVuZGVyRGF0YSBlcnJvcjpcIixcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwb3NpdGlvbjogeyB4OiA0NzUsIHk6IDQ3NSB9LFxuICAgICAgICByb3RhdGlvbjogMCxcbiAgICAgICAgc3ZnRGF0YTogbnVsbCxcbiAgICAgICAgbG9hZGVkOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZFN2Z0RhdGEoXG4gICAgcHJvcERhdGE6IFByb3BQbGFjZW1lbnREYXRhLFxuICAgIG1vdGlvbkRhdGE/OiBNb3Rpb25EYXRhXG4gICk6IFByb21pc2U8e1xuICAgIHN2Z0NvbnRlbnQ6IHN0cmluZztcbiAgICB2aWV3Qm94OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG4gICAgY2VudGVyOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gIH0+IHtcbiAgICAvLyBVc2UgbW90aW9uRGF0YS5jb2xvciBhcyBzb3VyY2Ugb2YgdHJ1dGgsIGZhbGxiYWNrIHRvIGJsdWVcbiAgICBjb25zdCBjb2xvciA9IG1vdGlvbkRhdGE/LmNvbG9yIHx8IE1vdGlvbkNvbG9yLkJMVUU7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgJHttb3Rpb25EYXRhPy5wcm9wVHlwZSB8fCBcInN0YWZmXCJ9XyR7Y29sb3J9YDtcblxuICAgIGlmICh0aGlzLnN2Z0NhY2hlLmhhcyhjYWNoZUtleSkpIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg4pyFIFByb3BDb29yZGluYXRvclNlcnZpY2U6IFVzaW5nIGNhY2hlZCBTVkcgZm9yICR7Y2FjaGVLZXl9YFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLnN2Z0NhY2hlLmdldChjYWNoZUtleSk7XG4gICAgICBpZiAoY2FjaGVkRGF0YSkge1xuICAgICAgICByZXR1cm4gY2FjaGVkRGF0YTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UhCBQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlOiBDcmVhdGluZyBuZXcgU1ZHIGZvciAke2NhY2hlS2V5fWApO1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcbiAgICAgIGAvaW1hZ2VzL3Byb3BzLyR7bW90aW9uRGF0YT8ucHJvcFR5cGUgfHwgXCJzdGFmZlwifS5zdmdgXG4gICAgKTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZmV0Y2ggU1ZHXCIpO1xuXG4gICAgY29uc3Qgb3JpZ2luYWxTdmdUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIGNvbnN0IHsgdmlld0JveCwgY2VudGVyIH0gPSB0aGlzLnBhcnNlUHJvcFN2ZyhvcmlnaW5hbFN2Z1RleHQpO1xuICAgIGNvbnN0IGNvbG9yZWRTdmdUZXh0ID0gdGhpcy5hcHBseUNvbG9yVG9Tdmcob3JpZ2luYWxTdmdUZXh0LCBjb2xvcik7XG5cbiAgICAvLyBFeHRyYWN0IGp1c3QgdGhlIGlubmVyIFNWRyBjb250ZW50IChubyBzY2FsaW5nIG5lZWRlZCAtIHByb3BzIGFyZSBhbHJlYWR5IGNvcnJlY3RseSBzaXplZClcbiAgICBjb25zdCBzdmdDb250ZW50ID0gdGhpcy5leHRyYWN0U3ZnQ29udGVudChjb2xvcmVkU3ZnVGV4dCk7XG5cbiAgICBjb25zdCBzdmdEYXRhID0ge1xuICAgICAgc3ZnQ29udGVudCxcbiAgICAgIHZpZXdCb3gsXG4gICAgICBjZW50ZXIsXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5K+IFByb3BDb29yZGluYXRvclNlcnZpY2U6IENhY2hpbmcgU1ZHIGZvciAke2NhY2hlS2V5fWApO1xuICAgIHRoaXMuc3ZnQ2FjaGUuc2V0KGNhY2hlS2V5LCBzdmdEYXRhKTtcbiAgICByZXR1cm4gc3ZnRGF0YTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VQcm9wU3ZnKHN2Z1RleHQ6IHN0cmluZyk6IHtcbiAgICB2aWV3Qm94OiB7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH07XG4gICAgY2VudGVyOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH07XG4gIH0ge1xuICAgIGNvbnN0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoc3ZnVGV4dCwgXCJpbWFnZS9zdmcreG1sXCIpO1xuICAgIGNvbnN0IHN2ZyA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7XG5cbiAgICBjb25zdCB2aWV3Qm94VmFsdWVzID0gc3ZnLmdldEF0dHJpYnV0ZShcInZpZXdCb3hcIik/LnNwbGl0KC9cXHMrLykgfHwgW1xuICAgICAgXCIwXCIsXG4gICAgICBcIjBcIixcbiAgICAgIFwiMjUyLjhcIixcbiAgICAgIFwiNzcuOFwiLFxuICAgIF07XG4gICAgY29uc3Qgdmlld0JveCA9IHtcbiAgICAgIHdpZHRoOiBwYXJzZUZsb2F0KHZpZXdCb3hWYWx1ZXNbMl0gfHwgXCIyNTIuOFwiKSB8fCAyNTIuOCxcbiAgICAgIGhlaWdodDogcGFyc2VGbG9hdCh2aWV3Qm94VmFsdWVzWzNdIHx8IFwiNzcuOFwiKSB8fCA3Ny44LFxuICAgIH07XG5cbiAgICBsZXQgY2VudGVyID0geyB4OiB2aWV3Qm94LndpZHRoIC8gMiwgeTogdmlld0JveC5oZWlnaHQgLyAyIH07XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY2VudGVyRWxlbWVudCA9IGRvYy5nZXRFbGVtZW50QnlJZChcImNlbnRlclBvaW50XCIpO1xuICAgICAgaWYgKGNlbnRlckVsZW1lbnQpIHtcbiAgICAgICAgY2VudGVyID0ge1xuICAgICAgICAgIHg6IHBhcnNlRmxvYXQoY2VudGVyRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJjeFwiKSB8fCBcIjBcIikgfHwgY2VudGVyLngsXG4gICAgICAgICAgeTogcGFyc2VGbG9hdChjZW50ZXJFbGVtZW50LmdldEF0dHJpYnV0ZShcImN5XCIpIHx8IFwiMFwiKSB8fCBjZW50ZXIueSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIFVzZSBkZWZhdWx0IGNlbnRlclxuICAgIH1cblxuICAgIHJldHVybiB7IHZpZXdCb3gsIGNlbnRlciB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhcHBseUNvbG9yVG9Tdmcoc3ZnVGV4dDogc3RyaW5nLCBjb2xvcjogTW90aW9uQ29sb3IpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbG9yTWFwID0gbmV3IE1hcChbXG4gICAgICBbTW90aW9uQ29sb3IuQkxVRSwgXCIjMkUzMTkyXCJdLFxuICAgICAgW01vdGlvbkNvbG9yLlJFRCwgXCIjRUQxQzI0XCJdLFxuICAgIF0pO1xuXG4gICAgY29uc3QgdGFyZ2V0Q29sb3IgPSBjb2xvck1hcC5nZXQoY29sb3IpIHx8IFwiIzJFMzE5MlwiO1xuXG4gICAgbGV0IGNvbG9yZWRTdmcgPSBzdmdUZXh0LnJlcGxhY2UoXG4gICAgICAvZmlsbD1cIiNbMC05QS1GYS1mXXs2fVwiL2csXG4gICAgICBgZmlsbD1cIiR7dGFyZ2V0Q29sb3J9XCJgXG4gICAgKTtcbiAgICBjb2xvcmVkU3ZnID0gY29sb3JlZFN2Zy5yZXBsYWNlKFxuICAgICAgL2ZpbGw6XFxzKiNbMC05QS1GYS1mXXs2fS9nLFxuICAgICAgYGZpbGw6JHt0YXJnZXRDb2xvcn1gXG4gICAgKTtcblxuICAgIC8vIE1ha2UgQ1NTIGNsYXNzIG5hbWVzIHVuaXF1ZSBmb3IgZWFjaCBjb2xvciB0byBwcmV2ZW50IGNvbmZsaWN0c1xuICAgIC8vIFJlcGxhY2UgLnN0MCwgLnN0MSwgZXRjLiB3aXRoIC5zdDAtYmx1ZSwgLnN0MS1ibHVlLCBldGMuXG4gICAgY29uc3QgY29sb3JTdWZmaXggPSBjb2xvci50b0xvd2VyQ2FzZSgpO1xuICAgIGNvbG9yZWRTdmcgPSBjb2xvcmVkU3ZnLnJlcGxhY2UoL1xcLnN0KFxcZCspL2csIGAuc3QkMS0ke2NvbG9yU3VmZml4fWApO1xuXG4gICAgLy8gQWxzbyB1cGRhdGUgY2xhc3MgcmVmZXJlbmNlcyBpbiBlbGVtZW50c1xuICAgIGNvbG9yZWRTdmcgPSBjb2xvcmVkU3ZnLnJlcGxhY2UoXG4gICAgICAvY2xhc3M9XCJzdChcXGQrKVwiL2csXG4gICAgICBgY2xhc3M9XCJzdCQxLSR7Y29sb3JTdWZmaXh9XCJgXG4gICAgKTtcblxuICAgIC8vIFJlbW92ZSBjZW50ZXJQb2ludCBjaXJjbGUgdG8gcHJldmVudCBkZXRlY3Rpb24gaXNzdWVzXG4gICAgY29sb3JlZFN2ZyA9IGNvbG9yZWRTdmcucmVwbGFjZShcbiAgICAgIC88Y2lyY2xlW14+XSppZD1cImNlbnRlclBvaW50XCJbXj5dKlxcLz8+L2csXG4gICAgICBcIlwiXG4gICAgKTtcblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYPCflKcgUHJvcENvb3JkaW5hdG9yU2VydmljZTogQXBwbGllZCB1bmlxdWUgY2xhc3MgbmFtZXMgd2l0aCBzdWZmaXggLSR7Y29sb3JTdWZmaXh9YFxuICAgICk7XG4gICAgcmV0dXJuIGNvbG9yZWRTdmc7XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RTdmdDb250ZW50KHN2Z1RleHQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gRXh0cmFjdCBTVkcgY29udGVudCAoZXZlcnl0aGluZyBpbnNpZGUgdGhlIDxzdmc+IHRhZ3MpXG4gICAgLy8gUHJvcHMgYXJlIGFscmVhZHkgY29ycmVjdGx5IHNpemVkIGZvciA5NTB4OTUwIGNvb3JkaW5hdGUgc3lzdGVtXG4gICAgY29uc29sZS5sb2coXG4gICAgICBg8J+UjSBQcm9wQ29vcmRpbmF0b3JTZXJ2aWNlOiBFeHRyYWN0aW5nIFNWRyBjb250ZW50IGZyb206ICR7c3ZnVGV4dC5zdWJzdHJpbmcoMCwgMjAwKX0uLi5gXG4gICAgKTtcblxuICAgIGNvbnN0IHN2Z0NvbnRlbnRNYXRjaCA9IHN2Z1RleHQubWF0Y2goLzxzdmdbXj5dKj4oLiopPFxcL3N2Zz4vcyk7XG4gICAgaWYgKCFzdmdDb250ZW50TWF0Y2gpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBleHRyYWN0IFNWRyBjb250ZW50XCIpO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5qrIFByb3BDb29yZGluYXRvclNlcnZpY2U6IFNWRyB0ZXh0IHRoYXQgZmFpbGVkIHRvIG1hdGNoOiAke3N2Z1RleHR9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBzdmdUZXh0O1xuICAgIH1cblxuICAgIGNvbnN0IGV4dHJhY3RlZENvbnRlbnQgPSBzdmdDb250ZW50TWF0Y2hbMV07XG4gICAgY29uc29sZS5sb2coXG4gICAgICBg4pyFIFByb3BDb29yZGluYXRvclNlcnZpY2U6IEV4dHJhY3RlZCBTVkcgY29udGVudDogJHtleHRyYWN0ZWRDb250ZW50LnN1YnN0cmluZygwLCAyMDApfS4uLmBcbiAgICApO1xuICAgIHJl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
