import { BeatGridPositioner } from "/src/lib/services/implementations/image-export/composition/internal/BeatGridPositioner.ts";
import { CanvasCreator } from "/src/lib/services/implementations/image-export/composition/internal/CanvasCreator.ts";
import { CompositionUtils } from "/src/lib/services/implementations/image-export/composition/internal/CompositionTypes.ts";
import { TextOverlayApplicator } from "/src/lib/services/implementations/image-export/composition/internal/TextOverlayApplicator.ts";
export class ImageCompositionService {
  // Internal composition components (not exposed via DI)
  canvasCreator;
  beatPositioner;
  textApplicator;
  constructor(layoutService, dimensionService, beatRenderer, wordRenderer, userInfoRenderer, difficultyRenderer, textUtils) {
    this.canvasCreator = new CanvasCreator(layoutService, dimensionService);
    this.beatPositioner = new BeatGridPositioner(beatRenderer);
    this.textApplicator = new TextOverlayApplicator(
      wordRenderer,
      userInfoRenderer,
      difficultyRenderer,
      textUtils
    );
  }
  /**
   * Compose complete sequence image from sequence data
   * Main entry point that orchestrates the entire composition process
   */
  async composeSequenceImage(sequence, options) {
    if (!sequence) {
      throw new Error("Sequence data is required for composition");
    }
    try {
      const layoutData = this.canvasCreator.calculateLayoutData(
        sequence,
        options
      );
      const mainCanvas = this.canvasCreator.createMainCanvas(
        layoutData,
        options
      );
      const beatCanvases = await this.beatPositioner.renderAllBeats(
        sequence,
        layoutData,
        options
      );
      const startPositionCanvas = options.includeStartPosition ? await this.beatPositioner.renderStartPosition(
        sequence,
        layoutData,
        options
      ) : null;
      await this.composeFromCanvases(
        beatCanvases,
        startPositionCanvas,
        layoutData,
        CompositionUtils.toCompositionOptions(options, layoutData)
      );
      this.textApplicator.addTextOverlays(
        mainCanvas,
        sequence,
        layoutData,
        options
      );
      return mainCanvas;
    } catch (error) {
      throw new Error(
        `Image composition failed: ${error instanceof Error ? error.message : "Unknown error"}`
      );
    }
  }
  /**
   * Compose image from pre-rendered canvases
   * Lower-level composition for when beats are already rendered
   */
  async composeFromCanvases(beatCanvases, startPositionCanvas, layoutData, options) {
    const mainCanvas = this.canvasCreator.createMainCanvas(layoutData, options);
    const ctx = mainCanvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from main canvas");
    }
    this.fillBackground(ctx, mainCanvas.width, mainCanvas.height);
    let startColumn = 0;
    if (startPositionCanvas && options.includeStartPosition) {
      this.drawBeatCanvas(
        ctx,
        startPositionCanvas,
        0,
        // column 0
        0,
        // row 0
        layoutData,
        options
      );
      startColumn = 1;
    }
    this.beatPositioner.drawBeatsInGrid(
      ctx,
      beatCanvases,
      layoutData,
      options,
      startColumn
    );
    return mainCanvas;
  }
  /**
   * Apply background and borders
   * Matches desktop white background
   */
  applyBackground(canvas, backgroundColor = "white") {
    const ctx = canvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from canvas");
    }
    this.fillBackground(ctx, canvas.width, canvas.height, backgroundColor);
    return canvas;
  }
  /**
   * Optimize canvas for export
   * Applies final optimizations before export
   */
  optimizeForExport(canvas) {
    return canvas;
  }
  /**
   * Fill canvas background
   */
  fillBackground(ctx, width, height, color = "white") {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, width, height);
  }
  /**
   * Draw a single beat canvas at grid position
   */
  drawBeatCanvas(ctx, beatCanvas, column, row, layoutData, _options) {
    const x = column * layoutData.beatSize;
    const y = row * layoutData.beatSize + layoutData.additionalHeightTop;
    ctx.drawImage(beatCanvas, x, y);
  }
  /**
   * Create composition preview (smaller scale)
   */
  async createPreview(sequence, options, previewScale = 0.5) {
    const previewOptions = {
      ...options,
      beatScale: options.beatScale * previewScale
    };
    return await this.composeSequenceImage(sequence, previewOptions);
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9pbWFnZS1leHBvcnQvSW1hZ2VDb21wb3NpdGlvblNlcnZpY2UudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIi8qKlxuICogSW1hZ2UgQ29tcG9zaXRpb24gU2VydmljZVxuICpcbiAqIE1haW4gb3JjaGVzdHJhdG9yIGZvciBjb21wb3NpbmcgY29tcGxldGUgVEtBIHNlcXVlbmNlIGltYWdlcy4gVGhpcyBzZXJ2aWNlXG4gKiBjb21iaW5lcyByZW5kZXJlZCBiZWF0cywgdGV4dCBvdmVybGF5cywgYW5kIGJhY2tncm91bmQgZWxlbWVudHMgdG8gY3JlYXRlXG4gKiB0aGUgZmluYWwgZXhwb3J0IGltYWdlLiBFcXVpdmFsZW50IHRvIGRlc2t0b3AgSW1hZ2VDcmVhdG9yLlxuICpcbiAqIENyaXRpY2FsOiBNYWludGFpbnMgZXhhY3QgcG9zaXRpb25pbmcgYW5kIHNpemluZyBjb21wYXRpYmlsaXR5IHdpdGggZGVza3RvcC5cbiAqXG4gKiBBcmNoaXRlY3R1cmU6IFVzZXMgaW50ZXJuYWwgY29tcG9zaXRpb24gdG8gZGVsZWdhdGUgdG8gc3BlY2lhbGl6ZWQgY29tcG9uZW50c1xuICogd2hpbGUgbWFpbnRhaW5pbmcgdGhlIHNhbWUgcHVibGljIGludGVyZmFjZSBjb250cmFjdHMuXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBTZXF1ZW5jZURhdGEgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcbmltcG9ydCB0eXBlIHtcbiAgQ29tcG9zaXRpb25PcHRpb25zLFxuICBJQmVhdFJlbmRlcmluZ1NlcnZpY2UsXG4gIElEaW1lbnNpb25DYWxjdWxhdGlvblNlcnZpY2UsXG4gIElJbWFnZUNvbXBvc2l0aW9uU2VydmljZSxcbiAgSUxheW91dENhbGN1bGF0aW9uU2VydmljZSxcbiAgTGF5b3V0RGF0YSxcbiAgVEtBSW1hZ2VFeHBvcnRPcHRpb25zLFxufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9pbWFnZS1leHBvcnQtaW50ZXJmYWNlc1wiO1xuXG5pbXBvcnQgdHlwZSB7XG4gIElEaWZmaWN1bHR5QmFkZ2VSZW5kZXJlcixcbiAgSVRleHRSZW5kZXJpbmdVdGlscyxcbiAgSVVzZXJJbmZvUmVuZGVyZXIsXG4gIElXb3JkVGV4dFJlbmRlcmVyLFxufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy90ZXh0LXJlbmRlcmluZy1pbnRlcmZhY2VzXCI7XG5cbi8vIEludGVybmFsIGNvbXBvc2l0aW9uIGNvbXBvbmVudHNcbmltcG9ydCB7IEJlYXRHcmlkUG9zaXRpb25lciB9IGZyb20gXCIuL2NvbXBvc2l0aW9uL2ludGVybmFsL0JlYXRHcmlkUG9zaXRpb25lclwiO1xuaW1wb3J0IHsgQ2FudmFzQ3JlYXRvciB9IGZyb20gXCIuL2NvbXBvc2l0aW9uL2ludGVybmFsL0NhbnZhc0NyZWF0b3JcIjtcbmltcG9ydCB7IENvbXBvc2l0aW9uVXRpbHMgfSBmcm9tIFwiLi9jb21wb3NpdGlvbi9pbnRlcm5hbC9Db21wb3NpdGlvblR5cGVzXCI7XG5pbXBvcnQgeyBUZXh0T3ZlcmxheUFwcGxpY2F0b3IgfSBmcm9tIFwiLi9jb21wb3NpdGlvbi9pbnRlcm5hbC9UZXh0T3ZlcmxheUFwcGxpY2F0b3JcIjtcblxuZXhwb3J0IGNsYXNzIEltYWdlQ29tcG9zaXRpb25TZXJ2aWNlIGltcGxlbWVudHMgSUltYWdlQ29tcG9zaXRpb25TZXJ2aWNlIHtcbiAgLy8gSW50ZXJuYWwgY29tcG9zaXRpb24gY29tcG9uZW50cyAobm90IGV4cG9zZWQgdmlhIERJKVxuICBwcml2YXRlIHJlYWRvbmx5IGNhbnZhc0NyZWF0b3I6IENhbnZhc0NyZWF0b3I7XG4gIHByaXZhdGUgcmVhZG9ubHkgYmVhdFBvc2l0aW9uZXI6IEJlYXRHcmlkUG9zaXRpb25lcjtcbiAgcHJpdmF0ZSByZWFkb25seSB0ZXh0QXBwbGljYXRvcjogVGV4dE92ZXJsYXlBcHBsaWNhdG9yO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIGxheW91dFNlcnZpY2U6IElMYXlvdXRDYWxjdWxhdGlvblNlcnZpY2UsXG4gICAgZGltZW5zaW9uU2VydmljZTogSURpbWVuc2lvbkNhbGN1bGF0aW9uU2VydmljZSxcbiAgICBiZWF0UmVuZGVyZXI6IElCZWF0UmVuZGVyaW5nU2VydmljZSxcbiAgICB3b3JkUmVuZGVyZXI6IElXb3JkVGV4dFJlbmRlcmVyLFxuICAgIHVzZXJJbmZvUmVuZGVyZXI6IElVc2VySW5mb1JlbmRlcmVyLFxuICAgIGRpZmZpY3VsdHlSZW5kZXJlcjogSURpZmZpY3VsdHlCYWRnZVJlbmRlcmVyLFxuICAgIHRleHRVdGlsczogSVRleHRSZW5kZXJpbmdVdGlsc1xuICApIHtcbiAgICAvLyBJbnRlcm5hbCBjb21wb3NpdGlvbiAtIHRoZXNlIGFyZSBub3QgcmVnaXN0ZXJlZCBpbiBESSBjb250YWluZXJcbiAgICB0aGlzLmNhbnZhc0NyZWF0b3IgPSBuZXcgQ2FudmFzQ3JlYXRvcihsYXlvdXRTZXJ2aWNlLCBkaW1lbnNpb25TZXJ2aWNlKTtcbiAgICB0aGlzLmJlYXRQb3NpdGlvbmVyID0gbmV3IEJlYXRHcmlkUG9zaXRpb25lcihiZWF0UmVuZGVyZXIpO1xuICAgIHRoaXMudGV4dEFwcGxpY2F0b3IgPSBuZXcgVGV4dE92ZXJsYXlBcHBsaWNhdG9yKFxuICAgICAgd29yZFJlbmRlcmVyLFxuICAgICAgdXNlckluZm9SZW5kZXJlcixcbiAgICAgIGRpZmZpY3VsdHlSZW5kZXJlcixcbiAgICAgIHRleHRVdGlsc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcG9zZSBjb21wbGV0ZSBzZXF1ZW5jZSBpbWFnZSBmcm9tIHNlcXVlbmNlIGRhdGFcbiAgICogTWFpbiBlbnRyeSBwb2ludCB0aGF0IG9yY2hlc3RyYXRlcyB0aGUgZW50aXJlIGNvbXBvc2l0aW9uIHByb2Nlc3NcbiAgICovXG4gIGFzeW5jIGNvbXBvc2VTZXF1ZW5jZUltYWdlKFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEsXG4gICAgb3B0aW9uczogVEtBSW1hZ2VFeHBvcnRPcHRpb25zXG4gICk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+IHtcbiAgICBpZiAoIXNlcXVlbmNlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTZXF1ZW5jZSBkYXRhIGlzIHJlcXVpcmVkIGZvciBjb21wb3NpdGlvblwiKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gU3RlcCAxOiBDYWxjdWxhdGUgbGF5b3V0IGFuZCBkaW1lbnNpb25zXG4gICAgICBjb25zdCBsYXlvdXREYXRhID0gdGhpcy5jYW52YXNDcmVhdG9yLmNhbGN1bGF0ZUxheW91dERhdGEoXG4gICAgICAgIHNlcXVlbmNlLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuXG4gICAgICAvLyBTdGVwIDI6IENyZWF0ZSBtYWluIGNhbnZhcyB3aXRoIGNhbGN1bGF0ZWQgZGltZW5zaW9uc1xuICAgICAgY29uc3QgbWFpbkNhbnZhcyA9IHRoaXMuY2FudmFzQ3JlYXRvci5jcmVhdGVNYWluQ2FudmFzKFxuICAgICAgICBsYXlvdXREYXRhLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuXG4gICAgICAvLyBTdGVwIDM6IFJlbmRlciBhbGwgYmVhdHMgdG8gaW5kaXZpZHVhbCBjYW52YXNlc1xuICAgICAgY29uc3QgYmVhdENhbnZhc2VzID0gYXdhaXQgdGhpcy5iZWF0UG9zaXRpb25lci5yZW5kZXJBbGxCZWF0cyhcbiAgICAgICAgc2VxdWVuY2UsXG4gICAgICAgIGxheW91dERhdGEsXG4gICAgICAgIG9wdGlvbnNcbiAgICAgICk7XG5cbiAgICAgIC8vIFN0ZXAgNDogUmVuZGVyIHN0YXJ0IHBvc2l0aW9uIGlmIG5lZWRlZFxuICAgICAgY29uc3Qgc3RhcnRQb3NpdGlvbkNhbnZhcyA9IG9wdGlvbnMuaW5jbHVkZVN0YXJ0UG9zaXRpb25cbiAgICAgICAgPyBhd2FpdCB0aGlzLmJlYXRQb3NpdGlvbmVyLnJlbmRlclN0YXJ0UG9zaXRpb24oXG4gICAgICAgICAgICBzZXF1ZW5jZSxcbiAgICAgICAgICAgIGxheW91dERhdGEsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgKVxuICAgICAgICA6IG51bGw7XG5cbiAgICAgIC8vIFN0ZXAgNTogQ29tcG9zZSBmaW5hbCBpbWFnZVxuICAgICAgYXdhaXQgdGhpcy5jb21wb3NlRnJvbUNhbnZhc2VzKFxuICAgICAgICBiZWF0Q2FudmFzZXMsXG4gICAgICAgIHN0YXJ0UG9zaXRpb25DYW52YXMsXG4gICAgICAgIGxheW91dERhdGEsXG4gICAgICAgIENvbXBvc2l0aW9uVXRpbHMudG9Db21wb3NpdGlvbk9wdGlvbnMob3B0aW9ucywgbGF5b3V0RGF0YSlcbiAgICAgICk7XG5cbiAgICAgIC8vIFN0ZXAgNjogQWRkIHRleHQgb3ZlcmxheXNcbiAgICAgIHRoaXMudGV4dEFwcGxpY2F0b3IuYWRkVGV4dE92ZXJsYXlzKFxuICAgICAgICBtYWluQ2FudmFzLFxuICAgICAgICBzZXF1ZW5jZSxcbiAgICAgICAgbGF5b3V0RGF0YSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgKTtcblxuICAgICAgcmV0dXJuIG1haW5DYW52YXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEltYWdlIGNvbXBvc2l0aW9uIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwifWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbXBvc2UgaW1hZ2UgZnJvbSBwcmUtcmVuZGVyZWQgY2FudmFzZXNcbiAgICogTG93ZXItbGV2ZWwgY29tcG9zaXRpb24gZm9yIHdoZW4gYmVhdHMgYXJlIGFscmVhZHkgcmVuZGVyZWRcbiAgICovXG4gIGFzeW5jIGNvbXBvc2VGcm9tQ2FudmFzZXMoXG4gICAgYmVhdENhbnZhc2VzOiBIVE1MQ2FudmFzRWxlbWVudFtdLFxuICAgIHN0YXJ0UG9zaXRpb25DYW52YXM6IEhUTUxDYW52YXNFbGVtZW50IHwgbnVsbCxcbiAgICBsYXlvdXREYXRhOiBMYXlvdXREYXRhLFxuICAgIG9wdGlvbnM6IENvbXBvc2l0aW9uT3B0aW9uc1xuICApOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XG4gICAgLy8gQ3JlYXRlIG1haW4gY2FudmFzIGlmIG5vdCBwcm92aWRlZFxuICAgIGNvbnN0IG1haW5DYW52YXMgPSB0aGlzLmNhbnZhc0NyZWF0b3IuY3JlYXRlTWFpbkNhbnZhcyhsYXlvdXREYXRhLCBvcHRpb25zKTtcbiAgICBjb25zdCBjdHggPSBtYWluQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBpZiAoIWN0eCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCAyRCBjb250ZXh0IGZyb20gbWFpbiBjYW52YXNcIik7XG4gICAgfVxuXG4gICAgLy8gU3RlcCAxOiBGaWxsIGJhY2tncm91bmRcbiAgICB0aGlzLmZpbGxCYWNrZ3JvdW5kKGN0eCwgbWFpbkNhbnZhcy53aWR0aCwgbWFpbkNhbnZhcy5oZWlnaHQpO1xuXG4gICAgLy8gU3RlcCAyOiBQb3NpdGlvbiBhbmQgZHJhdyBzdGFydCBwb3NpdGlvblxuICAgIGxldCBzdGFydENvbHVtbiA9IDA7XG4gICAgaWYgKHN0YXJ0UG9zaXRpb25DYW52YXMgJiYgb3B0aW9ucy5pbmNsdWRlU3RhcnRQb3NpdGlvbikge1xuICAgICAgdGhpcy5kcmF3QmVhdENhbnZhcyhcbiAgICAgICAgY3R4LFxuICAgICAgICBzdGFydFBvc2l0aW9uQ2FudmFzLFxuICAgICAgICAwLCAvLyBjb2x1bW4gMFxuICAgICAgICAwLCAvLyByb3cgMFxuICAgICAgICBsYXlvdXREYXRhLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICAgICAgc3RhcnRDb2x1bW4gPSAxO1xuICAgIH1cblxuICAgIC8vIFN0ZXAgMzogUG9zaXRpb24gYW5kIGRyYXcgYWxsIGJlYXRzIGluIGdyaWQgbGF5b3V0XG4gICAgdGhpcy5iZWF0UG9zaXRpb25lci5kcmF3QmVhdHNJbkdyaWQoXG4gICAgICBjdHgsXG4gICAgICBiZWF0Q2FudmFzZXMsXG4gICAgICBsYXlvdXREYXRhLFxuICAgICAgb3B0aW9ucyxcbiAgICAgIHN0YXJ0Q29sdW1uXG4gICAgKTtcblxuICAgIHJldHVybiBtYWluQ2FudmFzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IGJhY2tncm91bmQgYW5kIGJvcmRlcnNcbiAgICogTWF0Y2hlcyBkZXNrdG9wIHdoaXRlIGJhY2tncm91bmRcbiAgICovXG4gIGFwcGx5QmFja2dyb3VuZChcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICAgIGJhY2tncm91bmRDb2xvcjogc3RyaW5nID0gXCJ3aGl0ZVwiXG4gICk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IDJEIGNvbnRleHQgZnJvbSBjYW52YXNcIik7XG4gICAgfVxuICAgIHRoaXMuZmlsbEJhY2tncm91bmQoY3R4LCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQsIGJhY2tncm91bmRDb2xvcik7XG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpbWl6ZSBjYW52YXMgZm9yIGV4cG9ydFxuICAgKiBBcHBsaWVzIGZpbmFsIG9wdGltaXphdGlvbnMgYmVmb3JlIGV4cG9ydFxuICAgKi9cbiAgb3B0aW1pemVGb3JFeHBvcnQoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYXMtaXMuIEluIHRoZSBmdXR1cmUsIGNvdWxkIGFwcGx5OlxuICAgIC8vIC0gQW50aS1hbGlhc2luZyBpbXByb3ZlbWVudHNcbiAgICAvLyAtIENvbG9yIHNwYWNlIGNvbnZlcnNpb25zXG4gICAgLy8gLSBDb21wcmVzc2lvbiBvcHRpbWl6YXRpb25zXG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxuXG4gIC8qKlxuICAgKiBGaWxsIGNhbnZhcyBiYWNrZ3JvdW5kXG4gICAqL1xuICBwcml2YXRlIGZpbGxCYWNrZ3JvdW5kKFxuICAgIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELFxuICAgIHdpZHRoOiBudW1iZXIsXG4gICAgaGVpZ2h0OiBudW1iZXIsXG4gICAgY29sb3I6IHN0cmluZyA9IFwid2hpdGVcIlxuICApOiB2b2lkIHtcbiAgICBjdHguZmlsbFN0eWxlID0gY29sb3I7XG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgYSBzaW5nbGUgYmVhdCBjYW52YXMgYXQgZ3JpZCBwb3NpdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBkcmF3QmVhdENhbnZhcyhcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgICBiZWF0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCxcbiAgICBjb2x1bW46IG51bWJlcixcbiAgICByb3c6IG51bWJlcixcbiAgICBsYXlvdXREYXRhOiBMYXlvdXREYXRhLFxuICAgIF9vcHRpb25zOiBDb21wb3NpdGlvbk9wdGlvbnNcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgeCA9IGNvbHVtbiAqIGxheW91dERhdGEuYmVhdFNpemU7XG4gICAgY29uc3QgeSA9IHJvdyAqIGxheW91dERhdGEuYmVhdFNpemUgKyBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRUb3A7XG5cbiAgICBjdHguZHJhd0ltYWdlKGJlYXRDYW52YXMsIHgsIHkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjb21wb3NpdGlvbiBwcmV2aWV3IChzbWFsbGVyIHNjYWxlKVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUHJldmlldyhcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIG9wdGlvbnM6IFRLQUltYWdlRXhwb3J0T3B0aW9ucyxcbiAgICBwcmV2aWV3U2NhbGU6IG51bWJlciA9IDAuNVxuICApOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XG4gICAgY29uc3QgcHJldmlld09wdGlvbnMgPSB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgYmVhdFNjYWxlOiBvcHRpb25zLmJlYXRTY2FsZSAqIHByZXZpZXdTY2FsZSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tcG9zZVNlcXVlbmNlSW1hZ2Uoc2VxdWVuY2UsIHByZXZpZXdPcHRpb25zKTtcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIkFBZ0NBLFNBQVMsMEJBQTBCO0FBQ25DLFNBQVMscUJBQXFCO0FBQzlCLFNBQVMsd0JBQXdCO0FBQ2pDLFNBQVMsNkJBQTZCO0FBRS9CLGFBQU0sd0JBQTREO0FBQUE7QUFBQSxFQUV0RDtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFFakIsWUFDRSxlQUNBLGtCQUNBLGNBQ0EsY0FDQSxrQkFDQSxvQkFDQSxXQUNBO0FBRUEsU0FBSyxnQkFBZ0IsSUFBSSxjQUFjLGVBQWUsZ0JBQWdCO0FBQ3RFLFNBQUssaUJBQWlCLElBQUksbUJBQW1CLFlBQVk7QUFDekQsU0FBSyxpQkFBaUIsSUFBSTtBQUFBLE1BQ3hCO0FBQUEsTUFDQTtBQUFBLE1BQ0E7QUFBQSxNQUNBO0FBQUEsSUFDRjtBQUFBLEVBQ0Y7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLEVBTUEsTUFBTSxxQkFDSixVQUNBLFNBQzRCO0FBQzVCLFFBQUksQ0FBQyxVQUFVO0FBQ2IsWUFBTSxJQUFJLE1BQU0sMkNBQTJDO0FBQUEsSUFDN0Q7QUFFQSxRQUFJO0FBRUYsWUFBTSxhQUFhLEtBQUssY0FBYztBQUFBLFFBQ3BDO0FBQUEsUUFDQTtBQUFBLE1BQ0Y7QUFHQSxZQUFNLGFBQWEsS0FBSyxjQUFjO0FBQUEsUUFDcEM7QUFBQSxRQUNBO0FBQUEsTUFDRjtBQUdBLFlB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
