export class SequenceCardMetadataOverlayService {
  titleHeight = 40;
  titlePadding = 10;
  beatNumberSize = 14;
  defaultBackgroundColor = "#ffffff";
  /**
   * Add metadata overlays to SVG
   */
  async addMetadataOverlays(svg, sequence, metadata, dimensions) {
    try {
      console.log(`üè∑Ô∏è Adding metadata overlays for sequence: ${sequence.name}`);
      let modifiedSVG = svg;
      if (metadata.backgroundColor) {
        modifiedSVG = this.addBackgroundAndBorders(
          modifiedSVG,
          dimensions,
          metadata.backgroundColor
        );
      }
      if (metadata.title || sequence.name) {
        const title = metadata.title || sequence.name || "Untitled Sequence";
        const titleOverlay = this.generateTitleOverlay(title, dimensions);
        modifiedSVG = this.insertBeforeClosingTag(
          modifiedSVG,
          titleOverlay,
          "</svg>"
        );
      }
      if (metadata.beatNumbers) {
        const beatCount = sequence.beats?.length || 0;
        if (beatCount > 0) {
          const layout = this.extractLayoutFromSVG(modifiedSVG, beatCount);
          const beatNumberOverlays = this.generateBeatNumberOverlays(
            beatCount,
            layout
          );
          for (const overlay of beatNumberOverlays) {
            modifiedSVG = this.insertBeforeClosingTag(
              modifiedSVG,
              overlay,
              "</svg>"
            );
          }
        }
      }
      if (metadata.timestamp) {
        const timestampOverlay = this.generateTimestampOverlay(dimensions);
        modifiedSVG = this.insertBeforeClosingTag(
          modifiedSVG,
          timestampOverlay,
          "</svg>"
        );
      }
      if (metadata.author || sequence.metadata?.author) {
        const author = metadata.author || sequence.metadata?.author;
        if (author) {
          const authorOverlay = this.generateAuthorOverlay(author, dimensions);
          modifiedSVG = this.insertBeforeClosingTag(
            modifiedSVG,
            authorOverlay,
            "</svg>"
          );
        }
      }
      console.log("‚úÖ Successfully added metadata overlays");
      return modifiedSVG;
    } catch (error) {
      console.error("‚ùå Failed to add metadata overlays:", error);
      return svg;
    }
  }
  /**
   * Generate title overlay
   */
  generateTitleOverlay(title, dimensions) {
    const centerX = dimensions.width / 2;
    const titleY = this.titlePadding + this.titleHeight / 2;
    const escapedTitle = this.escapeXMLChars(title);
    return `
      <!-- Title Background -->
      <rect 
        x="0" 
        y="0" 
        width="${dimensions.width}" 
        height="${this.titleHeight}" 
        fill="rgba(0, 0, 0, 0.05)" 
        stroke="none"
      />
      
      <!-- Title Text -->
      <text 
        x="${centerX}" 
        y="${titleY}" 
        text-anchor="middle" 
        dominant-baseline="central"
        font-family="system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif" 
        font-size="18" 
        font-weight="600" 
        fill="#333333"
        letter-spacing="0.5px"
      >
        ${escapedTitle}
      </text>`;
  }
  /**
   * Generate beat number overlays
   */
  generateBeatNumberOverlays(beatCount, layout) {
    const overlays = [];
    const padding = 20;
    for (let i = 0; i < beatCount; i++) {
      const row = Math.floor(i / layout.columns);
      const col = i % layout.columns;
      const x = padding + col * (layout.beatWidth + 8) + 5;
      const y = this.titleHeight + padding + row * (layout.beatHeight + 8) + 15;
      const beatNumber = i + 1;
      overlays.push(`
        <!-- Beat Number ${beatNumber} Background -->
        <circle 
          cx="${x + 8}" 
          cy="${y}" 
          r="10" 
          fill="rgba(0, 0, 0, 0.7)" 
          stroke="rgba(255, 255, 255, 0.8)" 
          stroke-width="1"
        />
        
        <!-- Beat Number ${beatNumber} Text -->
        <text 
          x="${x + 8}" 
          y="${y}" 
          text-anchor="middle" 
          dominant-baseline="central"
          font-family="system-ui, sans-serif" 
          font-size="${this.beatNumberSize}" 
          font-weight="bold" 
          fill="white"
        >
          ${beatNumber}
        </text>`);
    }
    return overlays;
  }
  /**
   * Add background and borders
   */
  addBackgroundAndBorders(svg, dimensions, backgroundColor) {
    const bgColor = backgroundColor || this.defaultBackgroundColor;
    const backgroundRect = `
      <!-- Card Background -->
      <rect 
        width="100%" 
        height="100%" 
        fill="${bgColor}" 
        stroke="#e0e0e0" 
        stroke-width="2" 
        rx="8" 
        ry="8"
      />`;
    return this.insertAfterOpeningTag(svg, backgroundRect, "<svg");
  }
  // ============================================================================
  // PRIVATE METHODS
  // ============================================================================
  generateTimestampOverlay(dimensions) {
    const now = /* @__PURE__ */ new Date();
    const timestamp = now.toLocaleDateString() + " " + now.toLocaleTimeString();
    const escapedTimestamp = this.escapeXMLChars(timestamp);
    return `
      <!-- Timestamp -->
      <text 
        x="${dimensions.width - 10}" 
        y="${dimensions.height - 10}" 
        text-anchor="end" 
        font-family="system-ui, sans-serif" 
        font-size="10" 
        fill="#666666"
        opacity="0.7"
      >
        ${escapedTimestamp}
      </text>`;
  }
  generateAuthorOverlay(author, dimensions) {
    const escapedAuthor = this.escapeXMLChars(author);
    return `
      <!-- Author -->
      <text 
        x="10" 
        y="${dimensions.height - 10}" 
        text-anchor="start" 
        font-family="system-ui, sans-serif" 
        font-size="12" 
        fill="#666666"
        font-style="italic"
      >
        by ${escapedAuthor}
      </text>`;
  }
  extractLayoutFromSVG(svg, beatCount) {
    const layoutMatch = svg.match(/<!-- Layout: (\d+)x(\d+), (\d+)x(\d+) -->/);
    if (layoutMatch) {
      return {
        rows: parseInt(layoutMatch[1]),
        columns: parseInt(layoutMatch[2]),
        beatWidth: parseInt(layoutMatch[3]),
        beatHeight: parseInt(layoutMatch[4])
      };
    }
    const columns = Math.min(beatCount, 4);
    const rows = Math.ceil(beatCount / columns);
    return {
      rows,
      columns,
      beatWidth: 120,
      // Reasonable default
      beatHeight: 120
    };
  }
  escapeXMLChars(text) {
    return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
  }
  insertAfterOpeningTag(svg, content, tagStart) {
    const tagEndIndex = svg.indexOf(">", svg.indexOf(tagStart));
    if (tagEndIndex === -1) {
      console.warn("Could not find opening SVG tag");
      return svg;
    }
    return svg.substring(0, tagEndIndex + 1) + content + svg.substring(tagEndIndex + 1);
  }
  insertBeforeClosingTag(svg, content, closingTag) {
    const lastIndex = svg.lastIndexOf(closingTag);
    if (lastIndex === -1) {
      console.warn(`Could not find closing tag: ${closingTag}`);
      return svg + content;
    }
    return svg.substring(0, lastIndex) + content + "\n" + svg.substring(lastIndex);
  }
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiQzovVEtBL3dlYi9zcmMvbGliL3NlcnZpY2VzL2ltcGxlbWVudGF0aW9ucy9leHBvcnQvc2VxdWVuY2UtY2FyZC9TZXF1ZW5jZUNhcmRNZXRhZGF0YU92ZXJsYXlTZXJ2aWNlLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIFNlcXVlbmNlIENhcmQgTWV0YWRhdGEgT3ZlcmxheSBTZXJ2aWNlXG4gKlxuICogSGFuZGxlcyBhZGRpbmcgbWV0YWRhdGEgb3ZlcmxheXMgdG8gc2VxdWVuY2UgY2FyZCBTVkdzLlxuICogU2luZ2xlIHJlc3BvbnNpYmlsaXR5OiBBZGRpbmcgdGl0bGVzLCBiZWF0IG51bWJlcnMsIGFuZCBzdHlsaW5nLlxuICovXG5cbmltcG9ydCB0eXBlIHsgU2VxdWVuY2VEYXRhIH0gZnJvbSBcIi4uLy4uLy4uL2ludGVyZmFjZXMvZG9tYWluLXR5cGVzXCI7XG5pbXBvcnQgdHlwZSB7XG4gIElTZXF1ZW5jZUNhcmRNZXRhZGF0YU92ZXJsYXlTZXJ2aWNlLFxuICBTZXF1ZW5jZUNhcmREaW1lbnNpb25zLFxuICBTZXF1ZW5jZUNhcmRNZXRhZGF0YSxcbn0gZnJvbSBcIi4uLy4uLy4uL2ludGVyZmFjZXMvc2VxdWVuY2UtY2FyZC1leHBvcnQtaW50ZXJmYWNlc1wiO1xuXG5leHBvcnQgY2xhc3MgU2VxdWVuY2VDYXJkTWV0YWRhdGFPdmVybGF5U2VydmljZVxuICBpbXBsZW1lbnRzIElTZXF1ZW5jZUNhcmRNZXRhZGF0YU92ZXJsYXlTZXJ2aWNlXG57XG4gIHByaXZhdGUgcmVhZG9ubHkgdGl0bGVIZWlnaHQgPSA0MDtcbiAgcHJpdmF0ZSByZWFkb25seSB0aXRsZVBhZGRpbmcgPSAxMDtcbiAgcHJpdmF0ZSByZWFkb25seSBiZWF0TnVtYmVyU2l6ZSA9IDE0O1xuICBwcml2YXRlIHJlYWRvbmx5IGRlZmF1bHRCYWNrZ3JvdW5kQ29sb3IgPSBcIiNmZmZmZmZcIjtcblxuICAvKipcbiAgICogQWRkIG1ldGFkYXRhIG92ZXJsYXlzIHRvIFNWR1xuICAgKi9cbiAgYXN5bmMgYWRkTWV0YWRhdGFPdmVybGF5cyhcbiAgICBzdmc6IHN0cmluZyxcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIG1ldGFkYXRhOiBTZXF1ZW5jZUNhcmRNZXRhZGF0YSxcbiAgICBkaW1lbnNpb25zOiBTZXF1ZW5jZUNhcmREaW1lbnNpb25zXG4gICk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn4+377iPIEFkZGluZyBtZXRhZGF0YSBvdmVybGF5cyBmb3Igc2VxdWVuY2U6ICR7c2VxdWVuY2UubmFtZX1gKTtcblxuICAgICAgbGV0IG1vZGlmaWVkU1ZHID0gc3ZnO1xuXG4gICAgICAvLyBBZGQgYmFja2dyb3VuZCBhbmQgYm9yZGVycyBmaXJzdFxuICAgICAgaWYgKG1ldGFkYXRhLmJhY2tncm91bmRDb2xvcikge1xuICAgICAgICBtb2RpZmllZFNWRyA9IHRoaXMuYWRkQmFja2dyb3VuZEFuZEJvcmRlcnMoXG4gICAgICAgICAgbW9kaWZpZWRTVkcsXG4gICAgICAgICAgZGltZW5zaW9ucyxcbiAgICAgICAgICBtZXRhZGF0YS5iYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIHRpdGxlIGlmIHJlcXVlc3RlZFxuICAgICAgaWYgKG1ldGFkYXRhLnRpdGxlIHx8IHNlcXVlbmNlLm5hbWUpIHtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBtZXRhZGF0YS50aXRsZSB8fCBzZXF1ZW5jZS5uYW1lIHx8IFwiVW50aXRsZWQgU2VxdWVuY2VcIjtcbiAgICAgICAgY29uc3QgdGl0bGVPdmVybGF5ID0gdGhpcy5nZW5lcmF0ZVRpdGxlT3ZlcmxheSh0aXRsZSwgZGltZW5zaW9ucyk7XG4gICAgICAgIG1vZGlmaWVkU1ZHID0gdGhpcy5pbnNlcnRCZWZvcmVDbG9zaW5nVGFnKFxuICAgICAgICAgIG1vZGlmaWVkU1ZHLFxuICAgICAgICAgIHRpdGxlT3ZlcmxheSxcbiAgICAgICAgICBcIjwvc3ZnPlwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBiZWF0IG51bWJlcnMgaWYgcmVxdWVzdGVkXG4gICAgICBpZiAobWV0YWRhdGEuYmVhdE51bWJlcnMpIHtcbiAgICAgICAgY29uc3QgYmVhdENvdW50ID0gc2VxdWVuY2UuYmVhdHM/Lmxlbmd0aCB8fCAwO1xuICAgICAgICBpZiAoYmVhdENvdW50ID4gMCkge1xuICAgICAgICAgIGNvbnN0IGxheW91dCA9IHRoaXMuZXh0cmFjdExheW91dEZyb21TVkcobW9kaWZpZWRTVkcsIGJlYXRDb3VudCk7XG4gICAgICAgICAgY29uc3QgYmVhdE51bWJlck92ZXJsYXlzID0gdGhpcy5nZW5lcmF0ZUJlYXROdW1iZXJPdmVybGF5cyhcbiAgICAgICAgICAgIGJlYXRDb3VudCxcbiAgICAgICAgICAgIGxheW91dFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IG92ZXJsYXkgb2YgYmVhdE51bWJlck92ZXJsYXlzKSB7XG4gICAgICAgICAgICBtb2RpZmllZFNWRyA9IHRoaXMuaW5zZXJ0QmVmb3JlQ2xvc2luZ1RhZyhcbiAgICAgICAgICAgICAgbW9kaWZpZWRTVkcsXG4gICAgICAgICAgICAgIG92ZXJsYXksXG4gICAgICAgICAgICAgIFwiPC9zdmc+XCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB0aW1lc3RhbXAgaWYgcmVxdWVzdGVkXG4gICAgICBpZiAobWV0YWRhdGEudGltZXN0YW1wKSB7XG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcE92ZXJsYXkgPSB0aGlzLmdlbmVyYXRlVGltZXN0YW1wT3ZlcmxheShkaW1lbnNpb25zKTtcbiAgICAgICAgbW9kaWZpZWRTVkcgPSB0aGlzLmluc2VydEJlZm9yZUNsb3NpbmdUYWcoXG4gICAgICAgICAgbW9kaWZpZWRTVkcsXG4gICAgICAgICAgdGltZXN0YW1wT3ZlcmxheSxcbiAgICAgICAgICBcIjwvc3ZnPlwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBhdXRob3IgaWYgcmVxdWVzdGVkIGFuZCBhdmFpbGFibGVcbiAgICAgIGlmIChtZXRhZGF0YS5hdXRob3IgfHwgc2VxdWVuY2UubWV0YWRhdGE/LmF1dGhvcikge1xuICAgICAgICBjb25zdCBhdXRob3IgPSBtZXRhZGF0YS5hdXRob3IgfHwgKHNlcXVlbmNlLm1ldGFkYXRhPy5hdXRob3IgYXMgc3RyaW5nKTtcbiAgICAgICAgaWYgKGF1dGhvcikge1xuICAgICAgICAgIGNvbnN0IGF1dGhvck92ZXJsYXkgPSB0aGlzLmdlbmVyYXRlQXV0aG9yT3ZlcmxheShhdXRob3IsIGRpbWVuc2lvbnMpO1xuICAgICAgICAgIG1vZGlmaWVkU1ZHID0gdGhpcy5pbnNlcnRCZWZvcmVDbG9zaW5nVGFnKFxuICAgICAgICAgICAgbW9kaWZpZWRTVkcsXG4gICAgICAgICAgICBhdXRob3JPdmVybGF5LFxuICAgICAgICAgICAgXCI8L3N2Zz5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXCLinIUgU3VjY2Vzc2Z1bGx5IGFkZGVkIG1ldGFkYXRhIG92ZXJsYXlzXCIpO1xuICAgICAgcmV0dXJuIG1vZGlmaWVkU1ZHO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEZhaWxlZCB0byBhZGQgbWV0YWRhdGEgb3ZlcmxheXM6XCIsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBvcmlnaW5hbCBTVkcgaWYgb3ZlcmxheSBhZGRpdGlvbiBmYWlsc1xuICAgICAgcmV0dXJuIHN2ZztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdGl0bGUgb3ZlcmxheVxuICAgKi9cbiAgZ2VuZXJhdGVUaXRsZU92ZXJsYXkoXG4gICAgdGl0bGU6IHN0cmluZyxcbiAgICBkaW1lbnNpb25zOiBTZXF1ZW5jZUNhcmREaW1lbnNpb25zXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgY2VudGVyWCA9IGRpbWVuc2lvbnMud2lkdGggLyAyO1xuICAgIGNvbnN0IHRpdGxlWSA9IHRoaXMudGl0bGVQYWRkaW5nICsgdGhpcy50aXRsZUhlaWdodCAvIDI7XG5cbiAgICAvLyBFc2NhcGUgWE1MIHNwZWNpYWwgY2hhcmFjdGVycyBpbiB0aXRsZVxuICAgIGNvbnN0IGVzY2FwZWRUaXRsZSA9IHRoaXMuZXNjYXBlWE1MQ2hhcnModGl0bGUpO1xuXG4gICAgcmV0dXJuIGBcbiAgICAgIDwhLS0gVGl0bGUgQmFja2dyb3VuZCAtLT5cbiAgICAgIDxyZWN0IFxuICAgICAgICB4PVwiMFwiIFxuICAgICAgICB5PVwiMFwiIFxuICAgICAgICB3aWR0aD1cIiR7ZGltZW5zaW9ucy53aWR0aH1cIiBcbiAgICAgICAgaGVpZ2h0PVwiJHt0aGlzLnRpdGxlSGVpZ2h0fVwiIFxuICAgICAgICBmaWxsPVwicmdiYSgwLCAwLCAwLCAwLjA1KVwiIFxuICAgICAgICBzdHJva2U9XCJub25lXCJcbiAgICAgIC8+XG4gICAgICBcbiAgICAgIDwhLS0gVGl0bGUgVGV4dCAtLT5cbiAgICAgIDx0ZXh0IFxuICAgICAgICB4PVwiJHtjZW50ZXJYfVwiIFxuICAgICAgICB5PVwiJHt0aXRsZVl9XCIgXG4gICAgICAgIHRleHQtYW5jaG9yPVwibWlkZGxlXCIgXG4gICAgICAgIGRvbWluYW50LWJhc2VsaW5lPVwiY2VudHJhbFwiXG4gICAgICAgIGZvbnQtZmFtaWx5PVwic3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCAnU2Vnb2UgVUknLCBSb2JvdG8sIHNhbnMtc2VyaWZcIiBcbiAgICAgICAgZm9udC1zaXplPVwiMThcIiBcbiAgICAgICAgZm9udC13ZWlnaHQ9XCI2MDBcIiBcbiAgICAgICAgZmlsbD1cIiMzMzMzMzNcIlxuICAgICAgICBsZXR0ZXItc3BhY2luZz1cIjAuNXB4XCJcbiAgICAgID5cbiAgICAgICAgJHtlc2NhcGVkVGl0bGV9XG4gICAgICA8L3RleHQ+YDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBiZWF0IG51bWJlciBvdmVybGF5c1xuICAgKi9cbiAgZ2VuZXJhdGVCZWF0TnVtYmVyT3ZlcmxheXMoXG4gICAgYmVhdENvdW50OiBudW1iZXIsXG4gICAgbGF5b3V0OiB7XG4gICAgICByb3dzOiBudW1iZXI7XG4gICAgICBjb2x1bW5zOiBudW1iZXI7XG4gICAgICBiZWF0V2lkdGg6IG51bWJlcjtcbiAgICAgIGJlYXRIZWlnaHQ6IG51bWJlcjtcbiAgICB9XG4gICk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBvdmVybGF5czogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBwYWRkaW5nID0gMjA7IC8vIFNhbWUgYXMgbGF5b3V0IHBhZGRpbmdcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmVhdENvdW50OyBpKyspIHtcbiAgICAgIGNvbnN0IHJvdyA9IE1hdGguZmxvb3IoaSAvIGxheW91dC5jb2x1bW5zKTtcbiAgICAgIGNvbnN0IGNvbCA9IGkgJSBsYXlvdXQuY29sdW1ucztcblxuICAgICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uIChhY2NvdW50aW5nIGZvciB0aXRsZSBhbmQgbGF5b3V0IHBhZGRpbmcpXG4gICAgICBjb25zdCB4ID0gcGFkZGluZyArIGNvbCAqIChsYXlvdXQuYmVhdFdpZHRoICsgOCkgKyA1OyAvLyA4ID0gc3BhY2luZywgNSA9IG51bWJlciBvZmZzZXRcbiAgICAgIGNvbnN0IHkgPSB0aGlzLnRpdGxlSGVpZ2h0ICsgcGFkZGluZyArIHJvdyAqIChsYXlvdXQuYmVhdEhlaWdodCArIDgpICsgMTU7IC8vIDE1ID0gbnVtYmVyIG9mZnNldFxuXG4gICAgICBjb25zdCBiZWF0TnVtYmVyID0gaSArIDE7XG5cbiAgICAgIG92ZXJsYXlzLnB1c2goYFxuICAgICAgICA8IS0tIEJlYXQgTnVtYmVyICR7YmVhdE51bWJlcn0gQmFja2dyb3VuZCAtLT5cbiAgICAgICAgPGNpcmNsZSBcbiAgICAgICAgICBjeD1cIiR7eCArIDh9XCIgXG4gICAgICAgICAgY3k9XCIke3l9XCIgXG4gICAgICAgICAgcj1cIjEwXCIgXG4gICAgICAgICAgZmlsbD1cInJnYmEoMCwgMCwgMCwgMC43KVwiIFxuICAgICAgICAgIHN0cm9rZT1cInJnYmEoMjU1LCAyNTUsIDI1NSwgMC44KVwiIFxuICAgICAgICAgIHN0cm9rZS13aWR0aD1cIjFcIlxuICAgICAgICAvPlxuICAgICAgICBcbiAgICAgICAgPCEtLSBCZWF0IE51bWJlciAke2JlYXROdW1iZXJ9IFRleHQgLS0+XG4gICAgICAgIDx0ZXh0IFxuICAgICAgICAgIHg9XCIke3ggKyA4fVwiIFxuICAgICAgICAgIHk9XCIke3l9XCIgXG4gICAgICAgICAgdGV4dC1hbmNob3I9XCJtaWRkbGVcIiBcbiAgICAgICAgICBkb21pbmFudC1iYXNlbGluZT1cImNlbnRyYWxcIlxuICAgICAgICAgIGZvbnQtZmFtaWx5PVwic3lzdGVtLXVpLCBzYW5zLXNlcmlmXCIgXG4gICAgICAgICAgZm9udC1zaXplPVwiJHt0aGlzLmJlYXROdW1iZXJTaXplfVwiIFxuICAgICAgICAgIGZvbnQtd2VpZ2h0PVwiYm9sZFwiIFxuICAgICAgICAgIGZpbGw9XCJ3aGl0ZVwiXG4gICAgICAgID5cbiAgICAgICAgICAke2JlYXROdW1iZXJ9XG4gICAgICAgIDwvdGV4dD5gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb3ZlcmxheXM7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGJhY2tncm91bmQgYW5kIGJvcmRlcnNcbiAgICovXG4gIGFkZEJhY2tncm91bmRBbmRCb3JkZXJzKFxuICAgIHN2Zzogc3RyaW5nLFxuICAgIGRpbWVuc2lvbnM6IFNlcXVlbmNlQ2FyZERpbWVuc2lvbnMsXG4gICAgYmFja2dyb3VuZENvbG9yPzogc3RyaW5nXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgYmdDb2xvciA9IGJhY2tncm91bmRDb2xvciB8fCB0aGlzLmRlZmF1bHRCYWNrZ3JvdW5kQ29sb3I7XG5cbiAgICAvLyBJbnNlcnQgYmFja2dyb3VuZCByaWdodCBhZnRlciBvcGVuaW5nIFNWRyB0YWdcbiAgICBjb25zdCBiYWNrZ3JvdW5kUmVjdCA9IGBcbiAgICAgIDwhLS0gQ2FyZCBCYWNrZ3JvdW5kIC0tPlxuICAgICAgPHJlY3QgXG4gICAgICAgIHdpZHRoPVwiMTAwJVwiIFxuICAgICAgICBoZWlnaHQ9XCIxMDAlXCIgXG4gICAgICAgIGZpbGw9XCIke2JnQ29sb3J9XCIgXG4gICAgICAgIHN0cm9rZT1cIiNlMGUwZTBcIiBcbiAgICAgICAgc3Ryb2tlLXdpZHRoPVwiMlwiIFxuICAgICAgICByeD1cIjhcIiBcbiAgICAgICAgcnk9XCI4XCJcbiAgICAgIC8+YDtcblxuICAgIHJldHVybiB0aGlzLmluc2VydEFmdGVyT3BlbmluZ1RhZyhzdmcsIGJhY2tncm91bmRSZWN0LCBcIjxzdmdcIik7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFBSSVZBVEUgTUVUSE9EU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRpbWVzdGFtcE92ZXJsYXkoZGltZW5zaW9uczogU2VxdWVuY2VDYXJkRGltZW5zaW9ucyk6IHN0cmluZyB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBub3cudG9Mb2NhbGVEYXRlU3RyaW5nKCkgKyBcIiBcIiArIG5vdy50b0xvY2FsZVRpbWVTdHJpbmcoKTtcbiAgICBjb25zdCBlc2NhcGVkVGltZXN0YW1wID0gdGhpcy5lc2NhcGVYTUxDaGFycyh0aW1lc3RhbXApO1xuXG4gICAgcmV0dXJuIGBcbiAgICAgIDwhLS0gVGltZXN0YW1wIC0tPlxuICAgICAgPHRleHQgXG4gICAgICAgIHg9XCIke2RpbWVuc2lvbnMud2lkdGggLSAxMH1cIiBcbiAgICAgICAgeT1cIiR7ZGltZW5zaW9ucy5oZWlnaHQgLSAxMH1cIiBcbiAgICAgICAgdGV4dC1hbmNob3I9XCJlbmRcIiBcbiAgICAgICAgZm9udC1mYW1pbHk9XCJzeXN0ZW0tdWksIHNhbnMtc2VyaWZcIiBcbiAgICAgICAgZm9udC1zaXplPVwiMTBcIiBcbiAgICAgICAgZmlsbD1cIiM2NjY2NjZcIlxuICAgICAgICBvcGFjaXR5PVwiMC43XCJcbiAgICAgID5cbiAgICAgICAgJHtlc2NhcGVkVGltZXN0YW1wfVxuICAgICAgPC90ZXh0PmA7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQXV0aG9yT3ZlcmxheShcbiAgICBhdXRob3I6IHN0cmluZyxcbiAgICBkaW1lbnNpb25zOiBTZXF1ZW5jZUNhcmREaW1lbnNpb25zXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgZXNjYXBlZEF1dGhvciA9IHRoaXMuZXNjYXBlWE1MQ2hhcnMoYXV0aG9yKTtcblxuICAgIHJldHVybiBgXG4gICAgICA8IS0tIEF1dGhvciAtLT5cbiAgICAgIDx0ZXh0IFxuICAgICAgICB4PVwiMTBcIiBcbiAgICAgICAgeT1cIiR7ZGltZW5zaW9ucy5oZWlnaHQgLSAxMH1cIiBcbiAgICAgICAgdGV4dC1hbmNob3I9XCJzdGFydFwiIFxuICAgICAgICBmb250LWZhbWlseT1cInN5c3RlbS11aSwgc2Fucy1zZXJpZlwiIFxuICAgICAgICBmb250LXNpemU9XCIxMlwiIFxuICAgICAgICBmaWxsPVwiIzY2NjY2NlwiXG4gICAgICAgIGZvbnQtc3R5bGU9XCJpdGFsaWNcIlxuICAgICAgPlxuICAgICAgICBieSAke2VzY2FwZWRBdXRob3J9XG4gICAgICA8L3RleHQ+YDtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdExheW91dEZyb21TVkcoXG4gICAgc3ZnOiBzdHJpbmcsXG4gICAgYmVhdENvdW50OiBudW1iZXJcbiAgKTogeyByb3dzOiBudW1iZXI7IGNvbHVtbnM6IG51bWJlcjsgYmVhdFdpZHRoOiBudW1iZXI7IGJlYXRIZWlnaHQ6IG51bWJlciB9IHtcbiAgICAvLyBUcnkgdG8gZXh0cmFjdCBsYXlvdXQgaW5mbyBmcm9tIFNWRyBjb21tZW50cyBvciBjYWxjdWxhdGUgZmFsbGJhY2tcblxuICAgIC8vIExvb2sgZm9yIGxheW91dCBjb21tZW50cyAoaWYgYWRkZWQgYnkgY29tcG9zaXRpb24gc2VydmljZSlcbiAgICBjb25zdCBsYXlvdXRNYXRjaCA9IHN2Zy5tYXRjaCgvPCEtLSBMYXlvdXQ6IChcXGQrKXgoXFxkKyksIChcXGQrKXgoXFxkKykgLS0+Lyk7XG5cbiAgICBpZiAobGF5b3V0TWF0Y2gpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJvd3M6IHBhcnNlSW50KGxheW91dE1hdGNoWzFdKSxcbiAgICAgICAgY29sdW1uczogcGFyc2VJbnQobGF5b3V0TWF0Y2hbMl0pLFxuICAgICAgICBiZWF0V2lkdGg6IHBhcnNlSW50KGxheW91dE1hdGNoWzNdKSxcbiAgICAgICAgYmVhdEhlaWdodDogcGFyc2VJbnQobGF5b3V0TWF0Y2hbNF0pLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogZXN0aW1hdGUgYmFzZWQgb24gYmVhdCBjb3VudFxuICAgIGNvbnN0IGNvbHVtbnMgPSBNYXRoLm1pbihiZWF0Q291bnQsIDQpO1xuICAgIGNvbnN0IHJvd3MgPSBNYXRoLmNlaWwoYmVhdENvdW50IC8gY29sdW1ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcm93cyxcbiAgICAgIGNvbHVtbnMsXG4gICAgICBiZWF0V2lkdGg6IDEyMCwgLy8gUmVhc29uYWJsZSBkZWZhdWx0XG4gICAgICBiZWF0SGVpZ2h0OiAxMjAsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZXNjYXBlWE1MQ2hhcnModGV4dDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGV4dFxuICAgICAgLnJlcGxhY2UoLyYvZywgXCImYW1wO1wiKVxuICAgICAgLnJlcGxhY2UoLzwvZywgXCImbHQ7XCIpXG4gICAgICAucmVwbGFjZSgvPi9nLCBcIiZndDtcIilcbiAgICAgIC5yZXBsYWNlKC9cIi9nLCBcIiZxdW90O1wiKVxuICAgICAgLnJlcGxhY2UoLycvZywgXCImIzM5O1wiKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5zZXJ0QWZ0ZXJPcGVuaW5nVGFnKFxuICAgIHN2Zzogc3RyaW5nLFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICB0YWdTdGFydDogc3RyaW5nXG4gICk6IHN0cmluZyB7XG4gICAgY29uc3QgdGFnRW5kSW5kZXggPSBzdmcuaW5kZXhPZihcIj5cIiwgc3ZnLmluZGV4T2YodGFnU3RhcnQpKTtcbiAgICBpZiAodGFnRW5kSW5kZXggPT09IC0xKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgZmluZCBvcGVuaW5nIFNWRyB0YWdcIik7XG4gICAgICByZXR1cm4gc3ZnO1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBzdmcuc3Vic3RyaW5nKDAsIHRhZ0VuZEluZGV4ICsgMSkgK1xuICAgICAgY29udGVudCArXG4gICAgICBzdmcuc3Vic3RyaW5nKHRhZ0VuZEluZGV4ICsgMSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBpbnNlcnRCZWZvcmVDbG9zaW5nVGFnKFxuICAgIHN2Zzogc3RyaW5nLFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBjbG9zaW5nVGFnOiBzdHJpbmdcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBsYXN0SW5kZXggPSBzdmcubGFzdEluZGV4T2YoY2xvc2luZ1RhZyk7XG4gICAgaWYgKGxhc3RJbmRleCA9PT0gLTEpIHtcbiAgICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IGZpbmQgY2xvc2luZyB0YWc6ICR7Y2xvc2luZ1RhZ31gKTtcbiAgICAgIHJldHVybiBzdmcgKyBjb250ZW50O1xuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBzdmcuc3Vic3RyaW5nKDAsIGxhc3RJbmRleCkgKyBjb250ZW50ICsgXCJcXG5cIiArIHN2Zy5zdWJzdHJpbmcobGFzdEluZGV4KVxuICAgICk7XG4gIH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICJBQWNPLGFBQU0sbUNBRWI7QUFBQSxFQUNtQixjQUFjO0FBQUEsRUFDZCxlQUFlO0FBQUEsRUFDZixpQkFBaUI7QUFBQSxFQUNqQix5QkFBeUI7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUsxQyxNQUFNLG9CQUNKLEtBQ0EsVUFDQSxVQUNBLFlBQ2lCO0FBQ2pCLFFBQUk7QUFDRixjQUFRLElBQUksOENBQThDLFNBQVMsSUFBSSxFQUFFO0FBRXpFLFVBQUksY0FBYztBQUdsQixVQUFJLFNBQVMsaUJBQWlCO0FBQzVCLHNCQUFjLEtBQUs7QUFBQSxVQUNqQjtBQUFBLFVBQ0E7QUFBQSxVQUNBLFNBQVM7QUFBQSxRQUNYO0FBQUEsTUFDRjtBQUdBLFVBQUksU0FBUyxTQUFTLFNBQVMsTUFBTTtBQUNuQyxjQUFNLFFBQVEsU0FBUyxTQUFTLFNBQVMsUUFBUTtBQUNqRCxjQUFNLGVBQWUsS0FBSyxxQkFBcUIsT0FBTyxVQUFVO0FBQ2hFLHNCQUFjLEtBQUs7QUFBQSxVQUNqQjtBQUFBLFVBQ0E7QUFBQSxVQUNBO0FBQUEsUUFDRjtBQUFBLE1BQ0Y7QUFHQSxVQUFJLFNBQVMsYUFBYTtBQUN4QixjQUFNLFlBQVksU0FBUyxPQUFPLFVBQVU7QUFDNUMsWUFBSSxZQUFZLEdBQUc7QUFDakIsZ0JBQU0sU0FBUyxLQUFLLHFCQUFxQixhQUFhLFNBQVM7QUFDL0QsZ0JBQU0scUJBQXFCLEtBQUs7QUFBQSxZQUM5QjtBQUFBLFlBQ0E7QUFBQSxVQUNGO0FBRUEscUJBQVcsV0FBVyxvQkFBb0I7QUFDeEMsMEJBQWMsS0FBSztBQUFBLGNBQ2pCO0FBQUEsY0FDQTtBQUFBLGNBQ0E7QUFBQSxZQUNGO0FBQUEsVUFDRjtBQUFBLFFBQ0Y7QUFBQSxNQUNGO0FBR0EsVUFBSSxTQUFTLFdBQVc7QUFDdEIsY0FBTSxtQkFBbUIsS0FBSyx5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
