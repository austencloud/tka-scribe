export class CanvasManagementService {
  // Canvas pool management
  canvasPool = /* @__PURE__ */ new Map();
  MAX_POOL_SIZE_PER_DIMENSION = 10;
  POOL_CLEANUP_INTERVAL = 3e4;
  // 30 seconds
  MAX_UNUSED_TIME = 6e4;
  // 1 minute
  // Memory tracking
  totalCanvasMemory = 0;
  MAX_TOTAL_MEMORY = 512 * 1024 * 1024;
  // 512MB limit
  // Cleanup timer
  cleanupTimer;
  constructor() {
    this.startCleanupTimer();
  }
  /**
   * Create optimized canvas
   * Uses pooling for common sizes to improve performance
   */
  createCanvas(width, height) {
    if (width <= 0 || height <= 0) {
      throw new Error(`Invalid canvas dimensions: ${width}x${height}`);
    }
    const requiredMemory = width * height * 4;
    if (!this.canAllocateMemory(requiredMemory)) {
      this.forceCleanup();
      if (!this.canAllocateMemory(requiredMemory)) {
        throw new Error(
          `Cannot allocate ${Math.round(requiredMemory / 1024 / 1024)}MB for canvas - memory limit exceeded`
        );
      }
    }
    const poolKey = this.getPoolKey(width, height);
    const pooledCanvas = this.getCanvasFromPool(poolKey);
    if (pooledCanvas) {
      this.prepareCanvas(pooledCanvas, width, height);
      return pooledCanvas;
    }
    const canvas = document.createElement("canvas");
    this.prepareCanvas(canvas, width, height);
    this.totalCanvasMemory += requiredMemory;
    return canvas;
  }
  /**
   * Clone canvas
   * Creates an exact copy of the source canvas
   */
  cloneCanvas(source) {
    if (!source) {
      throw new Error("Source canvas is required for cloning");
    }
    const clone = this.createCanvas(source.width, source.height);
    const ctx = clone.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from cloned canvas");
    }
    ctx.drawImage(source, 0, 0);
    return clone;
  }
  /**
   * Dispose canvas resources
   * Returns canvas to pool or disposes if pool is full
   */
  disposeCanvas(canvas) {
    if (!canvas) {
      return;
    }
    const poolKey = this.getPoolKey(canvas.width, canvas.height);
    if (this.returnCanvasToPool(canvas, poolKey)) {
      return;
    }
    this.forceDisposeCanvas(canvas);
  }
  /**
   * Get canvas memory usage
   * Returns total memory used by tracked canvases
   */
  getMemoryUsage() {
    return this.totalCanvasMemory;
  }
  /**
   * Clear canvas cache
   * Removes all pooled canvases and resets memory tracking
   */
  clearCache() {
    for (const pool of this.canvasPool.values()) {
      for (const entry of pool) {
        this.forceDisposeCanvas(entry.canvas);
      }
    }
    this.canvasPool.clear();
    this.totalCanvasMemory = 0;
  }
  /**
   * Prepare canvas for use
   */
  prepareCanvas(canvas, width, height) {
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from canvas");
    }
    ctx.clearRect(0, 0, width, height);
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
  }
  /**
   * Get pool key for canvas dimensions
   */
  getPoolKey(width, height) {
    return `${width}x${height}`;
  }
  /**
   * Get canvas from pool if available
   */
  getCanvasFromPool(poolKey) {
    const pool = this.canvasPool.get(poolKey);
    if (!pool || pool.length === 0) {
      return null;
    }
    const entry = pool.find((e) => !e.inUse);
    if (entry) {
      entry.inUse = true;
      entry.lastUsed = Date.now();
      return entry.canvas;
    }
    return null;
  }
  /**
   * Return canvas to pool
   */
  returnCanvasToPool(canvas, poolKey) {
    let pool = this.canvasPool.get(poolKey);
    if (!pool) {
      pool = [];
      this.canvasPool.set(poolKey, pool);
    }
    if (pool.length >= this.MAX_POOL_SIZE_PER_DIMENSION) {
      return false;
    }
    const memorySize = canvas.width * canvas.height * 4;
    if (memorySize > 64 * 1024 * 1024) {
      return false;
    }
    pool.push({
      canvas,
      lastUsed: Date.now(),
      inUse: false
    });
    return true;
  }
  /**
   * Force dispose canvas (remove from memory tracking)
   */
  forceDisposeCanvas(canvas) {
    if (canvas) {
      const memorySize = canvas.width * canvas.height * 4;
      this.totalCanvasMemory = Math.max(0, this.totalCanvasMemory - memorySize);
      canvas.width = 0;
      canvas.height = 0;
    }
  }
  /**
   * Check if we can allocate memory
   */
  canAllocateMemory(requiredBytes) {
    return this.totalCanvasMemory + requiredBytes <= this.MAX_TOTAL_MEMORY;
  }
  /**
   * Start cleanup timer
   */
  startCleanupTimer() {
    if (typeof window !== "undefined") {
      this.cleanupTimer = window.setInterval(() => {
        this.cleanupUnusedCanvases();
      }, this.POOL_CLEANUP_INTERVAL);
    }
  }
  /**
   * Cleanup unused canvases from pool
   */
  cleanupUnusedCanvases() {
    const now = Date.now();
    for (const [poolKey, pool] of this.canvasPool.entries()) {
      const filtered = pool.filter((entry) => {
        const isOld = now - entry.lastUsed > this.MAX_UNUSED_TIME;
        const shouldRemove = !entry.inUse && isOld;
        if (shouldRemove) {
          this.forceDisposeCanvas(entry.canvas);
        }
        return !shouldRemove;
      });
      if (filtered.length === 0) {
        this.canvasPool.delete(poolKey);
      } else {
        this.canvasPool.set(poolKey, filtered);
      }
    }
  }
  /**
   * Force cleanup when memory limit is reached
   */
  forceCleanup() {
    const allEntries = [];
    for (const [poolKey, pool] of this.canvasPool.entries()) {
      pool.forEach((entry, index) => {
        if (!entry.inUse) {
          allEntries.push({ poolKey, entry, index });
        }
      });
    }
    allEntries.sort((a, b) => a.entry.lastUsed - b.entry.lastUsed);
    for (const { poolKey, entry, index } of allEntries) {
      const pool = this.canvasPool.get(poolKey);
      if (pool) {
        this.forceDisposeCanvas(entry.canvas);
        pool.splice(index, 1);
        if (pool.length === 0) {
          this.canvasPool.delete(poolKey);
        }
        if (this.totalCanvasMemory < this.MAX_TOTAL_MEMORY * 0.8) {
          break;
        }
      }
    }
  }
  /**
   * Get cache statistics
   */
  getCacheStats() {
    let totalCanvases = 0;
    for (const pool of this.canvasPool.values()) {
      totalCanvases += pool.length;
    }
    const memoryUsageMB = this.totalCanvasMemory / (1024 * 1024);
    const maxMemoryMB = this.MAX_TOTAL_MEMORY / (1024 * 1024);
    const utilizationPercent = this.totalCanvasMemory / this.MAX_TOTAL_MEMORY * 100;
    return {
      totalPools: this.canvasPool.size,
      totalCanvases,
      memoryUsageMB,
      maxMemoryMB,
      utilizationPercent
    };
  }
  /**
   * Optimize canvas for specific use case
   */
  optimizeCanvas(canvas, purpose) {
    const ctx = canvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from canvas");
    }
    switch (purpose) {
      case "export":
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "high";
        break;
      case "preview":
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "medium";
        break;
      case "thumbnail":
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = "low";
        break;
    }
    return canvas;
  }
  /**
   * Create canvas with specific performance settings
   */
  createOptimizedCanvas(width, height, purpose) {
    const canvas = this.createCanvas(width, height);
    return this.optimizeCanvas(canvas, purpose);
  }
  /**
   * Batch create canvases
   */
  batchCreateCanvases(dimensions, purpose = "export") {
    return dimensions.map(
      ({ width, height }) => this.createOptimizedCanvas(width, height, purpose)
    );
  }
  /**
   * Batch dispose canvases
   */
  batchDisposeCanvases(canvases) {
    for (const canvas of canvases) {
      this.disposeCanvas(canvas);
    }
  }
  /**
   * Dispose of service and cleanup resources
   */
  dispose() {
    if (this.cleanupTimer) {
      clearInterval(this.cleanupTimer);
      this.cleanupTimer = void 0;
    }
    this.clearCache();
  }
  /**
   * Debug method to test canvas management
   */
  debugCanvasManagement() {
    let createTest = false;
    let poolTest = false;
    let memoryTest = false;
    try {
      const testCanvas = this.createCanvas(100, 100);
      createTest = testCanvas.width === 100 && testCanvas.height === 100;
      this.disposeCanvas(testCanvas);
      const pooledCanvas = this.createCanvas(100, 100);
      poolTest = pooledCanvas.width === 100 && pooledCanvas.height === 100;
      const initialMemory = this.getMemoryUsage();
      const bigCanvas = this.createCanvas(1e3, 1e3);
      const afterMemory = this.getMemoryUsage();
      memoryTest = afterMemory > initialMemory;
      this.disposeCanvas(pooledCanvas);
      this.disposeCanvas(bigCanvas);
    } catch (error) {
      console.error("Canvas management debug failed:", error);
    }
    return { createTest, poolTest, memoryTest };
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNhbnZhc01hbmFnZW1lbnRTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2FudmFzIE1hbmFnZW1lbnQgU2VydmljZVxuICpcbiAqIE1hbmFnZXMgY2FudmFzIGNyZWF0aW9uLCBwb29saW5nLCBhbmQgbWVtb3J5IG9wdGltaXphdGlvbiBmb3IgVEtBIGltYWdlIGV4cG9ydC5cbiAqIFRoaXMgc2VydmljZSBwcm92aWRlcyBlZmZpY2llbnQgY2FudmFzIHJlc291cmNlIG1hbmFnZW1lbnQgdG8gcHJldmVudCBtZW1vcnlcbiAqIGxlYWtzIGFuZCBpbXByb3ZlIHBlcmZvcm1hbmNlIGR1cmluZyBpbWFnZSBleHBvcnQgb3BlcmF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IElDYW52YXNNYW5hZ2VtZW50U2VydmljZSB9IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzL2ltYWdlLWV4cG9ydC1pbnRlcmZhY2VzXCI7XG5cbmludGVyZmFjZSBDYW52YXNQb29sRW50cnkge1xuICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICBsYXN0VXNlZDogbnVtYmVyO1xuICBpblVzZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIENhbnZhc01hbmFnZW1lbnRTZXJ2aWNlIGltcGxlbWVudHMgSUNhbnZhc01hbmFnZW1lbnRTZXJ2aWNlIHtcbiAgLy8gQ2FudmFzIHBvb2wgbWFuYWdlbWVudFxuICBwcml2YXRlIGNhbnZhc1Bvb2wgPSBuZXcgTWFwPHN0cmluZywgQ2FudmFzUG9vbEVudHJ5W10+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgTUFYX1BPT0xfU0laRV9QRVJfRElNRU5TSU9OID0gMTA7XG4gIHByaXZhdGUgcmVhZG9ubHkgUE9PTF9DTEVBTlVQX0lOVEVSVkFMID0gMzAwMDA7IC8vIDMwIHNlY29uZHNcbiAgcHJpdmF0ZSByZWFkb25seSBNQVhfVU5VU0VEX1RJTUUgPSA2MDAwMDsgLy8gMSBtaW51dGVcblxuICAvLyBNZW1vcnkgdHJhY2tpbmdcbiAgcHJpdmF0ZSB0b3RhbENhbnZhc01lbW9yeSA9IDA7XG4gIHByaXZhdGUgcmVhZG9ubHkgTUFYX1RPVEFMX01FTU9SWSA9IDUxMiAqIDEwMjQgKiAxMDI0OyAvLyA1MTJNQiBsaW1pdFxuXG4gIC8vIENsZWFudXAgdGltZXJcbiAgcHJpdmF0ZSBjbGVhbnVwVGltZXI/OiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zdGFydENsZWFudXBUaW1lcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBvcHRpbWl6ZWQgY2FudmFzXG4gICAqIFVzZXMgcG9vbGluZyBmb3IgY29tbW9uIHNpemVzIHRvIGltcHJvdmUgcGVyZm9ybWFuY2VcbiAgICovXG4gIGNyZWF0ZUNhbnZhcyh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNhbnZhcyBkaW1lbnNpb25zOiAke3dpZHRofXgke2hlaWdodH1gKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBtZW1vcnkgbGltaXRzXG4gICAgY29uc3QgcmVxdWlyZWRNZW1vcnkgPSB3aWR0aCAqIGhlaWdodCAqIDQ7IC8vIFJHQkEgYnl0ZXNcbiAgICBpZiAoIXRoaXMuY2FuQWxsb2NhdGVNZW1vcnkocmVxdWlyZWRNZW1vcnkpKSB7XG4gICAgICB0aGlzLmZvcmNlQ2xlYW51cCgpO1xuICAgICAgaWYgKCF0aGlzLmNhbkFsbG9jYXRlTWVtb3J5KHJlcXVpcmVkTWVtb3J5KSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgYENhbm5vdCBhbGxvY2F0ZSAke01hdGgucm91bmQocmVxdWlyZWRNZW1vcnkgLyAxMDI0IC8gMTAyNCl9TUIgZm9yIGNhbnZhcyAtIG1lbW9yeSBsaW1pdCBleGNlZWRlZGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gZ2V0IGNhbnZhcyBmcm9tIHBvb2xcbiAgICBjb25zdCBwb29sS2V5ID0gdGhpcy5nZXRQb29sS2V5KHdpZHRoLCBoZWlnaHQpO1xuICAgIGNvbnN0IHBvb2xlZENhbnZhcyA9IHRoaXMuZ2V0Q2FudmFzRnJvbVBvb2wocG9vbEtleSk7XG5cbiAgICBpZiAocG9vbGVkQ2FudmFzKSB7XG4gICAgICB0aGlzLnByZXBhcmVDYW52YXMocG9vbGVkQ2FudmFzLCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgIHJldHVybiBwb29sZWRDYW52YXM7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG5ldyBjYW52YXNcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIHRoaXMucHJlcGFyZUNhbnZhcyhjYW52YXMsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgLy8gVHJhY2sgbWVtb3J5IHVzYWdlXG4gICAgdGhpcy50b3RhbENhbnZhc01lbW9yeSArPSByZXF1aXJlZE1lbW9yeTtcblxuICAgIHJldHVybiBjYW52YXM7XG4gIH1cblxuICAvKipcbiAgICogQ2xvbmUgY2FudmFzXG4gICAqIENyZWF0ZXMgYW4gZXhhY3QgY29weSBvZiB0aGUgc291cmNlIGNhbnZhc1xuICAgKi9cbiAgY2xvbmVDYW52YXMoc291cmNlOiBIVE1MQ2FudmFzRWxlbWVudCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBpZiAoIXNvdXJjZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU291cmNlIGNhbnZhcyBpcyByZXF1aXJlZCBmb3IgY2xvbmluZ1wiKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbG9uZSA9IHRoaXMuY3JlYXRlQ2FudmFzKHNvdXJjZS53aWR0aCwgc291cmNlLmhlaWdodCk7XG4gICAgY29uc3QgY3R4ID0gY2xvbmUuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IDJEIGNvbnRleHQgZnJvbSBjbG9uZWQgY2FudmFzXCIpO1xuICAgIH1cblxuICAgIC8vIENvcHkgc291cmNlIGNhbnZhcyB0byBjbG9uZVxuICAgIGN0eC5kcmF3SW1hZ2Uoc291cmNlLCAwLCAwKTtcblxuICAgIHJldHVybiBjbG9uZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwb3NlIGNhbnZhcyByZXNvdXJjZXNcbiAgICogUmV0dXJucyBjYW52YXMgdG8gcG9vbCBvciBkaXNwb3NlcyBpZiBwb29sIGlzIGZ1bGxcbiAgICovXG4gIGRpc3Bvc2VDYW52YXMoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IHZvaWQge1xuICAgIGlmICghY2FudmFzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcG9vbEtleSA9IHRoaXMuZ2V0UG9vbEtleShjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgLy8gVHJ5IHRvIHJldHVybiB0byBwb29sXG4gICAgaWYgKHRoaXMucmV0dXJuQ2FudmFzVG9Qb29sKGNhbnZhcywgcG9vbEtleSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQb29sIGlzIGZ1bGwgb3IgY2FudmFzIHRvbyBsYXJnZSwgZGlzcG9zZSBjb21wbGV0ZWx5XG4gICAgdGhpcy5mb3JjZURpc3Bvc2VDYW52YXMoY2FudmFzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY2FudmFzIG1lbW9yeSB1c2FnZVxuICAgKiBSZXR1cm5zIHRvdGFsIG1lbW9yeSB1c2VkIGJ5IHRyYWNrZWQgY2FudmFzZXNcbiAgICovXG4gIGdldE1lbW9yeVVzYWdlKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMudG90YWxDYW52YXNNZW1vcnk7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgY2FudmFzIGNhY2hlXG4gICAqIFJlbW92ZXMgYWxsIHBvb2xlZCBjYW52YXNlcyBhbmQgcmVzZXRzIG1lbW9yeSB0cmFja2luZ1xuICAgKi9cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICAvLyBEaXNwb3NlIGFsbCBwb29sZWQgY2FudmFzZXNcbiAgICBmb3IgKGNvbnN0IHBvb2wgb2YgdGhpcy5jYW52YXNQb29sLnZhbHVlcygpKSB7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIHBvb2wpIHtcbiAgICAgICAgdGhpcy5mb3JjZURpc3Bvc2VDYW52YXMoZW50cnkuY2FudmFzKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmNhbnZhc1Bvb2wuY2xlYXIoKTtcbiAgICB0aGlzLnRvdGFsQ2FudmFzTWVtb3J5ID0gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcmVwYXJlIGNhbnZhcyBmb3IgdXNlXG4gICAqL1xuICBwcml2YXRlIHByZXBhcmVDYW52YXMoXG4gICAgY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCxcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyXG4gICk6IHZvaWQge1xuICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgICAvLyBDbGVhciBjYW52YXNcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IDJEIGNvbnRleHQgZnJvbSBjYW52YXNcIik7XG4gICAgfVxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG5cbiAgICAvLyBTZXQgZGVmYXVsdCByZW5kZXJpbmcgcHJvcGVydGllcyBmb3IgaGlnaCBxdWFsaXR5XG4gICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRydWU7XG4gICAgY3R4LmltYWdlU21vb3RoaW5nUXVhbGl0eSA9IFwiaGlnaFwiO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwb29sIGtleSBmb3IgY2FudmFzIGRpbWVuc2lvbnNcbiAgICovXG4gIHByaXZhdGUgZ2V0UG9vbEtleSh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke3dpZHRofXgke2hlaWdodH1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjYW52YXMgZnJvbSBwb29sIGlmIGF2YWlsYWJsZVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRDYW52YXNGcm9tUG9vbChwb29sS2V5OiBzdHJpbmcpOiBIVE1MQ2FudmFzRWxlbWVudCB8IG51bGwge1xuICAgIGNvbnN0IHBvb2wgPSB0aGlzLmNhbnZhc1Bvb2wuZ2V0KHBvb2xLZXkpO1xuICAgIGlmICghcG9vbCB8fCBwb29sLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy8gRmluZCBhbiB1bnVzZWQgY2FudmFzXG4gICAgY29uc3QgZW50cnkgPSBwb29sLmZpbmQoKGUpID0+ICFlLmluVXNlKTtcbiAgICBpZiAoZW50cnkpIHtcbiAgICAgIGVudHJ5LmluVXNlID0gdHJ1ZTtcbiAgICAgIGVudHJ5Lmxhc3RVc2VkID0gRGF0ZS5ub3coKTtcbiAgICAgIHJldHVybiBlbnRyeS5jYW52YXM7XG4gICAgfVxuXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGNhbnZhcyB0byBwb29sXG4gICAqL1xuICBwcml2YXRlIHJldHVybkNhbnZhc1RvUG9vbChcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICAgIHBvb2xLZXk6IHN0cmluZ1xuICApOiBib29sZWFuIHtcbiAgICBsZXQgcG9vbCA9IHRoaXMuY2FudmFzUG9vbC5nZXQocG9vbEtleSk7XG5cbiAgICBpZiAoIXBvb2wpIHtcbiAgICAgIHBvb2wgPSBbXTtcbiAgICAgIHRoaXMuY2FudmFzUG9vbC5zZXQocG9vbEtleSwgcG9vbCk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgcG9vbCBpcyBmdWxsXG4gICAgaWYgKHBvb2wubGVuZ3RoID49IHRoaXMuTUFYX1BPT0xfU0laRV9QRVJfRElNRU5TSU9OKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgY2FudmFzIGlzIHRvbyBsYXJnZSBmb3IgcG9vbGluZ1xuICAgIGNvbnN0IG1lbW9yeVNpemUgPSBjYW52YXMud2lkdGggKiBjYW52YXMuaGVpZ2h0ICogNDtcbiAgICBpZiAobWVtb3J5U2l6ZSA+IDY0ICogMTAyNCAqIDEwMjQpIHtcbiAgICAgIC8vIDY0TUIgbGltaXQgZm9yIHBvb2xpbmdcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBBZGQgdG8gcG9vbFxuICAgIHBvb2wucHVzaCh7XG4gICAgICBjYW52YXMsXG4gICAgICBsYXN0VXNlZDogRGF0ZS5ub3coKSxcbiAgICAgIGluVXNlOiBmYWxzZSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvcmNlIGRpc3Bvc2UgY2FudmFzIChyZW1vdmUgZnJvbSBtZW1vcnkgdHJhY2tpbmcpXG4gICAqL1xuICBwcml2YXRlIGZvcmNlRGlzcG9zZUNhbnZhcyhjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KTogdm9pZCB7XG4gICAgaWYgKGNhbnZhcykge1xuICAgICAgY29uc3QgbWVtb3J5U2l6ZSA9IGNhbnZhcy53aWR0aCAqIGNhbnZhcy5oZWlnaHQgKiA0O1xuICAgICAgdGhpcy50b3RhbENhbnZhc01lbW9yeSA9IE1hdGgubWF4KDAsIHRoaXMudG90YWxDYW52YXNNZW1vcnkgLSBtZW1vcnlTaXplKTtcblxuICAgICAgLy8gQ2xlYXIgY2FudmFzXG4gICAgICBjYW52YXMud2lkdGggPSAwO1xuICAgICAgY2FudmFzLmhlaWdodCA9IDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHdlIGNhbiBhbGxvY2F0ZSBtZW1vcnlcbiAgICovXG4gIHByaXZhdGUgY2FuQWxsb2NhdGVNZW1vcnkocmVxdWlyZWRCeXRlczogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudG90YWxDYW52YXNNZW1vcnkgKyByZXF1aXJlZEJ5dGVzIDw9IHRoaXMuTUFYX1RPVEFMX01FTU9SWTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBjbGVhbnVwIHRpbWVyXG4gICAqL1xuICBwcml2YXRlIHN0YXJ0Q2xlYW51cFRpbWVyKCk6IHZvaWQge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICB0aGlzLmNsZWFudXBUaW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHRoaXMuY2xlYW51cFVudXNlZENhbnZhc2VzKCk7XG4gICAgICB9LCB0aGlzLlBPT0xfQ0xFQU5VUF9JTlRFUlZBTCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgdW51c2VkIGNhbnZhc2VzIGZyb20gcG9vbFxuICAgKi9cbiAgcHJpdmF0ZSBjbGVhbnVwVW51c2VkQ2FudmFzZXMoKTogdm9pZCB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcblxuICAgIGZvciAoY29uc3QgW3Bvb2xLZXksIHBvb2xdIG9mIHRoaXMuY2FudmFzUG9vbC5lbnRyaWVzKCkpIHtcbiAgICAgIC8vIFJlbW92ZSBvbGQgdW51c2VkIGNhbnZhc2VzXG4gICAgICBjb25zdCBmaWx0ZXJlZCA9IHBvb2wuZmlsdGVyKChlbnRyeSkgPT4ge1xuICAgICAgICBjb25zdCBpc09sZCA9IG5vdyAtIGVudHJ5Lmxhc3RVc2VkID4gdGhpcy5NQVhfVU5VU0VEX1RJTUU7XG4gICAgICAgIGNvbnN0IHNob3VsZFJlbW92ZSA9ICFlbnRyeS5pblVzZSAmJiBpc09sZDtcblxuICAgICAgICBpZiAoc2hvdWxkUmVtb3ZlKSB7XG4gICAgICAgICAgdGhpcy5mb3JjZURpc3Bvc2VDYW52YXMoZW50cnkuY2FudmFzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAhc2hvdWxkUmVtb3ZlO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChmaWx0ZXJlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5jYW52YXNQb29sLmRlbGV0ZShwb29sS2V5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2FudmFzUG9vbC5zZXQocG9vbEtleSwgZmlsdGVyZWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JjZSBjbGVhbnVwIHdoZW4gbWVtb3J5IGxpbWl0IGlzIHJlYWNoZWRcbiAgICovXG4gIHByaXZhdGUgZm9yY2VDbGVhbnVwKCk6IHZvaWQge1xuICAgIC8vIFJlbW92ZSBvbGRlc3QgdW51c2VkIGNhbnZhc2VzIGZpcnN0XG4gICAgY29uc3QgYWxsRW50cmllczogQXJyYXk8e1xuICAgICAgcG9vbEtleTogc3RyaW5nO1xuICAgICAgZW50cnk6IENhbnZhc1Bvb2xFbnRyeTtcbiAgICAgIGluZGV4OiBudW1iZXI7XG4gICAgfT4gPSBbXTtcblxuICAgIGZvciAoY29uc3QgW3Bvb2xLZXksIHBvb2xdIG9mIHRoaXMuY2FudmFzUG9vbC5lbnRyaWVzKCkpIHtcbiAgICAgIHBvb2wuZm9yRWFjaCgoZW50cnksIGluZGV4KSA9PiB7XG4gICAgICAgIGlmICghZW50cnkuaW5Vc2UpIHtcbiAgICAgICAgICBhbGxFbnRyaWVzLnB1c2goeyBwb29sS2V5LCBlbnRyeSwgaW5kZXggfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNvcnQgYnkgbGFzdCB1c2VkIHRpbWUgKG9sZGVzdCBmaXJzdClcbiAgICBhbGxFbnRyaWVzLnNvcnQoKGEsIGIpID0+IGEuZW50cnkubGFzdFVzZWQgLSBiLmVudHJ5Lmxhc3RVc2VkKTtcblxuICAgIC8vIFJlbW92ZSBvbGRlc3QgY2FudmFzZXMgdW50aWwgd2UncmUgdW5kZXIgbWVtb3J5IGxpbWl0XG4gICAgZm9yIChjb25zdCB7IHBvb2xLZXksIGVudHJ5LCBpbmRleCB9IG9mIGFsbEVudHJpZXMpIHtcbiAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmNhbnZhc1Bvb2wuZ2V0KHBvb2xLZXkpO1xuICAgICAgaWYgKHBvb2wpIHtcbiAgICAgICAgdGhpcy5mb3JjZURpc3Bvc2VDYW52YXMoZW50cnkuY2FudmFzKTtcbiAgICAgICAgcG9vbC5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgICAgIGlmIChwb29sLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuY2FudmFzUG9vbC5kZWxldGUocG9vbEtleSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiB3ZSd2ZSBmcmVlZCBlbm91Z2ggbWVtb3J5XG4gICAgICAgIGlmICh0aGlzLnRvdGFsQ2FudmFzTWVtb3J5IDwgdGhpcy5NQVhfVE9UQUxfTUVNT1JZICogMC44KSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIHN0YXRpc3RpY3NcbiAgICovXG4gIGdldENhY2hlU3RhdHMoKToge1xuICAgIHRvdGFsUG9vbHM6IG51bWJlcjtcbiAgICB0b3RhbENhbnZhc2VzOiBudW1iZXI7XG4gICAgbWVtb3J5VXNhZ2VNQjogbnVtYmVyO1xuICAgIG1heE1lbW9yeU1COiBudW1iZXI7XG4gICAgdXRpbGl6YXRpb25QZXJjZW50OiBudW1iZXI7XG4gIH0ge1xuICAgIGxldCB0b3RhbENhbnZhc2VzID0gMDtcbiAgICBmb3IgKGNvbnN0IHBvb2wgb2YgdGhpcy5jYW52YXNQb29sLnZhbHVlcygpKSB7XG4gICAgICB0b3RhbENhbnZhc2VzICs9IHBvb2wubGVuZ3RoO1xuICAgIH1cblxuICAgIGNvbnN0IG1lbW9yeVVzYWdlTUIgPSB0aGlzLnRvdGFsQ2FudmFzTWVtb3J5IC8gKDEwMjQgKiAxMDI0KTtcbiAgICBjb25zdCBtYXhNZW1vcnlNQiA9IHRoaXMuTUFYX1RPVEFMX01FTU9SWSAvICgxMDI0ICogMTAyNCk7XG4gICAgY29uc3QgdXRpbGl6YXRpb25QZXJjZW50ID1cbiAgICAgICh0aGlzLnRvdGFsQ2FudmFzTWVtb3J5IC8gdGhpcy5NQVhfVE9UQUxfTUVNT1JZKSAqIDEwMDtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbFBvb2xzOiB0aGlzLmNhbnZhc1Bvb2wuc2l6ZSxcbiAgICAgIHRvdGFsQ2FudmFzZXMsXG4gICAgICBtZW1vcnlVc2FnZU1CLFxuICAgICAgbWF4TWVtb3J5TUIsXG4gICAgICB1dGlsaXphdGlvblBlcmNlbnQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpbWl6ZSBjYW52YXMgZm9yIHNwZWNpZmljIHVzZSBjYXNlXG4gICAqL1xuICBvcHRpbWl6ZUNhbnZhcyhcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICAgIHB1cnBvc2U6IFwiZXhwb3J0XCIgfCBcInByZXZpZXdcIiB8IFwidGh1bWJuYWlsXCJcbiAgKTogSFRNTENhbnZhc0VsZW1lbnQge1xuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgaWYgKCFjdHgpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBnZXQgMkQgY29udGV4dCBmcm9tIGNhbnZhc1wiKTtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHB1cnBvc2UpIHtcbiAgICAgIGNhc2UgXCJleHBvcnRcIjpcbiAgICAgICAgLy8gSGlnaCBxdWFsaXR5IHNldHRpbmdzIGZvciBleHBvcnRcbiAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGN0eC5pbWFnZVNtb290aGluZ1F1YWxpdHkgPSBcImhpZ2hcIjtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgXCJwcmV2aWV3XCI6XG4gICAgICAgIC8vIEJhbGFuY2VkIHF1YWxpdHkgZm9yIHByZXZpZXdcbiAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRydWU7XG4gICAgICAgIGN0eC5pbWFnZVNtb290aGluZ1F1YWxpdHkgPSBcIm1lZGl1bVwiO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcInRodW1ibmFpbFwiOlxuICAgICAgICAvLyBGYXN0IHJlbmRlcmluZyBmb3IgdGh1bWJuYWlsc1xuICAgICAgICBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nUXVhbGl0eSA9IFwibG93XCI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBjYW52YXM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGNhbnZhcyB3aXRoIHNwZWNpZmljIHBlcmZvcm1hbmNlIHNldHRpbmdzXG4gICAqL1xuICBjcmVhdGVPcHRpbWl6ZWRDYW52YXMoXG4gICAgd2lkdGg6IG51bWJlcixcbiAgICBoZWlnaHQ6IG51bWJlcixcbiAgICBwdXJwb3NlOiBcImV4cG9ydFwiIHwgXCJwcmV2aWV3XCIgfCBcInRodW1ibmFpbFwiXG4gICk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBjb25zdCBjYW52YXMgPSB0aGlzLmNyZWF0ZUNhbnZhcyh3aWR0aCwgaGVpZ2h0KTtcbiAgICByZXR1cm4gdGhpcy5vcHRpbWl6ZUNhbnZhcyhjYW52YXMsIHB1cnBvc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJhdGNoIGNyZWF0ZSBjYW52YXNlc1xuICAgKi9cbiAgYmF0Y2hDcmVhdGVDYW52YXNlcyhcbiAgICBkaW1lbnNpb25zOiBBcnJheTx7IHdpZHRoOiBudW1iZXI7IGhlaWdodDogbnVtYmVyIH0+LFxuICAgIHB1cnBvc2U6IFwiZXhwb3J0XCIgfCBcInByZXZpZXdcIiB8IFwidGh1bWJuYWlsXCIgPSBcImV4cG9ydFwiXG4gICk6IEhUTUxDYW52YXNFbGVtZW50W10ge1xuICAgIHJldHVybiBkaW1lbnNpb25zLm1hcCgoeyB3aWR0aCwgaGVpZ2h0IH0pID0+XG4gICAgICB0aGlzLmNyZWF0ZU9wdGltaXplZENhbnZhcyh3aWR0aCwgaGVpZ2h0LCBwdXJwb3NlKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQmF0Y2ggZGlzcG9zZSBjYW52YXNlc1xuICAgKi9cbiAgYmF0Y2hEaXNwb3NlQ2FudmFzZXMoY2FudmFzZXM6IEhUTUxDYW52YXNFbGVtZW50W10pOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IGNhbnZhcyBvZiBjYW52YXNlcykge1xuICAgICAgdGhpcy5kaXNwb3NlQ2FudmFzKGNhbnZhcyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2Ugb2Ygc2VydmljZSBhbmQgY2xlYW51cCByZXNvdXJjZXNcbiAgICovXG4gIGRpc3Bvc2UoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY2xlYW51cFRpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cFRpbWVyKTtcbiAgICAgIHRoaXMuY2xlYW51cFRpbWVyID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHRoaXMuY2xlYXJDYWNoZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlYnVnIG1ldGhvZCB0byB0ZXN0IGNhbnZhcyBtYW5hZ2VtZW50XG4gICAqL1xuICBkZWJ1Z0NhbnZhc01hbmFnZW1lbnQoKToge1xuICAgIGNyZWF0ZVRlc3Q6IGJvb2xlYW47XG4gICAgcG9vbFRlc3Q6IGJvb2xlYW47XG4gICAgbWVtb3J5VGVzdDogYm9vbGVhbjtcbiAgfSB7XG4gICAgbGV0IGNyZWF0ZVRlc3QgPSBmYWxzZTtcbiAgICBsZXQgcG9vbFRlc3QgPSBmYWxzZTtcbiAgICBsZXQgbWVtb3J5VGVzdCA9IGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRlc3QgY2FudmFzIGNyZWF0aW9uXG4gICAgICBjb25zdCB0ZXN0Q2FudmFzID0gdGhpcy5jcmVhdGVDYW52YXMoMTAwLCAxMDApO1xuICAgICAgY3JlYXRlVGVzdCA9IHRlc3RDYW52YXMud2lkdGggPT09IDEwMCAmJiB0ZXN0Q2FudmFzLmhlaWdodCA9PT0gMTAwO1xuXG4gICAgICAvLyBUZXN0IHBvb2xpbmdcbiAgICAgIHRoaXMuZGlzcG9zZUNhbnZhcyh0ZXN0Q2FudmFzKTtcbiAgICAgIGNvbnN0IHBvb2xlZENhbnZhcyA9IHRoaXMuY3JlYXRlQ2FudmFzKDEwMCwgMTAwKTtcbiAgICAgIHBvb2xUZXN0ID0gcG9vbGVkQ2FudmFzLndpZHRoID09PSAxMDAgJiYgcG9vbGVkQ2FudmFzLmhlaWdodCA9PT0gMTAwO1xuXG4gICAgICAvLyBUZXN0IG1lbW9yeSB0cmFja2luZ1xuICAgICAgY29uc3QgaW5pdGlhbE1lbW9yeSA9IHRoaXMuZ2V0TWVtb3J5VXNhZ2UoKTtcbiAgICAgIGNvbnN0IGJpZ0NhbnZhcyA9IHRoaXMuY3JlYXRlQ2FudmFzKDEwMDAsIDEwMDApO1xuICAgICAgY29uc3QgYWZ0ZXJNZW1vcnkgPSB0aGlzLmdldE1lbW9yeVVzYWdlKCk7XG4gICAgICBtZW1vcnlUZXN0ID0gYWZ0ZXJNZW1vcnkgPiBpbml0aWFsTWVtb3J5O1xuXG4gICAgICAvLyBDbGVhbnVwXG4gICAgICB0aGlzLmRpc3Bvc2VDYW52YXMocG9vbGVkQ2FudmFzKTtcbiAgICAgIHRoaXMuZGlzcG9zZUNhbnZhcyhiaWdDYW52YXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQ2FudmFzIG1hbmFnZW1lbnQgZGVidWcgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgY3JlYXRlVGVzdCwgcG9vbFRlc3QsIG1lbW9yeVRlc3QgfTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFnQk8sYUFBTSx3QkFBNEQ7QUFBQTtBQUFBLEVBRS9ELGFBQWEsb0JBQUksSUFBK0I7QUFBQSxFQUN2Qyw4QkFBOEI7QUFBQSxFQUM5Qix3QkFBd0I7QUFBQTtBQUFBLEVBQ3hCLGtCQUFrQjtBQUFBO0FBQUE7QUFBQSxFQUczQixvQkFBb0I7QUFBQSxFQUNYLG1CQUFtQixNQUFNLE9BQU87QUFBQTtBQUFBO0FBQUEsRUFHekM7QUFBQSxFQUVSLGNBQWM7QUFDWixT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