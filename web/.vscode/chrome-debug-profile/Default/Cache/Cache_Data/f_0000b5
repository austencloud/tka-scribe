import { Location, MotionType } from "/src/lib/domain/enums.ts";
export const UP = "up";
export const DOWN = "down";
export const LEFT = "left";
export const RIGHT = "right";
export const UPRIGHT = "upright";
export const DOWNRIGHT = "downright";
export const UPLEFT = "upleft";
export const DOWNLEFT = "downleft";
export const RED = "red";
export const BLUE = "blue";
const DIAMOND = "diamond";
const BOX = "box";
export class BetaPropDirectionCalculator {
  constructor(motionData) {
    this.motionData = motionData;
  }
  // Diamond grid maps for static/dash motions
  diamondMapRadial = {
    [Location.NORTH]: { [RED]: RIGHT, [BLUE]: LEFT },
    [Location.EAST]: { [RED]: DOWN, [BLUE]: UP },
    [Location.SOUTH]: { [RED]: LEFT, [BLUE]: RIGHT },
    [Location.WEST]: { [RED]: UP, [BLUE]: DOWN }
  };
  diamondMapNonRadial = {
    [Location.NORTH]: { [RED]: UP, [BLUE]: DOWN },
    [Location.EAST]: { [RED]: RIGHT, [BLUE]: LEFT },
    [Location.SOUTH]: { [RED]: DOWN, [BLUE]: UP },
    [Location.WEST]: { [RED]: LEFT, [BLUE]: RIGHT }
  };
  // Box grid maps for static/dash motions
  boxMapRadial = {
    [Location.NORTHEAST]: { [RED]: DOWNRIGHT, [BLUE]: UPLEFT },
    [Location.SOUTHEAST]: { [RED]: UPRIGHT, [BLUE]: DOWNLEFT },
    [Location.SOUTHWEST]: { [RED]: DOWNRIGHT, [BLUE]: UPLEFT },
    [Location.NORTHWEST]: { [RED]: UPRIGHT, [BLUE]: DOWNLEFT }
  };
  boxMapNonRadial = {
    [Location.NORTHEAST]: { [RED]: UPLEFT, [BLUE]: DOWNRIGHT },
    [Location.SOUTHEAST]: { [RED]: UPRIGHT, [BLUE]: DOWNLEFT },
    [Location.SOUTHWEST]: { [RED]: UPLEFT, [BLUE]: DOWNRIGHT },
    [Location.NORTHWEST]: { [RED]: DOWNLEFT, [BLUE]: UPRIGHT }
  };
  // Shift motion direction maps
  directionMapRadialShift = {
    [Location.EAST]: { [Location.NORTH]: RIGHT, [Location.SOUTH]: RIGHT },
    [Location.WEST]: { [Location.NORTH]: LEFT, [Location.SOUTH]: LEFT },
    [Location.NORTH]: { [Location.EAST]: UP, [Location.WEST]: UP },
    [Location.SOUTH]: { [Location.EAST]: DOWN, [Location.WEST]: DOWN },
    [Location.NORTHEAST]: {
      [Location.NORTHWEST]: UPRIGHT,
      [Location.SOUTHEAST]: UPRIGHT
    },
    [Location.SOUTHEAST]: {
      [Location.NORTHEAST]: DOWNRIGHT,
      [Location.SOUTHWEST]: DOWNRIGHT
    },
    [Location.SOUTHWEST]: {
      [Location.NORTHWEST]: DOWNLEFT,
      [Location.SOUTHEAST]: DOWNLEFT
    },
    [Location.NORTHWEST]: {
      [Location.NORTHEAST]: UPLEFT,
      [Location.SOUTHWEST]: UPLEFT
    }
  };
  directionMapNonRadialShift = {
    [Location.EAST]: { [Location.NORTH]: UP, [Location.SOUTH]: UP },
    [Location.WEST]: { [Location.NORTH]: DOWN, [Location.SOUTH]: DOWN },
    [Location.NORTH]: { [Location.EAST]: RIGHT, [Location.WEST]: RIGHT },
    [Location.SOUTH]: { [Location.EAST]: LEFT, [Location.WEST]: LEFT },
    [Location.NORTHEAST]: {
      [Location.SOUTHEAST]: UPLEFT,
      [Location.NORTHWEST]: DOWNRIGHT
    },
    [Location.SOUTHEAST]: {
      [Location.NORTHEAST]: UPRIGHT,
      [Location.SOUTHWEST]: UPRIGHT
    },
    [Location.SOUTHWEST]: {
      [Location.NORTHWEST]: UPLEFT,
      [Location.SOUTHEAST]: DOWNRIGHT
    },
    [Location.NORTHWEST]: {
      [Location.NORTHEAST]: DOWNLEFT,
      [Location.SOUTHWEST]: DOWNLEFT
    }
  };
  /**
   * Get direction for a prop based on its motion data and color
   */
  getDirection(prop) {
    const motionData = prop.color === "red" ? this.motionData.red : this.motionData.blue;
    if (!motionData) {
      console.error(`No motion data found for ${prop.color} prop`);
      return null;
    }
    if ([MotionType.PRO, MotionType.ANTI, MotionType.FLOAT].includes(
      motionData.motionType
    )) {
      return this.handleShiftMotion(prop, motionData);
    }
    return this.handleStaticDashMotion(prop);
  }
  /**
   * Handle shift motion direction calculation
   */
  handleShiftMotion(_prop, motionData) {
    const isRadial = this.endsWithRadialOrientation();
    const startLocation = motionData.startLocation ?? motionData.start_location ?? "";
    const endLocation = motionData.endLocation ?? motionData.end_location ?? "";
    return this.getShiftDirection(isRadial, startLocation, endLocation);
  }
  /**
   * Get shift direction based on start and end locations
   */
  getShiftDirection(isRadial, startLocation, endLocation) {
    const map = isRadial ? this.directionMapRadialShift : this.directionMapNonRadialShift;
    return map[startLocation]?.[endLocation] ?? null;
  }
  /**
   * Handle static/dash motion direction calculation
   */
  handleStaticDashMotion(prop) {
    const location = prop.location || "";
    const cardinalValues = [
      Location.NORTH,
      Location.SOUTH,
      Location.EAST,
      Location.WEST
    ];
    const gridMode = cardinalValues.includes(location) ? DIAMOND : BOX;
    const isRadial = this.endsWithRadialOrientation();
    if (gridMode === DIAMOND) {
      const map2 = isRadial ? this.diamondMapRadial : this.diamondMapNonRadial;
      return map2[location]?.[prop.color] ?? null;
    }
    const map = isRadial ? this.boxMapRadial : this.boxMapNonRadial;
    return map[location]?.[prop.color] ?? null;
  }
  /**
   * Get opposite direction
   */
  getOppositeDirection(direction) {
    const opposites = {
      [UP]: DOWN,
      [DOWN]: UP,
      [LEFT]: RIGHT,
      [RIGHT]: LEFT,
      [UPRIGHT]: DOWNLEFT,
      [DOWNLEFT]: UPRIGHT,
      [UPLEFT]: DOWNRIGHT,
      [DOWNRIGHT]: UPLEFT
    };
    return opposites[direction];
  }
  /**
   * Check if motion ends with radial orientation
   * This needs to be passed in from the test or determined by context
   */
  endsWithRadialOrientation() {
    const redEndOri = this.motionData.red.end_orientation ?? this.motionData.red.endOrientation;
    const blueEndOri = this.motionData.blue.end_orientation ?? this.motionData.blue.endOrientation;
    if (redEndOri === "in" && blueEndOri === "in") return true;
    if (redEndOri === "out" && blueEndOri === "out") return false;
    return true;
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJldGFQcm9wRGlyZWN0aW9uQ2FsY3VsYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJldGEgUHJvcCBEaXJlY3Rpb24gQ2FsY3VsYXRvclxuICpcbiAqIENhbGN1bGF0ZXMgbW92ZW1lbnQgZGlyZWN0aW9ucyBmb3IgYmV0YSBwcm9wIHBvc2l0aW9uaW5nIGJhc2VkIG9uIGxlZ2FjeSBsb2dpYy5cbiAqIFBvcnRlZCBmcm9tIGxlZ2FjeV93ZWIgQmV0YVByb3BEaXJlY3Rpb25DYWxjdWxhdG9yLnRzXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBNb3Rpb25EYXRhLCBQcm9wRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHsgTG9jYXRpb24sIE1vdGlvblR5cGUgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcblxuLy8gRGlyZWN0aW9uIGNvbnN0YW50c1xuZXhwb3J0IGNvbnN0IFVQID0gXCJ1cFwiO1xuZXhwb3J0IGNvbnN0IERPV04gPSBcImRvd25cIjtcbmV4cG9ydCBjb25zdCBMRUZUID0gXCJsZWZ0XCI7XG5leHBvcnQgY29uc3QgUklHSFQgPSBcInJpZ2h0XCI7XG5leHBvcnQgY29uc3QgVVBSSUdIVCA9IFwidXByaWdodFwiO1xuZXhwb3J0IGNvbnN0IERPV05SSUdIVCA9IFwiZG93bnJpZ2h0XCI7XG5leHBvcnQgY29uc3QgVVBMRUZUID0gXCJ1cGxlZnRcIjtcbmV4cG9ydCBjb25zdCBET1dOTEVGVCA9IFwiZG93bmxlZnRcIjtcblxuZXhwb3J0IHR5cGUgRGlyZWN0aW9uID1cbiAgfCB0eXBlb2YgVVBcbiAgfCB0eXBlb2YgRE9XTlxuICB8IHR5cGVvZiBMRUZUXG4gIHwgdHlwZW9mIFJJR0hUXG4gIHwgdHlwZW9mIFVQUklHSFRcbiAgfCB0eXBlb2YgRE9XTlJJR0hUXG4gIHwgdHlwZW9mIFVQTEVGVFxuICB8IHR5cGVvZiBET1dOTEVGVDtcblxuLy8gVXNlIGRvbWFpbiBMb2NhdGlvbiBlbnVtIHN0cmluZyB2YWx1ZXNcbnR5cGUgTG9jID0gYCR7TG9jYXRpb259YDsgLy8gZW51bSBzdHJpbmcgdmFsdWVzXG50eXBlIERpYW1vbmRMb2MgPVxuICB8IExvY2F0aW9uLk5PUlRIXG4gIHwgTG9jYXRpb24uU09VVEhcbiAgfCBMb2NhdGlvbi5FQVNUXG4gIHwgTG9jYXRpb24uV0VTVDtcbnR5cGUgQm94TG9jID1cbiAgfCBMb2NhdGlvbi5OT1JUSEVBU1RcbiAgfCBMb2NhdGlvbi5TT1VUSEVBU1RcbiAgfCBMb2NhdGlvbi5TT1VUSFdFU1RcbiAgfCBMb2NhdGlvbi5OT1JUSFdFU1Q7XG5cbi8vIENvbG9yIGNvbnN0YW50c1xuZXhwb3J0IGNvbnN0IFJFRCA9IFwicmVkXCI7XG5leHBvcnQgY29uc3QgQkxVRSA9IFwiYmx1ZVwiO1xuZXhwb3J0IHR5cGUgQ29sb3IgPSB0eXBlb2YgUkVEIHwgdHlwZW9mIEJMVUU7XG5cbi8vIEdyaWQgbW9kZSBjb25zdGFudHMga2VwdCBsb2NhbCAoY291bGQgaW1wb3J0IEdyaWRNb2RlIGlmIG5lZWRlZClcbmNvbnN0IERJQU1PTkQgPSBcImRpYW1vbmRcIjtcbmNvbnN0IEJPWCA9IFwiYm94XCI7XG5cbmV4cG9ydCBjbGFzcyBCZXRhUHJvcERpcmVjdGlvbkNhbGN1bGF0b3Ige1xuICAvLyBEaWFtb25kIGdyaWQgbWFwcyBmb3Igc3RhdGljL2Rhc2ggbW90aW9uc1xuICBwcml2YXRlIGRpYW1vbmRNYXBSYWRpYWw6IFJlY29yZDxEaWFtb25kTG9jLCBSZWNvcmQ8Q29sb3IsIERpcmVjdGlvbj4+ID0ge1xuICAgIFtMb2NhdGlvbi5OT1JUSF06IHsgW1JFRF06IFJJR0hULCBbQkxVRV06IExFRlQgfSxcbiAgICBbTG9jYXRpb24uRUFTVF06IHsgW1JFRF06IERPV04sIFtCTFVFXTogVVAgfSxcbiAgICBbTG9jYXRpb24uU09VVEhdOiB7IFtSRURdOiBMRUZULCBbQkxVRV06IFJJR0hUIH0sXG4gICAgW0xvY2F0aW9uLldFU1RdOiB7IFtSRURdOiBVUCwgW0JMVUVdOiBET1dOIH0sXG4gIH07XG5cbiAgcHJpdmF0ZSBkaWFtb25kTWFwTm9uUmFkaWFsOiBSZWNvcmQ8RGlhbW9uZExvYywgUmVjb3JkPENvbG9yLCBEaXJlY3Rpb24+PiA9IHtcbiAgICBbTG9jYXRpb24uTk9SVEhdOiB7IFtSRURdOiBVUCwgW0JMVUVdOiBET1dOIH0sXG4gICAgW0xvY2F0aW9uLkVBU1RdOiB7IFtSRURdOiBSSUdIVCwgW0JMVUVdOiBMRUZUIH0sXG4gICAgW0xvY2F0aW9uLlNPVVRIXTogeyBbUkVEXTogRE9XTiwgW0JMVUVdOiBVUCB9LFxuICAgIFtMb2NhdGlvbi5XRVNUXTogeyBbUkVEXTogTEVGVCwgW0JMVUVdOiBSSUdIVCB9LFxuICB9O1xuXG4gIC8vIEJveCBncmlkIG1hcHMgZm9yIHN0YXRpYy9kYXNoIG1vdGlvbnNcbiAgcHJpdmF0ZSBib3hNYXBSYWRpYWw6IFJlY29yZDxCb3hMb2MsIFJlY29yZDxDb2xvciwgRGlyZWN0aW9uPj4gPSB7XG4gICAgW0xvY2F0aW9uLk5PUlRIRUFTVF06IHsgW1JFRF06IERPV05SSUdIVCwgW0JMVUVdOiBVUExFRlQgfSxcbiAgICBbTG9jYXRpb24uU09VVEhFQVNUXTogeyBbUkVEXTogVVBSSUdIVCwgW0JMVUVdOiBET1dOTEVGVCB9LFxuICAgIFtMb2NhdGlvbi5TT1VUSFdFU1RdOiB7IFtSRURdOiBET1dOUklHSFQsIFtCTFVFXTogVVBMRUZUIH0sXG4gICAgW0xvY2F0aW9uLk5PUlRIV0VTVF06IHsgW1JFRF06IFVQUklHSFQsIFtCTFVFXTogRE9XTkxFRlQgfSxcbiAgfTtcblxuICBwcml2YXRlIGJveE1hcE5vblJhZGlhbDogUmVjb3JkPEJveExvYywgUmVjb3JkPENvbG9yLCBEaXJlY3Rpb24+PiA9IHtcbiAgICBbTG9jYXRpb24uTk9SVEhFQVNUXTogeyBbUkVEXTogVVBMRUZULCBbQkxVRV06IERPV05SSUdIVCB9LFxuICAgIFtMb2NhdGlvbi5TT1VUSEVBU1RdOiB7IFtSRURdOiBVUFJJR0hULCBbQkxVRV06IERPV05MRUZUIH0sXG4gICAgW0xvY2F0aW9uLlNPVVRIV0VTVF06IHsgW1JFRF06IFVQTEVGVCwgW0JMVUVdOiBET1dOUklHSFQgfSxcbiAgICBbTG9jYXRpb24uTk9SVEhXRVNUXTogeyBbUkVEXTogRE9XTkxFRlQsIFtCTFVFXTogVVBSSUdIVCB9LFxuICB9O1xuXG4gIC8vIFNoaWZ0IG1vdGlvbiBkaXJlY3Rpb24gbWFwc1xuICBwcml2YXRlIGRpcmVjdGlvbk1hcFJhZGlhbFNoaWZ0OiBSZWNvcmQ8XG4gICAgTG9jLFxuICAgIFBhcnRpYWw8UmVjb3JkPExvYywgRGlyZWN0aW9uPj5cbiAgPiA9IHtcbiAgICBbTG9jYXRpb24uRUFTVF06IHsgW0xvY2F0aW9uLk5PUlRIXTogUklHSFQsIFtMb2NhdGlvbi5TT1VUSF06IFJJR0hUIH0sXG4gICAgW0xvY2F0aW9uLldFU1RdOiB7IFtMb2NhdGlvbi5OT1JUSF06IExFRlQsIFtMb2NhdGlvbi5TT1VUSF06IExFRlQgfSxcbiAgICBbTG9jYXRpb24uTk9SVEhdOiB7IFtMb2NhdGlvbi5FQVNUXTogVVAsIFtMb2NhdGlvbi5XRVNUXTogVVAgfSxcbiAgICBbTG9jYXRpb24uU09VVEhdOiB7IFtMb2NhdGlvbi5FQVNUXTogRE9XTiwgW0xvY2F0aW9uLldFU1RdOiBET1dOIH0sXG4gICAgW0xvY2F0aW9uLk5PUlRIRUFTVF06IHtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1RdOiBVUFJJR0hULFxuICAgICAgW0xvY2F0aW9uLlNPVVRIRUFTVF06IFVQUklHSFQsXG4gICAgfSxcbiAgICBbTG9jYXRpb24uU09VVEhFQVNUXToge1xuICAgICAgW0xvY2F0aW9uLk5PUlRIRUFTVF06IERPV05SSUdIVCxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSFdFU1RdOiBET1dOUklHSFQsXG4gICAgfSxcbiAgICBbTG9jYXRpb24uU09VVEhXRVNUXToge1xuICAgICAgW0xvY2F0aW9uLk5PUlRIV0VTVF06IERPV05MRUZULFxuICAgICAgW0xvY2F0aW9uLlNPVVRIRUFTVF06IERPV05MRUZULFxuICAgIH0sXG4gICAgW0xvY2F0aW9uLk5PUlRIV0VTVF06IHtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1RdOiBVUExFRlQsXG4gICAgICBbTG9jYXRpb24uU09VVEhXRVNUXTogVVBMRUZULFxuICAgIH0sXG4gIH07XG5cbiAgcHJpdmF0ZSBkaXJlY3Rpb25NYXBOb25SYWRpYWxTaGlmdDogUmVjb3JkPFxuICAgIExvYyxcbiAgICBQYXJ0aWFsPFJlY29yZDxMb2MsIERpcmVjdGlvbj4+XG4gID4gPSB7XG4gICAgW0xvY2F0aW9uLkVBU1RdOiB7IFtMb2NhdGlvbi5OT1JUSF06IFVQLCBbTG9jYXRpb24uU09VVEhdOiBVUCB9LFxuICAgIFtMb2NhdGlvbi5XRVNUXTogeyBbTG9jYXRpb24uTk9SVEhdOiBET1dOLCBbTG9jYXRpb24uU09VVEhdOiBET1dOIH0sXG4gICAgW0xvY2F0aW9uLk5PUlRIXTogeyBbTG9jYXRpb24uRUFTVF06IFJJR0hULCBbTG9jYXRpb24uV0VTVF06IFJJR0hUIH0sXG4gICAgW0xvY2F0aW9uLlNPVVRIXTogeyBbTG9jYXRpb24uRUFTVF06IExFRlQsIFtMb2NhdGlvbi5XRVNUXTogTEVGVCB9LFxuICAgIFtMb2NhdGlvbi5OT1JUSEVBU1RdOiB7XG4gICAgICBbTG9jYXRpb24uU09VVEhFQVNUXTogVVBMRUZULFxuICAgICAgW0xvY2F0aW9uLk5PUlRIV0VTVF06IERPV05SSUdIVCxcbiAgICB9LFxuICAgIFtMb2NhdGlvbi5TT1VUSEVBU1RdOiB7XG4gICAgICBbTG9jYXRpb24uTk9SVEhFQVNUXTogVVBSSUdIVCxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSFdFU1RdOiBVUFJJR0hULFxuICAgIH0sXG4gICAgW0xvY2F0aW9uLlNPVVRIV0VTVF06IHtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1RdOiBVUExFRlQsXG4gICAgICBbTG9jYXRpb24uU09VVEhFQVNUXTogRE9XTlJJR0hULFxuICAgIH0sXG4gICAgW0xvY2F0aW9uLk5PUlRIV0VTVF06IHtcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1RdOiBET1dOTEVGVCxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSFdFU1RdOiBET1dOTEVGVCxcbiAgICB9LFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbW90aW9uRGF0YTogeyByZWQ6IE1vdGlvbkRhdGE7IGJsdWU6IE1vdGlvbkRhdGEgfSkge31cblxuICAvKipcbiAgICogR2V0IGRpcmVjdGlvbiBmb3IgYSBwcm9wIGJhc2VkIG9uIGl0cyBtb3Rpb24gZGF0YSBhbmQgY29sb3JcbiAgICovXG4gIGdldERpcmVjdGlvbihwcm9wOiBQcm9wRGF0YSk6IERpcmVjdGlvbiB8IG51bGwge1xuICAgIGNvbnN0IG1vdGlvbkRhdGEgPVxuICAgICAgcHJvcC5jb2xvciA9PT0gXCJyZWRcIiA/IHRoaXMubW90aW9uRGF0YS5yZWQgOiB0aGlzLm1vdGlvbkRhdGEuYmx1ZTtcbiAgICBpZiAoIW1vdGlvbkRhdGEpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYE5vIG1vdGlvbiBkYXRhIGZvdW5kIGZvciAke3Byb3AuY29sb3J9IHByb3BgKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIEhhbmRsZSBzaGlmdCBtb3Rpb25zIChwcm8sIGFudGksIGZsb2F0KVxuICAgIGlmIChcbiAgICAgIFtNb3Rpb25UeXBlLlBSTywgTW90aW9uVHlwZS5BTlRJLCBNb3Rpb25UeXBlLkZMT0FUXS5pbmNsdWRlcyhcbiAgICAgICAgbW90aW9uRGF0YS5tb3Rpb25UeXBlXG4gICAgICApXG4gICAgKSB7XG4gICAgICByZXR1cm4gdGhpcy5oYW5kbGVTaGlmdE1vdGlvbihwcm9wLCBtb3Rpb25EYXRhKTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgc3RhdGljL2Rhc2ggbW90aW9uc1xuICAgIHJldHVybiB0aGlzLmhhbmRsZVN0YXRpY0Rhc2hNb3Rpb24ocHJvcCk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHNoaWZ0IG1vdGlvbiBkaXJlY3Rpb24gY2FsY3VsYXRpb25cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlU2hpZnRNb3Rpb24oXG4gICAgX3Byb3A6IFByb3BEYXRhLFxuICAgIG1vdGlvbkRhdGE6IE1vdGlvbkRhdGFcbiAgKTogRGlyZWN0aW9uIHwgbnVsbCB7XG4gICAgY29uc3QgaXNSYWRpYWwgPSB0aGlzLmVuZHNXaXRoUmFkaWFsT3JpZW50YXRpb24oKTtcbiAgICBjb25zdCBzdGFydExvY2F0aW9uID1cbiAgICAgIChcbiAgICAgICAgbW90aW9uRGF0YSBhcyB1bmtub3duIGFzIHtcbiAgICAgICAgICBzdGFydExvY2F0aW9uPzogc3RyaW5nO1xuICAgICAgICAgIHN0YXJ0X2xvY2F0aW9uPzogc3RyaW5nO1xuICAgICAgICB9XG4gICAgICApLnN0YXJ0TG9jYXRpb24gPz9cbiAgICAgIChtb3Rpb25EYXRhIGFzIHVua25vd24gYXMgeyBzdGFydF9sb2NhdGlvbj86IHN0cmluZyB9KS5zdGFydF9sb2NhdGlvbiA/P1xuICAgICAgXCJcIjtcbiAgICBjb25zdCBlbmRMb2NhdGlvbiA9XG4gICAgICAobW90aW9uRGF0YSBhcyB1bmtub3duIGFzIHsgZW5kTG9jYXRpb24/OiBzdHJpbmc7IGVuZF9sb2NhdGlvbj86IHN0cmluZyB9KVxuICAgICAgICAuZW5kTG9jYXRpb24gPz9cbiAgICAgIChtb3Rpb25EYXRhIGFzIHVua25vd24gYXMgeyBlbmRfbG9jYXRpb24/OiBzdHJpbmcgfSkuZW5kX2xvY2F0aW9uID8/XG4gICAgICBcIlwiO1xuICAgIHJldHVybiB0aGlzLmdldFNoaWZ0RGlyZWN0aW9uKGlzUmFkaWFsLCBzdGFydExvY2F0aW9uLCBlbmRMb2NhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNoaWZ0IGRpcmVjdGlvbiBiYXNlZCBvbiBzdGFydCBhbmQgZW5kIGxvY2F0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXRTaGlmdERpcmVjdGlvbihcbiAgICBpc1JhZGlhbDogYm9vbGVhbixcbiAgICBzdGFydExvY2F0aW9uOiBzdHJpbmcsXG4gICAgZW5kTG9jYXRpb246IHN0cmluZ1xuICApOiBEaXJlY3Rpb24gfCBudWxsIHtcbiAgICBjb25zdCBtYXAgPSBpc1JhZGlhbFxuICAgICAgPyB0aGlzLmRpcmVjdGlvbk1hcFJhZGlhbFNoaWZ0XG4gICAgICA6IHRoaXMuZGlyZWN0aW9uTWFwTm9uUmFkaWFsU2hpZnQ7XG4gICAgcmV0dXJuIG1hcFtzdGFydExvY2F0aW9uIGFzIExvY10/LltlbmRMb2NhdGlvbiBhcyBMb2NdID8/IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIHN0YXRpYy9kYXNoIG1vdGlvbiBkaXJlY3Rpb24gY2FsY3VsYXRpb25cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlU3RhdGljRGFzaE1vdGlvbihwcm9wOiBQcm9wRGF0YSk6IERpcmVjdGlvbiB8IG51bGwge1xuICAgIGNvbnN0IGxvY2F0aW9uID0gKHByb3AubG9jYXRpb24gfHwgXCJcIikgYXMgTG9jO1xuICAgIGNvbnN0IGNhcmRpbmFsVmFsdWVzID0gW1xuICAgICAgTG9jYXRpb24uTk9SVEgsXG4gICAgICBMb2NhdGlvbi5TT1VUSCxcbiAgICAgIExvY2F0aW9uLkVBU1QsXG4gICAgICBMb2NhdGlvbi5XRVNULFxuICAgIF0gYXMgc3RyaW5nW107XG4gICAgY29uc3QgZ3JpZE1vZGUgPSBjYXJkaW5hbFZhbHVlcy5pbmNsdWRlcyhsb2NhdGlvbikgPyBESUFNT05EIDogQk9YO1xuICAgIGNvbnN0IGlzUmFkaWFsID0gdGhpcy5lbmRzV2l0aFJhZGlhbE9yaWVudGF0aW9uKCk7XG5cbiAgICBpZiAoZ3JpZE1vZGUgPT09IERJQU1PTkQpIHtcbiAgICAgIGNvbnN0IG1hcCA9IGlzUmFkaWFsID8gdGhpcy5kaWFtb25kTWFwUmFkaWFsIDogdGhpcy5kaWFtb25kTWFwTm9uUmFkaWFsO1xuICAgICAgcmV0dXJuIG1hcFtsb2NhdGlvbiBhcyBEaWFtb25kTG9jXT8uW3Byb3AuY29sb3IgYXMgQ29sb3JdID8/IG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgbWFwID0gaXNSYWRpYWwgPyB0aGlzLmJveE1hcFJhZGlhbCA6IHRoaXMuYm94TWFwTm9uUmFkaWFsO1xuICAgIHJldHVybiBtYXBbbG9jYXRpb24gYXMgQm94TG9jXT8uW3Byb3AuY29sb3IgYXMgQ29sb3JdID8/IG51bGw7XG4gIH1cblxuICAvKipcbiAgICogR2V0IG9wcG9zaXRlIGRpcmVjdGlvblxuICAgKi9cbiAgZ2V0T3Bwb3NpdGVEaXJlY3Rpb24oZGlyZWN0aW9uOiBEaXJlY3Rpb24pOiBEaXJlY3Rpb24ge1xuICAgIGNvbnN0IG9wcG9zaXRlczogUmVjb3JkPERpcmVjdGlvbiwgRGlyZWN0aW9uPiA9IHtcbiAgICAgIFtVUF06IERPV04sXG4gICAgICBbRE9XTl06IFVQLFxuICAgICAgW0xFRlRdOiBSSUdIVCxcbiAgICAgIFtSSUdIVF06IExFRlQsXG4gICAgICBbVVBSSUdIVF06IERPV05MRUZULFxuICAgICAgW0RPV05MRUZUXTogVVBSSUdIVCxcbiAgICAgIFtVUExFRlRdOiBET1dOUklHSFQsXG4gICAgICBbRE9XTlJJR0hUXTogVVBMRUZULFxuICAgIH07XG4gICAgcmV0dXJuIG9wcG9zaXRlc1tkaXJlY3Rpb25dO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIG1vdGlvbiBlbmRzIHdpdGggcmFkaWFsIG9yaWVudGF0aW9uXG4gICAqIFRoaXMgbmVlZHMgdG8gYmUgcGFzc2VkIGluIGZyb20gdGhlIHRlc3Qgb3IgZGV0ZXJtaW5lZCBieSBjb250ZXh0XG4gICAqL1xuICBwcml2YXRlIGVuZHNXaXRoUmFkaWFsT3JpZW50YXRpb24oKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVkRW5kT3JpID1cbiAgICAgIChcbiAgICAgICAgdGhpcy5tb3Rpb25EYXRhLnJlZCBhcyB1bmtub3duIGFzIHtcbiAgICAgICAgICBlbmRfb3JpZW50YXRpb24/OiBzdHJpbmc7XG4gICAgICAgICAgZW5kT3JpZW50YXRpb24/OiBzdHJpbmc7XG4gICAgICAgIH1cbiAgICAgICkuZW5kX29yaWVudGF0aW9uID8/XG4gICAgICAodGhpcy5tb3Rpb25EYXRhLnJlZCBhcyB1bmtub3duIGFzIHsgZW5kT3JpZW50YXRpb24/OiBzdHJpbmcgfSlcbiAgICAgICAgLmVuZE9yaWVudGF0aW9uO1xuICAgIGNvbnN0IGJsdWVFbmRPcmkgPVxuICAgICAgKFxuICAgICAgICB0aGlzLm1vdGlvbkRhdGEuYmx1ZSBhcyB1bmtub3duIGFzIHtcbiAgICAgICAgICBlbmRfb3JpZW50YXRpb24/OiBzdHJpbmc7XG4gICAgICAgICAgZW5kT3JpZW50YXRpb24/OiBzdHJpbmc7XG4gICAgICAgIH1cbiAgICAgICkuZW5kX29yaWVudGF0aW9uID8/XG4gICAgICAodGhpcy5tb3Rpb25EYXRhLmJsdWUgYXMgdW5rbm93biBhcyB7IGVuZE9yaWVudGF0aW9uPzogc3RyaW5nIH0pXG4gICAgICAgIC5lbmRPcmllbnRhdGlvbjtcbiAgICBpZiAocmVkRW5kT3JpID09PSBcImluXCIgJiYgYmx1ZUVuZE9yaSA9PT0gXCJpblwiKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAocmVkRW5kT3JpID09PSBcIm91dFwiICYmIGJsdWVFbmRPcmkgPT09IFwib3V0XCIpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFRQSxTQUFTLFVBQVUsa0JBQWtCO0FBRzlCLGFBQU0sS0FBSztBQUNYLGFBQU0sT0FBTztBQUNiLGFBQU0sT0FBTztBQUNiLGFBQU0sUUFBUTtBQUNkLGFBQU0sVUFBVTtBQUNoQixhQUFNLFlBQVk7QUFDbEIsYUFBTSxTQUFTO0FBQ2YsYUFBTSxXQUFXO0FBMEJqQixhQUFNLE1BQU07QUFDWixhQUFNLE9BQU87QUFJcEIsTUFBTSxVQUFVO0FBQ2hCLE1BQU0sTUFBTTtBQUVMLGFBQU0sNEJBQTRCO0FBQUEsRUFvRnZDLFlBQW9CLFlBQW1EO0FBQW5EO0FBQUEsRUFBb0Q7QUFBQTtBQUFBLEVBbEZoRSxtQkFBaUU7QUFBQSxJQUN2RSxDQUFDLFNBQVMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksR0FBRyxLQUFLO0FBQUEsSUFDL0MsQ0FBQyxTQUFTLElBQUksR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRztBQUFBLElBQzNDLENBQUMsU0FBUyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU07QUFBQSxJQUMvQyxDQUFDLFNBQVMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLO0FBQUEsRUFDN0M7QUFBQSxFQUVRLHNCQUFvRTtBQUFBLElBQzFFLENBQUMsU0FBUyxLQUFLLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUs7QUFBQSxJQUM1QyxDQUFDLFNBQVMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLElBQUksR0FBRyxLQUFLO0FBQUEsSUFDOUMsQ0FBQyxTQUFTLEtBQUssR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLEdBQUcsR0FBRztBQUFBLElBQzVDLENBQUMsU0FBUyxJQUFJLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU07QUFBQSxFQUNoRDtBQUFBO0FBQUEsRUFHUSxlQUF5RDtBQUFBLElBQy9ELENBQUMsU0FBUyxTQUFTLEdBQUcsRUFBRSxDQUFDLEdBQUcsR0FBRyxXQUFXLENBQUMsSUFBSSxHQUFHLE9BQU87QUFBQSxJQUN6RCxDQUFDLFNBQVMsU0FBUyxHQUFHLEVBQUUsQ0FBQyxHQUFHLEdBQUcsU0FBUyxDQUFDLElBQUksR0FBRyxTQUFTO0FBQUEsSUFDekQsQ0FBQyxTQUFTLFNBQVMsR0FBRyxFQUFFLENBQUMsR0FBRyxHQUFHLFdBQVcsQ0FBQyxJQUFJLEdBQUcsT0FBTztBQUFBLElBQ3pELENBQUMsU0FBUyxTQUFTLEdB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