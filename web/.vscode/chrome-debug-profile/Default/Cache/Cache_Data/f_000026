import { GridMode } from "/src/lib/domain/enums.ts";
import { sequenceStateService } from "/src/lib/services/SequenceStateService.svelte.ts";
export class ConstructTabCoordinationService {
  constructor(sequenceService, startPositionService) {
    this.sequenceService = sequenceService;
    this.startPositionService = startPositionService;
  }
  components = {};
  isHandlingSequenceModification = false;
  eventListenersSetup = false;
  boundEventHandlers = null;
  /**
   * Clean up resources when service is destroyed
   */
  destroy() {
    this.disconnectComponentSignals();
    this.components = {};
  }
  setupComponentCoordination(components) {
    this.components = components;
    if (!this.eventListenersSetup) {
      this.connectComponentSignals();
      this.eventListenersSetup = true;
    }
  }
  async handleSequenceModified(sequence) {
    if (this.isHandlingSequenceModification) {
      return;
    }
    try {
      this.isHandlingSequenceModification = true;
      sequenceStateService.setCurrentSequence(sequence);
      await this.updateUIBasedOnSequence(sequence);
      this.notifyComponents("sequence_modified", { sequence });
    } catch (error) {
      console.error("❌ Error handling sequence modification:", error);
    } finally {
      this.isHandlingSequenceModification = false;
    }
  }
  async handleStartPositionSet(startPosition) {
    try {
      sequenceStateService.setLoading(true);
      sequenceStateService.clearError();
      await this.startPositionService.setStartPosition(startPosition);
      const newSequence = await this.sequenceService.createSequence({
        name: `Sequence ${(/* @__PURE__ */ new Date()).toLocaleTimeString()}`,
        length: 0,
        // Start with 0 beats - beats will be added progressively
        gridMode: GridMode.DIAMOND,
        // Default grid mode
        propType: "staff"
        // Default prop type
      });
      await this.sequenceService.setSequenceStartPosition(
        newSequence.id,
        startPosition
      );
      const updatedSequence = await this.sequenceService.getSequence(
        newSequence.id
      );
      if (updatedSequence) {
        sequenceStateService.setCurrentSequence(updatedSequence);
        sequenceStateService.setLoading(false);
        this.notifyComponents("sequenceCreated", {
          sequence: updatedSequence,
          startPosition
        });
      } else {
        console.error("❌ Failed to reload updated sequence");
        sequenceStateService.setLoading(false);
        sequenceStateService.setError(
          "Failed to create sequence with start position"
        );
        return;
      }
      this.notifyComponents("start_position_set", { startPosition });
      this.notifyComponents("ui_state_update_requested", {
        action: "hide_start_position_picker"
      });
      await this.handleUITransitionRequest("option_picker");
    } catch (error) {
      console.error("❌ Error handling start position set:", error);
      sequenceStateService.setLoading(false);
      sequenceStateService.setError(
        `Failed to set start position: ${error instanceof Error ? error.message : "Unknown error"}`
      );
    }
  }
  async handleBeatAdded(beatData) {
    try {
      const currentSequence = sequenceStateService.currentSequence;
      if (!currentSequence) {
        console.error("❌ No current sequence available for adding beat");
        return;
      }
      if ("addBeat" in this.sequenceService && typeof this.sequenceService.addBeat === "function") {
        await this.sequenceService.addBeat(currentSequence.id, beatData);
        const updatedSequence = await this.sequenceService.getSequence(
          currentSequence.id
        );
        if (updatedSequence) {
          sequenceStateService.setCurrentSequence(updatedSequence);
        }
      } else {
        sequenceStateService.addBeat(beatData);
      }
      this.notifyComponents("beat_added", { beatData });
    } catch (error) {
      console.error("❌ Error handling beat added:", error);
      sequenceStateService.setError(
        `Failed to add beat: ${error instanceof Error ? error.message : "Unknown error"}`
      );
    }
  }
  async handleGenerationRequest(config) {
    try {
      this.notifyComponents("generation_requested", { config });
      setTimeout(() => {
        this.notifyComponents("generation_completed", {
          success: true,
          message: "Generation completed"
        });
      }, 1e3);
    } catch (error) {
      console.error("❌ Error handling generation request:", error);
    }
  }
  async handleUITransitionRequest(targetPanel) {
    try {
      const transitionEvent = new CustomEvent("construct-tab-transition", {
        detail: { targetPanel },
        bubbles: true
      });
      if (typeof window !== "undefined") {
        document.dispatchEvent(transitionEvent);
      }
      this.notifyComponents("ui_transition", { targetPanel });
    } catch (error) {
      console.error("❌ Error handling UI transition:", error);
    }
  }
  connectComponentSignals() {
    if (typeof window !== "undefined") {
      this.boundEventHandlers = {
        startPositionSelected: (event) => {
          this.handleStartPositionSet(event.detail.startPosition);
        },
        optionSelected: (event) => {
          this.handleBeatAdded(event.detail.beatData);
        },
        sequenceModified: (event) => {
          this.handleSequenceModified(event.detail.sequence);
        }
      };
      document.addEventListener(
        "start-position-selected",
        this.boundEventHandlers.startPositionSelected
      );
      document.addEventListener(
        "option-selected",
        this.boundEventHandlers.optionSelected
      );
      document.addEventListener(
        "sequence-modified",
        this.boundEventHandlers.sequenceModified
      );
    }
  }
  /**
   * Clean up event listeners to prevent memory leaks and duplicate handlers
   */
  disconnectComponentSignals() {
    if (typeof window !== "undefined" && this.boundEventHandlers) {
      document.removeEventListener(
        "start-position-selected",
        this.boundEventHandlers.startPositionSelected
      );
      document.removeEventListener(
        "option-selected",
        this.boundEventHandlers.optionSelected
      );
      document.removeEventListener(
        "sequence-modified",
        this.boundEventHandlers.sequenceModified
      );
      this.boundEventHandlers = null;
      this.eventListenersSetup = false;
    }
  }
  async updateUIBasedOnSequence(sequence) {
    try {
      const hasStartPosition = sequence?.startPosition != null;
      const hasBeats = sequence && sequence.beats && sequence.beats.length > 0;
      let targetPanel;
      if (hasStartPosition || hasBeats) {
        targetPanel = "option_picker";
      } else {
        targetPanel = "start_position_picker";
      }
      await this.handleUITransitionRequest(targetPanel);
    } catch (error) {
      console.error("❌ Error updating UI based on sequence:", error);
    }
  }
  hasStartPosition(sequence) {
    return sequence?.startPosition != null;
  }
  notifyComponents(eventType, data) {
    Object.entries(this.components).forEach(([name, component]) => {
      if (component && typeof component.handleEvent === "function") {
        try {
          component.handleEvent(eventType, data);
        } catch (error) {
          console.error(`❌ Error notifying component ${name}:`, error);
        }
      }
    });
    if (typeof window !== "undefined") {
      const event = new CustomEvent(`construct-coordination-${eventType}`, {
        detail: data,
        bubbles: true
      });
      document.dispatchEvent(event);
    }
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnN0cnVjdFRhYkNvb3JkaW5hdGlvblNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb25zdHJ1Y3QgVGFiIENvb3JkaW5hdGlvbiBTZXJ2aWNlIC0gSW1wbGVtZW50YXRpb25cbiAqXG4gKiBDb29yZGluYXRlcyBiZXR3ZWVuIGNvbnN0cnVjdCB0YWIgY29tcG9uZW50cyAoc3RhcnQgcG9zaXRpb24gcGlja2VyLCBvcHRpb24gcGlja2VyLCB3b3JrYmVuY2gpLlxuICogQmFzZWQgb24gZGVza3RvcCBDb25zdHJ1Y3RUYWJDb29yZGluYXRpb25TZXJ2aWNlIGJ1dCBzaW1wbGlmaWVkIGZvciB3ZWIgd2l0aCBydW5lcy5cbiAqXG4gKiBGSVhFRDogQWRkZWQgcHJvcGVyIHN0YXRlIHN5bmNocm9uaXphdGlvbiB0byByZXNvbHZlIHN0YXJ0IHBvc2l0aW9uIHNlbGVjdGlvbiBnZXR0aW5nIHN0dWNrXG4gKi9cblxuaW1wb3J0IHsgR3JpZE1vZGUgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcbmltcG9ydCB0eXBlIHsgQmVhdERhdGEsIFNlcXVlbmNlRGF0YSB9IGZyb20gXCIuLi8uLi9pbnRlcmZhY2VzL2RvbWFpbi10eXBlc1wiO1xuaW1wb3J0IHR5cGUge1xuICBJQ29uc3RydWN0VGFiQ29vcmRpbmF0aW9uU2VydmljZSxcbiAgSVN0YXJ0UG9zaXRpb25TZXJ2aWNlLFxufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9hcHBsaWNhdGlvbi1pbnRlcmZhY2VzXCI7XG5pbXBvcnQgdHlwZSB7IElTZXF1ZW5jZVNlcnZpY2UgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9zZXF1ZW5jZS1pbnRlcmZhY2VzXCI7XG5cbi8vIEltcG9ydCB0aGUgc2luZ2xldG9uIHNlcXVlbmNlIHN0YXRlIHNlcnZpY2UgZm9yIHByb3BlciBzeW5jaHJvbml6YXRpb25cbmltcG9ydCB7IHNlcXVlbmNlU3RhdGVTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uL1NlcXVlbmNlU3RhdGVTZXJ2aWNlLnN2ZWx0ZVwiO1xuXG5pbnRlcmZhY2UgQ29tcG9uZW50V2l0aEV2ZW50SGFuZGxlciB7XG4gIGhhbmRsZUV2ZW50PzogKGV2ZW50VHlwZTogc3RyaW5nLCBkYXRhOiB1bmtub3duKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgQ29uc3RydWN0VGFiQ29vcmRpbmF0aW9uU2VydmljZVxuICBpbXBsZW1lbnRzIElDb25zdHJ1Y3RUYWJDb29yZGluYXRpb25TZXJ2aWNlXG57XG4gIHByaXZhdGUgY29tcG9uZW50czogUmVjb3JkPHN0cmluZywgQ29tcG9uZW50V2l0aEV2ZW50SGFuZGxlcj4gPSB7fTtcbiAgcHJpdmF0ZSBpc0hhbmRsaW5nU2VxdWVuY2VNb2RpZmljYXRpb24gPSBmYWxzZTtcbiAgcHJpdmF0ZSBldmVudExpc3RlbmVyc1NldHVwID0gZmFsc2U7XG4gIHByaXZhdGUgYm91bmRFdmVudEhhbmRsZXJzOiB7XG4gICAgc3RhcnRQb3NpdGlvblNlbGVjdGVkOiAoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB2b2lkO1xuICAgIG9wdGlvblNlbGVjdGVkOiAoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB2b2lkO1xuICAgIHNlcXVlbmNlTW9kaWZpZWQ6IChldmVudDogQ3VzdG9tRXZlbnQpID0+IHZvaWQ7XG4gIH0gfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHNlcXVlbmNlU2VydmljZTogSVNlcXVlbmNlU2VydmljZSxcbiAgICBwcml2YXRlIHN0YXJ0UG9zaXRpb25TZXJ2aWNlOiBJU3RhcnRQb3NpdGlvblNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDbGVhbiB1cCByZXNvdXJjZXMgd2hlbiBzZXJ2aWNlIGlzIGRlc3Ryb3llZFxuICAgKi9cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLmRpc2Nvbm5lY3RDb21wb25lbnRTaWduYWxzKCk7XG4gICAgdGhpcy5jb21wb25lbnRzID0ge307XG4gIH1cblxuICBzZXR1cENvbXBvbmVudENvb3JkaW5hdGlvbihcbiAgICBjb21wb25lbnRzOiBSZWNvcmQ8c3RyaW5nLCBDb21wb25lbnRXaXRoRXZlbnRIYW5kbGVyPlxuICApOiB2b2lkIHtcbiAgICB0aGlzLmNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xuXG4gICAgLy8gU2V0IHVwIGFueSBjcm9zcy1jb21wb25lbnQgY29tbXVuaWNhdGlvbiBoZXJlIChvbmx5IG9uY2UpXG4gICAgaWYgKCF0aGlzLmV2ZW50TGlzdGVuZXJzU2V0dXApIHtcbiAgICAgIHRoaXMuY29ubmVjdENvbXBvbmVudFNpZ25hbHMoKTtcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnNTZXR1cCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlU2VxdWVuY2VNb2RpZmllZChzZXF1ZW5jZTogU2VxdWVuY2VEYXRhKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuaXNIYW5kbGluZ1NlcXVlbmNlTW9kaWZpY2F0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuaXNIYW5kbGluZ1NlcXVlbmNlTW9kaWZpY2F0aW9uID0gdHJ1ZTtcblxuICAgICAgLy8gKipDUklUSUNBTDogVXBkYXRlIHNpbmdsZXRvbiBzdGF0ZSB0byBrZWVwIFVJIGluIHN5bmMqKlxuICAgICAgc2VxdWVuY2VTdGF0ZVNlcnZpY2Uuc2V0Q3VycmVudFNlcXVlbmNlKHNlcXVlbmNlKTtcblxuICAgICAgLy8gVXBkYXRlIFVJIGJhc2VkIG9uIHNlcXVlbmNlIHN0YXRlXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVVJQmFzZWRPblNlcXVlbmNlKHNlcXVlbmNlKTtcblxuICAgICAgLy8gTm90aWZ5IGNvbXBvbmVudHMgYWJvdXQgc2VxdWVuY2UgY2hhbmdlXG4gICAgICB0aGlzLm5vdGlmeUNvbXBvbmVudHMoXCJzZXF1ZW5jZV9tb2RpZmllZFwiLCB7IHNlcXVlbmNlIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGhhbmRsaW5nIHNlcXVlbmNlIG1vZGlmaWNhdGlvbjpcIiwgZXJyb3IpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzSGFuZGxpbmdTZXF1ZW5jZU1vZGlmaWNhdGlvbiA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZVN0YXJ0UG9zaXRpb25TZXQoc3RhcnRQb3NpdGlvbjogQmVhdERhdGEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU2V0IGxvYWRpbmcgc3RhdGUgdG8gc2hvdyB1c2VyIHNvbWV0aGluZyBpcyBoYXBwZW5pbmdcbiAgICAgIHNlcXVlbmNlU3RhdGVTZXJ2aWNlLnNldExvYWRpbmcodHJ1ZSk7XG4gICAgICBzZXF1ZW5jZVN0YXRlU2VydmljZS5jbGVhckVycm9yKCk7XG5cbiAgICAgIC8vIFNldCB0aGUgc3RhcnQgcG9zaXRpb24gdXNpbmcgdGhlIHNlcnZpY2VcbiAgICAgIGF3YWl0IHRoaXMuc3RhcnRQb3NpdGlvblNlcnZpY2Uuc2V0U3RhcnRQb3NpdGlvbihzdGFydFBvc2l0aW9uKTtcblxuICAgICAgLy8gKipDUklUSUNBTDogQ3JlYXRlIGEgc2VxdWVuY2Ugd2l0aCB0aGUgc3RhcnQgcG9zaXRpb24gc3RvcmVkIHNlcGFyYXRlbHkqKlxuICAgICAgLy8gQ3JlYXRlIGEgbmV3IHNlcXVlbmNlIHdpdGggTk8gYmVhdHMgaW5pdGlhbGx5IChwcm9ncmVzc2l2ZSBjcmVhdGlvbilcbiAgICAgIGNvbnN0IG5ld1NlcXVlbmNlID0gYXdhaXQgdGhpcy5zZXF1ZW5jZVNlcnZpY2UuY3JlYXRlU2VxdWVuY2Uoe1xuICAgICAgICBuYW1lOiBgU2VxdWVuY2UgJHtuZXcgRGF0ZSgpLnRvTG9jYWxlVGltZVN0cmluZygpfWAsXG4gICAgICAgIGxlbmd0aDogMCwgLy8gU3RhcnQgd2l0aCAwIGJlYXRzIC0gYmVhdHMgd2lsbCBiZSBhZGRlZCBwcm9ncmVzc2l2ZWx5XG4gICAgICAgIGdyaWRNb2RlOiBHcmlkTW9kZS5ESUFNT05ELCAvLyBEZWZhdWx0IGdyaWQgbW9kZVxuICAgICAgICBwcm9wVHlwZTogXCJzdGFmZlwiLCAvLyBEZWZhdWx0IHByb3AgdHlwZVxuICAgICAgfSk7XG5cbiAgICAgIC8vICoqQ1JJVElDQUw6IFNldCB0aGUgc3RhcnQgcG9zaXRpb24gaW4gdGhlIHNlcXVlbmNlJ3Mgc3RhcnRQb3NpdGlvbiBmaWVsZCwgTk9UIGFzIGJlYXQgMCoqXG4gICAgICBhd2FpdCB0aGlzLnNlcXVlbmNlU2VydmljZS5zZXRTZXF1ZW5jZVN0YXJ0UG9zaXRpb24oXG4gICAgICAgIG5ld1NlcXVlbmNlLmlkLFxuICAgICAgICBzdGFydFBvc2l0aW9uXG4gICAgICApO1xuXG4gICAgICAvLyAqKkNSSVRJQ0FMOiBSZWxvYWQgdGhlIHNlcXVlbmNlIHRvIGdldCB0aGUgdXBkYXRlZCBzdGFydCBwb3NpdGlvbioqXG4gICAgICBjb25zdCB1cGRhdGVkU2VxdWVuY2UgPSBhd2FpdCB0aGlzLnNlcXVlbmNlU2VydmljZS5nZXRTZXF1ZW5jZShcbiAgICAgICAgbmV3U2VxdWVuY2UuaWRcbiAgICAgICk7XG5cbiAgICAgIGlmICh1cGRhdGVkU2VxdWVuY2UpIHtcbiAgICAgICAgLy8gKipDUklUSUNBTCBGSVg6IFVwZGF0ZSB0aGUgc2luZ2xldG9uIHN0YXRlIHRoYXQgVUkgY29tcG9uZW50cyB3YXRjaCoqXG4gICAgICAgIHNlcXVlbmNlU3RhdGVTZXJ2aWNlLnNldEN1cnJlbnRTZXF1ZW5jZSh1cGRhdGVkU2VxdWVuY2UpO1xuXG4gICAgICAgIC8vIEFsc28gY2xlYXIgbG9hZGluZyBzdGF0ZVxuICAgICAgICBzZXF1ZW5jZVN0YXRlU2VydmljZS5zZXRMb2FkaW5nKGZhbHNlKTtcblxuICAgICAgICAvLyBTZXJ2aWNlIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgLSBsZXQgY29tcG9uZW50cyBoYW5kbGUgYWRkaXRpb25hbCBzdGF0ZSB1cGRhdGVzXG4gICAgICAgIHRoaXMubm90aWZ5Q29tcG9uZW50cyhcInNlcXVlbmNlQ3JlYXRlZFwiLCB7XG4gICAgICAgICAgc2VxdWVuY2U6IHVwZGF0ZWRTZXF1ZW5jZSxcbiAgICAgICAgICBzdGFydFBvc2l0aW9uOiBzdGFydFBvc2l0aW9uLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRmFpbGVkIHRvIHJlbG9hZCB1cGRhdGVkIHNlcXVlbmNlXCIpO1xuICAgICAgICBzZXF1ZW5jZVN0YXRlU2VydmljZS5zZXRMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgc2VxdWVuY2VTdGF0ZVNlcnZpY2Uuc2V0RXJyb3IoXG4gICAgICAgICAgXCJGYWlsZWQgdG8gY3JlYXRlIHNlcXVlbmNlIHdpdGggc3RhcnQgcG9zaXRpb25cIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIE5vdGlmeSBjb21wb25lbnRzXG4gICAgICB0aGlzLm5vdGlmeUNvbXBvbmVudHMoXCJzdGFydF9wb3NpdGlvbl9zZXRcIiwgeyBzdGFydFBvc2l0aW9uIH0pO1xuXG4gICAgICAvLyAqKkNSSVRJQ0FMOiBOb3RpZnkgY29tcG9uZW50cyB0byB1cGRhdGUgVUkgc3RhdGUqKlxuICAgICAgLy8gVGhlIHNob3VsZFNob3dTdGFydFBvc2l0aW9uUGlja2VyIGxvZ2ljIHNob3VsZCBub3cgYXV0b21hdGljYWxseSByZXR1cm4gZmFsc2VcbiAgICAgIC8vIGJlY2F1c2Ugd2UndmUgc2V0IGEgY3VycmVudCBzZXF1ZW5jZSB3aXRoIGEgc3RhcnRQb3NpdGlvblxuICAgICAgdGhpcy5ub3RpZnlDb21wb25lbnRzKFwidWlfc3RhdGVfdXBkYXRlX3JlcXVlc3RlZFwiLCB7XG4gICAgICAgIGFjdGlvbjogXCJoaWRlX3N0YXJ0X3Bvc2l0aW9uX3BpY2tlclwiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFRyYW5zaXRpb24gdG8gb3B0aW9uIHBpY2tlclxuICAgICAgYXdhaXQgdGhpcy5oYW5kbGVVSVRyYW5zaXRpb25SZXF1ZXN0KFwib3B0aW9uX3BpY2tlclwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBoYW5kbGluZyBzdGFydCBwb3NpdGlvbiBzZXQ6XCIsIGVycm9yKTtcbiAgICAgIHNlcXVlbmNlU3RhdGVTZXJ2aWNlLnNldExvYWRpbmcoZmFsc2UpO1xuICAgICAgc2VxdWVuY2VTdGF0ZVNlcnZpY2Uuc2V0RXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gc2V0IHN0YXJ0IHBvc2l0aW9uOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVCZWF0QWRkZWQoYmVhdERhdGE6IEJlYXREYXRhKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjdXJyZW50IHNlcXVlbmNlIGZyb20gc2luZ2xldG9uIHN0YXRlXG4gICAgICBjb25zdCBjdXJyZW50U2VxdWVuY2UgPSBzZXF1ZW5jZVN0YXRlU2VydmljZS5jdXJyZW50U2VxdWVuY2U7XG5cbiAgICAgIGlmICghY3VycmVudFNlcXVlbmNlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgTm8gY3VycmVudCBzZXF1ZW5jZSBhdmFpbGFibGUgZm9yIGFkZGluZyBiZWF0XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vICoqQ1JJVElDQUw6IFVzZSB0aGUgc2VydmljZSB0byBhZGQgdGhlIGJlYXQqKlxuICAgICAgaWYgKFxuICAgICAgICBcImFkZEJlYXRcIiBpbiB0aGlzLnNlcXVlbmNlU2VydmljZSAmJlxuICAgICAgICB0eXBlb2YgdGhpcy5zZXF1ZW5jZVNlcnZpY2UuYWRkQmVhdCA9PT0gXCJmdW5jdGlvblwiXG4gICAgICApIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zZXF1ZW5jZVNlcnZpY2UuYWRkQmVhdChjdXJyZW50U2VxdWVuY2UuaWQsIGJlYXREYXRhKTtcblxuICAgICAgICAvLyBSZWxvYWQgdGhlIHVwZGF0ZWQgc2VxdWVuY2VcbiAgICAgICAgY29uc3QgdXBkYXRlZFNlcXVlbmNlID0gYXdhaXQgdGhpcy5zZXF1ZW5jZVNlcnZpY2UuZ2V0U2VxdWVuY2UoXG4gICAgICAgICAgY3VycmVudFNlcXVlbmNlLmlkXG4gICAgICAgICk7XG4gICAgICAgIGlmICh1cGRhdGVkU2VxdWVuY2UpIHtcbiAgICAgICAgICAvLyAqKkNSSVRJQ0FMOiBVcGRhdGUgc2luZ2xldG9uIHN0YXRlKipcbiAgICAgICAgICBzZXF1ZW5jZVN0YXRlU2VydmljZS5zZXRDdXJyZW50U2VxdWVuY2UodXBkYXRlZFNlcXVlbmNlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmFsbGJhY2s6IGFkZCBiZWF0IGRpcmVjdGx5IHRvIHN0YXRlXG4gICAgICAgIHNlcXVlbmNlU3RhdGVTZXJ2aWNlLmFkZEJlYXQoYmVhdERhdGEpO1xuICAgICAgfVxuXG4gICAgICAvLyBOb3RpZnkgY29tcG9uZW50c1xuICAgICAgdGhpcy5ub3RpZnlDb21wb25lbnRzKFwiYmVhdF9hZGRlZFwiLCB7IGJlYXREYXRhIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIGhhbmRsaW5nIGJlYXQgYWRkZWQ6XCIsIGVycm9yKTtcbiAgICAgIHNlcXVlbmNlU3RhdGVTZXJ2aWNlLnNldEVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIGFkZCBiZWF0OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVHZW5lcmF0aW9uUmVxdWVzdChcbiAgICBjb25maWc6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUT0RPOiBJbXBsZW1lbnQgc2VxdWVuY2UgZ2VuZXJhdGlvblxuICAgICAgLy8gRm9yIG5vdywganVzdCBub3RpZnkgY29tcG9uZW50c1xuICAgICAgdGhpcy5ub3RpZnlDb21wb25lbnRzKFwiZ2VuZXJhdGlvbl9yZXF1ZXN0ZWRcIiwgeyBjb25maWcgfSk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIGdlbmVyYXRpb24gY29tcGxldGlvblxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMubm90aWZ5Q29tcG9uZW50cyhcImdlbmVyYXRpb25fY29tcGxldGVkXCIsIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiR2VuZXJhdGlvbiBjb21wbGV0ZWRcIixcbiAgICAgICAgfSk7XG4gICAgICB9LCAxMDAwKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBFcnJvciBoYW5kbGluZyBnZW5lcmF0aW9uIHJlcXVlc3Q6XCIsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVVSVRyYW5zaXRpb25SZXF1ZXN0KHRhcmdldFBhbmVsOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRW1pdCBjdXN0b20gZXZlbnRzIGZvciBVSSB0cmFuc2l0aW9ucyAoc2ltaWxhciB0byBsZWdhY3kgaW1wbGVtZW50YXRpb24pXG4gICAgICBjb25zdCB0cmFuc2l0aW9uRXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoXCJjb25zdHJ1Y3QtdGFiLXRyYW5zaXRpb25cIiwge1xuICAgICAgICBkZXRhaWw6IHsgdGFyZ2V0UGFuZWwgfSxcbiAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KHRyYW5zaXRpb25FdmVudCk7XG4gICAgICB9XG5cbiAgICAgIC8vIE5vdGlmeSBjb21wb25lbnRzIGFib3V0IHRoZSB0cmFuc2l0aW9uXG4gICAgICB0aGlzLm5vdGlmeUNvbXBvbmVudHMoXCJ1aV90cmFuc2l0aW9uXCIsIHsgdGFyZ2V0UGFuZWwgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCLinYwgRXJyb3IgaGFuZGxpbmcgVUkgdHJhbnNpdGlvbjpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY29ubmVjdENvbXBvbmVudFNpZ25hbHMoKTogdm9pZCB7XG4gICAgLy8gU2V0IHVwIGV2ZW50IGxpc3RlbmVycyBmb3IgY29tcG9uZW50IGNvb3JkaW5hdGlvblxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAvLyBDcmVhdGUgYm91bmQgZXZlbnQgaGFuZGxlcnMgdG8gYWxsb3cgcHJvcGVyIGNsZWFudXBcbiAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXJzID0ge1xuICAgICAgICBzdGFydFBvc2l0aW9uU2VsZWN0ZWQ6ICgoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVTdGFydFBvc2l0aW9uU2V0KGV2ZW50LmRldGFpbC5zdGFydFBvc2l0aW9uKTtcbiAgICAgICAgfSkgYXMgKGV2ZW50OiBDdXN0b21FdmVudCkgPT4gdm9pZCxcblxuICAgICAgICBvcHRpb25TZWxlY3RlZDogKChldmVudDogQ3VzdG9tRXZlbnQpID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUJlYXRBZGRlZChldmVudC5kZXRhaWwuYmVhdERhdGEpO1xuICAgICAgICB9KSBhcyAoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB2b2lkLFxuXG4gICAgICAgIHNlcXVlbmNlTW9kaWZpZWQ6ICgoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB7XG4gICAgICAgICAgdGhpcy5oYW5kbGVTZXF1ZW5jZU1vZGlmaWVkKGV2ZW50LmRldGFpbC5zZXF1ZW5jZSk7XG4gICAgICAgIH0pIGFzIChldmVudDogQ3VzdG9tRXZlbnQpID0+IHZvaWQsXG4gICAgICB9O1xuXG4gICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICBcInN0YXJ0LXBvc2l0aW9uLXNlbGVjdGVkXCIsXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXJzLnN0YXJ0UG9zaXRpb25TZWxlY3RlZCBhcyBFdmVudExpc3RlbmVyXG4gICAgICApO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJvcHRpb24tc2VsZWN0ZWRcIixcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcnMub3B0aW9uU2VsZWN0ZWQgYXMgRXZlbnRMaXN0ZW5lclxuICAgICAgKTtcbiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIFwic2VxdWVuY2UtbW9kaWZpZWRcIixcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlcnMuc2VxdWVuY2VNb2RpZmllZCBhcyBFdmVudExpc3RlbmVyXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbiB1cCBldmVudCBsaXN0ZW5lcnMgdG8gcHJldmVudCBtZW1vcnkgbGVha3MgYW5kIGR1cGxpY2F0ZSBoYW5kbGVyc1xuICAgKi9cbiAgcHJpdmF0ZSBkaXNjb25uZWN0Q29tcG9uZW50U2lnbmFscygpOiB2b2lkIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0aGlzLmJvdW5kRXZlbnRIYW5kbGVycykge1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJzdGFydC1wb3NpdGlvbi1zZWxlY3RlZFwiLFxuICAgICAgICB0aGlzLmJvdW5kRXZlbnRIYW5kbGVycy5zdGFydFBvc2l0aW9uU2VsZWN0ZWQgYXMgRXZlbnRMaXN0ZW5lclxuICAgICAgKTtcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXG4gICAgICAgIFwib3B0aW9uLXNlbGVjdGVkXCIsXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXJzLm9wdGlvblNlbGVjdGVkIGFzIEV2ZW50TGlzdGVuZXJcbiAgICAgICk7XG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFxuICAgICAgICBcInNlcXVlbmNlLW1vZGlmaWVkXCIsXG4gICAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXJzLnNlcXVlbmNlTW9kaWZpZWQgYXMgRXZlbnRMaXN0ZW5lclxuICAgICAgKTtcbiAgICAgIHRoaXMuYm91bmRFdmVudEhhbmRsZXJzID0gbnVsbDtcbiAgICAgIHRoaXMuZXZlbnRMaXN0ZW5lcnNTZXR1cCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVUlCYXNlZE9uU2VxdWVuY2Uoc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBEZXRlcm1pbmUgd2hpY2ggcGFuZWwgdG8gc2hvdyBiYXNlZCBvbiBzZXF1ZW5jZSBzdGF0ZVxuICAgICAgY29uc3QgaGFzU3RhcnRQb3NpdGlvbiA9IHNlcXVlbmNlPy5zdGFydFBvc2l0aW9uICE9IG51bGw7XG4gICAgICBjb25zdCBoYXNCZWF0cyA9IHNlcXVlbmNlICYmIHNlcXVlbmNlLmJlYXRzICYmIHNlcXVlbmNlLmJlYXRzLmxlbmd0aCA+IDA7XG5cbiAgICAgIGxldCB0YXJnZXRQYW5lbDogc3RyaW5nO1xuXG4gICAgICBpZiAoaGFzU3RhcnRQb3NpdGlvbiB8fCBoYXNCZWF0cykge1xuICAgICAgICB0YXJnZXRQYW5lbCA9IFwib3B0aW9uX3BpY2tlclwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0UGFuZWwgPSBcInN0YXJ0X3Bvc2l0aW9uX3BpY2tlclwiO1xuICAgICAgfVxuXG4gICAgICAvLyBUcmFuc2l0aW9uIHRvIGFwcHJvcHJpYXRlIHBhbmVsXG4gICAgICBhd2FpdCB0aGlzLmhhbmRsZVVJVHJhbnNpdGlvblJlcXVlc3QodGFyZ2V0UGFuZWwpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwi4p2MIEVycm9yIHVwZGF0aW5nIFVJIGJhc2VkIG9uIHNlcXVlbmNlOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYXNTdGFydFBvc2l0aW9uKHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEpOiBib29sZWFuIHtcbiAgICAvLyAqKkZJWEVEOiBDaGVjayB0aGUgc3RhcnRQb3NpdGlvbiBmaWVsZCBpbnN0ZWFkIG9mIGNoZWNraW5nIGJlYXRzWzBdKipcbiAgICAvLyBUaGlzIGFsaWducyB3aXRoIHRoZSBtb2Rlcm4gYXJjaGl0ZWN0dXJlIHdoZXJlIHN0YXJ0IHBvc2l0aW9uIGlzIHNlcGFyYXRlXG4gICAgcmV0dXJuIHNlcXVlbmNlPy5zdGFydFBvc2l0aW9uICE9IG51bGw7XG4gIH1cblxuICBwcml2YXRlIG5vdGlmeUNvbXBvbmVudHMoZXZlbnRUeXBlOiBzdHJpbmcsIGRhdGE6IHVua25vd24pOiB2b2lkIHtcbiAgICAvLyBOb3RpZnkgaW5kaXZpZHVhbCBjb21wb25lbnRzIGlmIHRoZXkgaGF2ZSBoYW5kbGVyc1xuICAgIE9iamVjdC5lbnRyaWVzKHRoaXMuY29tcG9uZW50cykuZm9yRWFjaCgoW25hbWUsIGNvbXBvbmVudF0pID0+IHtcbiAgICAgIGlmIChjb21wb25lbnQgJiYgdHlwZW9mIGNvbXBvbmVudC5oYW5kbGVFdmVudCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29tcG9uZW50LmhhbmRsZUV2ZW50KGV2ZW50VHlwZSwgZGF0YSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIG5vdGlmeWluZyBjb21wb25lbnQgJHtuYW1lfTpgLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEVtaXQgZ2xvYmFsIGV2ZW50IGZvciBhbnkgbGlzdGVuZXJzXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KGBjb25zdHJ1Y3QtY29vcmRpbmF0aW9uLSR7ZXZlbnRUeXBlfWAsIHtcbiAgICAgICAgZGV0YWlsOiBkYXRhLFxuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICB9XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6IkFBU0EsU0FBUyxnQkFBZ0I7QUFTekIsU0FBUyw0QkFBNEI7QUFNOUIsYUFBTSxnQ0FFYjtBQUFBLEVBVUUsWUFDVSxpQkFDQSxzQkFDUjtBQUZRO0FBQ0E7QUFBQSxFQUNQO0FBQUEsRUFaSyxhQUF3RCxDQUFDO0FBQUEsRUFDekQsaUNBQWlDO0FBQUEsRUFDakMsc0JBQXNCO0FBQUEsRUFDdEIscUJBSUc7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQVVYLFVBQWdCO0FBQ2QsU0FBSywyQkFBMkI7QUFDaEMsU0FBSyxhQUFhLENBQUM7QUFBQSxFQUNyQjtBQUFBLEVBRUEsMkJBQ0UsWUFDTTtBQUNOLFNBQUssYUFBYTtBQUdsQixRQUFJLENBQUMsS0FBSyxxQkFBcUI7QUFDN0IsV0FBSyx3QkFBd0I7QUFDN0IsV0FBSyxzQkFBc0I7QUFBQSxJQUM3QjtBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sdUJBQXVCLFVBQXVDO0FBQ2xFLFFBQUksS0FBSyxnQ0FBZ0M7QUFDdkM7QUFBQSxJQUNGO0FBRUEsUUFBSTtBQUNGLFdBQUssaUNBQWlDO0FBR3RDLDJC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QUE7QUFBQSxFQUtRLDZCQUFtQztBQUN6QyxRQUFJLE9BQU8sV0FBVyxlQUFlLEtBQUssb0JBQW9CO0FBQzVELGVBQVM7QUFBQSxRQUNQO0FBQUEsUUFDQSxLQUFLLG1CQUFtQjtBQUFBLE1BQzFCO0FBQ0EsZUFBUztBQUFBLFFBQ1A7QUFBQSxRQUNBLEtBQUssbUJBQW1CO0FBQUEsTUFDMUI7QUFDQSxlQUFTO0FBQUEsUUFDUDtBQUFBLFFBQ0EsS0FBSyxtQkFBbUI7QUFBQSxNQUMxQjtBQUNBLFdBQUsscUJBQXFCO0FBQzFCLFdBQUssc0JBQXNCO0FBQUEsSUFDN0I7QUFBQSxFQUNGO0FBQUEsRUFFQSxNQUFjLHdCQUF3QixVQUF1QztBQUMzRSxRQUFJO0FBRUYsWUFBTSxtQkFBbUIsVUFBVSxpQkFBaUI7QUFDcEQsWUFBTSxXQUFXLFlBQVksU0FBUyxTQUFTLFNBQVMsTUFBTSxTQUFTO0FBRXZFLFVBQUk7QUFFSixVQUFJLG9CQUFvQixVQUFVO0FBQ2hDLHNCQUFjO0FBQUEsTUFDaEIsT0FBTztBQUNMLHNCQUFjO0FBQUEsTUFDaEI7QUFHQSxZQUFNLEtBQUssMEJBQTBCLFdBQVc7QUFBQSxJQUNsRCxTQUFTLE9BQU87QUFDZCxjQUFRLE1BQU0sMENBQTBDLEtBQUs7QUFBQSxJQUMvRDtBQUFBLEVBQ0Y7QUFBQSxFQUVRLGlCQUFpQixVQUFpQztBQUd4RCxXQUFPLFVBQVUsaUJBQWlCO0FBQUEsRUFDcEM7QUFBQSxFQUVRLGlCQUFpQixXQUFtQixNQUFxQjtBQUUvRCxXQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUMsTUFBTSxTQUFTLE1BQU07QUFDN0QsVUFBSSxhQUFhLE9BQU8sVUFBVSxnQkFBZ0IsWUFBWTtBQUM1RCxZQUFJO0FBQ0Ysb0JBQVUsWUFBWSxXQUFXLElBQUk7QUFBQSxRQUN2QyxTQUFTLE9BQU87QUFDZCxrQkFBUSxNQUFNLCtCQUErQixJQUFJLEtBQUssS0FBSztBQUFBLFFBQzdEO0FBQUEsTUFDRjtBQUFBLElBQ0YsQ0FBQztBQUdELFFBQUksT0FBTyxXQUFXLGFBQWE7QUFDakMsWUFBTSxRQUFRLElBQUksWUFBWSwwQkFBMEIsU0FBUyxJQUFJO0FBQUEsUUFDbkUsUUFBUTtBQUFBLFFBQ1IsU0FBUztBQUFBLE1BQ1gsQ0FBQztBQUNELGVBQVMsY0FBYyxLQUFLO0FBQUEsSUFDOUI7QUFBQSxFQUNGO0FBQ0Y7IiwibmFtZXMiOltdfQ==