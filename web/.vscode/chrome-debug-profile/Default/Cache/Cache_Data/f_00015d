/* image-export-state.svelte.ts generated by Svelte v5.38.1 */
import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=de368f3a";

export function createImageExportState(exportService, initialOptions) {
	let exportOptions = $.tag($.state($.proxy(exportService.getDefaultOptions())), 'exportOptions');
	let previewImageUrl = $.tag($.state(null), 'previewImageUrl');
	let isGeneratingPreview = $.tag($.state(false), 'isGeneratingPreview');
	let previewError = $.tag($.state(null), 'previewError');
	let isExporting = $.tag($.state(false), 'isExporting');
	let exportError = $.tag($.state(null), 'exportError');
	let lastExportedFile = $.tag($.state(null), 'lastExportedFile');
	let currentSequence = $.tag($.state(null), 'currentSequence');

	if (initialOptions) {
		$.set(exportOptions, { ...$.get(exportOptions), ...initialOptions }, true);
	}

	const validationErrors = $.tag(
		$.derived(() => () => {
			if (!$.get(currentSequence)) return [];

			const validation = exportService.validateExport($.get(currentSequence), $.get(exportOptions));

			return validation.errors;
		}),
		'validationErrors'
	);

	const canExport = $.tag(
		$.derived(() => () => {
			return !$.get(isExporting) && !$.get(isGeneratingPreview) && $.strict_equals($.get(validationErrors).length, 0) && $.strict_equals($.get(currentSequence), null, false);
		}),
		'canExport'
	);

	$.user_effect(() => {
		if ($.get(currentSequence) && $.get(previewImageUrl)) {
			const timeoutId = setTimeout(
				() => {
					if ($.get(currentSequence)) {
						generatePreview($.get(currentSequence));
					}
				},
				300
			);

			return () => clearTimeout(timeoutId);
		}
	});

	async function updateOptions(newOptions) {
		try {
			clearErrors();
			$.set(exportOptions, { ...$.get(exportOptions), ...newOptions }, true);

			if ($.get(currentSequence)) {
				(await $.track_reactivity_loss(generatePreview($.get(currentSequence))))();
			}
		} catch(error) {
			console.error(...$.log_if_contains_state('error', "Failed to update export options:", error));
		}
	}

	async function generatePreview(sequence) {
		if (!sequence) {
			clearPreview();

			return;
		}

		$.set(currentSequence, sequence, true);
		$.set(isGeneratingPreview, true);
		$.set(previewError, null);

		try {
			const dataUrl = (await $.track_reactivity_loss(exportService.generatePreview(sequence, $.get(exportOptions))))();

			$.set(previewImageUrl, dataUrl, true);
		} catch(error) {
			const errorMessage = error instanceof Error ? error.message : "Preview generation failed";

			console.error(...$.log_if_contains_state('error', "Preview generation failed:", error));
			$.set(previewError, errorMessage, true);
			$.set(previewImageUrl, null);
		} finally {
			$.set(isGeneratingPreview, false);
		}
	}

	async function exportSequence(sequence, filename) {
		if (!sequence) {
			throw new Error("Sequence is required for export");
		}

		$.set(isExporting, true);
		$.set(exportError, null);
		$.set(lastExportedFile, null);

		try {
			$.set(currentSequence, sequence, true);
			(await $.track_reactivity_loss(exportService.exportAndDownload(sequence, filename, $.get(exportOptions))))();

			const displayFilename = filename || `${sequence.word || "sequence"}.${$.get(exportOptions).format.toLowerCase()}`;

			$.set(lastExportedFile, displayFilename, true);
		} catch(error) {
			const errorMessage = error instanceof Error ? error.message : "Export failed";

			console.error(...$.log_if_contains_state('error', "Export failed:", error));
			$.set(exportError, errorMessage, true);
		} finally {
			$.set(isExporting, false);
		}
	}

	function clearPreview() {
		$.set(previewImageUrl, null);
		$.set(previewError, null);
		$.set(isGeneratingPreview, false);
	}

	function clearErrors() {
		$.set(previewError, null);
		$.set(exportError, null);
	}

	function resetToDefaults() {
		clearErrors();
		clearPreview();
		$.set(exportOptions, exportService.getDefaultOptions(), true);
		$.set(lastExportedFile, null);
	}

	return {
		// State getters (using derived for reactivity)
		get exportOptions() {
			return $.get(exportOptions);
		},

		get previewImageUrl() {
			return $.get(previewImageUrl);
		},

		get isGeneratingPreview() {
			return $.get(isGeneratingPreview);
		},

		get previewError() {
			return $.get(previewError);
		},

		get isExporting() {
			return $.get(isExporting);
		},

		get exportError() {
			return $.get(exportError);
		},

		get lastExportedFile() {
			return $.get(lastExportedFile);
		},

		get canExport() {
			return $.get(canExport)();
		},

		get validationErrors() {
			return $.get(validationErrors)();
		},

		// Actions
		updateOptions,

		generatePreview,
		exportSequence,
		clearPreview,
		clearErrors,
		resetToDefaults
	};
}

export function createPersistentImageExportState(exportService, storageKey = "tka-image-export-options") {
	let savedOptions = {};

	try {
		const saved = localStorage.getItem(storageKey);

		if (saved) {
			savedOptions = JSON.parse(saved);
		}
	} catch(error) {
		console.warn(...$.log_if_contains_state('warn', "Failed to load saved export options:", error));
	}

	const state = createImageExportState(exportService, savedOptions);
	const originalUpdateOptions = state.updateOptions;

	const persistentUpdateOptions = async (newOptions) => {
		(await $.track_reactivity_loss(originalUpdateOptions(newOptions)))();

		try {
			localStorage.setItem(storageKey, JSON.stringify(state.exportOptions));
		} catch(error) {
			console.warn(...$.log_if_contains_state('warn', "Failed to save export options:", error));
		}
	};

	const originalResetToDefaults = state.resetToDefaults;

	const persistentResetToDefaults = () => {
		originalResetToDefaults();

		try {
			localStorage.removeItem(storageKey);
		} catch(error) {
			console.warn(...$.log_if_contains_state('warn', "Failed to clear saved export options:", error));
		}
	};

	return {
		...state,
		updateOptions: persistentUpdateOptions,
		resetToDefaults: persistentResetToDefaults
	};
}

export function createQuickExportState(exportService, purpose) {
	const presetOptions = {
		sharing: {
			beatScale: 0.8,
			format: "PNG",
			quality: 0.9,
			addUserInfo: false,
			addDifficultyLevel: false
		},

		printing: {
			beatScale: 1.2,
			format: "PNG",
			quality: 1,
			addUserInfo: true,
			addWord: true,
			addDifficultyLevel: true
		},

		archival: {
			beatScale: 1,
			format: "PNG",
			quality: 1,
			addUserInfo: true,
			addWord: true,
			addBeatNumbers: true,
			addReversalSymbols: true,
			addDifficultyLevel: true
		}
	};

	return createImageExportState(exportService, presetOptions[purpose]);
}

export function createBatchExportState(exportService) {
	const baseState = createImageExportState(exportService);
	let batchProgress = $.tag($.state($.proxy({ current: 0, total: 0 })), 'batchProgress');

	async function exportBatch(sequences) {
		if (!sequences || $.strict_equals(sequences.length, 0)) {
			throw new Error("No sequences provided for batch export");
		}

		$.set(batchProgress, { current: 0, total: sequences.length }, true);

		try {
			(await $.track_reactivity_loss(exportService.batchExport(sequences, baseState.exportOptions, (current, total) => {
				$.set(batchProgress, { current, total }, true);
			})))();
		} finally {
			$.set(batchProgress, { current: 0, total: 0 }, true);
		}
	}

	return {
		...baseState,

		get batchProgress() {
			return $.get(batchProgress);
		},

		exportBatch
	};
}
//# sourceMappingURL=data:application/json;base64,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UyxHQUFHLE9BQU87RUFDdkM7Q0FDRjs7O0tBR0s7O01BQ0MsZ0JBQWdCO2dCQUNYO0VBQ1Q7O0VBQ0E7O0FBRUoiLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VzIjpbImltYWdlLWV4cG9ydC1zdGF0ZS5zdmVsdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUS0EgSW1hZ2UgRXhwb3J0IFN0YXRlXG4gKlxuICogUmVhY3RpdmUgc3RhdGUgbWFuYWdlbWVudCBmb3IgVEtBIGltYWdlIGV4cG9ydCBmdW5jdGlvbmFsaXR5IHVzaW5nIFN2ZWx0ZSA1IHJ1bmVzLlxuICogVGhpcyBzdGF0ZSBsYXllciBwcm92aWRlcyB0aGUgcmVhY3RpdmUgaW50ZXJmYWNlIGJldHdlZW4gdGhlIGV4cG9ydCBVSSBjb21wb25lbnRzXG4gKiBhbmQgdGhlIGltYWdlIGV4cG9ydCBzZXJ2aWNlcy5cbiAqXG4gKiBDcml0aWNhbDogQWxsIHN0YXRlIHVzZXMgU3ZlbHRlIDUgcnVuZXMsIG5vIGxlZ2FjeSBzdG9yZXMuXG4gKi9cblxuaW1wb3J0IHR5cGUge1xuICBJVEtBSW1hZ2VFeHBvcnRTZXJ2aWNlLFxuICBUS0FJbWFnZUV4cG9ydE9wdGlvbnMsXG59IGZyb20gXCIkbGliL3NlcnZpY2VzL2ludGVyZmFjZXMvaW1hZ2UtZXhwb3J0LWludGVyZmFjZXNcIjtcbmltcG9ydCB0eXBlIHsgU2VxdWVuY2VEYXRhIH0gZnJvbSBcIiRsaWIvc2VydmljZXMvaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBJbWFnZUV4cG9ydFN0YXRlIHtcbiAgLy8gRXhwb3J0IG9wdGlvbnMgc3RhdGVcbiAgcmVhZG9ubHkgZXhwb3J0T3B0aW9uczogVEtBSW1hZ2VFeHBvcnRPcHRpb25zO1xuXG4gIC8vIFByZXZpZXcgc3RhdGVcbiAgcmVhZG9ubHkgcHJldmlld0ltYWdlVXJsOiBzdHJpbmcgfCBudWxsO1xuICByZWFkb25seSBpc0dlbmVyYXRpbmdQcmV2aWV3OiBib29sZWFuO1xuICByZWFkb25seSBwcmV2aWV3RXJyb3I6IHN0cmluZyB8IG51bGw7XG5cbiAgLy8gRXhwb3J0IHN0YXRlXG4gIHJlYWRvbmx5IGlzRXhwb3J0aW5nOiBib29sZWFuO1xuICByZWFkb25seSBleHBvcnRFcnJvcjogc3RyaW5nIHwgbnVsbDtcbiAgcmVhZG9ubHkgbGFzdEV4cG9ydGVkRmlsZTogc3RyaW5nIHwgbnVsbDtcblxuICAvLyBWYWxpZGF0aW9uIHN0YXRlXG4gIHJlYWRvbmx5IGNhbkV4cG9ydDogYm9vbGVhbjtcbiAgcmVhZG9ubHkgdmFsaWRhdGlvbkVycm9yczogc3RyaW5nW107XG5cbiAgLy8gQWN0aW9uc1xuICB1cGRhdGVPcHRpb25zOiAobmV3T3B0aW9uczogUGFydGlhbDxUS0FJbWFnZUV4cG9ydE9wdGlvbnM+KSA9PiBQcm9taXNlPHZvaWQ+O1xuICBnZW5lcmF0ZVByZXZpZXc6IChzZXF1ZW5jZT86IFNlcXVlbmNlRGF0YSkgPT4gUHJvbWlzZTx2b2lkPjtcbiAgZXhwb3J0U2VxdWVuY2U6IChzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLCBmaWxlbmFtZT86IHN0cmluZykgPT4gUHJvbWlzZTx2b2lkPjtcbiAgY2xlYXJQcmV2aWV3OiAoKSA9PiB2b2lkO1xuICBjbGVhckVycm9yczogKCkgPT4gdm9pZDtcbiAgcmVzZXRUb0RlZmF1bHRzOiAoKSA9PiB2b2lkO1xufVxuXG4vKipcbiAqIENyZWF0ZSBUS0EgaW1hZ2UgZXhwb3J0IHN0YXRlIGZhY3RvcnlcbiAqIFJldHVybnMgcmVhY3RpdmUgc3RhdGUgb2JqZWN0IHVzaW5nIFN2ZWx0ZSA1IHJ1bmVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbWFnZUV4cG9ydFN0YXRlKFxuICBleHBvcnRTZXJ2aWNlOiBJVEtBSW1hZ2VFeHBvcnRTZXJ2aWNlLFxuICBpbml0aWFsT3B0aW9ucz86IFBhcnRpYWw8VEtBSW1hZ2VFeHBvcnRPcHRpb25zPlxuKTogSW1hZ2VFeHBvcnRTdGF0ZSB7XG4gIC8vIENvcmUgZXhwb3J0IG9wdGlvbnMgc3RhdGVcbiAgbGV0IGV4cG9ydE9wdGlvbnMgPSAkc3RhdGU8VEtBSW1hZ2VFeHBvcnRPcHRpb25zPihcbiAgICBleHBvcnRTZXJ2aWNlLmdldERlZmF1bHRPcHRpb25zKClcbiAgKTtcblxuICAvLyBQcmV2aWV3IHN0YXRlXG4gIGxldCBwcmV2aWV3SW1hZ2VVcmwgPSAkc3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG4gIGxldCBpc0dlbmVyYXRpbmdQcmV2aWV3ID0gJHN0YXRlKGZhbHNlKTtcbiAgbGV0IHByZXZpZXdFcnJvciA9ICRzdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcblxuICAvLyBFeHBvcnQgc3RhdGVcbiAgbGV0IGlzRXhwb3J0aW5nID0gJHN0YXRlKGZhbHNlKTtcbiAgbGV0IGV4cG9ydEVycm9yID0gJHN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBsZXQgbGFzdEV4cG9ydGVkRmlsZSA9ICRzdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcblxuICAvLyBDdXJyZW50IHNlcXVlbmNlIGJlaW5nIHdvcmtlZCB3aXRoXG4gIGxldCBjdXJyZW50U2VxdWVuY2UgPSAkc3RhdGU8U2VxdWVuY2VEYXRhIHwgbnVsbD4obnVsbCk7XG5cbiAgLy8gSW5pdGlhbGl6ZSB3aXRoIHByb3ZpZGVkIG9wdGlvbnNcbiAgaWYgKGluaXRpYWxPcHRpb25zKSB7XG4gICAgZXhwb3J0T3B0aW9ucyA9IHsgLi4uZXhwb3J0T3B0aW9ucywgLi4uaW5pdGlhbE9wdGlvbnMgfTtcbiAgfVxuXG4gIC8vIERlcml2ZWQgc3RhdGUgLSB2YWxpZGF0aW9uXG4gIGNvbnN0IHZhbGlkYXRpb25FcnJvcnMgPSAkZGVyaXZlZCgoKSA9PiB7XG4gICAgaWYgKCFjdXJyZW50U2VxdWVuY2UpIHJldHVybiBbXTtcblxuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBleHBvcnRTZXJ2aWNlLnZhbGlkYXRlRXhwb3J0KFxuICAgICAgY3VycmVudFNlcXVlbmNlLFxuICAgICAgZXhwb3J0T3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHZhbGlkYXRpb24uZXJyb3JzO1xuICB9KTtcblxuICAvLyBEZXJpdmVkIHN0YXRlIC0gY2FuIGV4cG9ydFxuICBjb25zdCBjYW5FeHBvcnQgPSAkZGVyaXZlZCgoKSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgICFpc0V4cG9ydGluZyAmJlxuICAgICAgIWlzR2VuZXJhdGluZ1ByZXZpZXcgJiZcbiAgICAgIHZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID09PSAwICYmXG4gICAgICBjdXJyZW50U2VxdWVuY2UgIT09IG51bGxcbiAgICApO1xuICB9KTtcblxuICAvLyBBdXRvLXJlZ2VuZXJhdGUgcHJldmlldyB3aGVuIG9wdGlvbnMgY2hhbmdlXG4gICRlZmZlY3QoKCkgPT4ge1xuICAgIGlmIChjdXJyZW50U2VxdWVuY2UgJiYgcHJldmlld0ltYWdlVXJsKSB7XG4gICAgICAvLyBEZWJvdW5jZSBwcmV2aWV3IGdlbmVyYXRpb24gdG8gYXZvaWQgZXhjZXNzaXZlIHVwZGF0ZXNcbiAgICAgIGNvbnN0IHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpZiAoY3VycmVudFNlcXVlbmNlKSB7XG4gICAgICAgICAgZ2VuZXJhdGVQcmV2aWV3KGN1cnJlbnRTZXF1ZW5jZSk7XG4gICAgICAgIH1cbiAgICAgIH0sIDMwMCk7XG5cbiAgICAgIHJldHVybiAoKSA9PiBjbGVhclRpbWVvdXQodGltZW91dElkKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgZXhwb3J0IG9wdGlvbnNcbiAgICogVHJpZ2dlcnMgcHJldmlldyByZWdlbmVyYXRpb24gaWYgc2VxdWVuY2UgaXMgYXZhaWxhYmxlXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVPcHRpb25zKFxuICAgIG5ld09wdGlvbnM6IFBhcnRpYWw8VEtBSW1hZ2VFeHBvcnRPcHRpb25zPlxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY2xlYXJFcnJvcnMoKTtcbiAgICAgIGV4cG9ydE9wdGlvbnMgPSB7IC4uLmV4cG9ydE9wdGlvbnMsIC4uLm5ld09wdGlvbnMgfTtcblxuICAgICAgLy8gQXV0by1yZWdlbmVyYXRlIHByZXZpZXcgaWYgd2UgaGF2ZSBhIHNlcXVlbmNlXG4gICAgICBpZiAoY3VycmVudFNlcXVlbmNlKSB7XG4gICAgICAgIGF3YWl0IGdlbmVyYXRlUHJldmlldyhjdXJyZW50U2VxdWVuY2UpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSBleHBvcnQgb3B0aW9uczpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBwcmV2aWV3IGltYWdlXG4gICAqIFVwZGF0ZXMgcHJldmlldyBzdGF0ZSB3aXRoIGdlbmVyYXRlZCBpbWFnZSBVUkxcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUHJldmlldyhzZXF1ZW5jZT86IFNlcXVlbmNlRGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghc2VxdWVuY2UpIHtcbiAgICAgIGNsZWFyUHJldmlldygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBjdXJyZW50IHNlcXVlbmNlXG4gICAgY3VycmVudFNlcXVlbmNlID0gc2VxdWVuY2U7XG5cbiAgICBpc0dlbmVyYXRpbmdQcmV2aWV3ID0gdHJ1ZTtcbiAgICBwcmV2aWV3RXJyb3IgPSBudWxsO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRhdGFVcmwgPSBhd2FpdCBleHBvcnRTZXJ2aWNlLmdlbmVyYXRlUHJldmlldyhcbiAgICAgICAgc2VxdWVuY2UsXG4gICAgICAgIGV4cG9ydE9wdGlvbnNcbiAgICAgICk7XG4gICAgICBwcmV2aWV3SW1hZ2VVcmwgPSBkYXRhVXJsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiUHJldmlldyBnZW5lcmF0aW9uIGZhaWxlZFwiO1xuICAgICAgY29uc29sZS5lcnJvcihcIlByZXZpZXcgZ2VuZXJhdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgIHByZXZpZXdFcnJvciA9IGVycm9yTWVzc2FnZTtcbiAgICAgIHByZXZpZXdJbWFnZVVybCA9IG51bGw7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlzR2VuZXJhdGluZ1ByZXZpZXcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IHNlcXVlbmNlIGFzIGRvd25sb2FkYWJsZSBmaWxlXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBleHBvcnRTZXF1ZW5jZShcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIGZpbGVuYW1lPzogc3RyaW5nXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghc2VxdWVuY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlcXVlbmNlIGlzIHJlcXVpcmVkIGZvciBleHBvcnRcIik7XG4gICAgfVxuXG4gICAgaXNFeHBvcnRpbmcgPSB0cnVlO1xuICAgIGV4cG9ydEVycm9yID0gbnVsbDtcbiAgICBsYXN0RXhwb3J0ZWRGaWxlID0gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVcGRhdGUgY3VycmVudCBzZXF1ZW5jZVxuICAgICAgY3VycmVudFNlcXVlbmNlID0gc2VxdWVuY2U7XG5cbiAgICAgIC8vIFBlcmZvcm0gZXhwb3J0IGFuZCBkb3dubG9hZFxuICAgICAgYXdhaXQgZXhwb3J0U2VydmljZS5leHBvcnRBbmREb3dubG9hZChzZXF1ZW5jZSwgZmlsZW5hbWUsIGV4cG9ydE9wdGlvbnMpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBmaWxlbmFtZSBmb3IgZGlzcGxheSAoaWYgbm90IHByb3ZpZGVkKVxuICAgICAgY29uc3QgZGlzcGxheUZpbGVuYW1lID1cbiAgICAgICAgZmlsZW5hbWUgfHxcbiAgICAgICAgYCR7c2VxdWVuY2Uud29yZCB8fCBcInNlcXVlbmNlXCJ9LiR7ZXhwb3J0T3B0aW9ucy5mb3JtYXQudG9Mb3dlckNhc2UoKX1gO1xuICAgICAgbGFzdEV4cG9ydGVkRmlsZSA9IGRpc3BsYXlGaWxlbmFtZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIkV4cG9ydCBmYWlsZWRcIjtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFeHBvcnQgZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICBleHBvcnRFcnJvciA9IGVycm9yTWVzc2FnZTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgaXNFeHBvcnRpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgcHJldmlldyBzdGF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gY2xlYXJQcmV2aWV3KCk6IHZvaWQge1xuICAgIHByZXZpZXdJbWFnZVVybCA9IG51bGw7XG4gICAgcHJldmlld0Vycm9yID0gbnVsbDtcbiAgICBpc0dlbmVyYXRpbmdQcmV2aWV3ID0gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgZXJyb3Igc3RhdGVzXG4gICAqL1xuICBmdW5jdGlvbiBjbGVhckVycm9ycygpOiB2b2lkIHtcbiAgICBwcmV2aWV3RXJyb3IgPSBudWxsO1xuICAgIGV4cG9ydEVycm9yID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBvcHRpb25zIHRvIGRlZmF1bHRzXG4gICAqL1xuICBmdW5jdGlvbiByZXNldFRvRGVmYXVsdHMoKTogdm9pZCB7XG4gICAgY2xlYXJFcnJvcnMoKTtcbiAgICBjbGVhclByZXZpZXcoKTtcbiAgICBleHBvcnRPcHRpb25zID0gZXhwb3J0U2VydmljZS5nZXREZWZhdWx0T3B0aW9ucygpO1xuICAgIGxhc3RFeHBvcnRlZEZpbGUgPSBudWxsO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAvLyBTdGF0ZSBnZXR0ZXJzICh1c2luZyBkZXJpdmVkIGZvciByZWFjdGl2aXR5KVxuICAgIGdldCBleHBvcnRPcHRpb25zKCkge1xuICAgICAgcmV0dXJuIGV4cG9ydE9wdGlvbnM7XG4gICAgfSxcbiAgICBnZXQgcHJldmlld0ltYWdlVXJsKCkge1xuICAgICAgcmV0dXJuIHByZXZpZXdJbWFnZVVybDtcbiAgICB9LFxuICAgIGdldCBpc0dlbmVyYXRpbmdQcmV2aWV3KCkge1xuICAgICAgcmV0dXJuIGlzR2VuZXJhdGluZ1ByZXZpZXc7XG4gICAgfSxcbiAgICBnZXQgcHJldmlld0Vycm9yKCkge1xuICAgICAgcmV0dXJuIHByZXZpZXdFcnJvcjtcbiAgICB9LFxuICAgIGdldCBpc0V4cG9ydGluZygpIHtcbiAgICAgIHJldHVybiBpc0V4cG9ydGluZztcbiAgICB9LFxuICAgIGdldCBleHBvcnRFcnJvcigpIHtcbiAgICAgIHJldHVybiBleHBvcnRFcnJvcjtcbiAgICB9LFxuICAgIGdldCBsYXN0RXhwb3J0ZWRGaWxlKCkge1xuICAgICAgcmV0dXJuIGxhc3RFeHBvcnRlZEZpbGU7XG4gICAgfSxcbiAgICBnZXQgY2FuRXhwb3J0KCkge1xuICAgICAgcmV0dXJuIGNhbkV4cG9ydCgpO1xuICAgIH0sXG4gICAgZ2V0IHZhbGlkYXRpb25FcnJvcnMoKSB7XG4gICAgICByZXR1cm4gdmFsaWRhdGlvbkVycm9ycygpO1xuICAgIH0sXG5cbiAgICAvLyBBY3Rpb25zXG4gICAgdXBkYXRlT3B0aW9ucyxcbiAgICBnZW5lcmF0ZVByZXZpZXcsXG4gICAgZXhwb3J0U2VxdWVuY2UsXG4gICAgY2xlYXJQcmV2aWV3LFxuICAgIGNsZWFyRXJyb3JzLFxuICAgIHJlc2V0VG9EZWZhdWx0cyxcbiAgfTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgaW1hZ2UgZXhwb3J0IHN0YXRlIHdpdGggc2V0dGluZ3MgcGVyc2lzdGVuY2VcbiAqIEF1dG9tYXRpY2FsbHkgc2F2ZXMgYW5kIHJlc3RvcmVzIGV4cG9ydCBvcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQZXJzaXN0ZW50SW1hZ2VFeHBvcnRTdGF0ZShcbiAgZXhwb3J0U2VydmljZTogSVRLQUltYWdlRXhwb3J0U2VydmljZSxcbiAgc3RvcmFnZUtleTogc3RyaW5nID0gXCJ0a2EtaW1hZ2UtZXhwb3J0LW9wdGlvbnNcIlxuKTogSW1hZ2VFeHBvcnRTdGF0ZSB7XG4gIC8vIExvYWQgc2F2ZWQgb3B0aW9ucyBmcm9tIGxvY2FsU3RvcmFnZVxuICBsZXQgc2F2ZWRPcHRpb25zOiBQYXJ0aWFsPFRLQUltYWdlRXhwb3J0T3B0aW9ucz4gPSB7fTtcbiAgdHJ5IHtcbiAgICBjb25zdCBzYXZlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkpO1xuICAgIGlmIChzYXZlZCkge1xuICAgICAgc2F2ZWRPcHRpb25zID0gSlNPTi5wYXJzZShzYXZlZCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBsb2FkIHNhdmVkIGV4cG9ydCBvcHRpb25zOlwiLCBlcnJvcik7XG4gIH1cblxuICAvLyBDcmVhdGUgc3RhdGUgd2l0aCBzYXZlZCBvcHRpb25zXG4gIGNvbnN0IHN0YXRlID0gY3JlYXRlSW1hZ2VFeHBvcnRTdGF0ZShleHBvcnRTZXJ2aWNlLCBzYXZlZE9wdGlvbnMpO1xuXG4gIC8vIFdyYXAgdXBkYXRlT3B0aW9ucyB0byBzYXZlIHRvIGxvY2FsU3RvcmFnZVxuICBjb25zdCBvcmlnaW5hbFVwZGF0ZU9wdGlvbnMgPSBzdGF0ZS51cGRhdGVPcHRpb25zO1xuICBjb25zdCBwZXJzaXN0ZW50VXBkYXRlT3B0aW9ucyA9IGFzeW5jIChcbiAgICBuZXdPcHRpb25zOiBQYXJ0aWFsPFRLQUltYWdlRXhwb3J0T3B0aW9ucz5cbiAgKSA9PiB7XG4gICAgYXdhaXQgb3JpZ2luYWxVcGRhdGVPcHRpb25zKG5ld09wdGlvbnMpO1xuXG4gICAgLy8gU2F2ZSB1cGRhdGVkIG9wdGlvbnNcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleSwgSlNPTi5zdHJpbmdpZnkoc3RhdGUuZXhwb3J0T3B0aW9ucykpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gc2F2ZSBleHBvcnQgb3B0aW9uczpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfTtcblxuICAvLyBXcmFwIHJlc2V0VG9EZWZhdWx0cyB0byBjbGVhciBsb2NhbFN0b3JhZ2VcbiAgY29uc3Qgb3JpZ2luYWxSZXNldFRvRGVmYXVsdHMgPSBzdGF0ZS5yZXNldFRvRGVmYXVsdHM7XG4gIGNvbnN0IHBlcnNpc3RlbnRSZXNldFRvRGVmYXVsdHMgPSAoKSA9PiB7XG4gICAgb3JpZ2luYWxSZXNldFRvRGVmYXVsdHMoKTtcblxuICAgIC8vIENsZWFyIHNhdmVkIG9wdGlvbnNcbiAgICB0cnkge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oc3RvcmFnZUtleSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBjbGVhciBzYXZlZCBleHBvcnQgb3B0aW9uczpcIiwgZXJyb3IpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC4uLnN0YXRlLFxuICAgIHVwZGF0ZU9wdGlvbnM6IHBlcnNpc3RlbnRVcGRhdGVPcHRpb25zLFxuICAgIHJlc2V0VG9EZWZhdWx0czogcGVyc2lzdGVudFJlc2V0VG9EZWZhdWx0cyxcbiAgfTtcbn1cblxuLyoqXG4gKiBJbWFnZSBleHBvcnQgc3RhdGUgZm9yIHNwZWNpZmljIHVzZSBjYXNlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUXVpY2tFeHBvcnRTdGF0ZShcbiAgZXhwb3J0U2VydmljZTogSVRLQUltYWdlRXhwb3J0U2VydmljZSxcbiAgcHVycG9zZTogXCJzaGFyaW5nXCIgfCBcInByaW50aW5nXCIgfCBcImFyY2hpdmFsXCJcbik6IEltYWdlRXhwb3J0U3RhdGUge1xuICAvLyBQcmVzZXQgb3B0aW9ucyBmb3IgZGlmZmVyZW50IHB1cnBvc2VzXG4gIGNvbnN0IHByZXNldE9wdGlvbnM6IFJlY29yZDxzdHJpbmcsIFBhcnRpYWw8VEtBSW1hZ2VFeHBvcnRPcHRpb25zPj4gPSB7XG4gICAgc2hhcmluZzoge1xuICAgICAgYmVhdFNjYWxlOiAwLjgsXG4gICAgICBmb3JtYXQ6IFwiUE5HXCIsXG4gICAgICBxdWFsaXR5OiAwLjksXG4gICAgICBhZGRVc2VySW5mbzogZmFsc2UsXG4gICAgICBhZGREaWZmaWN1bHR5TGV2ZWw6IGZhbHNlLFxuICAgIH0sXG4gICAgcHJpbnRpbmc6IHtcbiAgICAgIGJlYXRTY2FsZTogMS4yLFxuICAgICAgZm9ybWF0OiBcIlBOR1wiLFxuICAgICAgcXVhbGl0eTogMS4wLFxuICAgICAgYWRkVXNlckluZm86IHRydWUsXG4gICAgICBhZGRXb3JkOiB0cnVlLFxuICAgICAgYWRkRGlmZmljdWx0eUxldmVsOiB0cnVlLFxuICAgIH0sXG4gICAgYXJjaGl2YWw6IHtcbiAgICAgIGJlYXRTY2FsZTogMS4wLFxuICAgICAgZm9ybWF0OiBcIlBOR1wiLFxuICAgICAgcXVhbGl0eTogMS4wLFxuICAgICAgYWRkVXNlckluZm86IHRydWUsXG4gICAgICBhZGRXb3JkOiB0cnVlLFxuICAgICAgYWRkQmVhdE51bWJlcnM6IHRydWUsXG4gICAgICBhZGRSZXZlcnNhbFN5bWJvbHM6IHRydWUsXG4gICAgICBhZGREaWZmaWN1bHR5TGV2ZWw6IHRydWUsXG4gICAgfSxcbiAgfTtcblxuICByZXR1cm4gY3JlYXRlSW1hZ2VFeHBvcnRTdGF0ZShleHBvcnRTZXJ2aWNlLCBwcmVzZXRPcHRpb25zW3B1cnBvc2VdKTtcbn1cblxuLyoqXG4gKiBCYXRjaCBleHBvcnQgc3RhdGUgZm9yIG11bHRpcGxlIHNlcXVlbmNlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQmF0Y2hFeHBvcnRTdGF0ZShcbiAgZXhwb3J0U2VydmljZTogSVRLQUltYWdlRXhwb3J0U2VydmljZVxuKTogSW1hZ2VFeHBvcnRTdGF0ZSAmIHtcbiAgYmF0Y2hQcm9ncmVzczogeyBjdXJyZW50OiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfTtcbiAgZXhwb3J0QmF0Y2g6IChzZXF1ZW5jZXM6IFNlcXVlbmNlRGF0YVtdKSA9PiBQcm9taXNlPHZvaWQ+O1xufSB7XG4gIGNvbnN0IGJhc2VTdGF0ZSA9IGNyZWF0ZUltYWdlRXhwb3J0U3RhdGUoZXhwb3J0U2VydmljZSk7XG5cbiAgLy8gQmF0Y2gtc3BlY2lmaWMgc3RhdGVcbiAgbGV0IGJhdGNoUHJvZ3Jlc3MgPSAkc3RhdGUoeyBjdXJyZW50OiAwLCB0b3RhbDogMCB9KTtcblxuICAvKipcbiAgICogRXhwb3J0IG11bHRpcGxlIHNlcXVlbmNlc1xuICAgKi9cbiAgYXN5bmMgZnVuY3Rpb24gZXhwb3J0QmF0Y2goc2VxdWVuY2VzOiBTZXF1ZW5jZURhdGFbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghc2VxdWVuY2VzIHx8IHNlcXVlbmNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHNlcXVlbmNlcyBwcm92aWRlZCBmb3IgYmF0Y2ggZXhwb3J0XCIpO1xuICAgIH1cblxuICAgIGJhdGNoUHJvZ3Jlc3MgPSB7IGN1cnJlbnQ6IDAsIHRvdGFsOiBzZXF1ZW5jZXMubGVuZ3RoIH07XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhwb3J0U2VydmljZS5iYXRjaEV4cG9ydChcbiAgICAgICAgc2VxdWVuY2VzLFxuICAgICAgICBiYXNlU3RhdGUuZXhwb3J0T3B0aW9ucyxcbiAgICAgICAgKGN1cnJlbnQ6IG51bWJlciwgdG90YWw6IG51bWJlcikgPT4ge1xuICAgICAgICAgIGJhdGNoUHJvZ3Jlc3MgPSB7IGN1cnJlbnQsIHRvdGFsIH07XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGJhdGNoUHJvZ3Jlc3MgPSB7IGN1cnJlbnQ6IDAsIHRvdGFsOiAwIH07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5iYXNlU3RhdGUsXG4gICAgZ2V0IGJhdGNoUHJvZ3Jlc3MoKSB7XG4gICAgICByZXR1cm4gYmF0Y2hQcm9ncmVzcztcbiAgICB9LFxuICAgIGV4cG9ydEJhdGNoLFxuICB9O1xufVxuIl0sImZpbGUiOiJGOi9DT0RFL1RLQS93ZWIvc3JjL2xpYi9zdGF0ZS9pbWFnZS1leHBvcnQtc3RhdGUuc3ZlbHRlLnRzIn0=