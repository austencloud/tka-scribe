/* sequence-state.svelte.ts generated by Svelte v5.38.1 */
import * as $ from "/node_modules/.vite/deps/svelte_internal_client.js?v=de368f3a";
import { GridMode } from "/src/lib/domain/enums.ts";

export function createSequenceState(sequenceService) {
	const state = $.tag_proxy(
		$.proxy({
			// Sequence state
			currentSequence: null,

			sequences: [],
			isLoading: false,
			error: null,

			// Selection state
			selectedBeatIndex: null,

			selectedSequenceId: null,

			// UI state
			showBeatNumbers: true,

			gridMode: GridMode.DIAMOND,

			// Arrow positioning state
			arrowPositions: /* @__PURE__ */ new Map(),

			arrowPositioningInProgress: false,
			arrowPositioningError: null
		}),
		'state'
	);

	function getCurrentSequence() {
		return state.currentSequence;
	}

	function getSequences() {
		return state.sequences;
	}

	function getIsLoading() {
		return state.isLoading;
	}

	function getError() {
		return state.error;
	}

	function getSelectedBeatIndex() {
		return state.selectedBeatIndex;
	}

	function getSelectedSequenceId() {
		return state.selectedSequenceId;
	}

	function getShowBeatNumbers() {
		return state.showBeatNumbers;
	}

	function getGridMode() {
		return state.gridMode;
	}

	function getArrowPositions() {
		return state.arrowPositions;
	}

	function getArrowPositioningInProgress() {
		return state.arrowPositioningInProgress;
	}

	function getArrowPositioningError() {
		return state.arrowPositioningError;
	}

	function getCurrentBeats() {
		return state.currentSequence ? [...state.currentSequence.beats] : [];
	}

	function getSelectedBeatData() {
		if ($.strict_equals(state.selectedBeatIndex, null) || !state.currentSequence) {
			return null;
		}

		return state.currentSequence.beats[state.selectedBeatIndex] ?? null;
	}

	function getSelectedBeat() {
		const beatIndex = state.selectedBeatIndex;
		const sequence = state.currentSequence;

		return $.strict_equals(beatIndex, null, false) && sequence ? sequence.beats[beatIndex] ?? null : null;
	}

	function getHasCurrentSequence() {
		return $.strict_equals(state.currentSequence, null, false);
	}

	function getSequenceCount() {
		return state.sequences.length;
	}

	function getHasUnsavedChanges() {
		return false;
	}

	function getHasArrowPositions() {
		return state.arrowPositions.size > 0;
	}

	function getArrowPositioningComplete() {
		return !state.arrowPositioningInProgress && state.arrowPositions.size > 0;
	}

	function setCurrentSequence(sequence) {
		state.currentSequence = sequence;
		state.selectedSequenceId = sequence?.id ?? null;
		state.selectedBeatIndex = null;
	}

	function addSequence(sequence) {
		state.sequences.push(sequence);
		setCurrentSequence(sequence);
	}

	function updateSequence(updatedSequence) {
		const index = state.sequences.findIndex((s) => $.strict_equals(s.id, updatedSequence.id));

		if (index >= 0) {
			state.sequences[index] = updatedSequence;
		}

		if ($.strict_equals(state.currentSequence?.id, updatedSequence.id)) {
			state.currentSequence = updatedSequence;
		}
	}

	function removeSequence(sequenceId) {
		state.sequences = state.sequences.filter((s) => $.strict_equals(s.id, sequenceId, false));

		if ($.strict_equals(state.currentSequence?.id, sequenceId)) {
			setCurrentSequence(null);
		}
	}

	function setSequences(newSequences) {
		state.sequences = newSequences;
	}

	function setLoading(loading) {
		state.isLoading = loading;
	}

	function setError(error) {
		state.error = error;
	}

	function clearError() {
		state.error = null;
	}

	function updateCurrentBeat(beatIndex, beatData) {
		if (state.currentSequence && beatIndex >= 0 && beatIndex < state.currentSequence.beats.length) {
			const newBeats = [...state.currentSequence.beats];

			newBeats[beatIndex] = beatData;
			state.currentSequence = { ...state.currentSequence, beats: newBeats };
		}
	}

	function selectBeat(beatIndex) {
		state.selectedBeatIndex = beatIndex;
	}

	function setGridMode(mode) {
		state.gridMode = mode;
	}

	function setShowBeatNumbers(show) {
		state.showBeatNumbers = show;
	}

	function setArrowPositions(positions) {
		state.arrowPositions = positions;
	}

	function setArrowPositioningInProgress(inProgress) {
		state.arrowPositioningInProgress = inProgress;
	}

	function setArrowPositioningError(error) {
		state.arrowPositioningError = error;
	}

	function getArrowPosition(color) {
		return state.arrowPositions.get(color) || null;
	}

	function clearArrowPositions() {
		state.arrowPositions.clear();
	}

	function resetSequenceState() {
		state.currentSequence = null;
		state.sequences = [];
		state.isLoading = false;
		state.error = null;
		state.selectedBeatIndex = null;
		state.selectedSequenceId = null;
		state.gridMode = GridMode.DIAMOND;
		state.arrowPositions.clear();
		state.arrowPositioningInProgress = false;
		state.arrowPositioningError = null;
	}

	async function loadSequences() {
		setLoading(true);
		setError(null);

		try {
			const sequences = (await $.track_reactivity_loss(sequenceService.getAllSequences()))();

			setSequences(sequences);
		} catch(error) {
			const errorMessage = error instanceof Error ? error.message : "Unknown error loading sequences";

			setError(errorMessage);
			console.error(...$.log_if_contains_state('error', "Failed to load sequences:", error));
		} finally {
			setLoading(false);
		}
	}

	async function createSequence(request) {
		setLoading(true);
		setError(null);

		try {
			const sequence = (await $.track_reactivity_loss(sequenceService.createSequence(request)))();

			addSequence(sequence);

			return sequence;
		} catch(error) {
			const errorMessage = error instanceof Error ? error.message : "Unknown error creating sequence";

			setError(errorMessage);
			console.error(...$.log_if_contains_state('error', "Failed to create sequence:", error));

			return null;
		} finally {
			setLoading(false);
		}
	}

	async function updateSequenceBeats(sequenceId, beatIndex, beatData) {
		try {
			(await $.track_reactivity_loss(sequenceService.updateBeat(sequenceId, beatIndex, beatData)))();
			updateCurrentBeat(beatIndex, beatData);
		} catch(error) {
			const errorMessage = error instanceof Error ? error.message : "Unknown error updating beat";

			setError(errorMessage);
			console.error(...$.log_if_contains_state('error', "Failed to update beat:", error));
		}
	}

	return {
		// State access (reactive)
		get currentSequence() {
			return state.currentSequence;
		},

		get sequences() {
			return state.sequences;
		},

		get isLoading() {
			return state.isLoading;
		},

		get error() {
			return state.error;
		},

		get selectedBeatIndex() {
			return state.selectedBeatIndex;
		},

		get selectedSequenceId() {
			return state.selectedSequenceId;
		},

		get showBeatNumbers() {
			return state.showBeatNumbers;
		},

		get gridMode() {
			return state.gridMode;
		},

		get arrowPositions() {
			return state.arrowPositions;
		},

		get arrowPositioningInProgress() {
			return state.arrowPositioningInProgress;
		},

		get arrowPositioningError() {
			return state.arrowPositioningError;
		},

		// Getters
		getCurrentSequence,

		getSequences,
		getIsLoading,
		getError,
		getSelectedBeatIndex,
		getSelectedSequenceId,
		getShowBeatNumbers,
		getGridMode,
		getArrowPositions,
		getArrowPositioningInProgress,
		getArrowPositioningError,

		// Computed getters
		getCurrentBeats,

		getSelectedBeatData,
		getSelectedBeat,
		getHasCurrentSequence,
		getSequenceCount,
		getHasUnsavedChanges,
		getHasArrowPositions,
		getArrowPositioningComplete,

		// Actions
		setCurrentSequence,

		addSequence,
		updateSequence,
		removeSequence,
		setSequences,
		setLoading,
		setError,
		clearError,
		updateCurrentBeat,
		selectBeat,
		setGridMode,
		setShowBeatNumbers,
		setArrowPositions,
		setArrowPositioningInProgress,
		setArrowPositioningError,
		getArrowPosition,
		clearArrowPositions,
		resetSequenceState,

		// Service integration
		loadSequences,

		createSequence,
		updateSequenceBeats
	};
}
//# sourceMappingURL=data:application/json;base64,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QixLQUFLOztVQUMxQztFQUNULFVBQUU7R0FDQSxXQUFXLEtBQUs7RUFDbEI7Q0FDRjs7Z0JBS2Usb0JBQ2IsWUFDQSxXQUNBLFVBQ2U7TUFDWDtrQ0FDSSxnQkFBZ0IsV0FBVyxZQUFZLFdBQVcsUUFBUTtHQUNoRSxrQkFBa0IsV0FBVyxRQUFRO0VBQ3ZDLFFBQVMsT0FBTztTQUNSLGVBQ0osaUJBQWlCLFFBQVEsTUFBTSxVQUFVOztHQUMzQyxTQUFTLFlBQVk7R0FDckIsUUFBUSwwQ0FBTSwwQkFBMEIsS0FBSztFQUMvQztDQUNGOzs7O01BUU0sa0JBQWtCO1VBQ2IsTUFBTTtFQUNmOztNQUNJLFlBQVk7VUFDUCxNQUFNO0VBQ2Y7O01BQ0ksWUFBWTtVQUNQLE1BQU07RUFDZjs7TUFDSSxRQUFRO1VBQ0gsTUFBTTtFQUNmOztNQUNJLG9CQUFvQjtVQUNmLE1BQU07RUFDZjs7TUFDSSxxQkFBcUI7VUFDaEIsTUFBTTtFQUNmOztNQUNJLGtCQUFrQjtVQUNiLE1BQU07RUFDZjs7TUFDSSxXQUFXO1VBQ04sTUFBTTtFQUNmOztNQUNJLGlCQUFpQjtVQUNaLE1BQU07RUFDZjs7TUFDSSw2QkFBNkI7VUFDeEIsTUFBTTtFQUNmOztNQUNJLHdCQUF3QjtVQUNuQixNQUFNO0VBQ2Y7OztFQUdBOztFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOzs7RUFHQTs7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7O0VBR0E7O0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7O0VBR0E7O0VBQ0E7RUFDQTs7QUFFSiIsIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsic2VxdWVuY2Utc3RhdGUuc3ZlbHRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VxdWVuY2UgU3RhdGUgRmFjdG9yeSAtIENvbXBvbmVudC1TY29wZWQgU3RhdGUgZm9yIFN2ZWx0ZSA1IFJ1bmVzXG4gKlxuICogQ3JlYXRlcyBjb21wb25lbnQtc2NvcGVkIHNlcXVlbmNlIHN0YXRlIGluc3RlYWQgb2YgZ2xvYmFsIHNpbmdsZXRvbnMuXG4gKiBFYWNoIGNvbXBvbmVudCBnZXRzIGl0cyBvd24gaXNvbGF0ZWQgc3RhdGUgdGhyb3VnaCBmYWN0b3J5IGZ1bmN0aW9uLlxuICovXG5cbmltcG9ydCB0eXBlIHsgQmVhdERhdGEsIFNlcXVlbmNlRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHsgR3JpZE1vZGUgfSBmcm9tIFwiJGxpYi9kb21haW4vZW51bXNcIjtcbmltcG9ydCB0eXBlIHsgQXJyb3dQb3NpdGlvbiB9IGZyb20gXCIkc2VydmljZXMvaW50ZXJmYWNlcy9jb3JlLXR5cGVzXCI7XG5pbXBvcnQgdHlwZSB7IElTZXF1ZW5jZVNlcnZpY2UgfSBmcm9tIFwiJHNlcnZpY2VzL2ludGVyZmFjZXMvc2VxdWVuY2UtaW50ZXJmYWNlc1wiO1xuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGQUNUT1JZIEZVTkNUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTZXF1ZW5jZVN0YXRlKHNlcXVlbmNlU2VydmljZTogSVNlcXVlbmNlU2VydmljZSkge1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENPTVBPTkVOVC1TQ09QRUQgU1RBVEVcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGNvbnN0IHN0YXRlID0gJHN0YXRlKHtcbiAgICAvLyBTZXF1ZW5jZSBzdGF0ZVxuICAgIGN1cnJlbnRTZXF1ZW5jZTogbnVsbCBhcyBTZXF1ZW5jZURhdGEgfCBudWxsLFxuICAgIHNlcXVlbmNlczogW10gYXMgU2VxdWVuY2VEYXRhW10sXG4gICAgaXNMb2FkaW5nOiBmYWxzZSxcbiAgICBlcnJvcjogbnVsbCBhcyBzdHJpbmcgfCBudWxsLFxuXG4gICAgLy8gU2VsZWN0aW9uIHN0YXRlXG4gICAgc2VsZWN0ZWRCZWF0SW5kZXg6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCxcbiAgICBzZWxlY3RlZFNlcXVlbmNlSWQ6IG51bGwgYXMgc3RyaW5nIHwgbnVsbCxcblxuICAgIC8vIFVJIHN0YXRlXG4gICAgc2hvd0JlYXROdW1iZXJzOiB0cnVlLFxuICAgIGdyaWRNb2RlOiBHcmlkTW9kZS5ESUFNT05EIGFzIEdyaWRNb2RlLFxuXG4gICAgLy8gQXJyb3cgcG9zaXRpb25pbmcgc3RhdGVcbiAgICBhcnJvd1Bvc2l0aW9uczogbmV3IE1hcDxzdHJpbmcsIEFycm93UG9zaXRpb24+KCksXG4gICAgYXJyb3dQb3NpdGlvbmluZ0luUHJvZ3Jlc3M6IGZhbHNlLFxuICAgIGFycm93UG9zaXRpb25pbmdFcnJvcjogbnVsbCBhcyBzdHJpbmcgfCBudWxsLFxuICB9KTtcblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIEdFVFRFUlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRTZXF1ZW5jZSgpIHtcbiAgICByZXR1cm4gc3RhdGUuY3VycmVudFNlcXVlbmNlO1xuICB9XG4gIGZ1bmN0aW9uIGdldFNlcXVlbmNlcygpIHtcbiAgICByZXR1cm4gc3RhdGUuc2VxdWVuY2VzO1xuICB9XG4gIGZ1bmN0aW9uIGdldElzTG9hZGluZygpIHtcbiAgICByZXR1cm4gc3RhdGUuaXNMb2FkaW5nO1xuICB9XG4gIGZ1bmN0aW9uIGdldEVycm9yKCkge1xuICAgIHJldHVybiBzdGF0ZS5lcnJvcjtcbiAgfVxuICBmdW5jdGlvbiBnZXRTZWxlY3RlZEJlYXRJbmRleCgpIHtcbiAgICByZXR1cm4gc3RhdGUuc2VsZWN0ZWRCZWF0SW5kZXg7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U2VsZWN0ZWRTZXF1ZW5jZUlkKCkge1xuICAgIHJldHVybiBzdGF0ZS5zZWxlY3RlZFNlcXVlbmNlSWQ7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U2hvd0JlYXROdW1iZXJzKCkge1xuICAgIHJldHVybiBzdGF0ZS5zaG93QmVhdE51bWJlcnM7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0R3JpZE1vZGUoKSB7XG4gICAgcmV0dXJuIHN0YXRlLmdyaWRNb2RlO1xuICB9XG4gIGZ1bmN0aW9uIGdldEFycm93UG9zaXRpb25zKCkge1xuICAgIHJldHVybiBzdGF0ZS5hcnJvd1Bvc2l0aW9ucztcbiAgfVxuICBmdW5jdGlvbiBnZXRBcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcygpIHtcbiAgICByZXR1cm4gc3RhdGUuYXJyb3dQb3NpdGlvbmluZ0luUHJvZ3Jlc3M7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0QXJyb3dQb3NpdGlvbmluZ0Vycm9yKCkge1xuICAgIHJldHVybiBzdGF0ZS5hcnJvd1Bvc2l0aW9uaW5nRXJyb3I7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIENPTVBVVEVEIEdFVFRFUlNcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRCZWF0cygpOiBCZWF0RGF0YVtdIHtcbiAgICAvLyBSZXR1cm4gYSBtdXRhYmxlIGNvcHkgdG8gYWxsb3cgVUkgbW9kaWZpY2F0aW9ucyB3aXRob3V0IHZpb2xhdGluZyByZWFkb25seSBkb21haW4gbW9kZWxcbiAgICByZXR1cm4gc3RhdGUuY3VycmVudFNlcXVlbmNlID8gWy4uLnN0YXRlLmN1cnJlbnRTZXF1ZW5jZS5iZWF0c10gOiBbXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFNlbGVjdGVkQmVhdERhdGEoKTogQmVhdERhdGEgfCBudWxsIHtcbiAgICBpZiAoc3RhdGUuc2VsZWN0ZWRCZWF0SW5kZXggPT09IG51bGwgfHwgIXN0YXRlLmN1cnJlbnRTZXF1ZW5jZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBzdGF0ZS5jdXJyZW50U2VxdWVuY2UuYmVhdHNbc3RhdGUuc2VsZWN0ZWRCZWF0SW5kZXhdID8/IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTZWxlY3RlZEJlYXQoKTogQmVhdERhdGEgfCBudWxsIHtcbiAgICBjb25zdCBiZWF0SW5kZXggPSBzdGF0ZS5zZWxlY3RlZEJlYXRJbmRleDtcbiAgICBjb25zdCBzZXF1ZW5jZSA9IHN0YXRlLmN1cnJlbnRTZXF1ZW5jZTtcbiAgICByZXR1cm4gYmVhdEluZGV4ICE9PSBudWxsICYmIHNlcXVlbmNlXG4gICAgICA/IChzZXF1ZW5jZS5iZWF0c1tiZWF0SW5kZXhdID8/IG51bGwpXG4gICAgICA6IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRIYXNDdXJyZW50U2VxdWVuY2UoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHN0YXRlLmN1cnJlbnRTZXF1ZW5jZSAhPT0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFNlcXVlbmNlQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gc3RhdGUuc2VxdWVuY2VzLmxlbmd0aDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEhhc1Vuc2F2ZWRDaGFuZ2VzKCk6IGJvb2xlYW4ge1xuICAgIC8vIFRPRE86IEltcGxlbWVudCBjaGFuZ2UgdHJhY2tpbmdcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRIYXNBcnJvd1Bvc2l0aW9ucygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3RhdGUuYXJyb3dQb3NpdGlvbnMuc2l6ZSA+IDA7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRBcnJvd1Bvc2l0aW9uaW5nQ29tcGxldGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICFzdGF0ZS5hcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcyAmJiBzdGF0ZS5hcnJvd1Bvc2l0aW9ucy5zaXplID4gMDtcbiAgfVxuXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgLy8gQUNUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgY3VycmVudCBzZXF1ZW5jZVxuICAgKi9cbiAgZnVuY3Rpb24gc2V0Q3VycmVudFNlcXVlbmNlKHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEgfCBudWxsKTogdm9pZCB7XG4gICAgc3RhdGUuY3VycmVudFNlcXVlbmNlID0gc2VxdWVuY2U7XG4gICAgc3RhdGUuc2VsZWN0ZWRTZXF1ZW5jZUlkID0gc2VxdWVuY2U/LmlkID8/IG51bGw7XG4gICAgc3RhdGUuc2VsZWN0ZWRCZWF0SW5kZXggPSBudWxsOyAvLyBSZXNldCBiZWF0IHNlbGVjdGlvblxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBzZXF1ZW5jZSB0byB0aGUgbGlzdFxuICAgKi9cbiAgZnVuY3Rpb24gYWRkU2VxdWVuY2Uoc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSk6IHZvaWQge1xuICAgIHN0YXRlLnNlcXVlbmNlcy5wdXNoKHNlcXVlbmNlKTtcbiAgICBzZXRDdXJyZW50U2VxdWVuY2Uoc2VxdWVuY2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZXF1ZW5jZSBpbiB0aGUgbGlzdFxuICAgKi9cbiAgZnVuY3Rpb24gdXBkYXRlU2VxdWVuY2UodXBkYXRlZFNlcXVlbmNlOiBTZXF1ZW5jZURhdGEpOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHN0YXRlLnNlcXVlbmNlcy5maW5kSW5kZXgoKHMpID0+IHMuaWQgPT09IHVwZGF0ZWRTZXF1ZW5jZS5pZCk7XG4gICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgIHN0YXRlLnNlcXVlbmNlc1tpbmRleF0gPSB1cGRhdGVkU2VxdWVuY2U7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIGN1cnJlbnQgc2VxdWVuY2UgaWYgaXQncyB0aGUgc2FtZSBvbmVcbiAgICBpZiAoc3RhdGUuY3VycmVudFNlcXVlbmNlPy5pZCA9PT0gdXBkYXRlZFNlcXVlbmNlLmlkKSB7XG4gICAgICBzdGF0ZS5jdXJyZW50U2VxdWVuY2UgPSB1cGRhdGVkU2VxdWVuY2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBzZXF1ZW5jZSBmcm9tIHRoZSBsaXN0XG4gICAqL1xuICBmdW5jdGlvbiByZW1vdmVTZXF1ZW5jZShzZXF1ZW5jZUlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBzdGF0ZS5zZXF1ZW5jZXMgPSBzdGF0ZS5zZXF1ZW5jZXMuZmlsdGVyKChzKSA9PiBzLmlkICE9PSBzZXF1ZW5jZUlkKTtcblxuICAgIC8vIENsZWFyIGN1cnJlbnQgc2VxdWVuY2UgaWYgaXQgd2FzIGRlbGV0ZWRcbiAgICBpZiAoc3RhdGUuY3VycmVudFNlcXVlbmNlPy5pZCA9PT0gc2VxdWVuY2VJZCkge1xuICAgICAgc2V0Q3VycmVudFNlcXVlbmNlKG51bGwpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc2VxdWVuY2VzIGxpc3RcbiAgICovXG4gIGZ1bmN0aW9uIHNldFNlcXVlbmNlcyhuZXdTZXF1ZW5jZXM6IFNlcXVlbmNlRGF0YVtdKTogdm9pZCB7XG4gICAgc3RhdGUuc2VxdWVuY2VzID0gbmV3U2VxdWVuY2VzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBsb2FkaW5nIHN0YXRlXG4gICAqL1xuICBmdW5jdGlvbiBzZXRMb2FkaW5nKGxvYWRpbmc6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBzdGF0ZS5pc0xvYWRpbmcgPSBsb2FkaW5nO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBlcnJvciBzdGF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gc2V0RXJyb3IoZXJyb3I6IHN0cmluZyB8IG51bGwpOiB2b2lkIHtcbiAgICBzdGF0ZS5lcnJvciA9IGVycm9yO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGVycm9yIHN0YXRlXG4gICAqL1xuICBmdW5jdGlvbiBjbGVhckVycm9yKCk6IHZvaWQge1xuICAgIHN0YXRlLmVycm9yID0gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgY3VycmVudCBiZWF0IGluIHNlcXVlbmNlXG4gICAqL1xuICBmdW5jdGlvbiB1cGRhdGVDdXJyZW50QmVhdChiZWF0SW5kZXg6IG51bWJlciwgYmVhdERhdGE6IEJlYXREYXRhKTogdm9pZCB7XG4gICAgaWYgKFxuICAgICAgc3RhdGUuY3VycmVudFNlcXVlbmNlICYmXG4gICAgICBiZWF0SW5kZXggPj0gMCAmJlxuICAgICAgYmVhdEluZGV4IDwgc3RhdGUuY3VycmVudFNlcXVlbmNlLmJlYXRzLmxlbmd0aFxuICAgICkge1xuICAgICAgLy8gQ3JlYXRlIGEgbmV3IGJlYXRzIGFycmF5IChyZXNwZWN0aW5nIGltbXV0YWJpbGl0eSBvZiBkb21haW4gbW9kZWwpIGFuZCBhc3NpZ25cbiAgICAgIGNvbnN0IG5ld0JlYXRzID0gWy4uLnN0YXRlLmN1cnJlbnRTZXF1ZW5jZS5iZWF0c107XG4gICAgICBuZXdCZWF0c1tiZWF0SW5kZXhdID0gYmVhdERhdGE7XG4gICAgICBzdGF0ZS5jdXJyZW50U2VxdWVuY2UgPSB7XG4gICAgICAgIC4uLnN0YXRlLmN1cnJlbnRTZXF1ZW5jZSxcbiAgICAgICAgYmVhdHM6IG5ld0JlYXRzLFxuICAgICAgfSBhcyBTZXF1ZW5jZURhdGE7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbGVjdCBhIGJlYXRcbiAgICovXG4gIGZ1bmN0aW9uIHNlbGVjdEJlYXQoYmVhdEluZGV4OiBudW1iZXIgfCBudWxsKTogdm9pZCB7XG4gICAgc3RhdGUuc2VsZWN0ZWRCZWF0SW5kZXggPSBiZWF0SW5kZXg7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGdyaWQgbW9kZVxuICAgKi9cbiAgZnVuY3Rpb24gc2V0R3JpZE1vZGUobW9kZTogR3JpZE1vZGUpOiB2b2lkIHtcbiAgICBzdGF0ZS5ncmlkTW9kZSA9IG1vZGU7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHNob3cgYmVhdCBudW1iZXJzXG4gICAqL1xuICBmdW5jdGlvbiBzZXRTaG93QmVhdE51bWJlcnMoc2hvdzogYm9vbGVhbik6IHZvaWQge1xuICAgIHN0YXRlLnNob3dCZWF0TnVtYmVycyA9IHNob3c7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGFycm93IHBvc2l0aW9uc1xuICAgKi9cbiAgZnVuY3Rpb24gc2V0QXJyb3dQb3NpdGlvbnMocG9zaXRpb25zOiBNYXA8c3RyaW5nLCBBcnJvd1Bvc2l0aW9uPik6IHZvaWQge1xuICAgIHN0YXRlLmFycm93UG9zaXRpb25zID0gcG9zaXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBhcnJvdyBwb3NpdGlvbmluZyBpbiBwcm9ncmVzc1xuICAgKi9cbiAgZnVuY3Rpb24gc2V0QXJyb3dQb3NpdGlvbmluZ0luUHJvZ3Jlc3MoaW5Qcm9ncmVzczogYm9vbGVhbik6IHZvaWQge1xuICAgIHN0YXRlLmFycm93UG9zaXRpb25pbmdJblByb2dyZXNzID0gaW5Qcm9ncmVzcztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYXJyb3cgcG9zaXRpb25pbmcgZXJyb3JcbiAgICovXG4gIGZ1bmN0aW9uIHNldEFycm93UG9zaXRpb25pbmdFcnJvcihlcnJvcjogc3RyaW5nIHwgbnVsbCk6IHZvaWQge1xuICAgIHN0YXRlLmFycm93UG9zaXRpb25pbmdFcnJvciA9IGVycm9yO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhcnJvdyBwb3NpdGlvbiBmb3IgY29sb3JcbiAgICovXG4gIGZ1bmN0aW9uIGdldEFycm93UG9zaXRpb24oY29sb3I6IHN0cmluZyk6IEFycm93UG9zaXRpb24gfCBudWxsIHtcbiAgICByZXR1cm4gc3RhdGUuYXJyb3dQb3NpdGlvbnMuZ2V0KGNvbG9yKSB8fCBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCBhcnJvdyBwb3NpdGlvbnNcbiAgICovXG4gIGZ1bmN0aW9uIGNsZWFyQXJyb3dQb3NpdGlvbnMoKTogdm9pZCB7XG4gICAgc3RhdGUuYXJyb3dQb3NpdGlvbnMuY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBhbGwgc3RhdGVcbiAgICovXG4gIGZ1bmN0aW9uIHJlc2V0U2VxdWVuY2VTdGF0ZSgpOiB2b2lkIHtcbiAgICBzdGF0ZS5jdXJyZW50U2VxdWVuY2UgPSBudWxsO1xuICAgIHN0YXRlLnNlcXVlbmNlcyA9IFtdO1xuICAgIHN0YXRlLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIHN0YXRlLmVycm9yID0gbnVsbDtcbiAgICBzdGF0ZS5zZWxlY3RlZEJlYXRJbmRleCA9IG51bGw7XG4gICAgc3RhdGUuc2VsZWN0ZWRTZXF1ZW5jZUlkID0gbnVsbDtcbiAgICBzdGF0ZS5ncmlkTW9kZSA9IEdyaWRNb2RlLkRJQU1PTkQ7XG4gICAgc3RhdGUuYXJyb3dQb3NpdGlvbnMuY2xlYXIoKTtcbiAgICBzdGF0ZS5hcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgIHN0YXRlLmFycm93UG9zaXRpb25pbmdFcnJvciA9IG51bGw7XG4gIH1cblxuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gIC8vIFNFUlZJQ0UgSU5URUdSQVRJT04gQUNUSU9OU1xuICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgLyoqXG4gICAqIExvYWQgc2VxdWVuY2VzIHVzaW5nIHRoZSBpbmplY3RlZCBzZXJ2aWNlXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiBsb2FkU2VxdWVuY2VzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHNldExvYWRpbmcodHJ1ZSk7XG4gICAgc2V0RXJyb3IobnVsbCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlcXVlbmNlcyA9IGF3YWl0IHNlcXVlbmNlU2VydmljZS5nZXRBbGxTZXF1ZW5jZXMoKTtcbiAgICAgIHNldFNlcXVlbmNlcyhzZXF1ZW5jZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPVxuICAgICAgICBlcnJvciBpbnN0YW5jZW9mIEVycm9yXG4gICAgICAgICAgPyBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgOiBcIlVua25vd24gZXJyb3IgbG9hZGluZyBzZXF1ZW5jZXNcIjtcbiAgICAgIHNldEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGxvYWQgc2VxdWVuY2VzOlwiLCBlcnJvcik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldExvYWRpbmcoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgc2VxdWVuY2UgdXNpbmcgdGhlIGluamVjdGVkIHNlcnZpY2VcbiAgICovXG4gIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVNlcXVlbmNlKHJlcXVlc3Q6IHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgbGVuZ3RoOiBudW1iZXI7XG4gIH0pOiBQcm9taXNlPFNlcXVlbmNlRGF0YSB8IG51bGw+IHtcbiAgICBzZXRMb2FkaW5nKHRydWUpO1xuICAgIHNldEVycm9yKG51bGwpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXF1ZW5jZSA9IGF3YWl0IHNlcXVlbmNlU2VydmljZS5jcmVhdGVTZXF1ZW5jZShyZXF1ZXN0KTtcbiAgICAgIGFkZFNlcXVlbmNlKHNlcXVlbmNlKTtcbiAgICAgIHJldHVybiBzZXF1ZW5jZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID1cbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvclxuICAgICAgICAgID8gZXJyb3IubWVzc2FnZVxuICAgICAgICAgIDogXCJVbmtub3duIGVycm9yIGNyZWF0aW5nIHNlcXVlbmNlXCI7XG4gICAgICBzZXRFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgc2VxdWVuY2U6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRMb2FkaW5nKGZhbHNlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNlcXVlbmNlIHVzaW5nIHRoZSBpbmplY3RlZCBzZXJ2aWNlXG4gICAqL1xuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVTZXF1ZW5jZUJlYXRzKFxuICAgIHNlcXVlbmNlSWQ6IHN0cmluZyxcbiAgICBiZWF0SW5kZXg6IG51bWJlcixcbiAgICBiZWF0RGF0YTogQmVhdERhdGFcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHNlcXVlbmNlU2VydmljZS51cGRhdGVCZWF0KHNlcXVlbmNlSWQsIGJlYXRJbmRleCwgYmVhdERhdGEpO1xuICAgICAgdXBkYXRlQ3VycmVudEJlYXQoYmVhdEluZGV4LCBiZWF0RGF0YSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9XG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yIHVwZGF0aW5nIGJlYXRcIjtcbiAgICAgIHNldEVycm9yKGVycm9yTWVzc2FnZSk7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHVwZGF0ZSBiZWF0OlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBSRVRVUk4gU1RBVEUgT0JKRUNUXG4gIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICByZXR1cm4ge1xuICAgIC8vIFN0YXRlIGFjY2VzcyAocmVhY3RpdmUpXG4gICAgZ2V0IGN1cnJlbnRTZXF1ZW5jZSgpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5jdXJyZW50U2VxdWVuY2U7XG4gICAgfSxcbiAgICBnZXQgc2VxdWVuY2VzKCkge1xuICAgICAgcmV0dXJuIHN0YXRlLnNlcXVlbmNlcztcbiAgICB9LFxuICAgIGdldCBpc0xvYWRpbmcoKSB7XG4gICAgICByZXR1cm4gc3RhdGUuaXNMb2FkaW5nO1xuICAgIH0sXG4gICAgZ2V0IGVycm9yKCkge1xuICAgICAgcmV0dXJuIHN0YXRlLmVycm9yO1xuICAgIH0sXG4gICAgZ2V0IHNlbGVjdGVkQmVhdEluZGV4KCkge1xuICAgICAgcmV0dXJuIHN0YXRlLnNlbGVjdGVkQmVhdEluZGV4O1xuICAgIH0sXG4gICAgZ2V0IHNlbGVjdGVkU2VxdWVuY2VJZCgpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5zZWxlY3RlZFNlcXVlbmNlSWQ7XG4gICAgfSxcbiAgICBnZXQgc2hvd0JlYXROdW1iZXJzKCkge1xuICAgICAgcmV0dXJuIHN0YXRlLnNob3dCZWF0TnVtYmVycztcbiAgICB9LFxuICAgIGdldCBncmlkTW9kZSgpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5ncmlkTW9kZTtcbiAgICB9LFxuICAgIGdldCBhcnJvd1Bvc2l0aW9ucygpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5hcnJvd1Bvc2l0aW9ucztcbiAgICB9LFxuICAgIGdldCBhcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcygpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5hcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcztcbiAgICB9LFxuICAgIGdldCBhcnJvd1Bvc2l0aW9uaW5nRXJyb3IoKSB7XG4gICAgICByZXR1cm4gc3RhdGUuYXJyb3dQb3NpdGlvbmluZ0Vycm9yO1xuICAgIH0sXG5cbiAgICAvLyBHZXR0ZXJzXG4gICAgZ2V0Q3VycmVudFNlcXVlbmNlLFxuICAgIGdldFNlcXVlbmNlcyxcbiAgICBnZXRJc0xvYWRpbmcsXG4gICAgZ2V0RXJyb3IsXG4gICAgZ2V0U2VsZWN0ZWRCZWF0SW5kZXgsXG4gICAgZ2V0U2VsZWN0ZWRTZXF1ZW5jZUlkLFxuICAgIGdldFNob3dCZWF0TnVtYmVycyxcbiAgICBnZXRHcmlkTW9kZSxcbiAgICBnZXRBcnJvd1Bvc2l0aW9ucyxcbiAgICBnZXRBcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcyxcbiAgICBnZXRBcnJvd1Bvc2l0aW9uaW5nRXJyb3IsXG5cbiAgICAvLyBDb21wdXRlZCBnZXR0ZXJzXG4gICAgZ2V0Q3VycmVudEJlYXRzLFxuICAgIGdldFNlbGVjdGVkQmVhdERhdGEsXG4gICAgZ2V0U2VsZWN0ZWRCZWF0LFxuICAgIGdldEhhc0N1cnJlbnRTZXF1ZW5jZSxcbiAgICBnZXRTZXF1ZW5jZUNvdW50LFxuICAgIGdldEhhc1Vuc2F2ZWRDaGFuZ2VzLFxuICAgIGdldEhhc0Fycm93UG9zaXRpb25zLFxuICAgIGdldEFycm93UG9zaXRpb25pbmdDb21wbGV0ZSxcblxuICAgIC8vIEFjdGlvbnNcbiAgICBzZXRDdXJyZW50U2VxdWVuY2UsXG4gICAgYWRkU2VxdWVuY2UsXG4gICAgdXBkYXRlU2VxdWVuY2UsXG4gICAgcmVtb3ZlU2VxdWVuY2UsXG4gICAgc2V0U2VxdWVuY2VzLFxuICAgIHNldExvYWRpbmcsXG4gICAgc2V0RXJyb3IsXG4gICAgY2xlYXJFcnJvcixcbiAgICB1cGRhdGVDdXJyZW50QmVhdCxcbiAgICBzZWxlY3RCZWF0LFxuICAgIHNldEdyaWRNb2RlLFxuICAgIHNldFNob3dCZWF0TnVtYmVycyxcbiAgICBzZXRBcnJvd1Bvc2l0aW9ucyxcbiAgICBzZXRBcnJvd1Bvc2l0aW9uaW5nSW5Qcm9ncmVzcyxcbiAgICBzZXRBcnJvd1Bvc2l0aW9uaW5nRXJyb3IsXG4gICAgZ2V0QXJyb3dQb3NpdGlvbixcbiAgICBjbGVhckFycm93UG9zaXRpb25zLFxuICAgIHJlc2V0U2VxdWVuY2VTdGF0ZSxcblxuICAgIC8vIFNlcnZpY2UgaW50ZWdyYXRpb25cbiAgICBsb2FkU2VxdWVuY2VzLFxuICAgIGNyZWF0ZVNlcXVlbmNlLFxuICAgIHVwZGF0ZVNlcXVlbmNlQmVhdHMsXG4gIH07XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIE1PREVSTiBGQUNUT1JZIEVYUE9SVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vLyBFeHBvcnQgb25seSB0aGUgZmFjdG9yeSBmdW5jdGlvbiAtIGNvbXBvbmVudHMgc2hvdWxkIHVzZSBjcmVhdGVTZXF1ZW5jZVN0YXRlKClcbi8vIFRoaXMgZWxpbWluYXRlcyBsZWdhY3kgY29tcGF0aWJpbGl0eSBjb2RlIGFuZCBlbmZvcmNlcyBwcm9wZXIgY29tcG9uZW50LXNjb3BlZCBzdGF0ZVxuIl0sImZpbGUiOiJGOi9DT0RFL1RLQS93ZWIvc3JjL2xpYi9zdGF0ZS9zZXF1ZW5jZS1zdGF0ZS5zdmVsdGUudHMifQ==