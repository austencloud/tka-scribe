import {
  Orientation,
  MotionType,
  Location,
  RotationDirection,
  HandPath,
  MotionColor
} from "/src/lib/domain/enums.ts";
export class OrientationCalculationService {
  handpathCalculator;
  constructor() {
    this.handpathCalculator = new HandpathCalculator();
  }
  /**
   * Calculate end orientation - exact port from legacy calculate_end_ori()
   */
  calculateEndOrientation(motion, _color) {
    const motionType = motion.motionType;
    const turns = motion.turns;
    const startOrientation = motion.startOrientation;
    const propRotDir = motion.rotationDirection;
    const startLocation = motion.startLocation;
    const endLocation = motion.endLocation;
    let endOrientation;
    if (motionType === MotionType.FLOAT) {
      const handpathDirection = this.handpathCalculator.getHandRotDir(
        startLocation,
        endLocation
      );
      endOrientation = this.calculateFloatOrientation(
        startOrientation,
        handpathDirection
      );
    } else {
      endOrientation = this.calculateTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir,
        startLocation,
        endLocation
      );
    }
    if (endOrientation === null || endOrientation === void 0) {
      throw new Error(
        "Calculated end orientation cannot be None. Please check the input data and orientation calculator."
      );
    }
    return endOrientation;
  }
  /**
   * Calculate turn orientation - exact port from legacy
   */
  calculateTurnOrientation(motionType, turns, startOrientation, propRotDir, startLocation, endLocation) {
    if (turns === 0 || turns === 1 || turns === 2 || turns === 3) {
      return this.calculateWholeTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir
      );
    } else if (turns === "fl") {
      const handpathDirection = this.handpathCalculator.getHandRotDir(
        startLocation,
        endLocation
      );
      return this.calculateFloatOrientation(
        startOrientation,
        handpathDirection
      );
    } else {
      return this.calculateHalfTurnOrientation(
        motionType,
        turns,
        startOrientation,
        propRotDir
      );
    }
  }
  /**
   * Calculate whole turn orientation - exact port from legacy
   */
  calculateWholeTurnOrientation(motionType, turns, startOrientation, _propRotDir) {
    if (motionType === MotionType.PRO || motionType === MotionType.STATIC) {
      if (turns % 2 === 0) {
        return startOrientation;
      } else {
        return this.switchOrientation(startOrientation);
      }
    } else if (motionType === MotionType.ANTI || motionType === MotionType.DASH) {
      if (turns % 2 === 0) {
        return this.switchOrientation(startOrientation);
      } else {
        return startOrientation;
      }
    }
    return startOrientation;
  }
  /**
   * Calculate half turn orientation - exact port from legacy
   */
  calculateHalfTurnOrientation(motionType, turns, startOrientation, propRotDir) {
    let orientationMap;
    if (motionType === MotionType.ANTI || motionType === MotionType.DASH) {
      orientationMap = {
        [`${Orientation.IN}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.IN}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.OUT}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.OUT}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.CLOCK}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.CLOCK}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.COUNTER}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.COUNTER}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN
      };
    } else if (motionType === MotionType.PRO || motionType === MotionType.STATIC) {
      orientationMap = {
        [`${Orientation.IN}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.IN}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.OUT}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.CLOCK : Orientation.COUNTER,
        [`${Orientation.OUT}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.COUNTER : Orientation.CLOCK,
        [`${Orientation.CLOCK}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT,
        [`${Orientation.CLOCK}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.COUNTER}_${RotationDirection.CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.OUT : Orientation.IN,
        [`${Orientation.COUNTER}_${RotationDirection.COUNTER_CLOCKWISE}`]: turns % 2 === 0.5 ? Orientation.IN : Orientation.OUT
      };
    } else {
      return startOrientation;
    }
    const key = `${startOrientation}_${propRotDir}`;
    return orientationMap[key] || startOrientation;
  }
  /**
   * Calculate float orientation - exact port from legacy
   */
  calculateFloatOrientation(startOrientation, handpathDirection) {
    const orientationMap = {
      [`${Orientation.IN}_${HandPath.CLOCKWISE}`]: Orientation.CLOCK,
      [`${Orientation.IN}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.COUNTER,
      [`${Orientation.OUT}_${HandPath.CLOCKWISE}`]: Orientation.COUNTER,
      [`${Orientation.OUT}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.CLOCK,
      [`${Orientation.CLOCK}_${HandPath.CLOCKWISE}`]: Orientation.OUT,
      [`${Orientation.CLOCK}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.IN,
      [`${Orientation.COUNTER}_${HandPath.CLOCKWISE}`]: Orientation.IN,
      [`${Orientation.COUNTER}_${HandPath.COUNTER_CLOCKWISE}`]: Orientation.OUT
    };
    const key = `${startOrientation}_${handpathDirection}`;
    return orientationMap[key] || startOrientation;
  }
  /**
   * Switch orientation - exact port from legacy
   */
  switchOrientation(ori) {
    const switchMap = {
      [Orientation.IN]: Orientation.OUT,
      [Orientation.OUT]: Orientation.IN,
      [Orientation.CLOCK]: Orientation.COUNTER,
      [Orientation.COUNTER]: Orientation.CLOCK
    };
    return switchMap[ori] || ori;
  }
  /**
   * Update start orientations - returns updated beat data
   */
  updateStartOrientations(nextBeat, lastBeat) {
    if (!nextBeat.pictographData || !lastBeat.pictographData) {
      throw new Error("Both beats must have pictographData");
    }
    const lastBlueMotion = lastBeat.pictographData.motions?.["blue"];
    const lastRedMotion = lastBeat.pictographData.motions?.["red"];
    if (!lastBlueMotion?.endOrientation || !lastRedMotion?.endOrientation) {
      throw new Error(
        "End orientations cannot be None. Ensure the previous beat has valid orientations."
      );
    }
    const updatedMotions = { ...nextBeat.pictographData.motions };
    if (updatedMotions.blue) {
      updatedMotions.blue = {
        ...updatedMotions.blue,
        startOrientation: lastBlueMotion.endOrientation
      };
    }
    if (updatedMotions.red) {
      updatedMotions.red = {
        ...updatedMotions.red,
        startOrientation: lastRedMotion.endOrientation
      };
    }
    return {
      ...nextBeat,
      pictographData: {
        ...nextBeat.pictographData,
        motions: updatedMotions
      }
    };
  }
  /**
   * Update end orientations - returns updated beat data
   */
  updateEndOrientations(beat) {
    if (!beat.pictographData) {
      throw new Error("Beat must have pictographData");
    }
    const updatedMotions = { ...beat.pictographData.motions };
    const blueMotion = beat.pictographData.motions?.["blue"];
    if (blueMotion) {
      const blueMotionData = {
        motionType: blueMotion.motionType || MotionType.STATIC,
        rotationDirection: blueMotion.rotationDirection || RotationDirection.NO_ROTATION,
        startLocation: blueMotion.startLocation || Location.NORTH,
        endLocation: blueMotion.endLocation || Location.NORTH,
        turns: blueMotion.turns || 0,
        startOrientation: blueMotion.startOrientation || Orientation.IN,
        endOrientation: blueMotion.endOrientation || Orientation.IN,
        isVisible: blueMotion.isVisible ?? true
      };
      const calculatedEndOri = this.calculateEndOrientation(
        blueMotionData,
        MotionColor.BLUE
      );
      updatedMotions.blue = {
        ...blueMotion,
        endOrientation: calculatedEndOri
      };
    }
    const redMotion = beat.pictographData.motions?.["red"];
    if (redMotion) {
      const redMotionData = {
        motionType: redMotion.motionType || MotionType.STATIC,
        rotationDirection: redMotion.rotationDirection || RotationDirection.NO_ROTATION,
        startLocation: redMotion.startLocation || Location.NORTH,
        endLocation: redMotion.endLocation || Location.NORTH,
        turns: redMotion.turns || 0,
        startOrientation: redMotion.startOrientation || Orientation.IN,
        endOrientation: redMotion.endOrientation || Orientation.IN,
        isVisible: redMotion.isVisible ?? true
      };
      const calculatedEndOri = this.calculateEndOrientation(
        redMotionData,
        MotionColor.RED
      );
      updatedMotions.red = {
        ...redMotion,
        endOrientation: calculatedEndOri
      };
    }
    return {
      ...beat,
      pictographData: {
        ...beat.pictographData,
        motions: updatedMotions
      }
    };
  }
}
class HandpathCalculator {
  handRotDirMap;
  constructor() {
    const clockwisePairs = [
      [Location.SOUTH, Location.WEST],
      [Location.WEST, Location.NORTH],
      [Location.NORTH, Location.EAST],
      [Location.EAST, Location.SOUTH]
    ];
    const counterClockwisePairs = [
      [Location.WEST, Location.SOUTH],
      [Location.NORTH, Location.WEST],
      [Location.EAST, Location.NORTH],
      [Location.SOUTH, Location.EAST]
    ];
    const diagonalClockwise = [
      [Location.NORTHEAST, Location.SOUTHEAST],
      [Location.SOUTHEAST, Location.SOUTHWEST],
      [Location.SOUTHWEST, Location.NORTHWEST],
      [Location.NORTHWEST, Location.NORTHEAST]
    ];
    const diagonalCounterClockwise = [
      [Location.NORTHEAST, Location.NORTHWEST],
      [Location.NORTHWEST, Location.SOUTHWEST],
      [Location.SOUTHWEST, Location.SOUTHEAST],
      [Location.SOUTHEAST, Location.NORTHEAST]
    ];
    const dashPairs = [
      [Location.SOUTH, Location.NORTH],
      [Location.WEST, Location.EAST],
      [Location.NORTH, Location.SOUTH],
      [Location.EAST, Location.WEST],
      [Location.NORTHEAST, Location.SOUTHWEST],
      [Location.SOUTHEAST, Location.NORTHWEST],
      [Location.SOUTHWEST, Location.NORTHEAST],
      [Location.NORTHWEST, Location.SOUTHEAST]
    ];
    const staticPairs = [
      [Location.NORTH, Location.NORTH],
      [Location.EAST, Location.EAST],
      [Location.SOUTH, Location.SOUTH],
      [Location.WEST, Location.WEST],
      [Location.NORTHEAST, Location.NORTHEAST],
      [Location.SOUTHEAST, Location.SOUTHEAST],
      [Location.SOUTHWEST, Location.SOUTHWEST],
      [Location.NORTHWEST, Location.NORTHWEST]
    ];
    this.handRotDirMap = /* @__PURE__ */ new Map();
    clockwisePairs.concat(diagonalClockwise).forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.CLOCKWISE);
    });
    counterClockwisePairs.concat(diagonalCounterClockwise).forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.COUNTER_CLOCKWISE);
    });
    dashPairs.forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.DASH);
    });
    staticPairs.forEach(([start, end]) => {
      this.handRotDirMap.set(`${start}_${end}`, HandPath.STATIC);
    });
  }
  /**
   * Get hand rotation direction - exact port from legacy
   */
  getHandRotDir(startLocation, endLocation) {
    const key = `${startLocation}_${endLocation}`;
    return this.handRotDirMap.get(key) || "NO HAND ROTATION FOUND";
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogT3JpZW50YXRpb24gQ2FsY3VsYXRpb24gU2VydmljZSAtIENvbXBsZXRlIHBvcnQgZnJvbSBsZWdhY3kgSnNvbk9yaUNhbGN1bGF0b3JcbiAqXG4gKiBFeGFjdCBpbXBsZW1lbnRhdGlvbiBvZiBsZWdhY3kgb3JpZW50YXRpb24gY2FsY3VsYXRpb24gYWxnb3JpdGhtcyBpbmNsdWRpbmc6XG4gKiAtIENvbXBsZXRlIGZsb2F0IG9yaWVudGF0aW9uIGNhbGN1bGF0aW9uIHdpdGggaGFuZHBhdGggZGlyZWN0aW9uXG4gKiAtIEZ1bGwgdHVybiBvcmllbnRhdGlvbiBjYWxjdWxhdGlvbiBmb3Igd2hvbGUgYW5kIGhhbGYgdHVybnNcbiAqIC0gRXhhY3QgbW90aW9uIHR5cGUgZGlmZmVyZW50aWF0aW9uIChQUk8vU1RBVElDIHZzIEFOVEkvREFTSClcbiAqIC0gQ29tcGxldGUgaGFuZHBhdGggY2FsY3VsYXRpb24gZm9yIGFsbCBsb2NhdGlvbiBwYWlyc1xuICovXG5cbmltcG9ydCB0eXBlIHsgQmVhdERhdGEgfSBmcm9tIFwiJGxpYi9kb21haW4vQmVhdERhdGFcIjtcbmltcG9ydCB0eXBlIHsgTW90aW9uRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9Nb3Rpb25EYXRhXCI7XG5pbXBvcnQge1xuICBPcmllbnRhdGlvbixcbiAgTW90aW9uVHlwZSxcbiAgTG9jYXRpb24sXG4gIFJvdGF0aW9uRGlyZWN0aW9uLFxuICBIYW5kUGF0aCxcbiAgTW90aW9uQ29sb3IsXG59IGZyb20gXCIkbGliL2RvbWFpbi9lbnVtc1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlSW50ZXJmYWNlIHtcbiAgY2FsY3VsYXRlRW5kT3JpZW50YXRpb24obW90aW9uOiBNb3Rpb25EYXRhLCBjb2xvcjogTW90aW9uQ29sb3IpOiBPcmllbnRhdGlvbjtcbiAgdXBkYXRlU3RhcnRPcmllbnRhdGlvbnMobmV4dEJlYXQ6IEJlYXREYXRhLCBsYXN0QmVhdDogQmVhdERhdGEpOiBCZWF0RGF0YTtcbiAgdXBkYXRlRW5kT3JpZW50YXRpb25zKGJlYXQ6IEJlYXREYXRhKTogQmVhdERhdGE7XG59XG5cbmV4cG9ydCBjbGFzcyBPcmllbnRhdGlvbkNhbGN1bGF0aW9uU2VydmljZVxuICBpbXBsZW1lbnRzIE9yaWVudGF0aW9uQ2FsY3VsYXRpb25TZXJ2aWNlSW50ZXJmYWNlXG57XG4gIHByaXZhdGUgaGFuZHBhdGhDYWxjdWxhdG9yOiBIYW5kcGF0aENhbGN1bGF0b3I7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5oYW5kcGF0aENhbGN1bGF0b3IgPSBuZXcgSGFuZHBhdGhDYWxjdWxhdG9yKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGVuZCBvcmllbnRhdGlvbiAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3kgY2FsY3VsYXRlX2VuZF9vcmkoKVxuICAgKi9cbiAgY2FsY3VsYXRlRW5kT3JpZW50YXRpb24oXG4gICAgbW90aW9uOiBNb3Rpb25EYXRhLFxuICAgIF9jb2xvcjogTW90aW9uQ29sb3JcbiAgKTogT3JpZW50YXRpb24ge1xuICAgIGNvbnN0IG1vdGlvblR5cGUgPSBtb3Rpb24ubW90aW9uVHlwZTtcbiAgICBjb25zdCB0dXJucyA9IG1vdGlvbi50dXJucztcbiAgICBjb25zdCBzdGFydE9yaWVudGF0aW9uID0gbW90aW9uLnN0YXJ0T3JpZW50YXRpb247XG4gICAgY29uc3QgcHJvcFJvdERpciA9IG1vdGlvbi5yb3RhdGlvbkRpcmVjdGlvbjtcbiAgICBjb25zdCBzdGFydExvY2F0aW9uID0gbW90aW9uLnN0YXJ0TG9jYXRpb247XG4gICAgY29uc3QgZW5kTG9jYXRpb24gPSBtb3Rpb24uZW5kTG9jYXRpb247XG5cbiAgICBsZXQgZW5kT3JpZW50YXRpb246IE9yaWVudGF0aW9uO1xuXG4gICAgaWYgKG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuRkxPQVQpIHtcbiAgICAgIGNvbnN0IGhhbmRwYXRoRGlyZWN0aW9uID0gdGhpcy5oYW5kcGF0aENhbGN1bGF0b3IuZ2V0SGFuZFJvdERpcihcbiAgICAgICAgc3RhcnRMb2NhdGlvbixcbiAgICAgICAgZW5kTG9jYXRpb25cbiAgICAgICkgYXMgSGFuZFBhdGg7XG4gICAgICBlbmRPcmllbnRhdGlvbiA9IHRoaXMuY2FsY3VsYXRlRmxvYXRPcmllbnRhdGlvbihcbiAgICAgICAgc3RhcnRPcmllbnRhdGlvbixcbiAgICAgICAgaGFuZHBhdGhEaXJlY3Rpb25cbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGVuZE9yaWVudGF0aW9uID0gdGhpcy5jYWxjdWxhdGVUdXJuT3JpZW50YXRpb24oXG4gICAgICAgIG1vdGlvblR5cGUsXG4gICAgICAgIHR1cm5zLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uLFxuICAgICAgICBwcm9wUm90RGlyLFxuICAgICAgICBzdGFydExvY2F0aW9uLFxuICAgICAgICBlbmRMb2NhdGlvblxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoZW5kT3JpZW50YXRpb24gPT09IG51bGwgfHwgZW5kT3JpZW50YXRpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkNhbGN1bGF0ZWQgZW5kIG9yaWVudGF0aW9uIGNhbm5vdCBiZSBOb25lLiBcIiArXG4gICAgICAgICAgXCJQbGVhc2UgY2hlY2sgdGhlIGlucHV0IGRhdGEgYW5kIG9yaWVudGF0aW9uIGNhbGN1bGF0b3IuXCJcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuZE9yaWVudGF0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0dXJuIG9yaWVudGF0aW9uIC0gZXhhY3QgcG9ydCBmcm9tIGxlZ2FjeVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUdXJuT3JpZW50YXRpb24oXG4gICAgbW90aW9uVHlwZTogTW90aW9uVHlwZSxcbiAgICB0dXJuczogbnVtYmVyIHwgXCJmbFwiLFxuICAgIHN0YXJ0T3JpZW50YXRpb246IE9yaWVudGF0aW9uLFxuICAgIHByb3BSb3REaXI6IFJvdGF0aW9uRGlyZWN0aW9uLFxuICAgIHN0YXJ0TG9jYXRpb246IExvY2F0aW9uLFxuICAgIGVuZExvY2F0aW9uOiBMb2NhdGlvblxuICApOiBPcmllbnRhdGlvbiB7XG4gICAgaWYgKHR1cm5zID09PSAwIHx8IHR1cm5zID09PSAxIHx8IHR1cm5zID09PSAyIHx8IHR1cm5zID09PSAzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVXaG9sZVR1cm5PcmllbnRhdGlvbihcbiAgICAgICAgbW90aW9uVHlwZSxcbiAgICAgICAgdHVybnMgYXMgbnVtYmVyLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uLFxuICAgICAgICBwcm9wUm90RGlyXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAodHVybnMgPT09IFwiZmxcIikge1xuICAgICAgY29uc3QgaGFuZHBhdGhEaXJlY3Rpb24gPSB0aGlzLmhhbmRwYXRoQ2FsY3VsYXRvci5nZXRIYW5kUm90RGlyKFxuICAgICAgICBzdGFydExvY2F0aW9uLFxuICAgICAgICBlbmRMb2NhdGlvblxuICAgICAgKSBhcyBIYW5kUGF0aDtcbiAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZUZsb2F0T3JpZW50YXRpb24oXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb24sXG4gICAgICAgIGhhbmRwYXRoRGlyZWN0aW9uXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGVIYWxmVHVybk9yaWVudGF0aW9uKFxuICAgICAgICBtb3Rpb25UeXBlLFxuICAgICAgICB0dXJucyBhcyBudW1iZXIsXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb24sXG4gICAgICAgIHByb3BSb3REaXJcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB3aG9sZSB0dXJuIG9yaWVudGF0aW9uIC0gZXhhY3QgcG9ydCBmcm9tIGxlZ2FjeVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVXaG9sZVR1cm5PcmllbnRhdGlvbihcbiAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLFxuICAgIHR1cm5zOiBudW1iZXIsXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgX3Byb3BSb3REaXI6IFJvdGF0aW9uRGlyZWN0aW9uXG4gICk6IE9yaWVudGF0aW9uIHtcbiAgICBpZiAobW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5QUk8gfHwgbW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5TVEFUSUMpIHtcbiAgICAgIGlmICh0dXJucyAlIDIgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5zd2l0Y2hPcmllbnRhdGlvbihzdGFydE9yaWVudGF0aW9uKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKFxuICAgICAgbW90aW9uVHlwZSA9PT0gTW90aW9uVHlwZS5BTlRJIHx8XG4gICAgICBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLkRBU0hcbiAgICApIHtcbiAgICAgIGlmICh0dXJucyAlIDIgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3dpdGNoT3JpZW50YXRpb24oc3RhcnRPcmllbnRhdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gc3RhcnRPcmllbnRhdGlvbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGhhbGYgdHVybiBvcmllbnRhdGlvbiAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3lcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlSGFsZlR1cm5PcmllbnRhdGlvbihcbiAgICBtb3Rpb25UeXBlOiBNb3Rpb25UeXBlLFxuICAgIHR1cm5zOiBudW1iZXIsXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgcHJvcFJvdERpcjogUm90YXRpb25EaXJlY3Rpb25cbiAgKTogT3JpZW50YXRpb24ge1xuICAgIGxldCBvcmllbnRhdGlvbk1hcDogUmVjb3JkPHN0cmluZywgT3JpZW50YXRpb24+O1xuXG4gICAgaWYgKG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuQU5USSB8fCBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLkRBU0gpIHtcbiAgICAgIG9yaWVudGF0aW9uTWFwID0ge1xuICAgICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ0xPQ0sgOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ09VTlRFUiA6IE9yaWVudGF0aW9uLkNMT0NLLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uT1VUfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uQ0xPQ0sgOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ0xPQ0t9XyR7Um90YXRpb25EaXJlY3Rpb24uQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uT1VUIDogT3JpZW50YXRpb24uSU4sXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DTE9DS31fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLklOIDogT3JpZW50YXRpb24uT1VULFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5JTiA6IE9yaWVudGF0aW9uLk9VVCxcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLkNPVU5URVJ9XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5PVVQgOiBPcmllbnRhdGlvbi5JTixcbiAgICAgIH07XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIG1vdGlvblR5cGUgPT09IE1vdGlvblR5cGUuUFJPIHx8XG4gICAgICBtb3Rpb25UeXBlID09PSBNb3Rpb25UeXBlLlNUQVRJQ1xuICAgICkge1xuICAgICAgb3JpZW50YXRpb25NYXAgPSB7XG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5JTn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5JTn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLkNMT0NLIDogT3JpZW50YXRpb24uQ09VTlRFUixcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLk9VVH1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DTE9DSyA6IE9yaWVudGF0aW9uLkNPVU5URVIsXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7Um90YXRpb25EaXJlY3Rpb24uQ09VTlRFUl9DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5DT1VOVEVSIDogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DTE9DS31fJHtSb3RhdGlvbkRpcmVjdGlvbi5DTE9DS1dJU0V9YF06XG4gICAgICAgICAgdHVybnMgJSAyID09PSAwLjUgPyBPcmllbnRhdGlvbi5JTiA6IE9yaWVudGF0aW9uLk9VVCxcbiAgICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOlxuICAgICAgICAgIHR1cm5zICUgMiA9PT0gMC41ID8gT3JpZW50YXRpb24uT1VUIDogT3JpZW50YXRpb24uSU4sXG4gICAgICAgIFtgJHtPcmllbnRhdGlvbi5DT1VOVEVSfV8ke1JvdGF0aW9uRGlyZWN0aW9uLkNMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLk9VVCA6IE9yaWVudGF0aW9uLklOLFxuICAgICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtSb3RhdGlvbkRpcmVjdGlvbi5DT1VOVEVSX0NMT0NLV0lTRX1gXTpcbiAgICAgICAgICB0dXJucyAlIDIgPT09IDAuNSA/IE9yaWVudGF0aW9uLklOIDogT3JpZW50YXRpb24uT1VULFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHN0YXJ0T3JpZW50YXRpb247XG4gICAgfVxuXG4gICAgY29uc3Qga2V5ID0gYCR7c3RhcnRPcmllbnRhdGlvbn1fJHtwcm9wUm90RGlyfWA7XG4gICAgcmV0dXJuIG9yaWVudGF0aW9uTWFwW2tleV0gfHwgc3RhcnRPcmllbnRhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZmxvYXQgb3JpZW50YXRpb24gLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUZsb2F0T3JpZW50YXRpb24oXG4gICAgc3RhcnRPcmllbnRhdGlvbjogT3JpZW50YXRpb24sXG4gICAgaGFuZHBhdGhEaXJlY3Rpb246IEhhbmRQYXRoXG4gICk6IE9yaWVudGF0aW9uIHtcbiAgICBjb25zdCBvcmllbnRhdGlvbk1hcDogUmVjb3JkPHN0cmluZywgT3JpZW50YXRpb24+ID0ge1xuICAgICAgW2Ake09yaWVudGF0aW9uLklOfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uQ0xPQ0ssXG4gICAgICBbYCR7T3JpZW50YXRpb24uSU59XyR7SGFuZFBhdGguQ09VTlRFUl9DTE9DS1dJU0V9YF06IE9yaWVudGF0aW9uLkNPVU5URVIsXG4gICAgICBbYCR7T3JpZW50YXRpb24uT1VUfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uQ09VTlRFUixcbiAgICAgIFtgJHtPcmllbnRhdGlvbi5PVVR9XyR7SGFuZFBhdGguQ09VTlRFUl9DTE9DS1dJU0V9YF06IE9yaWVudGF0aW9uLkNMT0NLLFxuICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uT1VULFxuICAgICAgW2Ake09yaWVudGF0aW9uLkNMT0NLfV8ke0hhbmRQYXRoLkNPVU5URVJfQ0xPQ0tXSVNFfWBdOiBPcmllbnRhdGlvbi5JTixcbiAgICAgIFtgJHtPcmllbnRhdGlvbi5DT1VOVEVSfV8ke0hhbmRQYXRoLkNMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uSU4sXG4gICAgICBbYCR7T3JpZW50YXRpb24uQ09VTlRFUn1fJHtIYW5kUGF0aC5DT1VOVEVSX0NMT0NLV0lTRX1gXTogT3JpZW50YXRpb24uT1VULFxuICAgIH07XG5cbiAgICBjb25zdCBrZXkgPSBgJHtzdGFydE9yaWVudGF0aW9ufV8ke2hhbmRwYXRoRGlyZWN0aW9ufWA7XG4gICAgcmV0dXJuIG9yaWVudGF0aW9uTWFwW2tleV0gfHwgc3RhcnRPcmllbnRhdGlvbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBTd2l0Y2ggb3JpZW50YXRpb24gLSBleGFjdCBwb3J0IGZyb20gbGVnYWN5XG4gICAqL1xuICBwcml2YXRlIHN3aXRjaE9yaWVudGF0aW9uKG9yaTogT3JpZW50YXRpb24pOiBPcmllbnRhdGlvbiB7XG4gICAgY29uc3Qgc3dpdGNoTWFwOiBSZWNvcmQ8c3RyaW5nLCBPcmllbnRhdGlvbj4gPSB7XG4gICAgICBbT3JpZW50YXRpb24uSU5dOiBPcmllbnRhdGlvbi5PVVQsXG4gICAgICBbT3JpZW50YXRpb24uT1VUXTogT3JpZW50YXRpb24uSU4sXG4gICAgICBbT3JpZW50YXRpb24uQ0xPQ0tdOiBPcmllbnRhdGlvbi5DT1VOVEVSLFxuICAgICAgW09yaWVudGF0aW9uLkNPVU5URVJdOiBPcmllbnRhdGlvbi5DTE9DSyxcbiAgICB9O1xuICAgIHJldHVybiBzd2l0Y2hNYXBbb3JpXSB8fCBvcmk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHN0YXJ0IG9yaWVudGF0aW9ucyAtIHJldHVybnMgdXBkYXRlZCBiZWF0IGRhdGFcbiAgICovXG4gIHVwZGF0ZVN0YXJ0T3JpZW50YXRpb25zKG5leHRCZWF0OiBCZWF0RGF0YSwgbGFzdEJlYXQ6IEJlYXREYXRhKTogQmVhdERhdGEge1xuICAgIGlmICghbmV4dEJlYXQucGljdG9ncmFwaERhdGEgfHwgIWxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJCb3RoIGJlYXRzIG11c3QgaGF2ZSBwaWN0b2dyYXBoRGF0YVwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXN0Qmx1ZU1vdGlvbiA9IGxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcImJsdWVcIl07XG4gICAgY29uc3QgbGFzdFJlZE1vdGlvbiA9IGxhc3RCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcInJlZFwiXTtcblxuICAgIGlmICghbGFzdEJsdWVNb3Rpb24/LmVuZE9yaWVudGF0aW9uIHx8ICFsYXN0UmVkTW90aW9uPy5lbmRPcmllbnRhdGlvbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkVuZCBvcmllbnRhdGlvbnMgY2Fubm90IGJlIE5vbmUuIEVuc3VyZSB0aGUgcHJldmlvdXMgYmVhdCBoYXMgdmFsaWQgb3JpZW50YXRpb25zLlwiXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSB1cGRhdGVkIG1vdGlvbnMgd2l0aCBuZXcgc3RhcnQgb3JpZW50YXRpb25zXG4gICAgY29uc3QgdXBkYXRlZE1vdGlvbnMgPSB7IC4uLm5leHRCZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMgfTtcblxuICAgIGlmICh1cGRhdGVkTW90aW9ucy5ibHVlKSB7XG4gICAgICB1cGRhdGVkTW90aW9ucy5ibHVlID0ge1xuICAgICAgICAuLi51cGRhdGVkTW90aW9ucy5ibHVlLFxuICAgICAgICBzdGFydE9yaWVudGF0aW9uOiBsYXN0Qmx1ZU1vdGlvbi5lbmRPcmllbnRhdGlvbixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHVwZGF0ZWRNb3Rpb25zLnJlZCkge1xuICAgICAgdXBkYXRlZE1vdGlvbnMucmVkID0ge1xuICAgICAgICAuLi51cGRhdGVkTW90aW9ucy5yZWQsXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb246IGxhc3RSZWRNb3Rpb24uZW5kT3JpZW50YXRpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFJldHVybiB1cGRhdGVkIGJlYXQgZGF0YVxuICAgIHJldHVybiB7XG4gICAgICAuLi5uZXh0QmVhdCxcbiAgICAgIHBpY3RvZ3JhcGhEYXRhOiB7XG4gICAgICAgIC4uLm5leHRCZWF0LnBpY3RvZ3JhcGhEYXRhLFxuICAgICAgICBtb3Rpb25zOiB1cGRhdGVkTW90aW9ucyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgZW5kIG9yaWVudGF0aW9ucyAtIHJldHVybnMgdXBkYXRlZCBiZWF0IGRhdGFcbiAgICovXG4gIHVwZGF0ZUVuZE9yaWVudGF0aW9ucyhiZWF0OiBCZWF0RGF0YSk6IEJlYXREYXRhIHtcbiAgICBpZiAoIWJlYXQucGljdG9ncmFwaERhdGEpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkJlYXQgbXVzdCBoYXZlIHBpY3RvZ3JhcGhEYXRhXCIpO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRNb3Rpb25zID0geyAuLi5iZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMgfTtcblxuICAgIC8vIENhbGN1bGF0ZSBibHVlIGVuZCBvcmllbnRhdGlvblxuICAgIGNvbnN0IGJsdWVNb3Rpb24gPSBiZWF0LnBpY3RvZ3JhcGhEYXRhLm1vdGlvbnM/LltcImJsdWVcIl07XG4gICAgaWYgKGJsdWVNb3Rpb24pIHtcbiAgICAgIGNvbnN0IGJsdWVNb3Rpb25EYXRhOiBNb3Rpb25EYXRhID0ge1xuICAgICAgICBtb3Rpb25UeXBlOiBibHVlTW90aW9uLm1vdGlvblR5cGUgfHwgTW90aW9uVHlwZS5TVEFUSUMsXG4gICAgICAgIHJvdGF0aW9uRGlyZWN0aW9uOlxuICAgICAgICAgIGJsdWVNb3Rpb24ucm90YXRpb25EaXJlY3Rpb24gfHwgUm90YXRpb25EaXJlY3Rpb24uTk9fUk9UQVRJT04sXG4gICAgICAgIHN0YXJ0TG9jYXRpb246IGJsdWVNb3Rpb24uc3RhcnRMb2NhdGlvbiB8fCBMb2NhdGlvbi5OT1JUSCxcbiAgICAgICAgZW5kTG9jYXRpb246IGJsdWVNb3Rpb24uZW5kTG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEgsXG4gICAgICAgIHR1cm5zOiBibHVlTW90aW9uLnR1cm5zIHx8IDAsXG4gICAgICAgIHN0YXJ0T3JpZW50YXRpb246IGJsdWVNb3Rpb24uc3RhcnRPcmllbnRhdGlvbiB8fCBPcmllbnRhdGlvbi5JTixcbiAgICAgICAgZW5kT3JpZW50YXRpb246IGJsdWVNb3Rpb24uZW5kT3JpZW50YXRpb24gfHwgT3JpZW50YXRpb24uSU4sXG4gICAgICAgIGlzVmlzaWJsZTogYmx1ZU1vdGlvbi5pc1Zpc2libGUgPz8gdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNhbGN1bGF0ZWRFbmRPcmkgPSB0aGlzLmNhbGN1bGF0ZUVuZE9yaWVudGF0aW9uKFxuICAgICAgICBibHVlTW90aW9uRGF0YSxcbiAgICAgICAgTW90aW9uQ29sb3IuQkxVRVxuICAgICAgKTtcblxuICAgICAgdXBkYXRlZE1vdGlvbnMuYmx1ZSA9IHtcbiAgICAgICAgLi4uYmx1ZU1vdGlvbixcbiAgICAgICAgZW5kT3JpZW50YXRpb246IGNhbGN1bGF0ZWRFbmRPcmksXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSByZWQgZW5kIG9yaWVudGF0aW9uXG4gICAgY29uc3QgcmVkTW90aW9uID0gYmVhdC5waWN0b2dyYXBoRGF0YS5tb3Rpb25zPy5bXCJyZWRcIl07XG4gICAgaWYgKHJlZE1vdGlvbikge1xuICAgICAgY29uc3QgcmVkTW90aW9uRGF0YTogTW90aW9uRGF0YSA9IHtcbiAgICAgICAgbW90aW9uVHlwZTogcmVkTW90aW9uLm1vdGlvblR5cGUgfHwgTW90aW9uVHlwZS5TVEFUSUMsXG4gICAgICAgIHJvdGF0aW9uRGlyZWN0aW9uOlxuICAgICAgICAgIHJlZE1vdGlvbi5yb3RhdGlvbkRpcmVjdGlvbiB8fCBSb3RhdGlvbkRpcmVjdGlvbi5OT19ST1RBVElPTixcbiAgICAgICAgc3RhcnRMb2NhdGlvbjogcmVkTW90aW9uLnN0YXJ0TG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEgsXG4gICAgICAgIGVuZExvY2F0aW9uOiByZWRNb3Rpb24uZW5kTG9jYXRpb24gfHwgTG9jYXRpb24uTk9SVEgsXG4gICAgICAgIHR1cm5zOiByZWRNb3Rpb24udHVybnMgfHwgMCxcbiAgICAgICAgc3RhcnRPcmllbnRhdGlvbjogcmVkTW90aW9uLnN0YXJ0T3JpZW50YXRpb24gfHwgT3JpZW50YXRpb24uSU4sXG4gICAgICAgIGVuZE9yaWVudGF0aW9uOiByZWRNb3Rpb24uZW5kT3JpZW50YXRpb24gfHwgT3JpZW50YXRpb24uSU4sXG4gICAgICAgIGlzVmlzaWJsZTogcmVkTW90aW9uLmlzVmlzaWJsZSA/PyB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY2FsY3VsYXRlZEVuZE9yaSA9IHRoaXMuY2FsY3VsYXRlRW5kT3JpZW50YXRpb24oXG4gICAgICAgIHJlZE1vdGlvbkRhdGEsXG4gICAgICAgIE1vdGlvbkNvbG9yLlJFRFxuICAgICAgKTtcblxuICAgICAgdXBkYXRlZE1vdGlvbnMucmVkID0ge1xuICAgICAgICAuLi5yZWRNb3Rpb24sXG4gICAgICAgIGVuZE9yaWVudGF0aW9uOiBjYWxjdWxhdGVkRW5kT3JpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdXBkYXRlZCBiZWF0IGRhdGFcbiAgICByZXR1cm4ge1xuICAgICAgLi4uYmVhdCxcbiAgICAgIHBpY3RvZ3JhcGhEYXRhOiB7XG4gICAgICAgIC4uLmJlYXQucGljdG9ncmFwaERhdGEsXG4gICAgICAgIG1vdGlvbnM6IHVwZGF0ZWRNb3Rpb25zLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogSGFuZHBhdGggQ2FsY3VsYXRvciAtIEV4YWN0IHBvcnQgZnJvbSBsZWdhY3kgSGFuZHBhdGhDYWxjdWxhdG9yXG4gKlxuICogQ2FsY3VsYXRlcyBoYW5kIHJvdGF0aW9uIGRpcmVjdGlvbiBiYXNlZCBvbiBzdGFydCBhbmQgZW5kIGxvY2F0aW9ucy5cbiAqIENvbXBsZXRlIG1hcHBpbmcgb2YgYWxsIGxvY2F0aW9uIHBhaXJzIHRvIGhhbmRwYXRoIGRpcmVjdGlvbnMuXG4gKi9cbmNsYXNzIEhhbmRwYXRoQ2FsY3VsYXRvciB7XG4gIHByaXZhdGUgaGFuZFJvdERpck1hcDogTWFwPHN0cmluZywgc3RyaW5nPjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBFeGFjdCBwYWlycyBmcm9tIGxlZ2FjeSBIYW5kcGF0aENhbGN1bGF0b3JcbiAgICBjb25zdCBjbG9ja3dpc2VQYWlycyA9IFtcbiAgICAgIFtMb2NhdGlvbi5TT1VUSCwgTG9jYXRpb24uV0VTVF0sXG4gICAgICBbTG9jYXRpb24uV0VTVCwgTG9jYXRpb24uTk9SVEhdLFxuICAgICAgW0xvY2F0aW9uLk5PUlRILCBMb2NhdGlvbi5FQVNUXSxcbiAgICAgIFtMb2NhdGlvbi5FQVNULCBMb2NhdGlvbi5TT1VUSF0sXG4gICAgXTtcblxuICAgIGNvbnN0IGNvdW50ZXJDbG9ja3dpc2VQYWlycyA9IFtcbiAgICAgIFtMb2NhdGlvbi5XRVNULCBMb2NhdGlvbi5TT1VUSF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEgsIExvY2F0aW9uLldFU1RdLFxuICAgICAgW0xvY2F0aW9uLkVBU1QsIExvY2F0aW9uLk5PUlRIXSxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSCwgTG9jYXRpb24uRUFTVF0sXG4gICAgXTtcblxuICAgIGNvbnN0IGRpYWdvbmFsQ2xvY2t3aXNlID0gW1xuICAgICAgW0xvY2F0aW9uLk5PUlRIRUFTVCwgTG9jYXRpb24uU09VVEhFQVNUXSxcbiAgICAgIFtMb2NhdGlvbi5TT1VUSEVBU1QsIExvY2F0aW9uLlNPVVRIV0VTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEhXRVNULCBMb2NhdGlvbi5OT1JUSFdFU1RdLFxuICAgICAgW0xvY2F0aW9uLk5PUlRIV0VTVCwgTG9jYXRpb24uTk9SVEhFQVNUXSxcbiAgICBdO1xuXG4gICAgY29uc3QgZGlhZ29uYWxDb3VudGVyQ2xvY2t3aXNlID0gW1xuICAgICAgW0xvY2F0aW9uLk5PUlRIRUFTVCwgTG9jYXRpb24uTk9SVEhXRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1QsIExvY2F0aW9uLlNPVVRIV0VTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEhXRVNULCBMb2NhdGlvbi5TT1VUSEVBU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIRUFTVCwgTG9jYXRpb24uTk9SVEhFQVNUXSxcbiAgICBdO1xuXG4gICAgY29uc3QgZGFzaFBhaXJzID0gW1xuICAgICAgW0xvY2F0aW9uLlNPVVRILCBMb2NhdGlvbi5OT1JUSF0sXG4gICAgICBbTG9jYXRpb24uV0VTVCwgTG9jYXRpb24uRUFTVF0sXG4gICAgICBbTG9jYXRpb24uTk9SVEgsIExvY2F0aW9uLlNPVVRIXSxcbiAgICAgIFtMb2NhdGlvbi5FQVNULCBMb2NhdGlvbi5XRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1QsIExvY2F0aW9uLlNPVVRIV0VTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEhFQVNULCBMb2NhdGlvbi5OT1JUSFdFU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIV0VTVCwgTG9jYXRpb24uTk9SVEhFQVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1QsIExvY2F0aW9uLlNPVVRIRUFTVF0sXG4gICAgXTtcblxuICAgIGNvbnN0IHN0YXRpY1BhaXJzID0gW1xuICAgICAgW0xvY2F0aW9uLk5PUlRILCBMb2NhdGlvbi5OT1JUSF0sXG4gICAgICBbTG9jYXRpb24uRUFTVCwgTG9jYXRpb24uRUFTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEgsIExvY2F0aW9uLlNPVVRIXSxcbiAgICAgIFtMb2NhdGlvbi5XRVNULCBMb2NhdGlvbi5XRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSEVBU1QsIExvY2F0aW9uLk5PUlRIRUFTVF0sXG4gICAgICBbTG9jYXRpb24uU09VVEhFQVNULCBMb2NhdGlvbi5TT1VUSEVBU1RdLFxuICAgICAgW0xvY2F0aW9uLlNPVVRIV0VTVCwgTG9jYXRpb24uU09VVEhXRVNUXSxcbiAgICAgIFtMb2NhdGlvbi5OT1JUSFdFU1QsIExvY2F0aW9uLk5PUlRIV0VTVF0sXG4gICAgXTtcblxuICAgIC8vIEJ1aWxkIHRoZSBjb21wbGV0ZSBtYXBcbiAgICB0aGlzLmhhbmRSb3REaXJNYXAgPSBuZXcgTWFwKCk7XG5cbiAgICAvLyBBZGQgYWxsIG1hcHBpbmdzXG4gICAgY2xvY2t3aXNlUGFpcnMuY29uY2F0KGRpYWdvbmFsQ2xvY2t3aXNlKS5mb3JFYWNoKChbc3RhcnQsIGVuZF0pID0+IHtcbiAgICAgIHRoaXMuaGFuZFJvdERpck1hcC5zZXQoYCR7c3RhcnR9XyR7ZW5kfWAsIEhhbmRQYXRoLkNMT0NLV0lTRSk7XG4gICAgfSk7XG5cbiAgICBjb3VudGVyQ2xvY2t3aXNlUGFpcnNcbiAgICAgIC5jb25jYXQoZGlhZ29uYWxDb3VudGVyQ2xvY2t3aXNlKVxuICAgICAgLmZvckVhY2goKFtzdGFydCwgZW5kXSkgPT4ge1xuICAgICAgICB0aGlzLmhhbmRSb3REaXJNYXAuc2V0KGAke3N0YXJ0fV8ke2VuZH1gLCBIYW5kUGF0aC5DT1VOVEVSX0NMT0NLV0lTRSk7XG4gICAgICB9KTtcblxuICAgIGRhc2hQYWlycy5mb3JFYWNoKChbc3RhcnQsIGVuZF0pID0+IHtcbiAgICAgIHRoaXMuaGFuZFJvdERpck1hcC5zZXQoYCR7c3RhcnR9XyR7ZW5kfWAsIEhhbmRQYXRoLkRBU0gpO1xuICAgIH0pO1xuXG4gICAgc3RhdGljUGFpcnMuZm9yRWFjaCgoW3N0YXJ0LCBlbmRdKSA9PiB7XG4gICAgICB0aGlzLmhhbmRSb3REaXJNYXAuc2V0KGAke3N0YXJ0fV8ke2VuZH1gLCBIYW5kUGF0aC5TVEFUSUMpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBoYW5kIHJvdGF0aW9uIGRpcmVjdGlvbiAtIGV4YWN0IHBvcnQgZnJvbSBsZWdhY3lcbiAgICovXG4gIGdldEhhbmRSb3REaXIoc3RhcnRMb2NhdGlvbjogc3RyaW5nLCBlbmRMb2NhdGlvbjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBrZXkgPSBgJHtzdGFydExvY2F0aW9ufV8ke2VuZExvY2F0aW9ufWA7XG4gICAgcmV0dXJuIHRoaXMuaGFuZFJvdERpck1hcC5nZXQoa2V5KSB8fCBcIk5PIEhBTkQgUk9UQVRJT04gRk9VTkRcIjtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFZQTtBQUFBLEVBQ0U7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxFQUNBO0FBQUEsRUFDQTtBQUFBLE9BQ0s7QUFRQSxhQUFNLDhCQUViO0FBQUEsRUFDVTtBQUFBLEVBRVIsY0FBYztBQUNaLFNBQUsscUJBQXFCLElBQUksbUJBQW1CO0FBQUEsRUFDbkQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLHdCQUNFLFFBQ0EsUUFDYTtBQUNiLFVBQU0sYUFBYSxPQUFPO0FBQzFCLFVBQU0sUUFBUSxPQUFPO0FBQ3JCLFVBQU0sbUJBQW1CLE9BQU87QUFDaEMsVUFBTSxhQUFhLE9BQU87QUFDMUIsVUFBTSxnQkFBZ0IsT0FBTztBQUM3QixVQUFNLGNBQWMsT0FBTztBQUUzQixRQUFJO0FBRUosUUFBSSxlQUFlLFdBQVcsT0FBTztBQUNuQyxZQUFNLG9CQUFvQixLQUFLLG1CQUFtQjtBQUFBLFFBQ2hEO0FBQUEsUUFDQTtBQUFBLE1BQ0Y7QUFDQSx1QkFBaUIsS0FBSztBQUFBLFFBQ3BCO0FBQUEsUUFDQTtBQUFBLE1BQ0Y7QUFBQSxJQUNGLE9BQU87QUFDTCx1QkFBaUIsS0FBSztBQUFBLFFBQ3BCO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUVBLFFBQUksbUJBQW1CLFFBQVEsbUJBQW1CLFFBQVc7QUFDM0QsWUFBTSxJQUFJO0FBQUEsUUFDUjtBQUFBLE1BRUY7QUFBQSxJQUNGO0FBRUEsV0FBTztBQUFBLEVBQ1Q7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtRLHlCQUNOLFlBQ0EsT0FDQSxrQkFDQSxZQUNBLGVBQ0EsYUFDYTtBQUNiLFFBQUks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