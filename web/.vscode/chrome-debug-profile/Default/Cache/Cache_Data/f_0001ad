export class CSVParserService {
  /**
   * Parse CSV text into structured result with detailed error reporting
   */
  parseCSV(csvText) {
    const result = {
      headers: [],
      rows: [],
      totalRows: 0,
      successfulRows: 0,
      errors: []
    };
    try {
      const lines = csvText.trim().split("\n");
      if (lines.length < 2) {
        result.errors.push({
          rowIndex: 0,
          error: "CSV must have at least header and one data row",
          rawRow: csvText
        });
        return result;
      }
      result.headers = lines[0].split(",").map((h) => h.trim());
      result.totalRows = lines.length - 1;
      for (let i = 1; i < lines.length; i++) {
        try {
          const values = lines[i].split(",").map((v) => v.trim());
          const row = this.createRowFromValues(result.headers, values);
          if (this.isValidRow(row)) {
            result.rows.push(row);
            result.successfulRows++;
          } else {
            result.errors.push({
              rowIndex: i,
              error: "Row validation failed - missing required fields",
              rawRow: lines[i]
            });
          }
        } catch (error) {
          result.errors.push({
            rowIndex: i,
            error: error instanceof Error ? error.message : "Unknown parsing error",
            rawRow: lines[i]
          });
        }
      }
      return result;
    } catch (error) {
      result.errors.push({
        rowIndex: 0,
        error: `CSV parsing failed: ${error instanceof Error ? error.message : "Unknown error"}`,
        rawRow: csvText.substring(0, 100) + "..."
      });
      return result;
    }
  }
  /**
   * Simple CSV parsing that returns only successful rows (legacy compatibility)
   */
  parseCSVToRows(csvText) {
    const result = this.parseCSV(csvText);
    if (result.errors.length > 0) {
      console.warn(
        `⚠️ CSV parsing had ${result.errors.length} errors out of ${result.totalRows} rows`
      );
      result.errors.forEach((error) => {
        console.warn(`⚠️ Row ${error.rowIndex}: ${error.error}`);
      });
    }
    return result.rows;
  }
  /**
   * Validate CSV structure before parsing
   */
  validateCSVStructure(csvText) {
    const errors = [];
    if (!csvText || csvText.trim().length === 0) {
      errors.push("CSV text is empty");
      return { isValid: false, errors };
    }
    const lines = csvText.trim().split("\n");
    if (lines.length < 2) {
      errors.push("CSV must have at least a header row and one data row");
      return { isValid: false, errors };
    }
    const headers = lines[0].split(",").map((h) => h.trim());
    const requiredHeaders = ["letter", "startPosition", "endPosition"];
    for (const required of requiredHeaders) {
      if (!headers.includes(required)) {
        errors.push(`Missing required header: ${required}`);
      }
    }
    const headerCount = headers.length;
    for (let i = 1; i < Math.min(lines.length, 10); i++) {
      const columnCount = lines[i].split(",").length;
      if (columnCount !== headerCount) {
        errors.push(
          `Row ${i} has ${columnCount} columns, expected ${headerCount}`
        );
      }
    }
    return { isValid: errors.length === 0, errors };
  }
  /**
   * Create a ParsedCsvRow from headers and values
   */
  createRowFromValues(headers, values) {
    const row = {};
    headers.forEach((header, index) => {
      row[header] = values[index] || "";
    });
    return {
      letter: row.letter || "",
      startPosition: row.startPosition || "",
      endPosition: row.endPosition || "",
      timing: row.timing || "",
      direction: row.direction || "",
      blueMotionType: row.blueMotionType || "",
      blueRotationDirection: row.blueRotationDirection || "",
      blueStartLocation: row.blueStartLocation || row.blueStartLoc || "",
      // Handle variations
      blueEndLocation: row.blueEndLocation || row.blueendLocation || "",
      // Handle variations
      redMotionType: row.redMotionType || "",
      redRotationDirection: row.redRotationDirection || "",
      redStartLocation: row.redStartLocation || row.redStartLoc || "",
      // Handle variations
      redEndLocation: row.redEndLocation || row.redendLocation || "",
      // Handle variations
      ...row
      // Include all other fields
    };
  }
  /**
   * Validate that a row has required fields
   */
  isValidRow(row) {
    return !!(row.letter && row.startPosition && row.endPosition);
  }
  /**
   * Get column mapping for different CSV formats (if needed)
   */
  getColumnMapping(headers) {
    const mapping = {};
    const variations = {
      blueStartLocation: [
        "blueStartLocation",
        "blueStartLoc",
        "blue_start_location"
      ],
      blueEndLocation: [
        "blueEndLocation",
        "blueendLocation",
        "blue_end_location"
      ],
      redStartLocation: [
        "redStartLocation",
        "redStartLoc",
        "red_start_location"
      ],
      redEndLocation: ["redEndLocation", "redendLocation", "red_end_location"]
    };
    for (const [standardName, variants] of Object.entries(variations)) {
      for (const variant of variants) {
        if (headers.includes(variant)) {
          mapping[standardName] = variant;
          break;
        }
      }
    }
    return mapping;
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNTVlBhcnNlclNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDU1ZQYXJzZXJTZXJ2aWNlIC0gQ2VudHJhbGl6ZWQgQ1NWIHBhcnNpbmcgdXRpbGl0aWVzXG4gKlxuICogUHJvdmlkZXMgY29uc2lzdGVudCBDU1YgcGFyc2luZyBmdW5jdGlvbmFsaXR5IHVzZWQgYWNyb3NzIGFsbCBkYXRhIHNlcnZpY2VzLlxuICogSGFuZGxlcyBsaW5lIHNwbGl0dGluZywgaGVhZGVyIGV4dHJhY3Rpb24sIGFuZCByb3cgcGFyc2luZyB3aXRoIGVycm9yIGhhbmRsaW5nLlxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFyc2VkQ3N2Um93IHtcbiAgbGV0dGVyOiBzdHJpbmc7XG4gIHN0YXJ0UG9zaXRpb246IHN0cmluZztcbiAgZW5kUG9zaXRpb246IHN0cmluZztcbiAgdGltaW5nOiBzdHJpbmc7XG4gIGRpcmVjdGlvbjogc3RyaW5nO1xuICBibHVlTW90aW9uVHlwZTogc3RyaW5nO1xuICBibHVlUm90YXRpb25EaXJlY3Rpb246IHN0cmluZztcbiAgYmx1ZVN0YXJ0TG9jYXRpb246IHN0cmluZztcbiAgYmx1ZUVuZExvY2F0aW9uOiBzdHJpbmc7XG4gIHJlZE1vdGlvblR5cGU6IHN0cmluZztcbiAgcmVkUm90YXRpb25EaXJlY3Rpb246IHN0cmluZztcbiAgcmVkU3RhcnRMb2NhdGlvbjogc3RyaW5nO1xuICByZWRFbmRMb2NhdGlvbjogc3RyaW5nO1xuICAvLyBBZGQgaW5kZXggc2lnbmF0dXJlIHRvIG1ha2UgaXQgY29tcGF0aWJsZSB3aXRoIFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbiAgW2tleTogc3RyaW5nXTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENTVlBhcnNlUmVzdWx0IHtcbiAgaGVhZGVyczogc3RyaW5nW107XG4gIHJvd3M6IFBhcnNlZENzdlJvd1tdO1xuICB0b3RhbFJvd3M6IG51bWJlcjtcbiAgc3VjY2Vzc2Z1bFJvd3M6IG51bWJlcjtcbiAgZXJyb3JzOiBBcnJheTx7IHJvd0luZGV4OiBudW1iZXI7IGVycm9yOiBzdHJpbmc7IHJhd1Jvdzogc3RyaW5nIH0+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIElDU1ZQYXJzZXJTZXJ2aWNlIHtcbiAgcGFyc2VDU1YoY3N2VGV4dDogc3RyaW5nKTogQ1NWUGFyc2VSZXN1bHQ7XG4gIHBhcnNlQ1NWVG9Sb3dzKGNzdlRleHQ6IHN0cmluZyk6IFBhcnNlZENzdlJvd1tdO1xuICB2YWxpZGF0ZUNTVlN0cnVjdHVyZShjc3ZUZXh0OiBzdHJpbmcpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yczogc3RyaW5nW10gfTtcbiAgY3JlYXRlUm93RnJvbVZhbHVlcyhoZWFkZXJzOiBzdHJpbmdbXSwgdmFsdWVzOiBzdHJpbmdbXSk6IFBhcnNlZENzdlJvdztcbn1cblxuZXhwb3J0IGNsYXNzIENTVlBhcnNlclNlcnZpY2UgaW1wbGVtZW50cyBJQ1NWUGFyc2VyU2VydmljZSB7XG4gIC8qKlxuICAgKiBQYXJzZSBDU1YgdGV4dCBpbnRvIHN0cnVjdHVyZWQgcmVzdWx0IHdpdGggZGV0YWlsZWQgZXJyb3IgcmVwb3J0aW5nXG4gICAqL1xuICBwYXJzZUNTVihjc3ZUZXh0OiBzdHJpbmcpOiBDU1ZQYXJzZVJlc3VsdCB7XG4gICAgY29uc3QgcmVzdWx0OiBDU1ZQYXJzZVJlc3VsdCA9IHtcbiAgICAgIGhlYWRlcnM6IFtdLFxuICAgICAgcm93czogW10sXG4gICAgICB0b3RhbFJvd3M6IDAsXG4gICAgICBzdWNjZXNzZnVsUm93czogMCxcbiAgICAgIGVycm9yczogW10sXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBsaW5lcyA9IGNzdlRleHQudHJpbSgpLnNwbGl0KFwiXFxuXCIpO1xuXG4gICAgICBpZiAobGluZXMubGVuZ3RoIDwgMikge1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goe1xuICAgICAgICAgIHJvd0luZGV4OiAwLFxuICAgICAgICAgIGVycm9yOiBcIkNTViBtdXN0IGhhdmUgYXQgbGVhc3QgaGVhZGVyIGFuZCBvbmUgZGF0YSByb3dcIixcbiAgICAgICAgICByYXdSb3c6IGNzdlRleHQsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuXG4gICAgICAvLyBQYXJzZSBoZWFkZXJzXG4gICAgICByZXN1bHQuaGVhZGVycyA9IGxpbmVzWzBdLnNwbGl0KFwiLFwiKS5tYXAoKGgpID0+IGgudHJpbSgpKTtcbiAgICAgIHJlc3VsdC50b3RhbFJvd3MgPSBsaW5lcy5sZW5ndGggLSAxOyAvLyBFeGNsdWRlIGhlYWRlclxuXG4gICAgICAvLyBQYXJzZSBkYXRhIHJvd3NcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBsaW5lc1tpXS5zcGxpdChcIixcIikubWFwKCh2KSA9PiB2LnRyaW0oKSk7XG4gICAgICAgICAgY29uc3Qgcm93ID0gdGhpcy5jcmVhdGVSb3dGcm9tVmFsdWVzKHJlc3VsdC5oZWFkZXJzLCB2YWx1ZXMpO1xuXG4gICAgICAgICAgaWYgKHRoaXMuaXNWYWxpZFJvdyhyb3cpKSB7XG4gICAgICAgICAgICByZXN1bHQucm93cy5wdXNoKHJvdyk7XG4gICAgICAgICAgICByZXN1bHQuc3VjY2Vzc2Z1bFJvd3MrKztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgcm93SW5kZXg6IGksXG4gICAgICAgICAgICAgIGVycm9yOiBcIlJvdyB2YWxpZGF0aW9uIGZhaWxlZCAtIG1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXCIsXG4gICAgICAgICAgICAgIHJhd1JvdzogbGluZXNbaV0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKHtcbiAgICAgICAgICAgIHJvd0luZGV4OiBpLFxuICAgICAgICAgICAgZXJyb3I6XG4gICAgICAgICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIHBhcnNpbmcgZXJyb3JcIixcbiAgICAgICAgICAgIHJhd1JvdzogbGluZXNbaV0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKHtcbiAgICAgICAgcm93SW5kZXg6IDAsXG4gICAgICAgIGVycm9yOiBgQ1NWIHBhcnNpbmcgZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YCxcbiAgICAgICAgcmF3Um93OiBjc3ZUZXh0LnN1YnN0cmluZygwLCAxMDApICsgXCIuLi5cIixcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2ltcGxlIENTViBwYXJzaW5nIHRoYXQgcmV0dXJucyBvbmx5IHN1Y2Nlc3NmdWwgcm93cyAobGVnYWN5IGNvbXBhdGliaWxpdHkpXG4gICAqL1xuICBwYXJzZUNTVlRvUm93cyhjc3ZUZXh0OiBzdHJpbmcpOiBQYXJzZWRDc3ZSb3dbXSB7XG4gICAgY29uc3QgcmVzdWx0ID0gdGhpcy5wYXJzZUNTVihjc3ZUZXh0KTtcblxuICAgIGlmIChyZXN1bHQuZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYOKaoO+4jyBDU1YgcGFyc2luZyBoYWQgJHtyZXN1bHQuZXJyb3JzLmxlbmd0aH0gZXJyb3JzIG91dCBvZiAke3Jlc3VsdC50b3RhbFJvd3N9IHJvd3NgXG4gICAgICApO1xuICAgICAgcmVzdWx0LmVycm9ycy5mb3JFYWNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBSb3cgJHtlcnJvci5yb3dJbmRleH06ICR7ZXJyb3IuZXJyb3J9YCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0LnJvd3M7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgQ1NWIHN0cnVjdHVyZSBiZWZvcmUgcGFyc2luZ1xuICAgKi9cbiAgdmFsaWRhdGVDU1ZTdHJ1Y3R1cmUoY3N2VGV4dDogc3RyaW5nKToge1xuICAgIGlzVmFsaWQ6IGJvb2xlYW47XG4gICAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKCFjc3ZUZXh0IHx8IGNzdlRleHQudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgZXJyb3JzLnB1c2goXCJDU1YgdGV4dCBpcyBlbXB0eVwiKTtcbiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMgfTtcbiAgICB9XG5cbiAgICBjb25zdCBsaW5lcyA9IGNzdlRleHQudHJpbSgpLnNwbGl0KFwiXFxuXCIpO1xuXG4gICAgaWYgKGxpbmVzLmxlbmd0aCA8IDIpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiQ1NWIG11c3QgaGF2ZSBhdCBsZWFzdCBhIGhlYWRlciByb3cgYW5kIG9uZSBkYXRhIHJvd1wiKTtcbiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBoZWFkZXIgc3RydWN0dXJlXG4gICAgY29uc3QgaGVhZGVycyA9IGxpbmVzWzBdLnNwbGl0KFwiLFwiKS5tYXAoKGgpID0+IGgudHJpbSgpKTtcbiAgICBjb25zdCByZXF1aXJlZEhlYWRlcnMgPSBbXCJsZXR0ZXJcIiwgXCJzdGFydFBvc2l0aW9uXCIsIFwiZW5kUG9zaXRpb25cIl07XG5cbiAgICBmb3IgKGNvbnN0IHJlcXVpcmVkIG9mIHJlcXVpcmVkSGVhZGVycykge1xuICAgICAgaWYgKCFoZWFkZXJzLmluY2x1ZGVzKHJlcXVpcmVkKSkge1xuICAgICAgICBlcnJvcnMucHVzaChgTWlzc2luZyByZXF1aXJlZCBoZWFkZXI6ICR7cmVxdWlyZWR9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGNvbnNpc3RlbnQgY29sdW1uIGNvdW50XG4gICAgY29uc3QgaGVhZGVyQ291bnQgPSBoZWFkZXJzLmxlbmd0aDtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IE1hdGgubWluKGxpbmVzLmxlbmd0aCwgMTApOyBpKyspIHtcbiAgICAgIC8vIENoZWNrIGZpcnN0IDEwIHJvd3NcbiAgICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gbGluZXNbaV0uc3BsaXQoXCIsXCIpLmxlbmd0aDtcbiAgICAgIGlmIChjb2x1bW5Db3VudCAhPT0gaGVhZGVyQ291bnQpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgYFJvdyAke2l9IGhhcyAke2NvbHVtbkNvdW50fSBjb2x1bW5zLCBleHBlY3RlZCAke2hlYWRlckNvdW50fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLCBlcnJvcnMgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBQYXJzZWRDc3ZSb3cgZnJvbSBoZWFkZXJzIGFuZCB2YWx1ZXNcbiAgICovXG4gIGNyZWF0ZVJvd0Zyb21WYWx1ZXMoaGVhZGVyczogc3RyaW5nW10sIHZhbHVlczogc3RyaW5nW10pOiBQYXJzZWRDc3ZSb3cge1xuICAgIGNvbnN0IHJvdzogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xuXG4gICAgaGVhZGVycy5mb3JFYWNoKChoZWFkZXIsIGluZGV4KSA9PiB7XG4gICAgICByb3dbaGVhZGVyXSA9IHZhbHVlc1tpbmRleF0gfHwgXCJcIjtcbiAgICB9KTtcblxuICAgIC8vIEVuc3VyZSByZXF1aXJlZCBmaWVsZHMgZXhpc3Qgd2l0aCBkZWZhdWx0c1xuICAgIHJldHVybiB7XG4gICAgICBsZXR0ZXI6IHJvdy5sZXR0ZXIgfHwgXCJcIixcbiAgICAgIHN0YXJ0UG9zaXRpb246IHJvdy5zdGFydFBvc2l0aW9uIHx8IFwiXCIsXG4gICAgICBlbmRQb3NpdGlvbjogcm93LmVuZFBvc2l0aW9uIHx8IFwiXCIsXG4gICAgICB0aW1pbmc6IHJvdy50aW1pbmcgfHwgXCJcIixcbiAgICAgIGRpcmVjdGlvbjogcm93LmRpcmVjdGlvbiB8fCBcIlwiLFxuICAgICAgYmx1ZU1vdGlvblR5cGU6IHJvdy5ibHVlTW90aW9uVHlwZSB8fCBcIlwiLFxuICAgICAgYmx1ZVJvdGF0aW9uRGlyZWN0aW9uOiByb3cuYmx1ZVJvdGF0aW9uRGlyZWN0aW9uIHx8IFwiXCIsXG4gICAgICBibHVlU3RhcnRMb2NhdGlvbjogcm93LmJsdWVTdGFydExvY2F0aW9uIHx8IHJvdy5ibHVlU3RhcnRMb2MgfHwgXCJcIiwgLy8gSGFuZGxlIHZhcmlhdGlvbnNcbiAgICAgIGJsdWVFbmRMb2NhdGlvbjogcm93LmJsdWVFbmRMb2NhdGlvbiB8fCByb3cuYmx1ZWVuZExvY2F0aW9uIHx8IFwiXCIsIC8vIEhhbmRsZSB2YXJpYXRpb25zXG4gICAgICByZWRNb3Rpb25UeXBlOiByb3cucmVkTW90aW9uVHlwZSB8fCBcIlwiLFxuICAgICAgcmVkUm90YXRpb25EaXJlY3Rpb246IHJvdy5yZWRSb3RhdGlvbkRpcmVjdGlvbiB8fCBcIlwiLFxuICAgICAgcmVkU3RhcnRMb2NhdGlvbjogcm93LnJlZFN0YXJ0TG9jYXRpb24gfHwgcm93LnJlZFN0YXJ0TG9jIHx8IFwiXCIsIC8vIEhhbmRsZSB2YXJpYXRpb25zXG4gICAgICByZWRFbmRMb2NhdGlvbjogcm93LnJlZEVuZExvY2F0aW9uIHx8IHJvdy5yZWRlbmRMb2NhdGlvbiB8fCBcIlwiLCAvLyBIYW5kbGUgdmFyaWF0aW9uc1xuICAgICAgLi4ucm93LCAvLyBJbmNsdWRlIGFsbCBvdGhlciBmaWVsZHNcbiAgICB9IGFzIFBhcnNlZENzdlJvdztcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSB0aGF0IGEgcm93IGhhcyByZXF1aXJlZCBmaWVsZHNcbiAgICovXG4gIHByaXZhdGUgaXNWYWxpZFJvdyhyb3c6IFBhcnNlZENzdlJvdyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIShyb3cubGV0dGVyICYmIHJvdy5zdGFydFBvc2l0aW9uICYmIHJvdy5lbmRQb3NpdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbHVtbiBtYXBwaW5nIGZvciBkaWZmZXJlbnQgQ1NWIGZvcm1hdHMgKGlmIG5lZWRlZClcbiAgICovXG4gIGdldENvbHVtbk1hcHBpbmcoaGVhZGVyczogc3RyaW5nW10pOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHtcbiAgICBjb25zdCBtYXBwaW5nOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge307XG5cbiAgICAvLyBIYW5kbGUgY29tbW9uIHZhcmlhdGlvbnMgaW4gY29sdW1uIG5hbWVzXG4gICAgY29uc3QgdmFyaWF0aW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICAgICAgYmx1ZVN0YXJ0TG9jYXRpb246IFtcbiAgICAgICAgXCJibHVlU3RhcnRMb2NhdGlvblwiLFxuICAgICAgICBcImJsdWVTdGFydExvY1wiLFxuICAgICAgICBcImJsdWVfc3RhcnRfbG9jYXRpb25cIixcbiAgICAgIF0sXG4gICAgICBibHVlRW5kTG9jYXRpb246IFtcbiAgICAgICAgXCJibHVlRW5kTG9jYXRpb25cIixcbiAgICAgICAgXCJibHVlZW5kTG9jYXRpb25cIixcbiAgICAgICAgXCJibHVlX2VuZF9sb2NhdGlvblwiLFxuICAgICAgXSxcbiAgICAgIHJlZFN0YXJ0TG9jYXRpb246IFtcbiAgICAgICAgXCJyZWRTdGFydExvY2F0aW9uXCIsXG4gICAgICAgIFwicmVkU3RhcnRMb2NcIixcbiAgICAgICAgXCJyZWRfc3RhcnRfbG9jYXRpb25cIixcbiAgICAgIF0sXG4gICAgICByZWRFbmRMb2NhdGlvbjogW1wicmVkRW5kTG9jYXRpb25cIiwgXCJyZWRlbmRMb2NhdGlvblwiLCBcInJlZF9lbmRfbG9jYXRpb25cIl0sXG4gICAgfTtcblxuICAgIGZvciAoY29uc3QgW3N0YW5kYXJkTmFtZSwgdmFyaWFudHNdIG9mIE9iamVjdC5lbnRyaWVzKHZhcmlhdGlvbnMpKSB7XG4gICAgICBmb3IgKGNvbnN0IHZhcmlhbnQgb2YgdmFyaWFudHMpIHtcbiAgICAgICAgaWYgKGhlYWRlcnMuaW5jbHVkZXModmFyaWFudCkpIHtcbiAgICAgICAgICBtYXBwaW5nW3N0YW5kYXJkTmFtZV0gPSB2YXJpYW50O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hcHBpbmc7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6IkFBd0NPLGFBQU0saUJBQThDO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFJekQsU0FBUyxTQUFpQztBQUN4QyxVQUFNLFNBQXlCO0FBQUEsTUFDN0IsU0FBUyxDQUFDO0FBQUEsTUFDVixNQUFNLENBQUM7QUFBQSxNQUNQLFdBQVc7QUFBQSxNQUNYLGdCQUFnQjtBQUFBLE1BQ2hCLFFBQVEsQ0FBQztBQUFBLElBQ1g7QUFFQSxRQUFJO0FBQ0YsWUFBTSxRQUFRLFFBQVEsS0FBSyxFQUFFLE1BQU0sSUFBSTtBQUV2QyxVQUFJLE1BQU0sU0FBUyxHQUFHO0FBQ3BCLGVBQU8sT0FBTyxLQUFLO0FBQUEsVUFDakIsVUFBVTtBQUFBLFVBQ1YsT0FBTztBQUFBLFVBQ1AsUUFBUTtBQUFBLFFBQ1YsQ0FBQztBQUNELGVBQU87QUFBQSxNQUNUO0FBR0EsYUFBTyxVQUFVLE1BQU0sQ0FBQyxFQUFFLE1BQU0sR0FBRyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDO0FBQ3hELGFBQU8sWUFBWSxNQUFNLFNBQVM7QUFHbEMsZUFBUyxJQUFJLEdBQUcsSUFBSSxNQUFNLFFBQVEsS0FBSztBQUNyQyxZQUFJO0FBQ0Ys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