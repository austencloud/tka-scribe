export class PageFactoryService {
  constructor(layoutService) {
    this.layoutService = layoutService;
  }
  createPages(sequences, options) {
    const validation = this.validatePageOptions(options);
    if (!validation.isValid) {
      throw new Error(
        `Invalid page options: ${validation.errors.map((e) => e.message).join(", ")}`
      );
    }
    const pages = [];
    const { layout, startPageNumber = 1 } = options;
    if (sequences.length === 0 && !options.enableEmptyPages) {
      return pages;
    }
    const pageDimensions = this.layoutService.calculatePageDimensions(
      layout.printConfiguration.paperSize,
      layout.printConfiguration.orientation
    );
    const margins = layout.printConfiguration.margins;
    const contentArea = this.layoutService.calculateContentArea(
      pageDimensions,
      margins
    );
    const cardAspectRatio = this.getCardAspectRatio(sequences[0]) || 0.7;
    let sequencesPerPage = layout.sequencesPerPage;
    if (layout.enableOptimization) {
      const optimalCardsPerPage = this.getOptimalCardsPerPage(
        contentArea,
        cardAspectRatio,
        layout.gridOptions
      );
      sequencesPerPage = optimalCardsPerPage;
    }
    if (sequences.length === 0) {
      const emptyPage = this.createEmptyPage(
        startPageNumber,
        layout,
        options.emptyPageMessage
      );
      return [emptyPage];
    }
    const sequenceGroups = this.distributeSequences(
      sequences,
      sequencesPerPage
    );
    sequenceGroups.forEach((sequenceGroup, index) => {
      const pageNumber = startPageNumber + index;
      const gridConfig = this.calculateGridForSequences(
        sequenceGroup,
        contentArea,
        cardAspectRatio,
        layout
      );
      const page = {
        id: `page-${pageNumber}`,
        sequences: sequenceGroup,
        layout: gridConfig,
        pageNumber,
        paperSize: layout.printConfiguration.paperSize,
        orientation: layout.printConfiguration.orientation,
        margins
      };
      pages.push(page);
    });
    return pages;
  }
  createEmptyPage(pageNumber, layout, _message) {
    const pageDimensions = this.layoutService.calculatePageDimensions(
      layout.printConfiguration.paperSize,
      layout.printConfiguration.orientation
    );
    const margins = layout.printConfiguration.margins;
    const contentArea = this.layoutService.calculateContentArea(
      pageDimensions,
      margins
    );
    const gridConfig = {
      rows: 1,
      columns: 1,
      spacing: 0,
      cardWidth: contentArea.width,
      cardHeight: contentArea.height
    };
    return {
      id: `empty-page-${pageNumber}`,
      sequences: [],
      layout: gridConfig,
      pageNumber,
      paperSize: layout.printConfiguration.paperSize,
      orientation: layout.printConfiguration.orientation,
      margins
    };
  }
  calculatePagesNeeded(sequenceCount, sequencesPerPage) {
    if (sequenceCount === 0) return 1;
    return Math.ceil(sequenceCount / sequencesPerPage);
  }
  distributeSequences(sequences, sequencesPerPage) {
    const groups = [];
    for (let i = 0; i < sequences.length; i += sequencesPerPage) {
      const group = sequences.slice(i, i + sequencesPerPage);
      groups.push(group);
    }
    return groups;
  }
  generatePageNumbers(pageCount, startNumber = 1) {
    return Array.from({ length: pageCount }, (_, index) => startNumber + index);
  }
  validatePageOptions(options) {
    const errors = [];
    const warnings = [];
    const suggestions = [];
    if (options.layout.sequencesPerPage < 1) {
      errors.push({
        code: "INVALID_SEQUENCES_PER_PAGE",
        message: "Sequences per page must be at least 1",
        field: "sequencesPerPage",
        severity: "error"
      });
    }
    if (options.startPageNumber < 1) {
      errors.push({
        code: "INVALID_START_PAGE",
        message: "Start page number must be at least 1",
        field: "startPageNumber",
        severity: "error"
      });
    }
    if (options.sequences.length > 1e3) {
      warnings.push({
        code: "LARGE_SEQUENCE_COUNT",
        message: "Large number of sequences may impact performance",
        suggestion: "Consider processing sequences in batches"
      });
    }
    const layoutValidation = this.layoutService.validateLayout(options.layout);
    errors.push(...layoutValidation.errors);
    warnings.push(...layoutValidation.warnings);
    suggestions.push(...layoutValidation.suggestions);
    return {
      isValid: errors.length === 0,
      errors,
      warnings,
      suggestions
    };
  }
  getOptimalCardsPerPage(contentArea, cardAspectRatio, options = {}) {
    const gridConfig = this.layoutService.calculateOptimalGrid(
      cardAspectRatio,
      contentArea,
      options
    );
    return gridConfig.rows * gridConfig.columns;
  }
  calculateGridForSequences(sequences, contentArea, cardAspectRatio, layout) {
    const targetSequences = Math.max(sequences.length, layout.sequencesPerPage);
    const gridOptions = {
      minCardsPerPage: sequences.length,
      maxCardsPerPage: targetSequences,
      preferSquareLayout: layout.gridOptions.preferSquareLayout || false,
      prioritizeCardSize: layout.gridOptions.prioritizeCardSize || true,
      allowPartialLastPage: layout.gridOptions.allowPartialLastPage || true
    };
    return this.layoutService.calculateOptimalGrid(
      cardAspectRatio,
      contentArea,
      gridOptions
    );
  }
  getCardAspectRatio(_sequence) {
    return 0.7;
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBhZ2VGYWN0b3J5U2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBhZ2UgRmFjdG9yeSBTZXJ2aWNlIEltcGxlbWVudGF0aW9uXG4gKlxuICogSGFuZGxlcyBjcmVhdGlvbiBvZiBwcmludGFibGUgcGFnZXMgd2l0aCBzZXF1ZW5jZSBjYXJkcyBkaXN0cmlidXRlZFxuICogYWNyb3NzIHRoZW0gYWNjb3JkaW5nIHRvIGxheW91dCBzcGVjaWZpY2F0aW9ucy5cbiAqXG4gKiBCYXNlZCBvbiBkZXNrdG9wIGFwcGxpY2F0aW9uJ3MgcHJpbnRhYmxlX2ZhY3RvcnkucHkgZnVuY3Rpb25hbGl0eS5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7XG4gIElQYWdlRmFjdG9yeVNlcnZpY2UsXG4gIElQcmludGFibGVQYWdlTGF5b3V0U2VydmljZSxcbn0gZnJvbSBcIi4uLy4uL2ludGVyZmFjZXMvc2VxdWVuY2UtaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHR5cGUge1xuICBQYWdlLFxuICBSZWN0YW5nbGUsXG4gIEdyaWRDb25maWcsXG4gIFBhZ2VMYXlvdXRDb25maWcsXG4gIFBhZ2VDcmVhdGlvbk9wdGlvbnMsXG4gIExheW91dFZhbGlkYXRpb25SZXN1bHQsXG4gIExheW91dFZhbGlkYXRpb25FcnJvcixcbiAgTGF5b3V0VmFsaWRhdGlvbldhcm5pbmcsXG4gIExheW91dFN1Z2dlc3Rpb24sXG4gIEdyaWRDYWxjdWxhdGlvbk9wdGlvbnMsXG59IGZyb20gXCIuLi8uLi8uLi9kb21haW4vcGFnZUxheW91dFwiO1xuaW1wb3J0IHR5cGUgeyBTZXF1ZW5jZURhdGEgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIFBhZ2VGYWN0b3J5U2VydmljZSBpbXBsZW1lbnRzIElQYWdlRmFjdG9yeVNlcnZpY2Uge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGxheW91dFNlcnZpY2U6IElQcmludGFibGVQYWdlTGF5b3V0U2VydmljZSkge31cblxuICBjcmVhdGVQYWdlcyhzZXF1ZW5jZXM6IFNlcXVlbmNlRGF0YVtdLCBvcHRpb25zOiBQYWdlQ3JlYXRpb25PcHRpb25zKTogUGFnZVtdIHtcbiAgICAvLyBWYWxpZGF0ZSBvcHRpb25zIGZpcnN0XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVQYWdlT3B0aW9ucyhvcHRpb25zKTtcbiAgICBpZiAoIXZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW52YWxpZCBwYWdlIG9wdGlvbnM6ICR7dmFsaWRhdGlvbi5lcnJvcnMubWFwKChlKSA9PiBlLm1lc3NhZ2UpLmpvaW4oXCIsIFwiKX1gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHBhZ2VzOiBQYWdlW10gPSBbXTtcbiAgICBjb25zdCB7IGxheW91dCwgc3RhcnRQYWdlTnVtYmVyID0gMSB9ID0gb3B0aW9ucztcblxuICAgIC8vIElmIG5vIHNlcXVlbmNlcyBhbmQgZW1wdHkgcGFnZXMgbm90IGVuYWJsZWQsIHJldHVybiBlbXB0eSBhcnJheVxuICAgIGlmIChzZXF1ZW5jZXMubGVuZ3RoID09PSAwICYmICFvcHRpb25zLmVuYWJsZUVtcHR5UGFnZXMpIHtcbiAgICAgIHJldHVybiBwYWdlcztcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgbGF5b3V0IGRldGFpbHNcbiAgICBjb25zdCBwYWdlRGltZW5zaW9ucyA9IHRoaXMubGF5b3V0U2VydmljZS5jYWxjdWxhdGVQYWdlRGltZW5zaW9ucyhcbiAgICAgIGxheW91dC5wcmludENvbmZpZ3VyYXRpb24ucGFwZXJTaXplLFxuICAgICAgbGF5b3V0LnByaW50Q29uZmlndXJhdGlvbi5vcmllbnRhdGlvblxuICAgICk7XG4gICAgY29uc3QgbWFyZ2lucyA9IGxheW91dC5wcmludENvbmZpZ3VyYXRpb24ubWFyZ2lucztcbiAgICBjb25zdCBjb250ZW50QXJlYSA9IHRoaXMubGF5b3V0U2VydmljZS5jYWxjdWxhdGVDb250ZW50QXJlYShcbiAgICAgIHBhZ2VEaW1lbnNpb25zLFxuICAgICAgbWFyZ2luc1xuICAgICk7XG5cbiAgICAvLyBHZXQgY2FyZCBhc3BlY3QgcmF0aW8gZnJvbSBmaXJzdCBzZXF1ZW5jZSBvciB1c2UgZGVmYXVsdFxuICAgIGNvbnN0IGNhcmRBc3BlY3RSYXRpbyA9IHRoaXMuZ2V0Q2FyZEFzcGVjdFJhdGlvKHNlcXVlbmNlc1swXSkgfHwgMC43O1xuXG4gICAgLy8gQ2FsY3VsYXRlIG9wdGltYWwgZ3JpZCBpZiBub3QgZml4ZWRcbiAgICBsZXQgc2VxdWVuY2VzUGVyUGFnZSA9IGxheW91dC5zZXF1ZW5jZXNQZXJQYWdlO1xuICAgIGlmIChsYXlvdXQuZW5hYmxlT3B0aW1pemF0aW9uKSB7XG4gICAgICBjb25zdCBvcHRpbWFsQ2FyZHNQZXJQYWdlID0gdGhpcy5nZXRPcHRpbWFsQ2FyZHNQZXJQYWdlKFxuICAgICAgICBjb250ZW50QXJlYSxcbiAgICAgICAgY2FyZEFzcGVjdFJhdGlvLFxuICAgICAgICBsYXlvdXQuZ3JpZE9wdGlvbnNcbiAgICAgICk7XG4gICAgICBzZXF1ZW5jZXNQZXJQYWdlID0gb3B0aW1hbENhcmRzUGVyUGFnZTtcbiAgICB9XG5cbiAgICAvLyBJZiBubyBzZXF1ZW5jZXMsIGNyZWF0ZSBzaW5nbGUgZW1wdHkgcGFnZVxuICAgIGlmIChzZXF1ZW5jZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCBlbXB0eVBhZ2UgPSB0aGlzLmNyZWF0ZUVtcHR5UGFnZShcbiAgICAgICAgc3RhcnRQYWdlTnVtYmVyLFxuICAgICAgICBsYXlvdXQsXG4gICAgICAgIG9wdGlvbnMuZW1wdHlQYWdlTWVzc2FnZVxuICAgICAgKTtcbiAgICAgIHJldHVybiBbZW1wdHlQYWdlXTtcbiAgICB9XG5cbiAgICAvLyBEaXN0cmlidXRlIHNlcXVlbmNlcyBhY3Jvc3MgcGFnZXNcbiAgICBjb25zdCBzZXF1ZW5jZUdyb3VwcyA9IHRoaXMuZGlzdHJpYnV0ZVNlcXVlbmNlcyhcbiAgICAgIHNlcXVlbmNlcyxcbiAgICAgIHNlcXVlbmNlc1BlclBhZ2VcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIHBhZ2VzIGZyb20gc2VxdWVuY2UgZ3JvdXBzXG4gICAgc2VxdWVuY2VHcm91cHMuZm9yRWFjaCgoc2VxdWVuY2VHcm91cCwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IHBhZ2VOdW1iZXIgPSBzdGFydFBhZ2VOdW1iZXIgKyBpbmRleDtcbiAgICAgIGNvbnN0IGdyaWRDb25maWcgPSB0aGlzLmNhbGN1bGF0ZUdyaWRGb3JTZXF1ZW5jZXMoXG4gICAgICAgIHNlcXVlbmNlR3JvdXAsXG4gICAgICAgIGNvbnRlbnRBcmVhLFxuICAgICAgICBjYXJkQXNwZWN0UmF0aW8sXG4gICAgICAgIGxheW91dFxuICAgICAgKTtcblxuICAgICAgY29uc3QgcGFnZTogUGFnZSA9IHtcbiAgICAgICAgaWQ6IGBwYWdlLSR7cGFnZU51bWJlcn1gLFxuICAgICAgICBzZXF1ZW5jZXM6IHNlcXVlbmNlR3JvdXAsXG4gICAgICAgIGxheW91dDogZ3JpZENvbmZpZyxcbiAgICAgICAgcGFnZU51bWJlcixcbiAgICAgICAgcGFwZXJTaXplOiBsYXlvdXQucHJpbnRDb25maWd1cmF0aW9uLnBhcGVyU2l6ZSxcbiAgICAgICAgb3JpZW50YXRpb246IGxheW91dC5wcmludENvbmZpZ3VyYXRpb24ub3JpZW50YXRpb24sXG4gICAgICAgIG1hcmdpbnM6IG1hcmdpbnMsXG4gICAgICB9O1xuXG4gICAgICBwYWdlcy5wdXNoKHBhZ2UpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHBhZ2VzO1xuICB9XG5cbiAgY3JlYXRlRW1wdHlQYWdlKFxuICAgIHBhZ2VOdW1iZXI6IG51bWJlcixcbiAgICBsYXlvdXQ6IFBhZ2VMYXlvdXRDb25maWcsXG4gICAgX21lc3NhZ2U/OiBzdHJpbmdcbiAgKTogUGFnZSB7XG4gICAgY29uc3QgcGFnZURpbWVuc2lvbnMgPSB0aGlzLmxheW91dFNlcnZpY2UuY2FsY3VsYXRlUGFnZURpbWVuc2lvbnMoXG4gICAgICBsYXlvdXQucHJpbnRDb25maWd1cmF0aW9uLnBhcGVyU2l6ZSxcbiAgICAgIGxheW91dC5wcmludENvbmZpZ3VyYXRpb24ub3JpZW50YXRpb25cbiAgICApO1xuICAgIGNvbnN0IG1hcmdpbnMgPSBsYXlvdXQucHJpbnRDb25maWd1cmF0aW9uLm1hcmdpbnM7XG4gICAgY29uc3QgY29udGVudEFyZWEgPSB0aGlzLmxheW91dFNlcnZpY2UuY2FsY3VsYXRlQ29udGVudEFyZWEoXG4gICAgICBwYWdlRGltZW5zaW9ucyxcbiAgICAgIG1hcmdpbnNcbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIG1pbmltYWwgZ3JpZCBjb25maWcgZm9yIGVtcHR5IHBhZ2VcbiAgICBjb25zdCBncmlkQ29uZmlnOiBHcmlkQ29uZmlnID0ge1xuICAgICAgcm93czogMSxcbiAgICAgIGNvbHVtbnM6IDEsXG4gICAgICBzcGFjaW5nOiAwLFxuICAgICAgY2FyZFdpZHRoOiBjb250ZW50QXJlYS53aWR0aCxcbiAgICAgIGNhcmRIZWlnaHQ6IGNvbnRlbnRBcmVhLmhlaWdodCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlkOiBgZW1wdHktcGFnZS0ke3BhZ2VOdW1iZXJ9YCxcbiAgICAgIHNlcXVlbmNlczogW10sXG4gICAgICBsYXlvdXQ6IGdyaWRDb25maWcsXG4gICAgICBwYWdlTnVtYmVyLFxuICAgICAgcGFwZXJTaXplOiBsYXlvdXQucHJpbnRDb25maWd1cmF0aW9uLnBhcGVyU2l6ZSxcbiAgICAgIG9yaWVudGF0aW9uOiBsYXlvdXQucHJpbnRDb25maWd1cmF0aW9uLm9yaWVudGF0aW9uLFxuICAgICAgbWFyZ2luczogbWFyZ2lucyxcbiAgICB9O1xuICB9XG5cbiAgY2FsY3VsYXRlUGFnZXNOZWVkZWQoXG4gICAgc2VxdWVuY2VDb3VudDogbnVtYmVyLFxuICAgIHNlcXVlbmNlc1BlclBhZ2U6IG51bWJlclxuICApOiBudW1iZXIge1xuICAgIGlmIChzZXF1ZW5jZUNvdW50ID09PSAwKSByZXR1cm4gMTsgLy8gQXQgbGVhc3Qgb25lIHBhZ2UgZm9yIGVtcHR5IHN0YXRlXG4gICAgcmV0dXJuIE1hdGguY2VpbChzZXF1ZW5jZUNvdW50IC8gc2VxdWVuY2VzUGVyUGFnZSk7XG4gIH1cblxuICBkaXN0cmlidXRlU2VxdWVuY2VzKFxuICAgIHNlcXVlbmNlczogU2VxdWVuY2VEYXRhW10sXG4gICAgc2VxdWVuY2VzUGVyUGFnZTogbnVtYmVyXG4gICk6IFNlcXVlbmNlRGF0YVtdW10ge1xuICAgIGNvbnN0IGdyb3VwczogU2VxdWVuY2VEYXRhW11bXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZXF1ZW5jZXMubGVuZ3RoOyBpICs9IHNlcXVlbmNlc1BlclBhZ2UpIHtcbiAgICAgIGNvbnN0IGdyb3VwID0gc2VxdWVuY2VzLnNsaWNlKGksIGkgKyBzZXF1ZW5jZXNQZXJQYWdlKTtcbiAgICAgIGdyb3Vwcy5wdXNoKGdyb3VwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3JvdXBzO1xuICB9XG5cbiAgZ2VuZXJhdGVQYWdlTnVtYmVycyhwYWdlQ291bnQ6IG51bWJlciwgc3RhcnROdW1iZXI6IG51bWJlciA9IDEpOiBudW1iZXJbXSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20oeyBsZW5ndGg6IHBhZ2VDb3VudCB9LCAoXywgaW5kZXgpID0+IHN0YXJ0TnVtYmVyICsgaW5kZXgpO1xuICB9XG5cbiAgdmFsaWRhdGVQYWdlT3B0aW9ucyhvcHRpb25zOiBQYWdlQ3JlYXRpb25PcHRpb25zKTogTGF5b3V0VmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgZXJyb3JzOiBMYXlvdXRWYWxpZGF0aW9uRXJyb3JbXSA9IFtdO1xuICAgIGNvbnN0IHdhcm5pbmdzOiBMYXlvdXRWYWxpZGF0aW9uV2FybmluZ1tdID0gW107XG4gICAgY29uc3Qgc3VnZ2VzdGlvbnM6IExheW91dFN1Z2dlc3Rpb25bXSA9IFtdO1xuXG4gICAgLy8gVmFsaWRhdGUgc2VxdWVuY2VzIHBlciBwYWdlXG4gICAgaWYgKG9wdGlvbnMubGF5b3V0LnNlcXVlbmNlc1BlclBhZ2UgPCAxKSB7XG4gICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgIGNvZGU6IFwiSU5WQUxJRF9TRVFVRU5DRVNfUEVSX1BBR0VcIixcbiAgICAgICAgbWVzc2FnZTogXCJTZXF1ZW5jZXMgcGVyIHBhZ2UgbXVzdCBiZSBhdCBsZWFzdCAxXCIsXG4gICAgICAgIGZpZWxkOiBcInNlcXVlbmNlc1BlclBhZ2VcIixcbiAgICAgICAgc2V2ZXJpdHk6IFwiZXJyb3JcIiBhcyBjb25zdCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHN0YXJ0IHBhZ2UgbnVtYmVyXG4gICAgaWYgKG9wdGlvbnMuc3RhcnRQYWdlTnVtYmVyIDwgMSkge1xuICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICBjb2RlOiBcIklOVkFMSURfU1RBUlRfUEFHRVwiLFxuICAgICAgICBtZXNzYWdlOiBcIlN0YXJ0IHBhZ2UgbnVtYmVyIG11c3QgYmUgYXQgbGVhc3QgMVwiLFxuICAgICAgICBmaWVsZDogXCJzdGFydFBhZ2VOdW1iZXJcIixcbiAgICAgICAgc2V2ZXJpdHk6IFwiZXJyb3JcIiBhcyBjb25zdCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHNlcXVlbmNlcyBhcnJheSBpcyB0b28gbGFyZ2VcbiAgICBpZiAob3B0aW9ucy5zZXF1ZW5jZXMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgd2FybmluZ3MucHVzaCh7XG4gICAgICAgIGNvZGU6IFwiTEFSR0VfU0VRVUVOQ0VfQ09VTlRcIixcbiAgICAgICAgbWVzc2FnZTogXCJMYXJnZSBudW1iZXIgb2Ygc2VxdWVuY2VzIG1heSBpbXBhY3QgcGVyZm9ybWFuY2VcIixcbiAgICAgICAgc3VnZ2VzdGlvbjogXCJDb25zaWRlciBwcm9jZXNzaW5nIHNlcXVlbmNlcyBpbiBiYXRjaGVzXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBsYXlvdXQgY29uZmlndXJhdGlvblxuICAgIGNvbnN0IGxheW91dFZhbGlkYXRpb24gPSB0aGlzLmxheW91dFNlcnZpY2UudmFsaWRhdGVMYXlvdXQob3B0aW9ucy5sYXlvdXQpO1xuICAgIGVycm9ycy5wdXNoKC4uLmxheW91dFZhbGlkYXRpb24uZXJyb3JzKTtcbiAgICB3YXJuaW5ncy5wdXNoKC4uLmxheW91dFZhbGlkYXRpb24ud2FybmluZ3MpO1xuICAgIHN1Z2dlc3Rpb25zLnB1c2goLi4ubGF5b3V0VmFsaWRhdGlvbi5zdWdnZXN0aW9ucyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzLFxuICAgICAgc3VnZ2VzdGlvbnMsXG4gICAgfTtcbiAgfVxuXG4gIGdldE9wdGltYWxDYXJkc1BlclBhZ2UoXG4gICAgY29udGVudEFyZWE6IFJlY3RhbmdsZSxcbiAgICBjYXJkQXNwZWN0UmF0aW86IG51bWJlcixcbiAgICBvcHRpb25zOiBQYXJ0aWFsPEdyaWRDYWxjdWxhdGlvbk9wdGlvbnM+ID0ge31cbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCBncmlkQ29uZmlnID0gdGhpcy5sYXlvdXRTZXJ2aWNlLmNhbGN1bGF0ZU9wdGltYWxHcmlkKFxuICAgICAgY2FyZEFzcGVjdFJhdGlvLFxuICAgICAgY29udGVudEFyZWEsXG4gICAgICBvcHRpb25zXG4gICAgKTtcblxuICAgIHJldHVybiBncmlkQ29uZmlnLnJvd3MgKiBncmlkQ29uZmlnLmNvbHVtbnM7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUdyaWRGb3JTZXF1ZW5jZXMoXG4gICAgc2VxdWVuY2VzOiBTZXF1ZW5jZURhdGFbXSxcbiAgICBjb250ZW50QXJlYTogUmVjdGFuZ2xlLFxuICAgIGNhcmRBc3BlY3RSYXRpbzogbnVtYmVyLFxuICAgIGxheW91dDogUGFnZUxheW91dENvbmZpZ1xuICApOiBHcmlkQ29uZmlnIHtcbiAgICAvLyBJZiB3ZSBoYXZlIGEgZml4ZWQgc2VxdWVuY2VzIHBlciBwYWdlLCB1c2UgdGhhdFxuICAgIGNvbnN0IHRhcmdldFNlcXVlbmNlcyA9IE1hdGgubWF4KHNlcXVlbmNlcy5sZW5ndGgsIGxheW91dC5zZXF1ZW5jZXNQZXJQYWdlKTtcblxuICAgIC8vIENhbGN1bGF0ZSBncmlkIGJhc2VkIG9uIGFjdHVhbCBzZXF1ZW5jZSBjb3VudCBvbiB0aGlzIHBhZ2VcbiAgICBjb25zdCBncmlkT3B0aW9uczogR3JpZENhbGN1bGF0aW9uT3B0aW9ucyA9IHtcbiAgICAgIG1pbkNhcmRzUGVyUGFnZTogc2VxdWVuY2VzLmxlbmd0aCxcbiAgICAgIG1heENhcmRzUGVyUGFnZTogdGFyZ2V0U2VxdWVuY2VzLFxuICAgICAgcHJlZmVyU3F1YXJlTGF5b3V0OiBsYXlvdXQuZ3JpZE9wdGlvbnMucHJlZmVyU3F1YXJlTGF5b3V0IHx8IGZhbHNlLFxuICAgICAgcHJpb3JpdGl6ZUNhcmRTaXplOiBsYXlvdXQuZ3JpZE9wdGlvbnMucHJpb3JpdGl6ZUNhcmRTaXplIHx8IHRydWUsXG4gICAgICBhbGxvd1BhcnRpYWxMYXN0UGFnZTogbGF5b3V0LmdyaWRPcHRpb25zLmFsbG93UGFydGlhbExhc3RQYWdlIHx8IHRydWUsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmxheW91dFNlcnZpY2UuY2FsY3VsYXRlT3B0aW1hbEdyaWQoXG4gICAgICBjYXJkQXNwZWN0UmF0aW8sXG4gICAgICBjb250ZW50QXJlYSxcbiAgICAgIGdyaWRPcHRpb25zXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q2FyZEFzcGVjdFJhdGlvKF9zZXF1ZW5jZT86IFNlcXVlbmNlRGF0YSk6IG51bWJlciB7XG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIGRlZmF1bHQgYXNwZWN0IHJhdGlvXG4gICAgLy8gVGhpcyBjb3VsZCBiZSBlbmhhbmNlZCB0byBjYWxjdWxhdGUgYmFzZWQgb24gYWN0dWFsIHNlcXVlbmNlIGNvbnRlbnRcbiAgICAvLyBvciByZWFkIGZyb20gc2VxdWVuY2UgbWV0YWRhdGFcbiAgICByZXR1cm4gMC43OyAvLyBXaWR0aC9IZWlnaHQgcmF0aW8gdHlwaWNhbCBmb3Igc2VxdWVuY2UgY2FyZHNcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUEyQk8sYUFBTSxtQkFBa0Q7QUFBQSxFQUM3RCxZQUE2QixlQUE0QztBQUE1QztBQUFBLEVBQTZDO0FBQUEsRUFFMUUsWUFBWSxXQUEyQixTQUFzQztBQUUzRSxVQUFNLGFBQWEsS0FBSyxvQkFBb0IsT0FBTztBQUNuRCxRQUFJLENBQUMsV0FBVyxTQUFTO0FBQ3ZCLFlBQU0sSUFBSTtBQUFBLFFBQ1IseUJBQXlCLFdBQVcsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxLQUFLLElBQUksQ0FBQztBQUFBLE1BQzdFO0FBQUEsSUFDRjtBQUVBLFVBQU0sUUFBZ0IsQ0FBQztBQUN2QixVQUFNLEVBQUUsUUFBUSxrQkFBa0IsRUFBRSxJQUFJO0FBR3hDLFFBQUksVUFBVSxXQUFXLEtBQUssQ0FBQyxRQUFRLGtCQUFrQjtBQUN2RCxhQUFPO0FBQUEsSUFDVDtBQUdBLFVBQU0saUJBQWlCLEtBQUssY0FBYztBQUFBLE1BQ3hDLE9BQU8sbUJBQW1CO0FBQUEsTUFDMUIsT0FBTyxtQkFBbUI7QUFBQSxJQUM1QjtBQUNBLFVBQU0sVUFBVSxPQUFPLG1CQUFtQjtBQUMxQyxVQUFNLGNBQWMsS0FBSyxjQUFjO0FBQUEsTUFDckM7QUFBQSxNQUNBO0FBQUEsSUFDRjtBQUdBLFVBQU0sa0JBQWtCLEtBQUssbUJBQW1CLFVBQVUsQ0FBQyxDQUFDLEtBQUs7QUFHakUsUUFBSSxtQkFBbUIsT0FBTztBQUM5QixRQUFJLE9BQU8sb0JBQW9CO0FBQzdCLFlBQU0sc0JBQXNCLEtBQUs7QUFBQSxRQUMvQjtBQUFBLFFBQ0E7QUFBQSxRQUNBLE9BQU87QUFBQSxNQUNUO0FBQ0EseUJBQW1CO0FBQUEsSUFDckI7QUFHQSxRQUFJLFVBQVUsV0FBVyxHQUFH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