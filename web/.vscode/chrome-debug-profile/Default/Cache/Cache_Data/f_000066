import { endsWithBeta } from "/src/lib/utils/betaDetection.ts";
export class PictographDataDebugger {
  traces = /* @__PURE__ */ new Map();
  debugEnabled = true;
  /**
   * Enable or disable debugging
   */
  setDebugEnabled(enabled) {
    this.debugEnabled = enabled;
  }
  /**
   * Start a new data flow trace
   */
  startTrace(identifier) {
    if (!this.debugEnabled) return;
    this.traces.set(identifier, []);
  }
  /**
   * Add a step to the trace
   */
  addTraceStep(identifier, step, data, errors, warnings) {
    if (!this.debugEnabled) return;
    const trace = this.traces.get(identifier) || [];
    trace.push({
      step,
      timestamp: Date.now(),
      data: this.sanitizeDataForLogging(data),
      errors,
      warnings
    });
    this.traces.set(identifier, trace);
  }
  /**
   * Get complete debug info for a pictograph
   */
  getPictographDebugInfo(pictographData, csvRow) {
    const identifier = `${pictographData.letter}_${Date.now()}`;
    const endsWithBetaPosition = endsWithBeta(pictographData);
    const hasValidMotionData = this.validateMotionData(pictographData);
    const hasValidPropData = this.validatePropData(pictographData);
    const propLocations = {};
    const motionEndLocations = {};
    if (pictographData.props) {
      Object.entries(pictographData.props).forEach(([color, prop]) => {
        propLocations[color] = prop.location || "unknown";
      });
    }
    if (pictographData.motions) {
      Object.entries(pictographData.motions).forEach(([color, motion]) => {
        motionEndLocations[color] = motion.endLocation || "unknown";
      });
    }
    const debugInfo = {
      letter: pictographData.letter || "unknown",
      gridMode: pictographData.gridMode || "unknown",
      endsWithBeta: endsWithBetaPosition,
      hasValidMotionData,
      hasValidPropData,
      propLocations,
      motionEndLocations,
      dataFlowTrace: this.traces.get(identifier) || [],
      csvRowData: csvRow
    };
    this.logDebugInfo(debugInfo);
    return debugInfo;
  }
  /**
   * Validate motion data completeness
   */
  validateMotionData(pictographData) {
    if (!pictographData.motions) return false;
    return Object.values(pictographData.motions).every(
      (motion) => motion.startLocation && motion.endLocation && motion.motionType !== void 0 && motion.rotationDirection !== void 0
    );
  }
  /**
   * Validate prop data completeness
   */
  validatePropData(pictographData) {
    if (!pictographData.props) return false;
    return Object.values(pictographData.props).every(
      (prop) => prop.location && prop.propType && prop.color && prop.orientation !== void 0
    );
  }
  /**
   * Log comprehensive debug information
   */
  logDebugInfo(debugInfo) {
    if (!this.debugEnabled) return;
    console.group(`ðŸ” Pictograph Debug: ${debugInfo.letter}`);
    console.log("ðŸ“Š Overview:", {
      letter: debugInfo.letter,
      gridMode: debugInfo.gridMode,
      endsWithBeta: debugInfo.endsWithBeta,
      hasValidMotionData: debugInfo.hasValidMotionData,
      hasValidPropData: debugInfo.hasValidPropData
    });
    console.log("ðŸ“ Prop Locations:", debugInfo.propLocations);
    console.log("ðŸŽ¯ Motion End Locations:", debugInfo.motionEndLocations);
    if (debugInfo.csvRowData) {
      console.log("ðŸ“„ CSV Row Data:", debugInfo.csvRowData);
    }
    const mismatches = [];
    Object.entries(debugInfo.propLocations).forEach(([color, propLoc]) => {
      const motionEndLoc = debugInfo.motionEndLocations[color];
      if (propLoc !== motionEndLoc && propLoc !== "unknown" && motionEndLoc !== "unknown") {
        mismatches.push(
          `${color}: prop(${propLoc}) != motion(${motionEndLoc})`
        );
      }
    });
    if (mismatches.length > 0) {
      console.warn("âš ï¸ Location Mismatches:", mismatches);
    }
    if (debugInfo.dataFlowTrace.length > 0) {
      console.log("ðŸ”„ Data Flow Trace:");
      debugInfo.dataFlowTrace.forEach((trace, index) => {
        console.log(`  ${index + 1}. ${trace.step}`, trace.data);
        if (trace.warnings?.length) {
          console.warn(`     Warnings:`, trace.warnings);
        }
        if (trace.errors?.length) {
          console.error(`     Errors:`, trace.errors);
        }
      });
    }
    console.groupEnd();
  }
  /**
   * Sanitize data for logging to prevent circular references
   */
  sanitizeDataForLogging(data) {
    if (data === null || data === void 0) return data;
    if (typeof data === "object") {
      if (Array.isArray(data)) {
        return data.map((item) => this.sanitizeDataForLogging(item));
      }
      const sanitized = {};
      Object.entries(data).forEach(([key, value]) => {
        if (typeof value === "function") {
          sanitized[key] = "[Function]";
        } else if (typeof value === "object" && value !== null) {
          sanitized[key] = JSON.parse(JSON.stringify(value, null, 2));
        } else {
          sanitized[key] = value;
        }
      });
      return sanitized;
    }
    return data;
  }
  /**
   * Clear all traces (useful for cleanup)
   */
  clearTraces() {
    this.traces.clear();
  }
  /**
   * Export debug data as JSON for external analysis
   */
  exportDebugData() {
    const allTraces = {};
    this.traces.forEach((trace, identifier) => {
      allTraces[identifier] = trace;
    });
    return JSON.stringify(
      {
        timestamp: (/* @__PURE__ */ new Date()).toISOString(),
        traces: allTraces
      },
      null,
      2
    );
  }
}
export const pictographDataDebugger = new PictographDataDebugger();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBpY3RvZ3JhcGhEYXRhRGVidWdnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFBpY3RvZ3JhcGhEYXRhRGVidWdnZXIgLSBDb21wcmVoZW5zaXZlIGRlYnVnZ2luZyBmb3IgcGljdG9ncmFwaCBkYXRhIGZsb3dcclxuICpcclxuICogVGhpcyBzZXJ2aWNlIGhlbHBzIHRyYWNlIGRhdGEgZnJvbSBDU1Yg4oaSIFBpY3RvZ3JhcGhEYXRhIOKGkiBQcm9wRGF0YSB0byBpZGVudGlmeVxyXG4gKiB3aGVyZSBkYXRhIGNvcnJ1cHRpb24gb3IgbWlzc2luZyBpbmZvcm1hdGlvbiBvY2N1cnMuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHR5cGUgeyBQaWN0b2dyYXBoRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9QaWN0b2dyYXBoRGF0YVwiO1xyXG5pbXBvcnQgeyBlbmRzV2l0aEJldGEgfSBmcm9tIFwiJGxpYi91dGlscy9iZXRhRGV0ZWN0aW9uXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERhdGFGbG93VHJhY2Uge1xyXG4gIHN0ZXA6IHN0cmluZztcclxuICB0aW1lc3RhbXA6IG51bWJlcjtcclxuICBkYXRhOiB1bmtub3duO1xyXG4gIGVycm9ycz86IHN0cmluZ1tdO1xyXG4gIHdhcm5pbmdzPzogc3RyaW5nW107XHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUGljdG9ncmFwaERlYnVnSW5mbyB7XHJcbiAgbGV0dGVyOiBzdHJpbmc7XHJcbiAgZ3JpZE1vZGU6IHN0cmluZztcclxuICBlbmRzV2l0aEJldGE6IGJvb2xlYW47XHJcbiAgaGFzVmFsaWRNb3Rpb25EYXRhOiBib29sZWFuO1xyXG4gIGhhc1ZhbGlkUHJvcERhdGE6IGJvb2xlYW47XHJcbiAgcHJvcExvY2F0aW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcclxuICBtb3Rpb25FbmRMb2NhdGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XHJcbiAgZGF0YUZsb3dUcmFjZTogRGF0YUZsb3dUcmFjZVtdO1xyXG4gIGNzdlJvd0RhdGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUGljdG9ncmFwaERhdGFEZWJ1Z2dlciB7XHJcbiAgcHJpdmF0ZSB0cmFjZXM6IE1hcDxzdHJpbmcsIERhdGFGbG93VHJhY2VbXT4gPSBuZXcgTWFwKCk7XHJcbiAgcHJpdmF0ZSBkZWJ1Z0VuYWJsZWQgPSB0cnVlO1xyXG5cclxuICAvKipcclxuICAgKiBFbmFibGUgb3IgZGlzYWJsZSBkZWJ1Z2dpbmdcclxuICAgKi9cclxuICBzZXREZWJ1Z0VuYWJsZWQoZW5hYmxlZDogYm9vbGVhbik6IHZvaWQge1xyXG4gICAgdGhpcy5kZWJ1Z0VuYWJsZWQgPSBlbmFibGVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgYSBuZXcgZGF0YSBmbG93IHRyYWNlXHJcbiAgICovXHJcbiAgc3RhcnRUcmFjZShpZGVudGlmaWVyOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5kZWJ1Z0VuYWJsZWQpIHJldHVybjtcclxuICAgIHRoaXMudHJhY2VzLnNldChpZGVudGlmaWVyLCBbXSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgYSBzdGVwIHRvIHRoZSB0cmFjZVxyXG4gICAqL1xyXG4gIGFkZFRyYWNlU3RlcChcclxuICAgIGlkZW50aWZpZXI6IHN0cmluZyxcclxuICAgIHN0ZXA6IHN0cmluZyxcclxuICAgIGRhdGE6IHVua25vd24sXHJcbiAgICBlcnJvcnM/OiBzdHJpbmdbXSxcclxuICAgIHdhcm5pbmdzPzogc3RyaW5nW11cclxuICApOiB2b2lkIHtcclxuICAgIGlmICghdGhpcy5kZWJ1Z0VuYWJsZWQpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCB0cmFjZSA9IHRoaXMudHJhY2VzLmdldChpZGVudGlmaWVyKSB8fCBbXTtcclxuICAgIHRyYWNlLnB1c2goe1xyXG4gICAgICBzdGVwLFxyXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXHJcbiAgICAgIGRhdGE6IHRoaXMuc2FuaXRpemVEYXRhRm9yTG9nZ2luZyhkYXRhKSxcclxuICAgICAgZXJyb3JzLFxyXG4gICAgICB3YXJuaW5ncyxcclxuICAgIH0pO1xyXG4gICAgdGhpcy50cmFjZXMuc2V0KGlkZW50aWZpZXIsIHRyYWNlKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBjb21wbGV0ZSBkZWJ1ZyBpbmZvIGZvciBhIHBpY3RvZ3JhcGhcclxuICAgKi9cclxuICBnZXRQaWN0b2dyYXBoRGVidWdJbmZvKFxyXG4gICAgcGljdG9ncmFwaERhdGE6IFBpY3RvZ3JhcGhEYXRhLFxyXG4gICAgY3N2Um93PzogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxyXG4gICk6IFBpY3RvZ3JhcGhEZWJ1Z0luZm8ge1xyXG4gICAgY29uc3QgaWRlbnRpZmllciA9IGAke3BpY3RvZ3JhcGhEYXRhLmxldHRlcn1fJHtEYXRlLm5vdygpfWA7XHJcblxyXG4gICAgLy8gQW5hbHl6ZSB0aGUgcGljdG9ncmFwaCBkYXRhIHVzaW5nIHRoZSBuZXcgYmV0YSBkZXRlY3Rpb25cclxuICAgIGNvbnN0IGVuZHNXaXRoQmV0YVBvc2l0aW9uID0gZW5kc1dpdGhCZXRhKHBpY3RvZ3JhcGhEYXRhKTtcclxuICAgIGNvbnN0IGhhc1ZhbGlkTW90aW9uRGF0YSA9IHRoaXMudmFsaWRhdGVNb3Rpb25EYXRhKHBpY3RvZ3JhcGhEYXRhKTtcclxuICAgIGNvbnN0IGhhc1ZhbGlkUHJvcERhdGEgPSB0aGlzLnZhbGlkYXRlUHJvcERhdGEocGljdG9ncmFwaERhdGEpO1xyXG5cclxuICAgIC8vIEV4dHJhY3QgbG9jYXRpb24gaW5mb3JtYXRpb25cclxuICAgIGNvbnN0IHByb3BMb2NhdGlvbnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcclxuICAgIGNvbnN0IG1vdGlvbkVuZExvY2F0aW9uczogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHt9O1xyXG5cclxuICAgIGlmIChwaWN0b2dyYXBoRGF0YS5wcm9wcykge1xyXG4gICAgICBPYmplY3QuZW50cmllcyhwaWN0b2dyYXBoRGF0YS5wcm9wcykuZm9yRWFjaCgoW2NvbG9yLCBwcm9wXSkgPT4ge1xyXG4gICAgICAgIHByb3BMb2NhdGlvbnNbY29sb3JdID0gcHJvcC5sb2NhdGlvbiB8fCBcInVua25vd25cIjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMpIHtcclxuICAgICAgT2JqZWN0LmVudHJpZXMocGljdG9ncmFwaERhdGEubW90aW9ucykuZm9yRWFjaCgoW2NvbG9yLCBtb3Rpb25dKSA9PiB7XHJcbiAgICAgICAgbW90aW9uRW5kTG9jYXRpb25zW2NvbG9yXSA9IG1vdGlvbi5lbmRMb2NhdGlvbiB8fCBcInVua25vd25cIjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGVidWdJbmZvOiBQaWN0b2dyYXBoRGVidWdJbmZvID0ge1xyXG4gICAgICBsZXR0ZXI6IHBpY3RvZ3JhcGhEYXRhLmxldHRlciB8fCBcInVua25vd25cIixcclxuICAgICAgZ3JpZE1vZGU6IHBpY3RvZ3JhcGhEYXRhLmdyaWRNb2RlIHx8IFwidW5rbm93blwiLFxyXG4gICAgICBlbmRzV2l0aEJldGE6IGVuZHNXaXRoQmV0YVBvc2l0aW9uLFxyXG4gICAgICBoYXNWYWxpZE1vdGlvbkRhdGEsXHJcbiAgICAgIGhhc1ZhbGlkUHJvcERhdGEsXHJcbiAgICAgIHByb3BMb2NhdGlvbnMsXHJcbiAgICAgIG1vdGlvbkVuZExvY2F0aW9ucyxcclxuICAgICAgZGF0YUZsb3dUcmFjZTogdGhpcy50cmFjZXMuZ2V0KGlkZW50aWZpZXIpIHx8IFtdLFxyXG4gICAgICBjc3ZSb3dEYXRhOiBjc3ZSb3csXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubG9nRGVidWdJbmZvKGRlYnVnSW5mbyk7XHJcbiAgICByZXR1cm4gZGVidWdJbmZvO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGUgbW90aW9uIGRhdGEgY29tcGxldGVuZXNzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB2YWxpZGF0ZU1vdGlvbkRhdGEocGljdG9ncmFwaERhdGE6IFBpY3RvZ3JhcGhEYXRhKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXBpY3RvZ3JhcGhEYXRhLm1vdGlvbnMpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhwaWN0b2dyYXBoRGF0YS5tb3Rpb25zKS5ldmVyeShcclxuICAgICAgKG1vdGlvbikgPT5cclxuICAgICAgICBtb3Rpb24uc3RhcnRMb2NhdGlvbiAmJlxyXG4gICAgICAgIG1vdGlvbi5lbmRMb2NhdGlvbiAmJlxyXG4gICAgICAgIG1vdGlvbi5tb3Rpb25UeXBlICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICBtb3Rpb24ucm90YXRpb25EaXJlY3Rpb24gIT09IHVuZGVmaW5lZFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlIHByb3AgZGF0YSBjb21wbGV0ZW5lc3NcclxuICAgKi9cclxuICBwcml2YXRlIHZhbGlkYXRlUHJvcERhdGEocGljdG9ncmFwaERhdGE6IFBpY3RvZ3JhcGhEYXRhKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoIXBpY3RvZ3JhcGhEYXRhLnByb3BzKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXMocGljdG9ncmFwaERhdGEucHJvcHMpLmV2ZXJ5KFxyXG4gICAgICAocHJvcCkgPT5cclxuICAgICAgICBwcm9wLmxvY2F0aW9uICYmXHJcbiAgICAgICAgcHJvcC5wcm9wVHlwZSAmJlxyXG4gICAgICAgIHByb3AuY29sb3IgJiZcclxuICAgICAgICBwcm9wLm9yaWVudGF0aW9uICE9PSB1bmRlZmluZWRcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBMb2cgY29tcHJlaGVuc2l2ZSBkZWJ1ZyBpbmZvcm1hdGlvblxyXG4gICAqL1xyXG4gIHByaXZhdGUgbG9nRGVidWdJbmZvKGRlYnVnSW5mbzogUGljdG9ncmFwaERlYnVnSW5mbyk6IHZvaWQge1xyXG4gICAgaWYgKCF0aGlzLmRlYnVnRW5hYmxlZCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnNvbGUuZ3JvdXAoYPCflI0gUGljdG9ncmFwaCBEZWJ1ZzogJHtkZWJ1Z0luZm8ubGV0dGVyfWApO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwi8J+TiiBPdmVydmlldzpcIiwge1xyXG4gICAgICBsZXR0ZXI6IGRlYnVnSW5mby5sZXR0ZXIsXHJcbiAgICAgIGdyaWRNb2RlOiBkZWJ1Z0luZm8uZ3JpZE1vZGUsXHJcbiAgICAgIGVuZHNXaXRoQmV0YTogZGVidWdJbmZvLmVuZHNXaXRoQmV0YSxcclxuICAgICAgaGFzVmFsaWRNb3Rpb25EYXRhOiBkZWJ1Z0luZm8uaGFzVmFsaWRNb3Rpb25EYXRhLFxyXG4gICAgICBoYXNWYWxpZFByb3BEYXRhOiBkZWJ1Z0luZm8uaGFzVmFsaWRQcm9wRGF0YSxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKFwi8J+TjSBQcm9wIExvY2F0aW9uczpcIiwgZGVidWdJbmZvLnByb3BMb2NhdGlvbnMpO1xyXG4gICAgY29uc29sZS5sb2coXCLwn46vIE1vdGlvbiBFbmQgTG9jYXRpb25zOlwiLCBkZWJ1Z0luZm8ubW90aW9uRW5kTG9jYXRpb25zKTtcclxuXHJcbiAgICBpZiAoZGVidWdJbmZvLmNzdlJvd0RhdGEpIHtcclxuICAgICAgY29uc29sZS5sb2coXCLwn5OEIENTViBSb3cgRGF0YTpcIiwgZGVidWdJbmZvLmNzdlJvd0RhdGEpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBkYXRhIG1pc21hdGNoZXNcclxuICAgIGNvbnN0IG1pc21hdGNoZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBPYmplY3QuZW50cmllcyhkZWJ1Z0luZm8ucHJvcExvY2F0aW9ucykuZm9yRWFjaCgoW2NvbG9yLCBwcm9wTG9jXSkgPT4ge1xyXG4gICAgICBjb25zdCBtb3Rpb25FbmRMb2MgPSBkZWJ1Z0luZm8ubW90aW9uRW5kTG9jYXRpb25zW2NvbG9yXTtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIHByb3BMb2MgIT09IG1vdGlvbkVuZExvYyAmJlxyXG4gICAgICAgIHByb3BMb2MgIT09IFwidW5rbm93blwiICYmXHJcbiAgICAgICAgbW90aW9uRW5kTG9jICE9PSBcInVua25vd25cIlxyXG4gICAgICApIHtcclxuICAgICAgICBtaXNtYXRjaGVzLnB1c2goXHJcbiAgICAgICAgICBgJHtjb2xvcn06IHByb3AoJHtwcm9wTG9jfSkgIT0gbW90aW9uKCR7bW90aW9uRW5kTG9jfSlgXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKG1pc21hdGNoZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICBjb25zb2xlLndhcm4oXCLimqDvuI8gTG9jYXRpb24gTWlzbWF0Y2hlczpcIiwgbWlzbWF0Y2hlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRlYnVnSW5mby5kYXRhRmxvd1RyYWNlLmxlbmd0aCA+IDApIHtcclxuICAgICAgY29uc29sZS5sb2coXCLwn5SEIERhdGEgRmxvdyBUcmFjZTpcIik7XHJcbiAgICAgIGRlYnVnSW5mby5kYXRhRmxvd1RyYWNlLmZvckVhY2goKHRyYWNlLCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGAgICR7aW5kZXggKyAxfS4gJHt0cmFjZS5zdGVwfWAsIHRyYWNlLmRhdGEpO1xyXG4gICAgICAgIGlmICh0cmFjZS53YXJuaW5ncz8ubGVuZ3RoKSB7XHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oYCAgICAgV2FybmluZ3M6YCwgdHJhY2Uud2FybmluZ3MpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHJhY2UuZXJyb3JzPy5sZW5ndGgpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYCAgICAgRXJyb3JzOmAsIHRyYWNlLmVycm9ycyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zb2xlLmdyb3VwRW5kKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTYW5pdGl6ZSBkYXRhIGZvciBsb2dnaW5nIHRvIHByZXZlbnQgY2lyY3VsYXIgcmVmZXJlbmNlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc2FuaXRpemVEYXRhRm9yTG9nZ2luZyhkYXRhOiB1bmtub3duKTogdW5rbm93biB7XHJcbiAgICBpZiAoZGF0YSA9PT0gbnVsbCB8fCBkYXRhID09PSB1bmRlZmluZWQpIHJldHVybiBkYXRhO1xyXG5cclxuICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSkge1xyXG4gICAgICAgIHJldHVybiBkYXRhLm1hcCgoaXRlbSkgPT4gdGhpcy5zYW5pdGl6ZURhdGFGb3JMb2dnaW5nKGl0ZW0pKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3Qgc2FuaXRpemVkOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IHt9O1xyXG4gICAgICBPYmplY3QuZW50cmllcyhkYXRhKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgIHNhbml0aXplZFtrZXldID0gXCJbRnVuY3Rpb25dXCI7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwpIHtcclxuICAgICAgICAgIC8vIExpbWl0IGRlcHRoIHRvIHByZXZlbnQgY2lyY3VsYXIgcmVmZXJlbmNlc1xyXG4gICAgICAgICAgc2FuaXRpemVkW2tleV0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHZhbHVlLCBudWxsLCAyKSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHNhbml0aXplZFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHNhbml0aXplZDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENsZWFyIGFsbCB0cmFjZXMgKHVzZWZ1bCBmb3IgY2xlYW51cClcclxuICAgKi9cclxuICBjbGVhclRyYWNlcygpOiB2b2lkIHtcclxuICAgIHRoaXMudHJhY2VzLmNsZWFyKCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBFeHBvcnQgZGVidWcgZGF0YSBhcyBKU09OIGZvciBleHRlcm5hbCBhbmFseXNpc1xyXG4gICAqL1xyXG4gIGV4cG9ydERlYnVnRGF0YSgpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgYWxsVHJhY2VzOiBSZWNvcmQ8c3RyaW5nLCBEYXRhRmxvd1RyYWNlW10+ID0ge307XHJcbiAgICB0aGlzLnRyYWNlcy5mb3JFYWNoKCh0cmFjZSwgaWRlbnRpZmllcikgPT4ge1xyXG4gICAgICBhbGxUcmFjZXNbaWRlbnRpZmllcl0gPSB0cmFjZTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShcclxuICAgICAge1xyXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxyXG4gICAgICAgIHRyYWNlczogYWxsVHJhY2VzLFxyXG4gICAgICB9LFxyXG4gICAgICBudWxsLFxyXG4gICAgICAyXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuLy8gU2luZ2xldG9uIGluc3RhbmNlIGZvciBnbG9iYWwgZGVidWdnaW5nXHJcbmV4cG9ydCBjb25zdCBwaWN0b2dyYXBoRGF0YURlYnVnZ2VyID0gbmV3IFBpY3RvZ3JhcGhEYXRhRGVidWdnZXIoKTtcclxuIl0sIm1hcHBpbmdzIjoiQUFRQSxTQUFTLG9CQUFvQjtBQXNCdEIsYUFB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