import { GridMode, MotionType } from "/src/lib/domain/enums.ts";
import { ArrowAdjustmentCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowAdjustmentCalculator.ts";
import { ArrowLocationCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowLocationCalculator.ts";
import { ArrowRotationCalculator } from "/src/lib/services/positioning/arrows/calculation/ArrowRotationCalculator.ts";
import { DashLocationCalculator } from "/src/lib/services/positioning/arrows/calculation/DashLocationCalculator.ts";
import { ArrowCoordinateSystemService } from "/src/lib/services/positioning/arrows/coordinate_system/ArrowCoordinateSystemService.ts";
import { ArrowPositionCalculator } from "/src/lib/services/positioning/arrows/orchestration/ArrowPositionCalculator.ts";
import { DefaultPlacementService } from "/src/lib/services/positioning/arrows/placement/DefaultPlacementService.ts";
import { SpecialPlacementService } from "/src/lib/services/positioning/arrows/placement/SpecialPlacementService.ts";
import {
  DirectionalTupleCalculator,
  DirectionalTupleProcessor,
  QuadrantIndexCalculator
} from "/src/lib/services/positioning/arrows/processors/DirectionalTupleProcessor.ts";
export class PositioningServiceFactory {
  /**
   * Factory for creating the complete positioning service ecosystem.
   *
   * Creates all services with proper dependency injection and ensures
   * they are wired together correctly for optimal positioning accuracy.
   */
  static instance;
  // Singleton services (shared across all arrows)
  dashLocationCalculator;
  coordinateSystemService;
  specialPlacementService;
  defaultPlacementService;
  directionalTupleProcessor;
  /**
   * Get the singleton instance of the positioning service factory.
   */
  static getInstance() {
    if (!PositioningServiceFactory.instance) {
      PositioningServiceFactory.instance = new PositioningServiceFactory();
    }
    return PositioningServiceFactory.instance;
  }
  createLocationCalculator() {
    if (!this.dashLocationCalculator) {
      this.dashLocationCalculator = this.createDashLocationCalculator();
    }
    return new ArrowLocationCalculator(this.dashLocationCalculator);
  }
  createRotationCalculator() {
    return new ArrowRotationCalculator();
  }
  createAdjustmentCalculator() {
    if (!this.specialPlacementService) {
      this.specialPlacementService = new SpecialPlacementService();
    }
    if (!this.defaultPlacementService) {
      this.defaultPlacementService = new DefaultPlacementService();
    }
    if (!this.directionalTupleProcessor) {
      this.directionalTupleProcessor = this.createDirectionalTupleProcessor();
    }
    return new ArrowAdjustmentCalculator({
      specialPlacementService: this.specialPlacementService,
      defaultPlacementService: this.defaultPlacementService,
      tupleProcessor: this.directionalTupleProcessor
    });
  }
  createCoordinateSystemService() {
    if (!this.coordinateSystemService) {
      this.coordinateSystemService = new ArrowCoordinateSystemService();
    }
    return this.coordinateSystemService;
  }
  createDashLocationCalculator() {
    if (!this.dashLocationCalculator) {
      this.dashLocationCalculator = new DashLocationCalculator();
    }
    return this.dashLocationCalculator;
  }
  createDirectionalTupleProcessor() {
    if (!this.directionalTupleProcessor) {
      const directionalTupleCalculator = new DirectionalTupleCalculator();
      const quadrantIndexCalculator = new QuadrantIndexCalculator();
      this.directionalTupleProcessor = new DirectionalTupleProcessor(
        directionalTupleCalculator,
        quadrantIndexCalculator
      );
    }
    return this.directionalTupleProcessor;
  }
  createPositioningOrchestrator() {
    const locationCalculator = this.createLocationCalculator();
    const rotationCalculator = this.createRotationCalculator();
    const adjustmentCalculator = this.createAdjustmentCalculator();
    const coordinateSystemService = this.createCoordinateSystemService();
    return new ArrowPositionCalculator(
      locationCalculator,
      rotationCalculator,
      adjustmentCalculator,
      coordinateSystemService
    );
  }
  /**
   * Create a complete positioning pipeline for use in services.
   * Returns all the key services needed for positioning operations.
   */
  createPositioningPipeline() {
    return {
      locationCalculator: this.createLocationCalculator(),
      rotationCalculator: this.createRotationCalculator(),
      adjustmentCalculator: this.createAdjustmentCalculator(),
      coordinateSystemService: this.createCoordinateSystemService(),
      orchestrator: this.createPositioningOrchestrator()
    };
  }
  /**
   * Reset all singleton services (useful for testing).
   */
  resetServices() {
    this.dashLocationCalculator = void 0;
    this.coordinateSystemService = void 0;
    this.specialPlacementService = void 0;
    this.defaultPlacementService = void 0;
    this.directionalTupleProcessor = void 0;
  }
  /**
   * Pre-warm all services by creating them in advance.
   * Useful for ensuring consistent performance.
   */
  async preWarmServices() {
    console.log("Pre-warming positioning services...");
    this.createLocationCalculator();
    this.createRotationCalculator();
    this.createCoordinateSystemService();
    this.createDirectionalTupleProcessor();
    if (!this.defaultPlacementService) {
      this.defaultPlacementService = new DefaultPlacementService();
    }
    if (!this.defaultPlacementService.isLoaded()) {
      try {
        await this.defaultPlacementService.debugAvailableKeys(
          MotionType.PRO,
          GridMode.DIAMOND
        );
        console.log("✅ Positioning services pre-warmed successfully");
      } catch (error) {
        console.warn("⚠️ Some positioning services failed to pre-warm:", error);
      }
    }
  }
}
export function getPositioningServiceFactory() {
  return PositioningServiceFactory.getInstance();
}
export function createPositioningOrchestrator() {
  return getPositioningServiceFactory().createPositioningOrchestrator();
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQb3NpdGlvbmluZyBTZXJ2aWNlIEZhY3RvcnlcbiAqXG4gKiBGYWN0b3J5IGZvciBjcmVhdGluZyBhbmQgd2lyaW5nIHVwIGFsbCBwb3NpdGlvbmluZyBzZXJ2aWNlcyB3aXRoIHByb3BlciBkZXBlbmRlbmNpZXMuXG4gKiBQcm92aWRlcyBhIGNlbnRyYWxpemVkIHdheSB0byBjcmVhdGUgdGhlIGNvbXBsZXRlIHBvc2l0aW9uaW5nIHBpcGVsaW5lLlxuICovXG5cbmltcG9ydCB7IEdyaWRNb2RlLCBNb3Rpb25UeXBlIH0gZnJvbSBcIiRsaWIvZG9tYWluL2VudW1zXCI7XG5pbXBvcnQgdHlwZSB7XG4gIElBcnJvd0FkanVzdG1lbnRDYWxjdWxhdG9yLFxuICBJQXJyb3dDb29yZGluYXRlU3lzdGVtU2VydmljZSxcbiAgSUFycm93TG9jYXRpb25DYWxjdWxhdG9yLFxuICBJQXJyb3dQb3NpdGlvbmluZ09yY2hlc3RyYXRvcixcbiAgSUFycm93Um90YXRpb25DYWxjdWxhdG9yLFxuICBJRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcixcbiAgSVBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnksXG59IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmdcIjtcbmltcG9ydCB7IEFycm93QWRqdXN0bWVudENhbGN1bGF0b3IgfSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9jYWxjdWxhdGlvbi9BcnJvd0FkanVzdG1lbnRDYWxjdWxhdG9yXCI7XG5pbXBvcnQgeyBBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvciB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL2NhbGN1bGF0aW9uL0Fycm93TG9jYXRpb25DYWxjdWxhdG9yXCI7XG5pbXBvcnQgeyBBcnJvd1JvdGF0aW9uQ2FsY3VsYXRvciB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL2NhbGN1bGF0aW9uL0Fycm93Um90YXRpb25DYWxjdWxhdG9yXCI7XG5pbXBvcnQgeyBEYXNoTG9jYXRpb25DYWxjdWxhdG9yIH0gZnJvbSBcIiRzZXJ2aWNlcy9wb3NpdGlvbmluZy9hcnJvd3MvY2FsY3VsYXRpb24vRGFzaExvY2F0aW9uQ2FsY3VsYXRvclwiO1xuaW1wb3J0IHsgQXJyb3dDb29yZGluYXRlU3lzdGVtU2VydmljZSB9IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL2Nvb3JkaW5hdGVfc3lzdGVtL0Fycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2VcIjtcbmltcG9ydCB7IEFycm93UG9zaXRpb25DYWxjdWxhdG9yIH0gZnJvbSBcIiRzZXJ2aWNlcy9wb3NpdGlvbmluZy9hcnJvd3Mvb3JjaGVzdHJhdGlvbi9BcnJvd1Bvc2l0aW9uQ2FsY3VsYXRvclwiO1xuaW1wb3J0IHsgRGVmYXVsdFBsYWNlbWVudFNlcnZpY2UgfSBmcm9tIFwiJHNlcnZpY2VzL3Bvc2l0aW9uaW5nL2Fycm93cy9wbGFjZW1lbnQvRGVmYXVsdFBsYWNlbWVudFNlcnZpY2VcIjtcbmltcG9ydCB7IFNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlIH0gZnJvbSBcIiRzZXJ2aWNlcy9wb3NpdGlvbmluZy9hcnJvd3MvcGxhY2VtZW50L1NwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlXCI7XG5pbXBvcnQge1xuICBEaXJlY3Rpb25hbFR1cGxlQ2FsY3VsYXRvcixcbiAgRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcixcbiAgUXVhZHJhbnRJbmRleENhbGN1bGF0b3IsXG59IGZyb20gXCIkc2VydmljZXMvcG9zaXRpb25pbmcvYXJyb3dzL3Byb2Nlc3NvcnMvRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvclwiO1xuXG5leHBvcnQgY2xhc3MgUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSBpbXBsZW1lbnRzIElQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5IHtcbiAgLyoqXG4gICAqIEZhY3RvcnkgZm9yIGNyZWF0aW5nIHRoZSBjb21wbGV0ZSBwb3NpdGlvbmluZyBzZXJ2aWNlIGVjb3N5c3RlbS5cbiAgICpcbiAgICogQ3JlYXRlcyBhbGwgc2VydmljZXMgd2l0aCBwcm9wZXIgZGVwZW5kZW5jeSBpbmplY3Rpb24gYW5kIGVuc3VyZXNcbiAgICogdGhleSBhcmUgd2lyZWQgdG9nZXRoZXIgY29ycmVjdGx5IGZvciBvcHRpbWFsIHBvc2l0aW9uaW5nIGFjY3VyYWN5LlxuICAgKi9cblxuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeTtcblxuICAvLyBTaW5nbGV0b24gc2VydmljZXMgKHNoYXJlZCBhY3Jvc3MgYWxsIGFycm93cylcbiAgcHJpdmF0ZSBkYXNoTG9jYXRpb25DYWxjdWxhdG9yOiBEYXNoTG9jYXRpb25DYWxjdWxhdG9yIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGNvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlOiBJQXJyb3dDb29yZGluYXRlU3lzdGVtU2VydmljZSB8IHVuZGVmaW5lZDtcbiAgcHJpdmF0ZSBzcGVjaWFsUGxhY2VtZW50U2VydmljZTogU3BlY2lhbFBsYWNlbWVudFNlcnZpY2UgfCB1bmRlZmluZWQ7XG4gIHByaXZhdGUgZGVmYXVsdFBsYWNlbWVudFNlcnZpY2U6IERlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIGRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3I6IElEaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHNpbmdsZXRvbiBpbnN0YW5jZSBvZiB0aGUgcG9zaXRpb25pbmcgc2VydmljZSBmYWN0b3J5LlxuICAgKi9cbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IFBvc2l0aW9uaW5nU2VydmljZUZhY3Rvcnkge1xuICAgIGlmICghUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeS5pbnN0YW5jZSkge1xuICAgICAgUG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeS5pbnN0YW5jZSA9IG5ldyBQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5KCk7XG4gICAgfVxuICAgIHJldHVybiBQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5Lmluc3RhbmNlO1xuICB9XG5cbiAgY3JlYXRlTG9jYXRpb25DYWxjdWxhdG9yKCk6IElBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFycm93IGxvY2F0aW9uIGNhbGN1bGF0b3Igd2l0aCBkYXNoIGxvY2F0aW9uIHNlcnZpY2UgZGVwZW5kZW5jeS5cbiAgICAgKi9cbiAgICBpZiAoIXRoaXMuZGFzaExvY2F0aW9uQ2FsY3VsYXRvcikge1xuICAgICAgdGhpcy5kYXNoTG9jYXRpb25DYWxjdWxhdG9yID0gdGhpcy5jcmVhdGVEYXNoTG9jYXRpb25DYWxjdWxhdG9yKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBBcnJvd0xvY2F0aW9uQ2FsY3VsYXRvcih0aGlzLmRhc2hMb2NhdGlvbkNhbGN1bGF0b3IpO1xuICB9XG5cbiAgY3JlYXRlUm90YXRpb25DYWxjdWxhdG9yKCk6IElBcnJvd1JvdGF0aW9uQ2FsY3VsYXRvciB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGFycm93IHJvdGF0aW9uIGNhbGN1bGF0b3IgKG5vIGRlcGVuZGVuY2llcykuXG4gICAgICovXG4gICAgcmV0dXJuIG5ldyBBcnJvd1JvdGF0aW9uQ2FsY3VsYXRvcigpO1xuICB9XG5cbiAgY3JlYXRlQWRqdXN0bWVudENhbGN1bGF0b3IoKTogSUFycm93QWRqdXN0bWVudENhbGN1bGF0b3Ige1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhcnJvdyBhZGp1c3RtZW50IGNhbGN1bGF0b3Igd2l0aCBwbGFjZW1lbnQgc2VydmljZXMgYW5kIHR1cGxlIHByb2Nlc3Nvci5cbiAgICAgKiBOb3cgdXNlcyBjb25zb2xpZGF0ZWQgc2VydmljZSB0aGF0IGNvbWJpbmVzIGxvb2t1cCBhbmQgY2FsY3VsYXRpb24gbG9naWMuXG4gICAgICovXG4gICAgaWYgKCF0aGlzLnNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlKSB7XG4gICAgICB0aGlzLnNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlID0gbmV3IFNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlKCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmRlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlKSB7XG4gICAgICB0aGlzLmRlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlID0gbmV3IERlZmF1bHRQbGFjZW1lbnRTZXJ2aWNlKCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IpIHtcbiAgICAgIHRoaXMuZGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvciA9IHRoaXMuY3JlYXRlRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcigpO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBjb25zb2xpZGF0ZWQgc2VydmljZSB3aXRoIGFsbCBkZXBlbmRlbmNpZXNcbiAgICByZXR1cm4gbmV3IEFycm93QWRqdXN0bWVudENhbGN1bGF0b3Ioe1xuICAgICAgc3BlY2lhbFBsYWNlbWVudFNlcnZpY2U6IHRoaXMuc3BlY2lhbFBsYWNlbWVudFNlcnZpY2UsXG4gICAgICBkZWZhdWx0UGxhY2VtZW50U2VydmljZTogdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZSxcbiAgICAgIHR1cGxlUHJvY2Vzc29yOiB0aGlzLmRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVDb29yZGluYXRlU3lzdGVtU2VydmljZSgpOiBJQXJyb3dDb29yZGluYXRlU3lzdGVtU2VydmljZSB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGNvb3JkaW5hdGUgc3lzdGVtIHNlcnZpY2UgKHNpbmdsZXRvbiBmb3IgY29uc2lzdGVuY3kpLlxuICAgICAqL1xuICAgIGlmICghdGhpcy5jb29yZGluYXRlU3lzdGVtU2VydmljZSkge1xuICAgICAgdGhpcy5jb29yZGluYXRlU3lzdGVtU2VydmljZSA9IG5ldyBBcnJvd0Nvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlKCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlO1xuICB9XG5cbiAgY3JlYXRlRGFzaExvY2F0aW9uQ2FsY3VsYXRvcigpOiBEYXNoTG9jYXRpb25DYWxjdWxhdG9yIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGUgZGFzaCBsb2NhdGlvbiBjYWxjdWxhdG9yIChzaW5nbGV0b24gZm9yIGNvbnNpc3RlbmN5KS5cbiAgICAgKi9cbiAgICBpZiAoIXRoaXMuZGFzaExvY2F0aW9uQ2FsY3VsYXRvcikge1xuICAgICAgdGhpcy5kYXNoTG9jYXRpb25DYWxjdWxhdG9yID0gbmV3IERhc2hMb2NhdGlvbkNhbGN1bGF0b3IoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZGFzaExvY2F0aW9uQ2FsY3VsYXRvcjtcbiAgfVxuXG4gIGNyZWF0ZURpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IoKTogSURpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3Ige1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBkaXJlY3Rpb25hbCB0dXBsZSBwcm9jZXNzb3Igd2l0aCBkZXBlbmRlbmNpZXMuXG4gICAgICovXG4gICAgaWYgKCF0aGlzLmRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IpIHtcbiAgICAgIGNvbnN0IGRpcmVjdGlvbmFsVHVwbGVDYWxjdWxhdG9yID0gbmV3IERpcmVjdGlvbmFsVHVwbGVDYWxjdWxhdG9yKCk7XG4gICAgICBjb25zdCBxdWFkcmFudEluZGV4Q2FsY3VsYXRvciA9IG5ldyBRdWFkcmFudEluZGV4Q2FsY3VsYXRvcigpO1xuXG4gICAgICB0aGlzLmRpcmVjdGlvbmFsVHVwbGVQcm9jZXNzb3IgPSBuZXcgRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcihcbiAgICAgICAgZGlyZWN0aW9uYWxUdXBsZUNhbGN1bGF0b3IsXG4gICAgICAgIHF1YWRyYW50SW5kZXhDYWxjdWxhdG9yXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yO1xuICB9XG5cbiAgY3JlYXRlUG9zaXRpb25pbmdPcmNoZXN0cmF0b3IoKTogSUFycm93UG9zaXRpb25pbmdPcmNoZXN0cmF0b3Ige1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgY29tcGxldGUgcG9zaXRpb25pbmcgb3JjaGVzdHJhdG9yIHdpdGggYWxsIGRlcGVuZGVuY2llcy5cbiAgICAgKiBUaGlzIGlzIHRoZSBtYWluIHNlcnZpY2UgdGhhdCBjb29yZGluYXRlcyBhbGwgcG9zaXRpb25pbmcgY2FsY3VsYXRpb25zLlxuICAgICAqL1xuICAgIGNvbnN0IGxvY2F0aW9uQ2FsY3VsYXRvciA9IHRoaXMuY3JlYXRlTG9jYXRpb25DYWxjdWxhdG9yKCk7XG4gICAgY29uc3Qgcm90YXRpb25DYWxjdWxhdG9yID0gdGhpcy5jcmVhdGVSb3RhdGlvbkNhbGN1bGF0b3IoKTtcbiAgICBjb25zdCBhZGp1c3RtZW50Q2FsY3VsYXRvciA9IHRoaXMuY3JlYXRlQWRqdXN0bWVudENhbGN1bGF0b3IoKTtcbiAgICBjb25zdCBjb29yZGluYXRlU3lzdGVtU2VydmljZSA9IHRoaXMuY3JlYXRlQ29vcmRpbmF0ZVN5c3RlbVNlcnZpY2UoKTtcblxuICAgIHJldHVybiBuZXcgQXJyb3dQb3NpdGlvbkNhbGN1bGF0b3IoXG4gICAgICBsb2NhdGlvbkNhbGN1bGF0b3IsXG4gICAgICByb3RhdGlvbkNhbGN1bGF0b3IsXG4gICAgICBhZGp1c3RtZW50Q2FsY3VsYXRvcixcbiAgICAgIGNvb3JkaW5hdGVTeXN0ZW1TZXJ2aWNlXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBjb21wbGV0ZSBwb3NpdGlvbmluZyBwaXBlbGluZSBmb3IgdXNlIGluIHNlcnZpY2VzLlxuICAgKiBSZXR1cm5zIGFsbCB0aGUga2V5IHNlcnZpY2VzIG5lZWRlZCBmb3IgcG9zaXRpb25pbmcgb3BlcmF0aW9ucy5cbiAgICovXG4gIGNyZWF0ZVBvc2l0aW9uaW5nUGlwZWxpbmUoKToge1xuICAgIGxvY2F0aW9uQ2FsY3VsYXRvcjogSUFycm93TG9jYXRpb25DYWxjdWxhdG9yO1xuICAgIHJvdGF0aW9uQ2FsY3VsYXRvcjogSUFycm93Um90YXRpb25DYWxjdWxhdG9yO1xuICAgIGFkanVzdG1lbnRDYWxjdWxhdG9yOiBJQXJyb3dBZGp1c3RtZW50Q2FsY3VsYXRvcjtcbiAgICBjb29yZGluYXRlU3lzdGVtU2VydmljZTogSUFycm93Q29vcmRpbmF0ZVN5c3RlbVNlcnZpY2U7XG4gICAgb3JjaGVzdHJhdG9yOiBJQXJyb3dQb3NpdGlvbmluZ09yY2hlc3RyYXRvcjtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvY2F0aW9uQ2FsY3VsYXRvcjogdGhpcy5jcmVhdGVMb2NhdGlvbkNhbGN1bGF0b3IoKSxcbiAgICAgIHJvdGF0aW9uQ2FsY3VsYXRvcjogdGhpcy5jcmVhdGVSb3RhdGlvbkNhbGN1bGF0b3IoKSxcbiAgICAgIGFkanVzdG1lbnRDYWxjdWxhdG9yOiB0aGlzLmNyZWF0ZUFkanVzdG1lbnRDYWxjdWxhdG9yKCksXG4gICAgICBjb29yZGluYXRlU3lzdGVtU2VydmljZTogdGhpcy5jcmVhdGVDb29yZGluYXRlU3lzdGVtU2VydmljZSgpLFxuICAgICAgb3JjaGVzdHJhdG9yOiB0aGlzLmNyZWF0ZVBvc2l0aW9uaW5nT3JjaGVzdHJhdG9yKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBhbGwgc2luZ2xldG9uIHNlcnZpY2VzICh1c2VmdWwgZm9yIHRlc3RpbmcpLlxuICAgKi9cbiAgcmVzZXRTZXJ2aWNlcygpOiB2b2lkIHtcbiAgICB0aGlzLmRhc2hMb2NhdGlvbkNhbGN1bGF0b3IgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5jb29yZGluYXRlU3lzdGVtU2VydmljZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnNwZWNpYWxQbGFjZW1lbnRTZXJ2aWNlID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5kaXJlY3Rpb25hbFR1cGxlUHJvY2Vzc29yID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFByZS13YXJtIGFsbCBzZXJ2aWNlcyBieSBjcmVhdGluZyB0aGVtIGluIGFkdmFuY2UuXG4gICAqIFVzZWZ1bCBmb3IgZW5zdXJpbmcgY29uc2lzdGVudCBwZXJmb3JtYW5jZS5cbiAgICovXG4gIGFzeW5jIHByZVdhcm1TZXJ2aWNlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhcIlByZS13YXJtaW5nIHBvc2l0aW9uaW5nIHNlcnZpY2VzLi4uXCIpO1xuXG4gICAgLy8gQ3JlYXRlIGFsbCBzaW5nbGV0b24gc2VydmljZXNcbiAgICB0aGlzLmNyZWF0ZUxvY2F0aW9uQ2FsY3VsYXRvcigpO1xuICAgIHRoaXMuY3JlYXRlUm90YXRpb25DYWxjdWxhdG9yKCk7XG4gICAgdGhpcy5jcmVhdGVDb29yZGluYXRlU3lzdGVtU2VydmljZSgpO1xuICAgIHRoaXMuY3JlYXRlRGlyZWN0aW9uYWxUdXBsZVByb2Nlc3NvcigpO1xuXG4gICAgLy8gTG9hZCBwbGFjZW1lbnQgZGF0YVxuICAgIGlmICghdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZSkge1xuICAgICAgdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZSA9IG5ldyBEZWZhdWx0UGxhY2VtZW50U2VydmljZSgpO1xuICAgIH1cblxuICAgIC8vIEVuc3VyZSBwbGFjZW1lbnQgZGF0YSBpcyBsb2FkZWRcbiAgICBpZiAoIXRoaXMuZGVmYXVsdFBsYWNlbWVudFNlcnZpY2UuaXNMb2FkZWQoKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWZhdWx0UGxhY2VtZW50U2VydmljZS5kZWJ1Z0F2YWlsYWJsZUtleXMoXG4gICAgICAgICAgTW90aW9uVHlwZS5QUk8sXG4gICAgICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICAgICApO1xuICAgICAgICBjb25zb2xlLmxvZyhcIuKchSBQb3NpdGlvbmluZyBzZXJ2aWNlcyBwcmUtd2FybWVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIuKaoO+4jyBTb21lIHBvc2l0aW9uaW5nIHNlcnZpY2VzIGZhaWxlZCB0byBwcmUtd2FybTpcIiwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGdldCB0aGUgcG9zaXRpb25pbmcgc2VydmljZSBmYWN0b3J5IGluc3RhbmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UG9zaXRpb25pbmdTZXJ2aWNlRmFjdG9yeSgpOiBQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5IHtcbiAgcmV0dXJuIFBvc2l0aW9uaW5nU2VydmljZUZhY3RvcnkuZ2V0SW5zdGFuY2UoKTtcbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBjcmVhdGUgYSBjb21wbGV0ZSBwb3NpdGlvbmluZyBvcmNoZXN0cmF0b3IuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbmluZ09yY2hlc3RyYXRvcigpOiBJQXJyb3dQb3NpdGlvbmluZ09yY2hlc3RyYXRvciB7XG4gIHJldHVybiBnZXRQb3NpdGlvbmluZ1NlcnZpY2VGYWN0b3J5KCkuY3JlYXRlUG9zaXRpb25pbmdPcmNoZXN0cmF0b3IoKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBT0EsU0FBUyxVQUFVLGtCQUFrQjtBQVVyQyxTQUFTLGlDQUFpQztBQUMxQyxTQUFTLCtCQUErQjtBQUN4QyxTQUFTLCtCQUErQjtBQUN4QyxTQUFTLDhCQUE4QjtBQUN2QyxTQUFTLG9DQUFvQztBQUM3QyxTQUFTLCtCQUErQjtBQUN4QyxTQUFTLCtCQUErQjtBQUN4QyxTQUFTLCtCQUErQjtBQUN4QztBQUFBLEVBQ0U7QUFBQSxF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