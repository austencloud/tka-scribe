export class ImageCompositionService {
  constructor(layoutService, dimensionService, beatRenderer, textRenderer) {
    this.layoutService = layoutService;
    this.dimensionService = dimensionService;
    this.beatRenderer = beatRenderer;
    this.textRenderer = textRenderer;
  }
  /**
   * Compose complete sequence image from sequence data
   * Main entry point that orchestrates the entire composition process
   */
  async composeSequenceImage(sequence, options) {
    if (!sequence) {
      throw new Error("Sequence data is required for composition");
    }
    try {
      const layoutData = this.calculateLayoutData(sequence, options);
      const mainCanvas = this.createMainCanvas(layoutData, options);
      const beatCanvases = await this.renderAllBeats(
        sequence,
        layoutData,
        options
      );
      const startPositionCanvas = options.includeStartPosition ? await this.renderStartPosition(sequence, layoutData, options) : null;
      await this.composeFromCanvases(
        beatCanvases,
        startPositionCanvas,
        layoutData,
        {
          ...options,
          layout: [layoutData.columns, layoutData.rows],
          additionalHeightTop: layoutData.additionalHeightTop || 0,
          additionalHeightBottom: layoutData.additionalHeightBottom || 0
        }
      );
      this.addTextOverlays(mainCanvas, sequence, layoutData, options);
      return mainCanvas;
    } catch (error) {
      throw new Error(
        `Image composition failed: ${error instanceof Error ? error.message : "Unknown error"}`
      );
    }
  }
  /**
   * Compose image from pre-rendered canvases
   * Lower-level composition for when beats are already rendered
   */
  async composeFromCanvases(beatCanvases, startPositionCanvas, layoutData, options) {
    const mainCanvas = this.createMainCanvas(layoutData, options);
    const ctx = mainCanvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from main canvas");
    }
    this.fillBackground(ctx, mainCanvas.width, mainCanvas.height);
    let startColumn = 0;
    if (startPositionCanvas && options.includeStartPosition) {
      this.drawBeatCanvas(
        ctx,
        startPositionCanvas,
        0,
        // column 0
        0,
        // row 0
        layoutData,
        options
      );
      startColumn = 1;
    }
    this.drawBeatsInGrid(ctx, beatCanvases, layoutData, options, startColumn);
    return mainCanvas;
  }
  /**
   * Apply background and borders
   * Matches desktop white background
   */
  applyBackground(canvas, backgroundColor = "white") {
    const ctx = canvas.getContext("2d");
    if (!ctx) {
      throw new Error("Failed to get 2D context from canvas");
    }
    this.fillBackground(ctx, canvas.width, canvas.height, backgroundColor);
    return canvas;
  }
  /**
   * Optimize canvas for export
   * Applies final optimizations before export
   */
  optimizeForExport(canvas) {
    return canvas;
  }
  /**
   * Calculate layout data for composition
   */
  calculateLayoutData(sequence, options) {
    const beatCount = sequence.beats.length;
    const [columns, rows] = this.layoutService.calculateLayout(
      beatCount,
      options.includeStartPosition
    );
    const [additionalHeightTop, additionalHeightBottom] = this.dimensionService.determineAdditionalHeights(
      options,
      beatCount,
      options.beatScale
    );
    return {
      columns,
      rows,
      beatSize: Math.floor(options.beatSize * options.beatScale),
      includeStartPosition: options.includeStartPosition,
      additionalHeightTop,
      additionalHeightBottom
    };
  }
  /**
   * Create main canvas with calculated dimensions
   */
  createMainCanvas(layoutData, options) {
    const totalAdditionalHeight = layoutData.additionalHeightTop + layoutData.additionalHeightBottom;
    const [width, height] = this.layoutService.calculateImageDimensions(
      [layoutData.columns, layoutData.rows],
      totalAdditionalHeight,
      options.beatScale
    );
    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    return canvas;
  }
  /**
   * Render all beats to individual canvases
   */
  async renderAllBeats(sequence, layoutData, options) {
    if (!sequence.beats || sequence.beats.length === 0) {
      return [];
    }
    const beatRenderOptions = {
      addBeatNumbers: options.addBeatNumbers,
      redVisible: options.redVisible,
      blueVisible: options.blueVisible,
      combinedGrids: options.combinedGrids,
      beatScale: options.beatScale
    };
    return await this.beatRenderer.renderBeatsToCanvases(
      [...sequence.beats],
      layoutData.beatSize,
      beatRenderOptions
    );
  }
  /**
   * Render start position canvas
   */
  async renderStartPosition(sequence, layoutData, options) {
    const beatRenderOptions = {
      addBeatNumbers: options.addBeatNumbers,
      redVisible: options.redVisible,
      blueVisible: options.blueVisible,
      combinedGrids: options.combinedGrids,
      beatScale: options.beatScale
    };
    return await this.beatRenderer.renderStartPositionToCanvas(
      sequence,
      layoutData.beatSize,
      beatRenderOptions
    );
  }
  /**
   * Fill canvas background
   */
  fillBackground(ctx, width, height, color = "white") {
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, width, height);
  }
  /**
   * Draw a single beat canvas at grid position
   */
  drawBeatCanvas(ctx, beatCanvas, column, row, layoutData, _options) {
    const x = column * layoutData.beatSize;
    const y = row * layoutData.beatSize + layoutData.additionalHeightTop;
    ctx.drawImage(beatCanvas, x, y);
  }
  /**
   * Draw all beats in grid layout
   * Matches desktop grid positioning exactly
   */
  drawBeatsInGrid(ctx, beatCanvases, layoutData, options, startColumn = 0) {
    let beatIndex = 0;
    for (let row = 0; row < layoutData.rows && beatIndex < beatCanvases.length; row++) {
      for (let col = startColumn; col < layoutData.columns && beatIndex < beatCanvases.length; col++) {
        const beatCanvas = beatCanvases[beatIndex];
        this.drawBeatCanvas(ctx, beatCanvas, col, row, layoutData, options);
        beatIndex++;
      }
    }
  }
  /**
   * Add text overlays (word, user info, difficulty)
   */
  addTextOverlays(canvas, sequence, layoutData, options) {
    const textOptions = {
      margin: Math.floor(options.margin * options.beatScale),
      beatScale: options.beatScale,
      additionalHeightTop: layoutData.additionalHeightTop,
      additionalHeightBottom: layoutData.additionalHeightBottom
    };
    if (options.addWord && sequence.word) {
      this.textRenderer.renderWordText(canvas, sequence.word, textOptions);
    }
    if (options.addUserInfo) {
      const userInfo = {
        userName: options.userName,
        notes: options.notes,
        exportDate: options.exportDate
      };
      this.textRenderer.renderUserInfo(canvas, userInfo, textOptions);
    }
    if (options.addDifficultyLevel && sequence.level && layoutData.additionalHeightTop > 0) {
      const badgeSize = Math.floor(layoutData.additionalHeightTop * 0.75);
      const inset = Math.floor(layoutData.additionalHeightTop / 8);
      this.textRenderer.renderDifficultyBadge(
        canvas,
        sequence.level,
        [inset, inset],
        badgeSize
      );
    }
  }
  /**
   * Validate composition parameters
   */
  validateCompositionParameters(sequence, options) {
    const errors = [];
    if (!sequence) {
      errors.push("Sequence data is required");
    }
    if (!options) {
      errors.push("Export options are required");
    }
    if (options && options.beatScale <= 0) {
      errors.push("Beat scale must be positive");
    }
    if (options && options.beatSize <= 0) {
      errors.push("Beat size must be positive");
    }
    if (sequence && sequence.beats && sequence.beats.length > 1e3) {
      errors.push("Too many beats - maximum 1000 supported");
    }
    return {
      valid: errors.length === 0,
      errors
    };
  }
  /**
   * Calculate memory usage estimate
   */
  estimateMemoryUsage(sequence, options) {
    const layoutData = this.calculateLayoutData(sequence, options);
    const totalAdditionalHeight = layoutData.additionalHeightTop + layoutData.additionalHeightBottom;
    const [width, height] = this.layoutService.calculateImageDimensions(
      [layoutData.columns, layoutData.rows],
      totalAdditionalHeight,
      options.beatScale
    );
    const mainCanvasBytes = width * height * 4;
    const beatCanvasBytes = sequence.beats.length * layoutData.beatSize * layoutData.beatSize * 4;
    const totalBytes = mainCanvasBytes + beatCanvasBytes;
    const estimatedMB = totalBytes / (1024 * 1024);
    const safe = estimatedMB < 100;
    return { estimatedMB, safe };
  }
  /**
   * Create composition preview (smaller scale)
   */
  async createPreview(sequence, options, previewScale = 0.5) {
    const previewOptions = {
      ...options,
      beatScale: options.beatScale * previewScale
    };
    return await this.composeSequenceImage(sequence, previewOptions);
  }
  /**
   * Debug method to create test composition
   */
  async createTestComposition() {
    const testSequence = {
      id: "test",
      name: "Test Sequence",
      word: "TEST",
      beats: [
        {
          id: "beat1",
          beatNumber: 1,
          duration: 1,
          blueReversal: false,
          redReversal: false,
          isBlank: true,
          metadata: {}
        }
      ],
      thumbnails: [],
      is_favorite: false,
      is_circular: false,
      tags: [],
      metadata: {},
      level: 3
    };
    const testOptions = {
      includeStartPosition: true,
      addBeatNumbers: true,
      addReversalSymbols: true,
      addUserInfo: true,
      addWord: true,
      combinedGrids: false,
      beatScale: 1,
      beatSize: 144,
      margin: 50,
      redVisible: true,
      blueVisible: true,
      userName: "Test User",
      exportDate: "1-1-2024",
      notes: "Test composition",
      format: "PNG",
      quality: 1,
      addDifficultyLevel: true
    };
    return await this.composeSequenceImage(testSequence, testOptions);
  }
  /**
   * Get composition statistics
   */
  getCompositionStats(sequence, options) {
    const beatCount = sequence.beats.length;
    const layout = this.layoutService.calculateLayout(
      beatCount,
      options.includeStartPosition
    );
    const layoutData = this.calculateLayoutData(sequence, options);
    const totalAdditionalHeight = layoutData.additionalHeightTop + layoutData.additionalHeightBottom;
    const dimensions = this.layoutService.calculateImageDimensions(
      layout,
      totalAdditionalHeight,
      options.beatScale
    );
    const { estimatedMB } = this.estimateMemoryUsage(sequence, options);
    const textElements = [];
    if (options.addWord && sequence.word) textElements.push("word");
    if (options.addUserInfo) textElements.push("userInfo");
    if (options.addDifficultyLevel && sequence.level)
      textElements.push("difficulty");
    return {
      beatCount,
      layout,
      dimensions,
      memoryEstimate: estimatedMB,
      textElements
    };
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltYWdlQ29tcG9zaXRpb25TZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW1hZ2UgQ29tcG9zaXRpb24gU2VydmljZVxuICpcbiAqIE1haW4gb3JjaGVzdHJhdG9yIGZvciBjb21wb3NpbmcgY29tcGxldGUgVEtBIHNlcXVlbmNlIGltYWdlcy4gVGhpcyBzZXJ2aWNlXG4gKiBjb21iaW5lcyByZW5kZXJlZCBiZWF0cywgdGV4dCBvdmVybGF5cywgYW5kIGJhY2tncm91bmQgZWxlbWVudHMgdG8gY3JlYXRlXG4gKiB0aGUgZmluYWwgZXhwb3J0IGltYWdlLiBFcXVpdmFsZW50IHRvIGRlc2t0b3AgSW1hZ2VDcmVhdG9yLlxuICpcbiAqIENyaXRpY2FsOiBNYWludGFpbnMgZXhhY3QgcG9zaXRpb25pbmcgYW5kIHNpemluZyBjb21wYXRpYmlsaXR5IHdpdGggZGVza3RvcC5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7XG4gIElJbWFnZUNvbXBvc2l0aW9uU2VydmljZSxcbiAgSUxheW91dENhbGN1bGF0aW9uU2VydmljZSxcbiAgSURpbWVuc2lvbkNhbGN1bGF0aW9uU2VydmljZSxcbiAgSUJlYXRSZW5kZXJpbmdTZXJ2aWNlLFxuICBJVGV4dFJlbmRlcmluZ1NlcnZpY2UsXG4gIFRLQUltYWdlRXhwb3J0T3B0aW9ucyxcbiAgQ29tcG9zaXRpb25PcHRpb25zLFxuICBMYXlvdXREYXRhLFxufSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9pbWFnZS1leHBvcnQtaW50ZXJmYWNlc1wiO1xuaW1wb3J0IHR5cGUgeyBTZXF1ZW5jZURhdGEgfSBmcm9tIFwiLi4vLi4vaW50ZXJmYWNlcy9kb21haW4tdHlwZXNcIjtcblxuZXhwb3J0IGNsYXNzIEltYWdlQ29tcG9zaXRpb25TZXJ2aWNlIGltcGxlbWVudHMgSUltYWdlQ29tcG9zaXRpb25TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBsYXlvdXRTZXJ2aWNlOiBJTGF5b3V0Q2FsY3VsYXRpb25TZXJ2aWNlLFxuICAgIHByaXZhdGUgZGltZW5zaW9uU2VydmljZTogSURpbWVuc2lvbkNhbGN1bGF0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGJlYXRSZW5kZXJlcjogSUJlYXRSZW5kZXJpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgdGV4dFJlbmRlcmVyOiBJVGV4dFJlbmRlcmluZ1NlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDb21wb3NlIGNvbXBsZXRlIHNlcXVlbmNlIGltYWdlIGZyb20gc2VxdWVuY2UgZGF0YVxuICAgKiBNYWluIGVudHJ5IHBvaW50IHRoYXQgb3JjaGVzdHJhdGVzIHRoZSBlbnRpcmUgY29tcG9zaXRpb24gcHJvY2Vzc1xuICAgKi9cbiAgYXN5bmMgY29tcG9zZVNlcXVlbmNlSW1hZ2UoXG4gICAgc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogUHJvbWlzZTxIVE1MQ2FudmFzRWxlbWVudD4ge1xuICAgIGlmICghc2VxdWVuY2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlNlcXVlbmNlIGRhdGEgaXMgcmVxdWlyZWQgZm9yIGNvbXBvc2l0aW9uXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBTdGVwIDE6IENhbGN1bGF0ZSBsYXlvdXQgYW5kIGRpbWVuc2lvbnNcbiAgICAgIGNvbnN0IGxheW91dERhdGEgPSB0aGlzLmNhbGN1bGF0ZUxheW91dERhdGEoc2VxdWVuY2UsIG9wdGlvbnMpO1xuXG4gICAgICAvLyBTdGVwIDI6IENyZWF0ZSBtYWluIGNhbnZhcyB3aXRoIGNhbGN1bGF0ZWQgZGltZW5zaW9uc1xuICAgICAgY29uc3QgbWFpbkNhbnZhcyA9IHRoaXMuY3JlYXRlTWFpbkNhbnZhcyhsYXlvdXREYXRhLCBvcHRpb25zKTtcblxuICAgICAgLy8gU3RlcCAzOiBSZW5kZXIgYWxsIGJlYXRzIHRvIGluZGl2aWR1YWwgY2FudmFzZXNcbiAgICAgIGNvbnN0IGJlYXRDYW52YXNlcyA9IGF3YWl0IHRoaXMucmVuZGVyQWxsQmVhdHMoXG4gICAgICAgIHNlcXVlbmNlLFxuICAgICAgICBsYXlvdXREYXRhLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuXG4gICAgICAvLyBTdGVwIDQ6IFJlbmRlciBzdGFydCBwb3NpdGlvbiBpZiBuZWVkZWRcbiAgICAgIGNvbnN0IHN0YXJ0UG9zaXRpb25DYW52YXMgPSBvcHRpb25zLmluY2x1ZGVTdGFydFBvc2l0aW9uXG4gICAgICAgID8gYXdhaXQgdGhpcy5yZW5kZXJTdGFydFBvc2l0aW9uKHNlcXVlbmNlLCBsYXlvdXREYXRhLCBvcHRpb25zKVxuICAgICAgICA6IG51bGw7XG5cbiAgICAgIC8vIFN0ZXAgNTogQ29tcG9zZSBmaW5hbCBpbWFnZVxuICAgICAgYXdhaXQgdGhpcy5jb21wb3NlRnJvbUNhbnZhc2VzKFxuICAgICAgICBiZWF0Q2FudmFzZXMsXG4gICAgICAgIHN0YXJ0UG9zaXRpb25DYW52YXMsXG4gICAgICAgIGxheW91dERhdGEsXG4gICAgICAgIHtcbiAgICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICAgIGxheW91dDogW2xheW91dERhdGEuY29sdW1ucywgbGF5b3V0RGF0YS5yb3dzXSxcbiAgICAgICAgICBhZGRpdGlvbmFsSGVpZ2h0VG9wOiBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRUb3AgfHwgMCxcbiAgICAgICAgICBhZGRpdGlvbmFsSGVpZ2h0Qm90dG9tOiBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRCb3R0b20gfHwgMCxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgLy8gU3RlcCA2OiBBZGQgdGV4dCBvdmVybGF5c1xuICAgICAgdGhpcy5hZGRUZXh0T3ZlcmxheXMobWFpbkNhbnZhcywgc2VxdWVuY2UsIGxheW91dERhdGEsIG9wdGlvbnMpO1xuXG4gICAgICByZXR1cm4gbWFpbkNhbnZhcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW1hZ2UgY29tcG9zaXRpb24gZmFpbGVkOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29tcG9zZSBpbWFnZSBmcm9tIHByZS1yZW5kZXJlZCBjYW52YXNlc1xuICAgKiBMb3dlci1sZXZlbCBjb21wb3NpdGlvbiBmb3Igd2hlbiBiZWF0cyBhcmUgYWxyZWFkeSByZW5kZXJlZFxuICAgKi9cbiAgYXN5bmMgY29tcG9zZUZyb21DYW52YXNlcyhcbiAgICBiZWF0Q2FudmFzZXM6IEhUTUxDYW52YXNFbGVtZW50W10sXG4gICAgc3RhcnRQb3NpdGlvbkNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQgfCBudWxsLFxuICAgIGxheW91dERhdGE6IExheW91dERhdGEsXG4gICAgb3B0aW9uczogQ29tcG9zaXRpb25PcHRpb25zXG4gICk6IFByb21pc2U8SFRNTENhbnZhc0VsZW1lbnQ+IHtcbiAgICAvLyBDcmVhdGUgbWFpbiBjYW52YXMgaWYgbm90IHByb3ZpZGVkXG4gICAgY29uc3QgbWFpbkNhbnZhcyA9IHRoaXMuY3JlYXRlTWFpbkNhbnZhcyhsYXlvdXREYXRhLCBvcHRpb25zKTtcbiAgICBjb25zdCBjdHggPSBtYWluQ2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBpZiAoIWN0eCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGdldCAyRCBjb250ZXh0IGZyb20gbWFpbiBjYW52YXNcIik7XG4gICAgfVxuXG4gICAgLy8gU3RlcCAxOiBGaWxsIGJhY2tncm91bmRcbiAgICB0aGlzLmZpbGxCYWNrZ3JvdW5kKGN0eCwgbWFpbkNhbnZhcy53aWR0aCwgbWFpbkNhbnZhcy5oZWlnaHQpO1xuXG4gICAgLy8gU3RlcCAyOiBQb3NpdGlvbiBhbmQgZHJhdyBzdGFydCBwb3NpdGlvblxuICAgIGxldCBzdGFydENvbHVtbiA9IDA7XG4gICAgaWYgKHN0YXJ0UG9zaXRpb25DYW52YXMgJiYgb3B0aW9ucy5pbmNsdWRlU3RhcnRQb3NpdGlvbikge1xuICAgICAgdGhpcy5kcmF3QmVhdENhbnZhcyhcbiAgICAgICAgY3R4LFxuICAgICAgICBzdGFydFBvc2l0aW9uQ2FudmFzLFxuICAgICAgICAwLCAvLyBjb2x1bW4gMFxuICAgICAgICAwLCAvLyByb3cgMFxuICAgICAgICBsYXlvdXREYXRhLFxuICAgICAgICBvcHRpb25zXG4gICAgICApO1xuICAgICAgc3RhcnRDb2x1bW4gPSAxO1xuICAgIH1cblxuICAgIC8vIFN0ZXAgMzogUG9zaXRpb24gYW5kIGRyYXcgYWxsIGJlYXRzIGluIGdyaWQgbGF5b3V0XG4gICAgdGhpcy5kcmF3QmVhdHNJbkdyaWQoY3R4LCBiZWF0Q2FudmFzZXMsIGxheW91dERhdGEsIG9wdGlvbnMsIHN0YXJ0Q29sdW1uKTtcblxuICAgIHJldHVybiBtYWluQ2FudmFzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IGJhY2tncm91bmQgYW5kIGJvcmRlcnNcbiAgICogTWF0Y2hlcyBkZXNrdG9wIHdoaXRlIGJhY2tncm91bmRcbiAgICovXG4gIGFwcGx5QmFja2dyb3VuZChcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICAgIGJhY2tncm91bmRDb2xvcjogc3RyaW5nID0gXCJ3aGl0ZVwiXG4gICk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGlmICghY3R4KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYWlsZWQgdG8gZ2V0IDJEIGNvbnRleHQgZnJvbSBjYW52YXNcIik7XG4gICAgfVxuICAgIHRoaXMuZmlsbEJhY2tncm91bmQoY3R4LCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQsIGJhY2tncm91bmRDb2xvcik7XG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpbWl6ZSBjYW52YXMgZm9yIGV4cG9ydFxuICAgKiBBcHBsaWVzIGZpbmFsIG9wdGltaXphdGlvbnMgYmVmb3JlIGV4cG9ydFxuICAgKi9cbiAgb3B0aW1pemVGb3JFeHBvcnQoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCk6IEhUTUxDYW52YXNFbGVtZW50IHtcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYXMtaXMuIEluIHRoZSBmdXR1cmUsIGNvdWxkIGFwcGx5OlxuICAgIC8vIC0gQW50aS1hbGlhc2luZyBpbXByb3ZlbWVudHNcbiAgICAvLyAtIENvbG9yIHNwYWNlIGNvbnZlcnNpb25zXG4gICAgLy8gLSBDb21wcmVzc2lvbiBvcHRpbWl6YXRpb25zXG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgbGF5b3V0IGRhdGEgZm9yIGNvbXBvc2l0aW9uXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUxheW91dERhdGEoXG4gICAgc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogTGF5b3V0RGF0YSB7XG4gICAgY29uc3QgYmVhdENvdW50ID0gc2VxdWVuY2UuYmVhdHMubGVuZ3RoO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGxheW91dCB1c2luZyBleGFjdCBkZXNrdG9wIGFsZ29yaXRobXNcbiAgICBjb25zdCBbY29sdW1ucywgcm93c10gPSB0aGlzLmxheW91dFNlcnZpY2UuY2FsY3VsYXRlTGF5b3V0KFxuICAgICAgYmVhdENvdW50LFxuICAgICAgb3B0aW9ucy5pbmNsdWRlU3RhcnRQb3NpdGlvblxuICAgICk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYWRkaXRpb25hbCBoZWlnaHRzIGZvciB0ZXh0IGFyZWFzXG4gICAgY29uc3QgW2FkZGl0aW9uYWxIZWlnaHRUb3AsIGFkZGl0aW9uYWxIZWlnaHRCb3R0b21dID1cbiAgICAgIHRoaXMuZGltZW5zaW9uU2VydmljZS5kZXRlcm1pbmVBZGRpdGlvbmFsSGVpZ2h0cyhcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICAgYmVhdENvdW50LFxuICAgICAgICBvcHRpb25zLmJlYXRTY2FsZVxuICAgICAgKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb2x1bW5zLFxuICAgICAgcm93cyxcbiAgICAgIGJlYXRTaXplOiBNYXRoLmZsb29yKG9wdGlvbnMuYmVhdFNpemUgKiBvcHRpb25zLmJlYXRTY2FsZSksXG4gICAgICBpbmNsdWRlU3RhcnRQb3NpdGlvbjogb3B0aW9ucy5pbmNsdWRlU3RhcnRQb3NpdGlvbixcbiAgICAgIGFkZGl0aW9uYWxIZWlnaHRUb3AsXG4gICAgICBhZGRpdGlvbmFsSGVpZ2h0Qm90dG9tLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIG1haW4gY2FudmFzIHdpdGggY2FsY3VsYXRlZCBkaW1lbnNpb25zXG4gICAqL1xuICBwcml2YXRlIGNyZWF0ZU1haW5DYW52YXMoXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogSFRNTENhbnZhc0VsZW1lbnQge1xuICAgIGNvbnN0IHRvdGFsQWRkaXRpb25hbEhlaWdodCA9XG4gICAgICBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRUb3AgKyBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRCb3R0b207XG5cbiAgICBjb25zdCBbd2lkdGgsIGhlaWdodF0gPSB0aGlzLmxheW91dFNlcnZpY2UuY2FsY3VsYXRlSW1hZ2VEaW1lbnNpb25zKFxuICAgICAgW2xheW91dERhdGEuY29sdW1ucywgbGF5b3V0RGF0YS5yb3dzXSxcbiAgICAgIHRvdGFsQWRkaXRpb25hbEhlaWdodCxcbiAgICAgIG9wdGlvbnMuYmVhdFNjYWxlXG4gICAgKTtcblxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcblxuICAgIHJldHVybiBjYW52YXM7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGFsbCBiZWF0cyB0byBpbmRpdmlkdWFsIGNhbnZhc2VzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJlbmRlckFsbEJlYXRzKFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEsXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogUHJvbWlzZTxIVE1MQ2FudmFzRWxlbWVudFtdPiB7XG4gICAgaWYgKCFzZXF1ZW5jZS5iZWF0cyB8fCBzZXF1ZW5jZS5iZWF0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBiZWF0UmVuZGVyT3B0aW9ucyA9IHtcbiAgICAgIGFkZEJlYXROdW1iZXJzOiBvcHRpb25zLmFkZEJlYXROdW1iZXJzLFxuICAgICAgcmVkVmlzaWJsZTogb3B0aW9ucy5yZWRWaXNpYmxlLFxuICAgICAgYmx1ZVZpc2libGU6IG9wdGlvbnMuYmx1ZVZpc2libGUsXG4gICAgICBjb21iaW5lZEdyaWRzOiBvcHRpb25zLmNvbWJpbmVkR3JpZHMsXG4gICAgICBiZWF0U2NhbGU6IG9wdGlvbnMuYmVhdFNjYWxlLFxuICAgIH07XG5cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5iZWF0UmVuZGVyZXIucmVuZGVyQmVhdHNUb0NhbnZhc2VzKFxuICAgICAgWy4uLnNlcXVlbmNlLmJlYXRzXSxcbiAgICAgIGxheW91dERhdGEuYmVhdFNpemUsXG4gICAgICBiZWF0UmVuZGVyT3B0aW9uc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIHN0YXJ0IHBvc2l0aW9uIGNhbnZhc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZW5kZXJTdGFydFBvc2l0aW9uKFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEsXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogUHJvbWlzZTxIVE1MQ2FudmFzRWxlbWVudD4ge1xuICAgIGNvbnN0IGJlYXRSZW5kZXJPcHRpb25zID0ge1xuICAgICAgYWRkQmVhdE51bWJlcnM6IG9wdGlvbnMuYWRkQmVhdE51bWJlcnMsXG4gICAgICByZWRWaXNpYmxlOiBvcHRpb25zLnJlZFZpc2libGUsXG4gICAgICBibHVlVmlzaWJsZTogb3B0aW9ucy5ibHVlVmlzaWJsZSxcbiAgICAgIGNvbWJpbmVkR3JpZHM6IG9wdGlvbnMuY29tYmluZWRHcmlkcyxcbiAgICAgIGJlYXRTY2FsZTogb3B0aW9ucy5iZWF0U2NhbGUsXG4gICAgfTtcblxuICAgIHJldHVybiBhd2FpdCB0aGlzLmJlYXRSZW5kZXJlci5yZW5kZXJTdGFydFBvc2l0aW9uVG9DYW52YXMoXG4gICAgICBzZXF1ZW5jZSxcbiAgICAgIGxheW91dERhdGEuYmVhdFNpemUsXG4gICAgICBiZWF0UmVuZGVyT3B0aW9uc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRmlsbCBjYW52YXMgYmFja2dyb3VuZFxuICAgKi9cbiAgcHJpdmF0ZSBmaWxsQmFja2dyb3VuZChcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgICB3aWR0aDogbnVtYmVyLFxuICAgIGhlaWdodDogbnVtYmVyLFxuICAgIGNvbG9yOiBzdHJpbmcgPSBcIndoaXRlXCJcbiAgKTogdm9pZCB7XG4gICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc2luZ2xlIGJlYXQgY2FudmFzIGF0IGdyaWQgcG9zaXRpb25cbiAgICovXG4gIHByaXZhdGUgZHJhd0JlYXRDYW52YXMoXG4gICAgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsXG4gICAgYmVhdENhbnZhczogSFRNTENhbnZhc0VsZW1lbnQsXG4gICAgY29sdW1uOiBudW1iZXIsXG4gICAgcm93OiBudW1iZXIsXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBfb3B0aW9uczogQ29tcG9zaXRpb25PcHRpb25zXG4gICk6IHZvaWQge1xuICAgIGNvbnN0IHggPSBjb2x1bW4gKiBsYXlvdXREYXRhLmJlYXRTaXplO1xuICAgIGNvbnN0IHkgPSByb3cgKiBsYXlvdXREYXRhLmJlYXRTaXplICsgbGF5b3V0RGF0YS5hZGRpdGlvbmFsSGVpZ2h0VG9wO1xuXG4gICAgY3R4LmRyYXdJbWFnZShiZWF0Q2FudmFzLCB4LCB5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGFsbCBiZWF0cyBpbiBncmlkIGxheW91dFxuICAgKiBNYXRjaGVzIGRlc2t0b3AgZ3JpZCBwb3NpdGlvbmluZyBleGFjdGx5XG4gICAqL1xuICBwcml2YXRlIGRyYXdCZWF0c0luR3JpZChcbiAgICBjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCxcbiAgICBiZWF0Q2FudmFzZXM6IEhUTUxDYW52YXNFbGVtZW50W10sXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBvcHRpb25zOiBDb21wb3NpdGlvbk9wdGlvbnMsXG4gICAgc3RhcnRDb2x1bW46IG51bWJlciA9IDBcbiAgKTogdm9pZCB7XG4gICAgbGV0IGJlYXRJbmRleCA9IDA7XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZ3JpZCBwb3NpdGlvbnMgKG1hdGNoZXMgZGVza3RvcCBsb2dpYylcbiAgICBmb3IgKFxuICAgICAgbGV0IHJvdyA9IDA7XG4gICAgICByb3cgPCBsYXlvdXREYXRhLnJvd3MgJiYgYmVhdEluZGV4IDwgYmVhdENhbnZhc2VzLmxlbmd0aDtcbiAgICAgIHJvdysrXG4gICAgKSB7XG4gICAgICBmb3IgKFxuICAgICAgICBsZXQgY29sID0gc3RhcnRDb2x1bW47XG4gICAgICAgIGNvbCA8IGxheW91dERhdGEuY29sdW1ucyAmJiBiZWF0SW5kZXggPCBiZWF0Q2FudmFzZXMubGVuZ3RoO1xuICAgICAgICBjb2wrK1xuICAgICAgKSB7XG4gICAgICAgIGNvbnN0IGJlYXRDYW52YXMgPSBiZWF0Q2FudmFzZXNbYmVhdEluZGV4XTtcbiAgICAgICAgdGhpcy5kcmF3QmVhdENhbnZhcyhjdHgsIGJlYXRDYW52YXMsIGNvbCwgcm93LCBsYXlvdXREYXRhLCBvcHRpb25zKTtcbiAgICAgICAgYmVhdEluZGV4Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCB0ZXh0IG92ZXJsYXlzICh3b3JkLCB1c2VyIGluZm8sIGRpZmZpY3VsdHkpXG4gICAqL1xuICBwcml2YXRlIGFkZFRleHRPdmVybGF5cyhcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50LFxuICAgIHNlcXVlbmNlOiBTZXF1ZW5jZURhdGEsXG4gICAgbGF5b3V0RGF0YTogTGF5b3V0RGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKTogdm9pZCB7XG4gICAgY29uc3QgdGV4dE9wdGlvbnMgPSB7XG4gICAgICBtYXJnaW46IE1hdGguZmxvb3Iob3B0aW9ucy5tYXJnaW4gKiBvcHRpb25zLmJlYXRTY2FsZSksXG4gICAgICBiZWF0U2NhbGU6IG9wdGlvbnMuYmVhdFNjYWxlLFxuICAgICAgYWRkaXRpb25hbEhlaWdodFRvcDogbGF5b3V0RGF0YS5hZGRpdGlvbmFsSGVpZ2h0VG9wLFxuICAgICAgYWRkaXRpb25hbEhlaWdodEJvdHRvbTogbGF5b3V0RGF0YS5hZGRpdGlvbmFsSGVpZ2h0Qm90dG9tLFxuICAgIH07XG5cbiAgICAvLyBBZGQgd29yZCB0aXRsZSBpZiBlbmFibGVkXG4gICAgaWYgKG9wdGlvbnMuYWRkV29yZCAmJiBzZXF1ZW5jZS53b3JkKSB7XG4gICAgICB0aGlzLnRleHRSZW5kZXJlci5yZW5kZXJXb3JkVGV4dChjYW52YXMsIHNlcXVlbmNlLndvcmQsIHRleHRPcHRpb25zKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgdXNlciBpbmZvIGlmIGVuYWJsZWRcbiAgICBpZiAob3B0aW9ucy5hZGRVc2VySW5mbykge1xuICAgICAgY29uc3QgdXNlckluZm8gPSB7XG4gICAgICAgIHVzZXJOYW1lOiBvcHRpb25zLnVzZXJOYW1lLFxuICAgICAgICBub3Rlczogb3B0aW9ucy5ub3RlcyxcbiAgICAgICAgZXhwb3J0RGF0ZTogb3B0aW9ucy5leHBvcnREYXRlLFxuICAgICAgfTtcbiAgICAgIHRoaXMudGV4dFJlbmRlcmVyLnJlbmRlclVzZXJJbmZvKGNhbnZhcywgdXNlckluZm8sIHRleHRPcHRpb25zKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgZGlmZmljdWx0eSBsZXZlbCBiYWRnZSBpZiBlbmFibGVkIGFuZCBhdmFpbGFibGVcbiAgICBpZiAoXG4gICAgICBvcHRpb25zLmFkZERpZmZpY3VsdHlMZXZlbCAmJlxuICAgICAgc2VxdWVuY2UubGV2ZWwgJiZcbiAgICAgIGxheW91dERhdGEuYWRkaXRpb25hbEhlaWdodFRvcCA+IDBcbiAgICApIHtcbiAgICAgIGNvbnN0IGJhZGdlU2l6ZSA9IE1hdGguZmxvb3IobGF5b3V0RGF0YS5hZGRpdGlvbmFsSGVpZ2h0VG9wICogMC43NSk7XG4gICAgICBjb25zdCBpbnNldCA9IE1hdGguZmxvb3IobGF5b3V0RGF0YS5hZGRpdGlvbmFsSGVpZ2h0VG9wIC8gOCk7XG5cbiAgICAgIHRoaXMudGV4dFJlbmRlcmVyLnJlbmRlckRpZmZpY3VsdHlCYWRnZShcbiAgICAgICAgY2FudmFzLFxuICAgICAgICBzZXF1ZW5jZS5sZXZlbCxcbiAgICAgICAgW2luc2V0LCBpbnNldF0sXG4gICAgICAgIGJhZGdlU2l6ZVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgY29tcG9zaXRpb24gcGFyYW1ldGVyc1xuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZUNvbXBvc2l0aW9uUGFyYW1ldGVycyhcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIG9wdGlvbnM6IFRLQUltYWdlRXhwb3J0T3B0aW9uc1xuICApOiB7IHZhbGlkOiBib29sZWFuOyBlcnJvcnM6IHN0cmluZ1tdIH0ge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICghc2VxdWVuY2UpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiU2VxdWVuY2UgZGF0YSBpcyByZXF1aXJlZFwiKTtcbiAgICB9XG5cbiAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiRXhwb3J0IG9wdGlvbnMgYXJlIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuYmVhdFNjYWxlIDw9IDApIHtcbiAgICAgIGVycm9ycy5wdXNoKFwiQmVhdCBzY2FsZSBtdXN0IGJlIHBvc2l0aXZlXCIpO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuYmVhdFNpemUgPD0gMCkge1xuICAgICAgZXJyb3JzLnB1c2goXCJCZWF0IHNpemUgbXVzdCBiZSBwb3NpdGl2ZVwiKTtcbiAgICB9XG5cbiAgICBpZiAoc2VxdWVuY2UgJiYgc2VxdWVuY2UuYmVhdHMgJiYgc2VxdWVuY2UuYmVhdHMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgZXJyb3JzLnB1c2goXCJUb28gbWFueSBiZWF0cyAtIG1heGltdW0gMTAwMCBzdXBwb3J0ZWRcIik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIG1lbW9yeSB1c2FnZSBlc3RpbWF0ZVxuICAgKi9cbiAgZXN0aW1hdGVNZW1vcnlVc2FnZShcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIG9wdGlvbnM6IFRLQUltYWdlRXhwb3J0T3B0aW9uc1xuICApOiB7IGVzdGltYXRlZE1COiBudW1iZXI7IHNhZmU6IGJvb2xlYW4gfSB7XG4gICAgY29uc3QgbGF5b3V0RGF0YSA9IHRoaXMuY2FsY3VsYXRlTGF5b3V0RGF0YShzZXF1ZW5jZSwgb3B0aW9ucyk7XG4gICAgY29uc3QgdG90YWxBZGRpdGlvbmFsSGVpZ2h0ID1cbiAgICAgIGxheW91dERhdGEuYWRkaXRpb25hbEhlaWdodFRvcCArIGxheW91dERhdGEuYWRkaXRpb25hbEhlaWdodEJvdHRvbTtcblxuICAgIGNvbnN0IFt3aWR0aCwgaGVpZ2h0XSA9IHRoaXMubGF5b3V0U2VydmljZS5jYWxjdWxhdGVJbWFnZURpbWVuc2lvbnMoXG4gICAgICBbbGF5b3V0RGF0YS5jb2x1bW5zLCBsYXlvdXREYXRhLnJvd3NdLFxuICAgICAgdG90YWxBZGRpdGlvbmFsSGVpZ2h0LFxuICAgICAgb3B0aW9ucy5iZWF0U2NhbGVcbiAgICApO1xuXG4gICAgLy8gRXN0aW1hdGUgbWVtb3J5IGZvciBtYWluIGNhbnZhcyArIGJlYXQgY2FudmFzZXNcbiAgICBjb25zdCBtYWluQ2FudmFzQnl0ZXMgPSB3aWR0aCAqIGhlaWdodCAqIDQ7IC8vIFJHQkFcbiAgICBjb25zdCBiZWF0Q2FudmFzQnl0ZXMgPVxuICAgICAgc2VxdWVuY2UuYmVhdHMubGVuZ3RoICogbGF5b3V0RGF0YS5iZWF0U2l6ZSAqIGxheW91dERhdGEuYmVhdFNpemUgKiA0O1xuICAgIGNvbnN0IHRvdGFsQnl0ZXMgPSBtYWluQ2FudmFzQnl0ZXMgKyBiZWF0Q2FudmFzQnl0ZXM7XG5cbiAgICBjb25zdCBlc3RpbWF0ZWRNQiA9IHRvdGFsQnl0ZXMgLyAoMTAyNCAqIDEwMjQpO1xuICAgIGNvbnN0IHNhZmUgPSBlc3RpbWF0ZWRNQiA8IDEwMDsgLy8gQ29uc2VydmF0aXZlIDEwME1CIGxpbWl0XG5cbiAgICByZXR1cm4geyBlc3RpbWF0ZWRNQiwgc2FmZSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBjb21wb3NpdGlvbiBwcmV2aWV3IChzbWFsbGVyIHNjYWxlKVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUHJldmlldyhcbiAgICBzZXF1ZW5jZTogU2VxdWVuY2VEYXRhLFxuICAgIG9wdGlvbnM6IFRLQUltYWdlRXhwb3J0T3B0aW9ucyxcbiAgICBwcmV2aWV3U2NhbGU6IG51bWJlciA9IDAuNVxuICApOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XG4gICAgY29uc3QgcHJldmlld09wdGlvbnMgPSB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgYmVhdFNjYWxlOiBvcHRpb25zLmJlYXRTY2FsZSAqIHByZXZpZXdTY2FsZSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tcG9zZVNlcXVlbmNlSW1hZ2Uoc2VxdWVuY2UsIHByZXZpZXdPcHRpb25zKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWJ1ZyBtZXRob2QgdG8gY3JlYXRlIHRlc3QgY29tcG9zaXRpb25cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVRlc3RDb21wb3NpdGlvbigpOiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PiB7XG4gICAgLy8gQ3JlYXRlIG1pbmltYWwgdGVzdCBzZXF1ZW5jZVxuICAgIGNvbnN0IHRlc3RTZXF1ZW5jZTogU2VxdWVuY2VEYXRhID0ge1xuICAgICAgaWQ6IFwidGVzdFwiLFxuICAgICAgbmFtZTogXCJUZXN0IFNlcXVlbmNlXCIsXG4gICAgICB3b3JkOiBcIlRFU1RcIixcbiAgICAgIGJlYXRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJiZWF0MVwiLFxuICAgICAgICAgIGJlYXROdW1iZXI6IDEsXG4gICAgICAgICAgZHVyYXRpb246IDEsXG4gICAgICAgICAgYmx1ZVJldmVyc2FsOiBmYWxzZSxcbiAgICAgICAgICByZWRSZXZlcnNhbDogZmFsc2UsXG4gICAgICAgICAgaXNCbGFuazogdHJ1ZSxcbiAgICAgICAgICBtZXRhZGF0YToge30sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdGh1bWJuYWlsczogW10sXG4gICAgICBpc19mYXZvcml0ZTogZmFsc2UsXG4gICAgICBpc19jaXJjdWxhcjogZmFsc2UsXG4gICAgICB0YWdzOiBbXSxcbiAgICAgIG1ldGFkYXRhOiB7fSxcbiAgICAgIGxldmVsOiAzLFxuICAgIH07XG5cbiAgICBjb25zdCB0ZXN0T3B0aW9uczogVEtBSW1hZ2VFeHBvcnRPcHRpb25zID0ge1xuICAgICAgaW5jbHVkZVN0YXJ0UG9zaXRpb246IHRydWUsXG4gICAgICBhZGRCZWF0TnVtYmVyczogdHJ1ZSxcbiAgICAgIGFkZFJldmVyc2FsU3ltYm9sczogdHJ1ZSxcbiAgICAgIGFkZFVzZXJJbmZvOiB0cnVlLFxuICAgICAgYWRkV29yZDogdHJ1ZSxcbiAgICAgIGNvbWJpbmVkR3JpZHM6IGZhbHNlLFxuICAgICAgYmVhdFNjYWxlOiAxLFxuICAgICAgYmVhdFNpemU6IDE0NCxcbiAgICAgIG1hcmdpbjogNTAsXG4gICAgICByZWRWaXNpYmxlOiB0cnVlLFxuICAgICAgYmx1ZVZpc2libGU6IHRydWUsXG4gICAgICB1c2VyTmFtZTogXCJUZXN0IFVzZXJcIixcbiAgICAgIGV4cG9ydERhdGU6IFwiMS0xLTIwMjRcIixcbiAgICAgIG5vdGVzOiBcIlRlc3QgY29tcG9zaXRpb25cIixcbiAgICAgIGZvcm1hdDogXCJQTkdcIixcbiAgICAgIHF1YWxpdHk6IDEuMCxcbiAgICAgIGFkZERpZmZpY3VsdHlMZXZlbDogdHJ1ZSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuY29tcG9zZVNlcXVlbmNlSW1hZ2UodGVzdFNlcXVlbmNlLCB0ZXN0T3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbXBvc2l0aW9uIHN0YXRpc3RpY3NcbiAgICovXG4gIGdldENvbXBvc2l0aW9uU3RhdHMoXG4gICAgc2VxdWVuY2U6IFNlcXVlbmNlRGF0YSxcbiAgICBvcHRpb25zOiBUS0FJbWFnZUV4cG9ydE9wdGlvbnNcbiAgKToge1xuICAgIGJlYXRDb3VudDogbnVtYmVyO1xuICAgIGxheW91dDogW251bWJlciwgbnVtYmVyXTtcbiAgICBkaW1lbnNpb25zOiBbbnVtYmVyLCBudW1iZXJdO1xuICAgIG1lbW9yeUVzdGltYXRlOiBudW1iZXI7XG4gICAgdGV4dEVsZW1lbnRzOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgY29uc3QgYmVhdENvdW50ID0gc2VxdWVuY2UuYmVhdHMubGVuZ3RoO1xuICAgIGNvbnN0IGxheW91dCA9IHRoaXMubGF5b3V0U2VydmljZS5jYWxjdWxhdGVMYXlvdXQoXG4gICAgICBiZWF0Q291bnQsXG4gICAgICBvcHRpb25zLmluY2x1ZGVTdGFydFBvc2l0aW9uXG4gICAgKTtcbiAgICBjb25zdCBsYXlvdXREYXRhID0gdGhpcy5jYWxjdWxhdGVMYXlvdXREYXRhKHNlcXVlbmNlLCBvcHRpb25zKTtcblxuICAgIGNvbnN0IHRvdGFsQWRkaXRpb25hbEhlaWdodCA9XG4gICAgICBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRUb3AgKyBsYXlvdXREYXRhLmFkZGl0aW9uYWxIZWlnaHRCb3R0b207XG4gICAgY29uc3QgZGltZW5zaW9ucyA9IHRoaXMubGF5b3V0U2VydmljZS5jYWxjdWxhdGVJbWFnZURpbWVuc2lvbnMoXG4gICAgICBsYXlvdXQsXG4gICAgICB0b3RhbEFkZGl0aW9uYWxIZWlnaHQsXG4gICAgICBvcHRpb25zLmJlYXRTY2FsZVxuICAgICk7XG5cbiAgICBjb25zdCB7IGVzdGltYXRlZE1CIH0gPSB0aGlzLmVzdGltYXRlTWVtb3J5VXNhZ2Uoc2VxdWVuY2UsIG9wdGlvbnMpO1xuXG4gICAgY29uc3QgdGV4dEVsZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGlmIChvcHRpb25zLmFkZFdvcmQgJiYgc2VxdWVuY2Uud29yZCkgdGV4dEVsZW1lbnRzLnB1c2goXCJ3b3JkXCIpO1xuICAgIGlmIChvcHRpb25zLmFkZFVzZXJJbmZvKSB0ZXh0RWxlbWVudHMucHVzaChcInVzZXJJbmZvXCIpO1xuICAgIGlmIChvcHRpb25zLmFkZERpZmZpY3VsdHlMZXZlbCAmJiBzZXF1ZW5jZS5sZXZlbClcbiAgICAgIHRleHRFbGVtZW50cy5wdXNoKFwiZGlmZmljdWx0eVwiKTtcblxuICAgIHJldHVybiB7XG4gICAgICBiZWF0Q291bnQsXG4gICAgICBsYXlvdXQsXG4gICAgICBkaW1lbnNpb25zLFxuICAgICAgbWVtb3J5RXN0aW1hdGU6IGVzdGltYXRlZE1CLFxuICAgICAgdGV4dEVsZW1lbnRzLFxuICAgIH07XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6IkFBc0JPLGFBQU0sd0JBQTREO0FBQUEsRUFDdkUsWUFDVSxlQUNBLGtCQUNBLGNBQ0EsY0FDUjtBQUpRO0FBQ0E7QUFDQTtBQUNBO0FBQUEsRUFDUDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFNSCxNQUFNLHFCQUNKLFVBQ0EsU0FDNEI7QUFDNUIsUUFBSSxDQUFDLFVBQVU7QUFDYixZQUFNLElBQUksTUFBTSwyQ0FBMkM7QUFBQSxJQUM3RDtBQUVBLFFBQUk7QUFFRixZQUFNLGFBQWEsS0FBSyxvQkFBb0IsVUFBVSxPQUFPO0FBRzdELFlBQU0sYUFBYSxLQUFLLGlCQUFpQixZQUFZLE9BQU87QUFHNUQsWUFBTSxlQUFlLE1BQU0sS0FBSztBQUFBLFFBQzlCO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxNQUNGO0FBR0EsWUFBTSxzQkFBc0IsUUFBUSx1QkFDaEMsTUFBTSxLQUFLLG9CQUFvQixVQUFVLFlBQVksT0FBTyxJQUM1RDtBQUdKLFlBQU0sS0FBSztBQUFBLFFBQ1Q7QUFBQSxRQUNBO0FBQUEsUUFDQTtBQUFBLFFBQ0E7QUFBQSxVQUNFLEdBQUc7QUFBQSxVQUNILFFBQVEsQ0FBQyxXQUFXLFNBQVMsV0FBVyxJQUFJO0FBQUEsVUFDNUMscUJBQXFCLFdBQVcsdUJBQXVCO0FBQUEsVUFDdkQsd0JBQXdCLFdBQVcsMEJBQTBCO0FBQUEsUUFDL0Q7QUFBQSxNQUNGO0FBR0EsV0FBSyxnQkFBZ0IsWUFBWSxVQUFVLFlBQVksT0FBTztBQUU5RCxhQUFPO0FBQUEsSUFDVCxTQUFTLE9BQU87QUFDZCxZQUFNLElBQUk7QUFBQSxRQUNS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