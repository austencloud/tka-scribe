import { GridMode } from "/src/lib/domain/index.ts";
export class CodexService {
  constructor(letterMappingRepository, lessonRepository, operationsService, letterQueryService) {
    this.letterMappingRepository = letterMappingRepository;
    this.lessonRepository = lessonRepository;
    this.operationsService = operationsService;
    this.letterQueryService = letterQueryService;
    console.log(
      "ðŸ”§ Clean CodexService initialized with proper dependency injection"
    );
  }
  initialized = false;
  /**
   * Initialize the service and all dependencies
   */
  async initialize() {
    if (this.initialized) return;
    try {
      console.log("ðŸš€ Initializing clean CodexService...");
      await Promise.all([
        this.letterMappingRepository.initialize(),
        this.lessonRepository.initialize()
        // LetterQueryService initializes automatically when first used
      ]);
      this.initialized = true;
      console.log("âœ… Clean CodexService fully initialized");
    } catch (error) {
      console.error("âŒ Failed to initialize clean CodexService:", error);
      throw error;
    }
  }
  /**
   * Load all pictographs in alphabetical order
   */
  async loadAllPictographs() {
    await this.initialize();
    console.log("ðŸ” Loading all codex pictographs...");
    const pictographs = await this.letterQueryService.getAllCodexPictographs(
      GridMode.DIAMOND
    );
    console.log(
      `ðŸ“Š Loaded ${pictographs.length} pictographs from codex query service`
    );
    const sortedPictographs = this.sortPictographsAlphabetically(pictographs);
    console.log(
      `âœ… Sorted ${sortedPictographs.length} pictographs alphabetically`
    );
    return sortedPictographs;
  }
  /**
   * Search pictographs by letter or pattern
   */
  async searchPictographs(searchTerm) {
    await this.initialize();
    const pictographs = await this.letterQueryService.searchPictographs(
      searchTerm,
      GridMode.DIAMOND
    );
    return this.sortPictographsAlphabetically(pictographs);
  }
  /**
   * Get a specific pictograph by letter
   */
  async getPictographByLetter(letter) {
    await this.initialize();
    return this.letterQueryService.getPictographByLetter(
      letter,
      GridMode.DIAMOND
    );
  }
  /**
   * Get pictographs for a specific lesson type
   */
  async getPictographsForLesson(lessonType) {
    await this.initialize();
    console.log(`ðŸ“š Getting pictographs for lesson type: ${lessonType}`);
    const letters = this.lessonRepository.getLettersForLesson(lessonType);
    if (letters.length === 0) {
      console.warn(`No letters found for lesson type: ${lessonType}`);
      return [];
    }
    const pictographs = await this.letterQueryService.getPictographsByLetters(
      letters,
      GridMode.DIAMOND
    );
    return this.sortPictographsAlphabetically(pictographs);
  }
  /**
   * Get letters organized by rows for grid display
   */
  getLettersByRow() {
    this.ensureInitialized();
    const rows = this.letterMappingRepository.getLetterRows();
    return rows.map((row) => [...row.letters]);
  }
  /**
   * Apply rotate operation to all pictographs
   */
  async rotateAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.rotateAllPictographs(pictographs);
  }
  /**
   * Apply mirror operation to all pictographs
   */
  async mirrorAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.mirrorAllPictographs(pictographs);
  }
  /**
   * Apply color swap operation to all pictographs
   */
  async colorSwapAllPictographs(pictographs) {
    await this.initialize();
    return this.operationsService.colorSwapAllPictographs(pictographs);
  }
  /**
   * Get all pictograph data organized by letter
   */
  async getAllPictographData() {
    await this.initialize();
    const allLetters = this.letterMappingRepository.getAllLetters();
    const result = {};
    allLetters.forEach((letter) => {
      result[letter] = null;
    });
    const pictographs = await this.loadAllPictographs();
    pictographs.forEach((pictograph) => {
      if (pictograph.letter) {
        result[pictograph.letter] = pictograph;
      }
    });
    return result;
  }
  // Additional clean helper methods
  /**
   * Get available lesson types
   */
  async getAvailableLessonTypes() {
    await this.initialize();
    return this.lessonRepository.getAllLessonTypes();
  }
  /**
   * Get letters by category
   */
  getLettersByCategory(category) {
    this.ensureInitialized();
    return this.letterMappingRepository.getLettersByCategory(category);
  }
  /**
   * Check if a letter is valid in the codex
   */
  isValidLetter(letter) {
    this.ensureInitialized();
    return this.letterMappingRepository.isValidLetter(letter);
  }
  // Private helper methods
  sortPictographsAlphabetically(pictographs) {
    return [...pictographs].sort((a, b) => {
      const letterA = a.letter || "";
      const letterB = b.letter || "";
      return letterA.localeCompare(letterB);
    });
  }
  ensureInitialized() {
    if (!this.initialized) {
      throw new Error(
        "CodexService not initialized. Methods will auto-initialize, but sync methods require prior initialization."
      );
    }
  }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvZGV4U2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENsZWFuIENvZGV4IFNlcnZpY2UgSW1wbGVtZW50YXRpb25cbiAqXG4gKiBBIGNsZWFuLCBtYWludGFpbmFibGUgaW1wbGVtZW50YXRpb24gdGhhdCB1c2VzIHByb3BlciBzZXBhcmF0aW9uIG9mIGNvbmNlcm5zLlxuICogTm8gbW9yZSBoYXJkY29kZWQgbWFwcGluZ3Mgb3IgbWl4ZWQgcmVzcG9uc2liaWxpdGllcyFcbiAqL1xuXG5pbXBvcnQgeyBHcmlkTW9kZSB9IGZyb20gXCIkbGliL2RvbWFpblwiO1xuaW1wb3J0IHR5cGUgeyBQaWN0b2dyYXBoRGF0YSB9IGZyb20gXCIkbGliL2RvbWFpbi9QaWN0b2dyYXBoRGF0YVwiO1xuaW1wb3J0IHR5cGUgeyBMZXR0ZXJDYXRlZ29yeSB9IGZyb20gXCIkbGliL2RvbWFpbi9jb2RleC90eXBlc1wiO1xuaW1wb3J0IHR5cGUgeyBJTGV0dGVyTWFwcGluZ1JlcG9zaXRvcnkgfSBmcm9tIFwiJGxpYi9yZXBvc2l0b3JpZXMvTGV0dGVyTWFwcGluZ1JlcG9zaXRvcnlcIjtcbmltcG9ydCB0eXBlIHsgSUxlc3NvblJlcG9zaXRvcnkgfSBmcm9tIFwiJGxpYi9yZXBvc2l0b3JpZXMvTGVzc29uUmVwb3NpdG9yeVwiO1xuXG5pbXBvcnQgdHlwZSB7IElQaWN0b2dyYXBoT3BlcmF0aW9uc1NlcnZpY2UgfSBmcm9tIFwiLi9QaWN0b2dyYXBoT3BlcmF0aW9uc1NlcnZpY2VcIjtcbmltcG9ydCB0eXBlIHsgSUNvZGV4U2VydmljZSB9IGZyb20gXCIuL0lDb2RleFNlcnZpY2VcIjtcbmltcG9ydCB0eXBlIHsgSUxldHRlclF1ZXJ5U2VydmljZSB9IGZyb20gXCIuLi9pbXBsZW1lbnRhdGlvbnMvZGF0YS9MZXR0ZXJRdWVyeVNlcnZpY2VcIjtcblxuLy8gUmUtZXhwb3J0IHRoZSBpbnRlcmZhY2UgZm9yIGNvbnZlbmllbmNlXG5leHBvcnQgdHlwZSB7IElDb2RleFNlcnZpY2UgfSBmcm9tIFwiLi9JQ29kZXhTZXJ2aWNlXCI7XG5cbmV4cG9ydCBjbGFzcyBDb2RleFNlcnZpY2UgaW1wbGVtZW50cyBJQ29kZXhTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbGV0dGVyTWFwcGluZ1JlcG9zaXRvcnk6IElMZXR0ZXJNYXBwaW5nUmVwb3NpdG9yeSxcbiAgICBwcml2YXRlIGxlc3NvblJlcG9zaXRvcnk6IElMZXNzb25SZXBvc2l0b3J5LFxuICAgIHByaXZhdGUgb3BlcmF0aW9uc1NlcnZpY2U6IElQaWN0b2dyYXBoT3BlcmF0aW9uc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBsZXR0ZXJRdWVyeVNlcnZpY2U6IElMZXR0ZXJRdWVyeVNlcnZpY2VcbiAgKSB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBcIvCflKcgQ2xlYW4gQ29kZXhTZXJ2aWNlIGluaXRpYWxpemVkIHdpdGggcHJvcGVyIGRlcGVuZGVuY3kgaW5qZWN0aW9uXCJcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHNlcnZpY2UgYW5kIGFsbCBkZXBlbmRlbmNpZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKFwi8J+agCBJbml0aWFsaXppbmcgY2xlYW4gQ29kZXhTZXJ2aWNlLi4uXCIpO1xuXG4gICAgICAvLyBJbml0aWFsaXplIGFsbCByZXBvc2l0b3JpZXMgYW5kIHNlcnZpY2VzXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMubGV0dGVyTWFwcGluZ1JlcG9zaXRvcnkuaW5pdGlhbGl6ZSgpLFxuICAgICAgICB0aGlzLmxlc3NvblJlcG9zaXRvcnkuaW5pdGlhbGl6ZSgpLFxuICAgICAgICAvLyBMZXR0ZXJRdWVyeVNlcnZpY2UgaW5pdGlhbGl6ZXMgYXV0b21hdGljYWxseSB3aGVuIGZpcnN0IHVzZWRcbiAgICAgIF0pO1xuXG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgIGNvbnNvbGUubG9nKFwi4pyFIENsZWFuIENvZGV4U2VydmljZSBmdWxseSBpbml0aWFsaXplZFwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBjbGVhbiBDb2RleFNlcnZpY2U6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2FkIGFsbCBwaWN0b2dyYXBocyBpbiBhbHBoYWJldGljYWwgb3JkZXJcbiAgICovXG4gIGFzeW5jIGxvYWRBbGxQaWN0b2dyYXBocygpOiBQcm9taXNlPFBpY3RvZ3JhcGhEYXRhW10+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgIGNvbnNvbGUubG9nKFwi8J+UjSBMb2FkaW5nIGFsbCBjb2RleCBwaWN0b2dyYXBocy4uLlwiKTtcbiAgICBjb25zdCBwaWN0b2dyYXBocyA9IGF3YWl0IHRoaXMubGV0dGVyUXVlcnlTZXJ2aWNlLmdldEFsbENvZGV4UGljdG9ncmFwaHMoXG4gICAgICBHcmlkTW9kZS5ESUFNT05EXG4gICAgKTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGDwn5OKIExvYWRlZCAke3BpY3RvZ3JhcGhzLmxlbmd0aH0gcGljdG9ncmFwaHMgZnJvbSBjb2RleCBxdWVyeSBzZXJ2aWNlYFxuICAgICk7XG4gICAgY29uc3Qgc29ydGVkUGljdG9ncmFwaHMgPSB0aGlzLnNvcnRQaWN0b2dyYXBoc0FscGhhYmV0aWNhbGx5KHBpY3RvZ3JhcGhzKTtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGDinIUgU29ydGVkICR7c29ydGVkUGljdG9ncmFwaHMubGVuZ3RofSBwaWN0b2dyYXBocyBhbHBoYWJldGljYWxseWBcbiAgICApO1xuICAgIHJldHVybiBzb3J0ZWRQaWN0b2dyYXBocztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2ggcGljdG9ncmFwaHMgYnkgbGV0dGVyIG9yIHBhdHRlcm5cbiAgICovXG4gIGFzeW5jIHNlYXJjaFBpY3RvZ3JhcGhzKHNlYXJjaFRlcm06IHN0cmluZyk6IFByb21pc2U8UGljdG9ncmFwaERhdGFbXT4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgY29uc3QgcGljdG9ncmFwaHMgPSBhd2FpdCB0aGlzLmxldHRlclF1ZXJ5U2VydmljZS5zZWFyY2hQaWN0b2dyYXBocyhcbiAgICAgIHNlYXJjaFRlcm0sXG4gICAgICBHcmlkTW9kZS5ESUFNT05EXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5zb3J0UGljdG9ncmFwaHNBbHBoYWJldGljYWxseShwaWN0b2dyYXBocyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgc3BlY2lmaWMgcGljdG9ncmFwaCBieSBsZXR0ZXJcbiAgICovXG4gIGFzeW5jIGdldFBpY3RvZ3JhcGhCeUxldHRlcihsZXR0ZXI6IHN0cmluZyk6IFByb21pc2U8UGljdG9ncmFwaERhdGEgfCBudWxsPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICByZXR1cm4gdGhpcy5sZXR0ZXJRdWVyeVNlcnZpY2UuZ2V0UGljdG9ncmFwaEJ5TGV0dGVyKFxuICAgICAgbGV0dGVyLFxuICAgICAgR3JpZE1vZGUuRElBTU9ORFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBpY3RvZ3JhcGhzIGZvciBhIHNwZWNpZmljIGxlc3NvbiB0eXBlXG4gICAqL1xuICBhc3luYyBnZXRQaWN0b2dyYXBoc0Zvckxlc3NvbihsZXNzb25UeXBlOiBzdHJpbmcpOiBQcm9taXNlPFBpY3RvZ3JhcGhEYXRhW10+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5OaIEdldHRpbmcgcGljdG9ncmFwaHMgZm9yIGxlc3NvbiB0eXBlOiAke2xlc3NvblR5cGV9YCk7XG5cbiAgICBjb25zdCBsZXR0ZXJzID0gdGhpcy5sZXNzb25SZXBvc2l0b3J5LmdldExldHRlcnNGb3JMZXNzb24obGVzc29uVHlwZSk7XG4gICAgaWYgKGxldHRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE5vIGxldHRlcnMgZm91bmQgZm9yIGxlc3NvbiB0eXBlOiAke2xlc3NvblR5cGV9YCk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgcGljdG9ncmFwaHMgPSBhd2FpdCB0aGlzLmxldHRlclF1ZXJ5U2VydmljZS5nZXRQaWN0b2dyYXBoc0J5TGV0dGVycyhcbiAgICAgIGxldHRlcnMsXG4gICAgICBHcmlkTW9kZS5ESUFNT05EXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5zb3J0UGljdG9ncmFwaHNBbHBoYWJldGljYWxseShwaWN0b2dyYXBocyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGxldHRlcnMgb3JnYW5pemVkIGJ5IHJvd3MgZm9yIGdyaWQgZGlzcGxheVxuICAgKi9cbiAgZ2V0TGV0dGVyc0J5Um93KCk6IHN0cmluZ1tdW10ge1xuICAgIHRoaXMuZW5zdXJlSW5pdGlhbGl6ZWQoKTtcblxuICAgIGNvbnN0IHJvd3MgPSB0aGlzLmxldHRlck1hcHBpbmdSZXBvc2l0b3J5LmdldExldHRlclJvd3MoKTtcbiAgICByZXR1cm4gcm93cy5tYXAoKHJvdykgPT4gWy4uLnJvdy5sZXR0ZXJzXSk7IC8vIFJldHVybiBjb3B5IHRvIHByZXZlbnQgbXV0YXRpb25cbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSByb3RhdGUgb3BlcmF0aW9uIHRvIGFsbCBwaWN0b2dyYXBoc1xuICAgKi9cbiAgYXN5bmMgcm90YXRlQWxsUGljdG9ncmFwaHMoXG4gICAgcGljdG9ncmFwaHM6IFBpY3RvZ3JhcGhEYXRhW11cbiAgKTogUHJvbWlzZTxQaWN0b2dyYXBoRGF0YVtdPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICByZXR1cm4gdGhpcy5vcGVyYXRpb25zU2VydmljZS5yb3RhdGVBbGxQaWN0b2dyYXBocyhwaWN0b2dyYXBocyk7XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgbWlycm9yIG9wZXJhdGlvbiB0byBhbGwgcGljdG9ncmFwaHNcbiAgICovXG4gIGFzeW5jIG1pcnJvckFsbFBpY3RvZ3JhcGhzKFxuICAgIHBpY3RvZ3JhcGhzOiBQaWN0b2dyYXBoRGF0YVtdXG4gICk6IFByb21pc2U8UGljdG9ncmFwaERhdGFbXT4ge1xuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZSgpO1xuXG4gICAgcmV0dXJuIHRoaXMub3BlcmF0aW9uc1NlcnZpY2UubWlycm9yQWxsUGljdG9ncmFwaHMocGljdG9ncmFwaHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IGNvbG9yIHN3YXAgb3BlcmF0aW9uIHRvIGFsbCBwaWN0b2dyYXBoc1xuICAgKi9cbiAgYXN5bmMgY29sb3JTd2FwQWxsUGljdG9ncmFwaHMoXG4gICAgcGljdG9ncmFwaHM6IFBpY3RvZ3JhcGhEYXRhW11cbiAgKTogUHJvbWlzZTxQaWN0b2dyYXBoRGF0YVtdPiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICByZXR1cm4gdGhpcy5vcGVyYXRpb25zU2VydmljZS5jb2xvclN3YXBBbGxQaWN0b2dyYXBocyhwaWN0b2dyYXBocyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBwaWN0b2dyYXBoIGRhdGEgb3JnYW5pemVkIGJ5IGxldHRlclxuICAgKi9cbiAgYXN5bmMgZ2V0QWxsUGljdG9ncmFwaERhdGEoKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBQaWN0b2dyYXBoRGF0YSB8IG51bGw+PiB7XG4gICAgYXdhaXQgdGhpcy5pbml0aWFsaXplKCk7XG5cbiAgICBjb25zdCBhbGxMZXR0ZXJzID0gdGhpcy5sZXR0ZXJNYXBwaW5nUmVwb3NpdG9yeS5nZXRBbGxMZXR0ZXJzKCk7XG4gICAgY29uc3QgcmVzdWx0OiBSZWNvcmQ8c3RyaW5nLCBQaWN0b2dyYXBoRGF0YSB8IG51bGw+ID0ge307XG5cbiAgICAvLyBJbml0aWFsaXplIGFsbCBsZXR0ZXJzIHRvIG51bGxcbiAgICBhbGxMZXR0ZXJzLmZvckVhY2goKGxldHRlcikgPT4ge1xuICAgICAgcmVzdWx0W2xldHRlcl0gPSBudWxsO1xuICAgIH0pO1xuXG4gICAgLy8gTG9hZCBhY3R1YWwgcGljdG9ncmFwaHNcbiAgICBjb25zdCBwaWN0b2dyYXBocyA9IGF3YWl0IHRoaXMubG9hZEFsbFBpY3RvZ3JhcGhzKCk7XG4gICAgcGljdG9ncmFwaHMuZm9yRWFjaCgocGljdG9ncmFwaCkgPT4ge1xuICAgICAgaWYgKHBpY3RvZ3JhcGgubGV0dGVyKSB7XG4gICAgICAgIHJlc3VsdFtwaWN0b2dyYXBoLmxldHRlcl0gPSBwaWN0b2dyYXBoO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIEFkZGl0aW9uYWwgY2xlYW4gaGVscGVyIG1ldGhvZHNcblxuICAvKipcbiAgICogR2V0IGF2YWlsYWJsZSBsZXNzb24gdHlwZXNcbiAgICovXG4gIGFzeW5jIGdldEF2YWlsYWJsZUxlc3NvblR5cGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemUoKTtcblxuICAgIHJldHVybiB0aGlzLmxlc3NvblJlcG9zaXRvcnkuZ2V0QWxsTGVzc29uVHlwZXMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbGV0dGVycyBieSBjYXRlZ29yeVxuICAgKi9cbiAgZ2V0TGV0dGVyc0J5Q2F0ZWdvcnkoY2F0ZWdvcnk6IExldHRlckNhdGVnb3J5KTogc3RyaW5nW10ge1xuICAgIHRoaXMuZW5zdXJlSW5pdGlhbGl6ZWQoKTtcblxuICAgIHJldHVybiB0aGlzLmxldHRlck1hcHBpbmdSZXBvc2l0b3J5LmdldExldHRlcnNCeUNhdGVnb3J5KGNhdGVnb3J5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhIGxldHRlciBpcyB2YWxpZCBpbiB0aGUgY29kZXhcbiAgICovXG4gIGlzVmFsaWRMZXR0ZXIobGV0dGVyOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB0aGlzLmVuc3VyZUluaXRpYWxpemVkKCk7XG5cbiAgICByZXR1cm4gdGhpcy5sZXR0ZXJNYXBwaW5nUmVwb3NpdG9yeS5pc1ZhbGlkTGV0dGVyKGxldHRlcik7XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBzb3J0UGljdG9ncmFwaHNBbHBoYWJldGljYWxseShcbiAgICBwaWN0b2dyYXBoczogUGljdG9ncmFwaERhdGFbXVxuICApOiBQaWN0b2dyYXBoRGF0YVtdIHtcbiAgICByZXR1cm4gWy4uLnBpY3RvZ3JhcGhzXS5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBsZXR0ZXJBID0gYS5sZXR0ZXIgfHwgXCJcIjtcbiAgICAgIGNvbnN0IGxldHRlckIgPSBiLmxldHRlciB8fCBcIlwiO1xuICAgICAgcmV0dXJuIGxldHRlckEubG9jYWxlQ29tcGFyZShsZXR0ZXJCKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgZW5zdXJlSW5pdGlhbGl6ZWQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiQ29kZXhTZXJ2aWNlIG5vdCBpbml0aWFsaXplZC4gTWV0aG9kcyB3aWxsIGF1dG8taW5pdGlhbGl6ZSwgYnV0IHN5bmMgbWV0aG9kcyByZXF1aXJlIHByaW9yIGluaXRpYWxpemF0aW9uLlwiXG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFPQSxTQUFTLGdCQUFnQjtBQWFsQixhQUFNLGFBQXNDO0FBQUEsRUFHakQsWUFDVSx5QkFDQSxrQkFDQSxtQkFDQSxvQkFDUjtBQUpR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