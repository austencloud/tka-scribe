
  /* Overlay (backdrop) */
  .drawer-overlay {
    position: fixed;
    inset: 0;
    z-index: calc(var(--sheet-z-index, var(--sheet-z-base, 50)) - 1);

    /* Transparent by default to allow glass morphism effect on drawer */
    background: var(--sheet-backdrop-bg, transparent);
    pointer-events: var(--sheet-backdrop-pointer-events, auto);
    transition: opacity var(--duration-dramatic, 350ms) var(--ease-out, cubic-bezier(0.16, 1, 0.3, 1));
    opacity: 0;
  }

  .drawer-overlay[data-state="open"] {
    opacity: 1;
  }

  .drawer-overlay[data-state="closed"] {
    opacity: 0;
    pointer-events: none;
  }

  /* Edit panel backdrop - completely transparent and non-interactive */
  .drawer-overlay.edit-panel-backdrop {
    background: transparent !important;
    backdrop-filter: none !important;
    pointer-events: none !important;
  }

  /* Sequence Actions sheet backdrop - completely transparent and non-interactive to show beats behind */
  .drawer-overlay.actions-sheet-backdrop {
    background: transparent !important;
    backdrop-filter: none !important;
    pointer-events: none !important;
  }

  /* Settings panel backdrop - modern frosted glass with blur */
  /* Override desktop sidebar constraint since settings drawer covers sidebar */
  .drawer-overlay.settings-backdrop,
  :global(.has-desktop-sidebar) .drawer-overlay.settings-backdrop {
    left: 0;
    background: var(--sheet-backdrop-bg, var(--backdrop-medium, rgba(0, 0, 0, 0.4)));
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    pointer-events: auto;
  }

  /* Side-by-side layout: Constrain backdrop to right half of viewport */
  .drawer-overlay.side-by-side-layout {
    left: var(--create-panel-left, 50%);
    right: 0;
    top: var(--create-panel-top, 0);
    bottom: var(--create-panel-bottom, 0);
  }

  /*
   * Desktop sidebar support: When sidebar is visible, ensure backdrop
   * doesn't cover it so navigation clicks work. Uses global CSS variable
   * --desktop-sidebar-width set by MainInterface.svelte
   */
  :global(.has-desktop-sidebar) .drawer-overlay {
    left: var(--desktop-sidebar-width, 220px);
  }

  /* Drawer content container */
  .drawer-content {
    position: fixed;
    z-index: var(--sheet-z-index, var(--sheet-z-base, 50));
    display: flex;
    flex-direction: column;
    outline: none;
    /* Background with theme-aware fallback */
    background: var(--sheet-bg, linear-gradient(135deg, rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0.60)));
    backdrop-filter: var(--sheet-filter, blur(24px));
    -webkit-backdrop-filter: var(--sheet-filter, blur(24px));

    border: var(
      --sheet-border,
      var(--sheet-border-subtle, 1px solid rgba(255, 255, 255, 0.1))
    );

    /* Smooth CSS transitions - using 2026 system tokens */
    transition:
      transform var(--duration-dramatic, 350ms) var(--ease-out, cubic-bezier(0.16, 1, 0.3, 1)),
      opacity var(--duration-dramatic, 350ms) var(--ease-out, cubic-bezier(0.16, 1, 0.3, 1));
    will-change: transform;

    /* Prevent pull-to-refresh ONLY on this drawer, not globally */
    overscroll-behavior-y: contain;
    /* Allow touch manipulation - default to vertical panning */
    touch-action: pan-y;
  }

  /* Horizontal touch action for right/left placement */
  .drawer-content[data-placement="right"],
  .drawer-content[data-placement="left"] {
    touch-action: pan-x;
    overscroll-behavior-x: contain;
  }

  .drawer-content[data-state="closed"] {
    pointer-events: none;
  }

  /* Bottom placement - default (mobile) */
  .drawer-content[data-placement="bottom"]:not(.side-by-side-layout) {
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    max-width: 100%;
    max-height: calc(100vh - 20px);

    margin: 0;
    border-top-left-radius: var(
      --sheet-border-radius-top-left,
      var(--sheet-radius-large, 20px)
    );
    border-top-right-radius: var(
      --sheet-border-radius-top-right,
      var(--sheet-radius-large, 20px)
    );
    border-bottom: none;
  }

  .drawer-content[data-placement="bottom"][data-state="closed"] {
    transform: translate3d(0, 100%, 0);
  }

  .drawer-content[data-placement="bottom"][data-state="open"] {
    transform: translate3d(0, 0, 0);
  }

  /* Top placement */
  .drawer-content[data-placement="top"] {
    top: 0;
    left: 0;
    right: 0;
    width: var(--sheet-width, min(720px, 100%));

    margin: 0 auto;
    border-bottom-left-radius: var(--sheet-radius-large, 20px);
    border-bottom-right-radius: var(--sheet-radius-large, 20px);
    border-top: none;
  }

  .drawer-content[data-placement="top"][data-state="closed"] {
    transform: translate3d(0, -100%, 0);
  }

  .drawer-content[data-placement="top"][data-state="open"] {
    transform: translate3d(0, 0, 0);
  }

  /* Right placement */
  .drawer-content[data-placement="right"] {
    top: 0;
    right: 0;
    bottom: 0;
    height: 100vh;
    max-height: 100vh;
    width: var(--sheet-width, min(600px, 90vw));
    border-left: var(
      --sheet-border-strong,
      2px solid rgba(255, 255, 255, 0.15)
    );
    border-right: none;
    border-top-left-radius: var(--sheet-radius-large, 20px);
    border-bottom-left-radius: var(--sheet-radius-large, 20px);
    cursor: grab;
  }

  .drawer-content[data-placement="right"].dragging {
    cursor: grabbing;
    user-select: none;
  }

  .drawer-content[data-placement="right"][data-state="closed"] {
    transform: translate3d(100%, 0, 0);
  }

  .drawer-content[data-placement="right"][data-state="open"] {
    transform: translate3d(0, 0, 0);
  }

  /* Right placement in side-by-side mode - use tracked width */
  .drawer-content[data-placement="right"].side-by-side-layout {
    top: var(--create-panel-top, 0);
    bottom: var(--create-panel-bottom, 0);
    height: auto;
    max-height: none;
    width: var(--create-panel-width, clamp(360px, 32vw, 520px));
    max-width: 100%;
  }

  /* Left placement */
  .drawer-content[data-placement="left"] {
    top: 0;
    left: 0;
    bottom: 0;
    height: 100vh;
    max-height: 100vh;
    width: var(--sheet-width, min(600px, 90vw));
    border-right: var(
      --sheet-border-strong,
      2px solid rgba(255, 255, 255, 0.15)
    );
    border-left: none;
    border-top-right-radius: var(--sheet-radius-large, 20px);
    border-bottom-right-radius: var(--sheet-radius-large, 20px);
    cursor: grab;
  }

  .drawer-content[data-placement="left"].dragging {
    cursor: grabbing;
    user-select: none;
  }

  .drawer-content[data-placement="left"][data-state="closed"] {
    transform: translate3d(-100%, 0, 0);
  }

  .drawer-content[data-placement="left"][data-state="open"] {
    transform: translate3d(0, 0, 0);
  }

  /* Handle - fully self-contained styling */
  /* 
   * The drawer handle is now fully self-contained within this component.
   * All styling variations (placement, layout mode) are handled here.
   * External components should NOT override these styles.
   * 
   * Handle adapts automatically to:
   * - Bottom placement (mobile): horizontal bar at top
   * - Right placement + side-by-side: vertical bar on left edge
   * - Left placement: vertical bar on right edge
   * - Top placement: horizontal bar at bottom
   */
  .drawer-handle {
    position: relative;
    width: 40px;
    height: 4px;
    margin: 10px auto 8px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.3);
    flex-shrink: 0;
  }

  /* Handle for right placement in side-by-side mode - vertical on left edge */
  .drawer-content[data-placement="right"].side-by-side-layout .drawer-handle {
    position: absolute;
    top: 50%;
    left: 18px;
    width: 4px;
    height: 52px;
    margin: 0;
    border-radius: 999px;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.35);
  }

  /* Handle for left placement - vertical on right edge */
  .drawer-content[data-placement="left"] .drawer-handle {
    position: absolute;
    top: 50%;
    right: 18px;
    width: 4px;
    height: 52px;
    margin: 0;
    border-radius: 999px;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.35);
  }

  /* Handle for top placement - horizontal on bottom edge */
  .drawer-content[data-placement="top"] .drawer-handle {
    position: relative;
    width: 40px;
    height: 4px;
    margin: 8px auto 10px;
    order: 1; /* Place below content */
  }

  /* Handle for bottom placement - stays at top (default) */
  .drawer-content[data-placement="bottom"]:not(.side-by-side-layout)
    .drawer-handle {
    position: relative;
    width: 40px;
    height: 4px;
    margin: 10px auto 8px;
  }

  /* Inner content container */
  .drawer-inner {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto;

    /* Contain scroll - don't chain to parent */
    overscroll-behavior-y: contain;
  }

  /* Scrollbar styling */
  .drawer-inner::-webkit-scrollbar {
    width: 8px;
  }

  .drawer-inner::-webkit-scrollbar-track {
    background: transparent;
  }

  .drawer-inner::-webkit-scrollbar-thumb {
    border-radius: 4px;
  }

  .drawer-inner::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
  }

  /* Mobile adjustments */
  @media (max-width: 480px) {
    .drawer-content[data-placement="bottom"] {
      border-top-left-radius: var(--sheet-radius-medium, 16px);
      border-top-right-radius: var(--sheet-radius-medium, 16px);
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .drawer-content {
      background: rgba(0, 0, 0, 0.98);
      border: 2px solid white;
    }

    .drawer-handle {
      background: rgba(255, 255, 255, 0.8);
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .drawer-content,
    .drawer-overlay {
      transition: none;
      animation: none;
    }
  }

  /* ============================================
   * Spring Animation
   * Simulates spring physics with CSS keyframes
   * Creates an iOS-like "bounce" effect on open
   * ============================================ */

  /* Spring timing function - approximates spring physics */
  .drawer-content.spring-animation {
    transition:
      transform 400ms cubic-bezier(0.34, 1.56, 0.64, 1),
      opacity 350ms cubic-bezier(0.32, 0.72, 0, 1);
  }

  /* Spring animation for bottom placement - refined 2026 spring physics */
  .drawer-content.spring-animation[data-placement="bottom"][data-state="open"] {
    animation: spring-slide-up 400ms var(--ease-spring, cubic-bezier(0.34, 1.56, 0.64, 1)) forwards;
  }

  @keyframes spring-slide-up {
    0% {
      transform: translate3d(0, 100%, 0);
    }
    65% {
      transform: translate3d(0, -2%, 0);
    }
    85% {
      transform: translate3d(0, 0.5%, 0);
    }
    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  /* Spring animation for top placement */
  .drawer-content.spring-animation[data-placement="top"][data-state="open"] {
    animation: spring-slide-down 400ms var(--ease-spring, cubic-bezier(0.34, 1.56, 0.64, 1)) forwards;
  }

  @keyframes spring-slide-down {
    0% {
      transform: translate3d(0, -100%, 0);
    }
    65% {
      transform: translate3d(0, 2%, 0);
    }
    85% {
      transform: translate3d(0, -0.5%, 0);
    }
    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  /* Spring animation for right placement */
  .drawer-content.spring-animation[data-placement="right"][data-state="open"] {
    animation: spring-slide-left 400ms var(--ease-spring, cubic-bezier(0.34, 1.56, 0.64, 1)) forwards;
  }

  @keyframes spring-slide-left {
    0% {
      transform: translate3d(100%, 0, 0);
    }
    65% {
      transform: translate3d(-2%, 0, 0);
    }
    85% {
      transform: translate3d(0.5%, 0, 0);
    }
    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  /* Spring animation for left placement */
  .drawer-content.spring-animation[data-placement="left"][data-state="open"] {
    animation: spring-slide-right 400ms var(--ease-spring, cubic-bezier(0.34, 1.56, 0.64, 1)) forwards;
  }

  @keyframes spring-slide-right {
    0% {
      transform: translate3d(-100%, 0, 0);
    }
    65% {
      transform: translate3d(2%, 0, 0);
    }
    85% {
      transform: translate3d(-0.5%, 0, 0);
    }
    100% {
      transform: translate3d(0, 0, 0);
    }
  }

  /* Disable spring animation during drag */
  .drawer-content.spring-animation.dragging {
    animation: none;
    transition: none;
  }

  /* ============================================
   * Background Scale Effect
   * Creates iOS-like depth when drawer opens
   *
   * Usage: Add class "drawer-scale-bg" to the element
   * you want to scale when the drawer opens.
   *
   * Example:
   *   <main class="drawer-scale-bg">...</main>
   *   <Drawer scaleBackground={true}>...</Drawer>
   * ============================================ */

  :global(.drawer-scale-bg) {
    transform-origin: center center;
    transform: scale(var(--drawer-bg-scale, 1));
    border-radius: var(--drawer-bg-border-radius, 0px);
    transition:
      transform 350ms cubic-bezier(0.32, 0.72, 0, 1),
      border-radius 350ms cubic-bezier(0.32, 0.72, 0, 1);
    overflow: hidden;
  }

  /* When drawer is active with scale, add subtle overlay */
  :global(body.drawer-scale-bg-active .drawer-scale-bg) {
    box-shadow:
      0 0 0 1px rgba(0, 0, 0, 0.1),
      0 10px 40px rgba(0, 0, 0, 0.3);
  }

  /* Dark mode variant for background dimming */
  :global(.drawer-scale-bg::after) {
    content: '';
    position: absolute;
    inset: 0;
    background: black;
    opacity: 0;
    pointer-events: none;
    transition: opacity 350ms cubic-bezier(0.32, 0.72, 0, 1);
    z-index: 1;
  }

  :global(body.drawer-scale-bg-active .drawer-scale-bg::after) {
    opacity: 0.15;
  }
