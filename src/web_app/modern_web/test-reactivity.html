<!DOCTYPE html>
<html>
<head>
    <title>Reactivity Test</title>
</head>
<body>
    <div id="test-output"></div>
    <button id="trigger-change">Trigger Change</button>
    
    <script type="module">
        // Simulate the exact runes pattern
        function createTestRunes() {
            let optionsData = $state([]);
            let uiState = $state({ isLoading: true });
            
            console.log('üîß Test runes created, optionsData length:', optionsData.length);
            
            function loadOptions() {
                console.log('üöÄ Test loadOptions called');
                uiState.isLoading = true;
                
                setTimeout(() => {
                    optionsData = [
                        { id: 1, letter: 'A', end_position: 'test1' },
                        { id: 2, letter: 'B', end_position: 'test2' },
                        { id: 3, letter: 'C', end_position: 'test3' }
                    ];
                    uiState.isLoading = false;
                    console.log('üîß Test setting optionsData with', optionsData.length, 'options');
                }, 100);
            }
            
            return {
                get allOptions() {
                    console.log('üîç Test allOptions getter called, returning', optionsData.length, 'options');
                    return optionsData;
                },
                get isLoading() {
                    console.log('üîç Test isLoading getter called, returning', uiState.isLoading);
                    return uiState.isLoading;
                },
                loadOptions
            };
        }
        
        // Simulate the component pattern
        function createTestComponent() {
            const testRunes = createTestRunes();
            let effectiveOptions = $state([]);
            let isLoading = $state(true);
            
            console.log('üîß Test component created');
            
            // Test $effect reactivity
            $effect(() => {
                console.log('üîç Test component $effect called');
                const options = testRunes.allOptions;
                const loading = testRunes.isLoading;
                
                console.log('üîç Test component updating:', {
                    optionsLength: options.length,
                    isLoading: loading
                });
                
                effectiveOptions = options;
                isLoading = loading;
                
                // Update UI
                updateUI();
            });
            
            function updateUI() {
                const output = document.getElementById('test-output');
                output.innerHTML = `
                    <h3>Test Results:</h3>
                    <p>Options: ${effectiveOptions.length}</p>
                    <p>Loading: ${isLoading}</p>
                    <p>Options data: ${JSON.stringify(effectiveOptions)}</p>
                `;
            }
            
            return {
                testRunes,
                effectiveOptions,
                isLoading
            };
        }
        
        // Initialize test
        const testComponent = createTestComponent();
        
        // Add button handler
        document.getElementById('trigger-change').addEventListener('click', () => {
            console.log('üéØ Triggering loadOptions...');
            testComponent.testRunes.loadOptions();
        });
        
        console.log('‚úÖ Test initialized');
    </script>
</body>
</html>
